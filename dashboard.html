<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Coaching & Leadership</title>
    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <style>
        /* --- Base Styles (Enhanced) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f8fafc; margin: 0; padding: 0; line-height: 1.6; color: #374151; display: flex; flex-direction: column; min-height: 100vh; }
        main { flex-grow: 1; display: flex; justify-content: center; align-items: flex-start; flex-direction: column; width: 100%; max-width: 1000px; margin: 20px auto; padding: 0 20px; /* Adjusted padding */ }
        .header { background: linear-gradient(90deg, #2c3e50, #34495e); color: white; padding: 18px 0; text-align: center; font-size: 26px; font-weight: 600; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); width: 100%; border-bottom: 3px solid #3498db; }
        .user-bar { background-color: #ffffff; padding: 12px 30px; display: flex; justify-content: space-between; align-items: center; color: #4b5563; font-size: 15px; width: 100%; border-bottom: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-info svg { color: #3498db; opacity: 1; }
        .user-details-bar { display: flex; flex-direction: column; }
        .user-name-bar { font-weight: 600; font-size: 16px; color: #1f2937; }
        .user-email-bar { font-size: 13px; opacity: 0.8; color: #6b7280; }
        .logout-button { background-color: #ef4444; color: white; border: none; padding: 9px 18px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; }
        .logout-button:hover { background-color: #dc2626; box-shadow: 0 2px 5px rgba(239, 68, 68, 0.3); transform: translateY(-1px); }
        .logout-button:active { transform: translateY(0); }
        .footer { text-align: center; padding: 25px 30px; background: #f9fafb; color: #6b7280; margin-top: auto; font-size: 14px; width: 100%; border-top: 1px solid #e5e7eb; }

        /* --- Dashboard & Admin Container Styles --- */
        .dashboard-container, #adminSection {
            background: white;
            padding: 35px 45px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            width: 100%;
            margin-bottom: 35px; /* Keep margin for spacing */
            text-align: left;
            opacity: 0; /* Initially hidden for fade-in */
            transition: opacity 0.7s ease-in-out;
             border: 1px solid #e5e7eb;
        }
        .dashboard-container.fade-in, #adminSection.fade-in { opacity: 1; }
        .dashboard-container h2 { /* Style for #welcomeMessage */
            color: #1f2937;
            margin-bottom: 25px;
            font-size: 28px;
            font-weight: 600;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 15px;
        }
         .dashboard-user-details {
            background-color: #f9fafb; /* Lighter bg */
            padding: 18px 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 18px;
             border: 1px solid #e5e7eb;
        }
        .dashboard-user-details svg { color: #3b82f6; width: 36px; height: 36px; }
        .dashboard-user-info { font-size: 17px; color: #374151; }
        .dashboard-user-info strong { font-weight: 600; color: #111827; }

        /* --- Course Section Styles --- */
        .course-sections h3 { color: #1f2937; margin-top: 35px; margin-bottom: 20px; font-size: 22px; font-weight: 600; }
        .course-section { background-color: #ffffff; border: 1px solid #e5e7eb; padding: 18px 25px; margin-bottom: 18px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; transition: box-shadow 0.3s ease, transform 0.2s ease, border-color 0.3s ease; flex-wrap: wrap; gap: 15px; }
        .course-section:hover { box-shadow: 0 4px 12px rgba(0,0,0, 0.08); transform: translateY(-2px); border-left: 4px solid #3b82f6; padding-left: 22px; }
        .section-title { font-size: 18px; font-weight: 500; color: #374151; flex-grow: 1; margin-right: 20px; }
        .section-progress { display: flex; align-items: center; gap: 18px; flex-shrink: 0; flex-basis: 300px; }
        .progress-bar-container { width: 160px; height: 12px; background-color: #e5e7eb; border-radius: 6px; overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #60a5fa, #3b82f6); border-radius: 6px; transition: width 0.8s cubic-bezier(0.25, 0.1, 0.25, 1); }
        .progress-text { font-size: 14px; color: #6b7280; min-width: 90px; text-align: right; font-weight: 500; }
        .section-link { background-color: #3b82f6; color: white; padding: 8px 15px; border-radius: 6px; text-decoration: none; font-size: 14px; font-weight: 500; transition: background-color 0.3s, transform 0.2s ease, box-shadow 0.3s ease; white-space: nowrap; }
        .section-link:hover { background-color: #2563eb; transform: translateY(-1px); box-shadow: 0 2px 5px rgba(59, 130, 246, 0.3); }
        /* Button styles for different states */
         .section-link.status-review { background-color: #10b981; }
         .section-link.status-review:hover { background-color: #059669; box-shadow: 0 2px 5px rgba(16, 185, 129, 0.3); }
         .section-link.status-continue { background-color: #f59e0b; }
         .section-link.status-continue:hover { background-color: #d97706; box-shadow: 0 2px 5px rgba(245, 158, 11, 0.3); }

        /* --- Admin Section Styles --- */
        #adminSection {
            background-color: #fef3c7; /* Light yellow for admin */ border: 1px solid #fcd34d; border-radius: 12px;
            padding: 35px 45px; margin-top: 25px; width: 100%; display: none; /* Initially hidden */ opacity: 0;
            transition: opacity 0.7s ease-in-out;
        }
        #adminSection.fade-in { opacity: 1; }
        #adminSection h3 { color: #b45309; /* Dark yellow/brown */ margin-bottom: 25px; font-size: 24px; border-bottom: 2px solid #fcd34d; padding-bottom: 15px; display: flex; align-items: center; gap: 10px; font-weight: 600; }
        #adminSection h3 svg { color: #b45309; }
        .admin-note { font-size: 15px; color: #78350f; background-color: #fffbeb; border: 1px solid #fef08a; padding: 15px 20px; border-radius: 6px; margin-bottom: 30px; line-height: 1.7; }
        .admin-user-table { width: 100%; border-collapse: collapse; margin-top: 20px; table-layout: fixed; }
        .admin-user-table th, .admin-user-table td { border: 1px solid #fde68a; padding: 12px 15px; text-align: left; font-size: 15px; word-wrap: break-word; }
        .admin-user-table th { background-color: #fef9c3; color: #92400e; font-weight: 600; }
        .admin-user-table td { background-color: #fffbeb; color: #374151;}
        .admin-user-table th:nth-child(1) { width: 40%; } /* Section Title */
        .admin-user-table th:nth-child(2) { width: 25%; text-align: center;} /* Progress */
        .admin-user-table th:nth-child(3) { width: 35%; } /* Status */
        .admin-user-table td:nth-child(2) { text-align: center; font-weight: 500;}

         /* Loading Message */
         #loadingMessage { text-align: center; padding: 60px 20px; font-size: 20px; color: #6b7280; width: 100%; }

         /* Responsive Adjustments */
         @media (max-width: 768px) {
             main { padding: 0 15px; margin: 15px auto; }
             .dashboard-container, #adminSection { padding: 25px 30px; }
             .header { font-size: 22px; padding: 15px 0; }
             .user-bar { padding: 10px 20px; }
         }
         @media (max-width: 600px) {
             .dashboard-container, #adminSection { padding: 20px; }
             .course-section { flex-direction: column; align-items: flex-start; padding: 15px; }
             .section-title { margin-right: 0; margin-bottom: 12px; font-size: 17px;}
             .section-progress { flex-basis: auto; width: 100%; justify-content: space-between; gap: 10px; }
             .progress-bar-container { flex-grow: 1; margin-right: 10px; height: 10px; }
             .progress-text { min-width: auto; }
             .section-link { padding: 7px 12px; font-size: 13px; }
             .admin-user-table th, .admin-user-table td { font-size: 14px; padding: 10px; }
         }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">Coaching & Leadership Dashboard</header>

    <!-- User Bar -->
    <div class="user-bar">
        <div class="user-info">
             <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> <circle cx="12" cy="7" r="4"></circle> </svg>
            <div class="user-details-bar">
                <span class="user-name-bar" id="userNameBar">Loading...</span>
                <span class="user-email-bar" id="userEmailBar"></span>
            </div>
        </div>
        <button class="logout-button" onclick="logout()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path> <polyline points="16 17 21 12 16 7"></polyline> <line x1="21" y1="12" x2="9" y2="12"></line> </svg>
            Logout
        </button>
    </div>

    <!-- Main Content Area -->
    <main>
        <div id="loadingMessage">Loading Dashboard...</div>

        <!-- User Dashboard Container -->
        <div class="dashboard-container" id="userDashboardContent" style="display: none;"> <!-- Hidden until logic runs -->
            <h2 id="welcomeMessage">Welcome!</h2>
            <div class="dashboard-user-details">
                 <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                 <div class="dashboard-user-info">
                     Logged in as: <strong id="dashboardUserName">Name</strong> (<span id="dashboardUserEmail">email</span>)
                 </div>
            </div>
            <div class="course-sections">
                <h3>Your Course Progress</h3>
                <div id="courseSectionsList">
                    <!-- Course sections will be loaded here by JS -->
                </div>
            </div>
        </div>

        <!-- Admin-Only Section -->
        <div id="adminSection" style="display: none;"> <!-- Hidden until logic runs -->
             <h3>
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                 Admin Panel - Progress Overview
             </h3>
             <p class="admin-note">
                 <strong>Important Note:</strong> Due to browser limitations (using localStorage), this panel currently only shows the progress data for <strong>your own admin account</strong> (<span id="adminEmailDisplay"></span>). A full implementation displaying *all* users requires a server-side database to store and retrieve everyone's progress centrally.
             </p>
            <div id="adminDataContainer">
                 <p>Loading your progress data...</p>
                 <!-- Admin table will be loaded here by JS -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        © 2025 Elmenisy Leadership Coaching - All Rights Reserved
    </footer>

    <script>
        // --- Constants ---
        const LOGGED_IN_KEY = 'isUserLoggedIn';
        const CURRENT_USER_KEY = 'currentUser';
        const SIGNUP_FLAG_KEY = 'hasSignedUpBefore';
        const ADMIN_EMAIL = 'm.elsayed@thechefz.co'; // Case-insensitive comparison
        const ASSESSMENT_URL = 'Assessment.html'; // URL for the assessment page

        // Course Sections Data
        const courseSections = [
            { id: 'index', title: 'Course Introduction Goal', link: 'index.html' },
            { id: 'article1', title: 'Introduction to Coaching and Leadership', link: 'article1.html' },
            { id: 'skills', title: 'Coaching Skills', link: 'coaching-skills.html' },
            { id: 'individuals', title: 'Coaching Individuals', link: 'coaching-individuals.html' },
            { id: 'team', title: 'Team Coaching', link: 'coaching-team.html' },
            { id: 'self', title: 'Self Coaching', link: 'coaching-yourself.html' },
            { id: 'action', title: 'Action Plan', link: 'action-plan.html' },
        ];

        // --- Global variable for admin status ---
        let IS_ADMIN_USER = false;

        // --- IMMEDIATE REDIRECTION LOGIC ---
        console.log("%cDashboard Page: Running IMMEDIATE redirection check...", "color: purple; font-weight: bold;");
        function quickCheckCurrentUserFormat() {
            const data = localStorage.getItem(CURRENT_USER_KEY);
            return data && data.length > 2 && data.startsWith('{') && data.endsWith('}');
        }
        const isLoggedIn_immediate = localStorage.getItem(LOGGED_IN_KEY) === 'true' && quickCheckCurrentUserFormat();
        const hasSignedUp_immediate = localStorage.getItem(SIGNUP_FLAG_KEY) === 'true';

        if (!isLoggedIn_immediate) {
            const targetUrl = hasSignedUp_immediate ? 'login.html' : 'signup.html';
            console.error(`%cDashboard Page IMMEDIATE Redirect: Not logged in or user data invalid. Redirecting to ${targetUrl}...`, "color: orange;");
            // Redirect to login/signup, passing this page as the intended destination
            window.location.replace(`${targetUrl}?redirect=${encodeURIComponent(window.location.pathname)}`);
            throw new Error("Redirecting user: Not logged in or invalid user data."); // Stop script execution
        } else {
            console.log("%cDashboard Page IMMEDIATE Check: User IS logged in. Proceeding.", "color: green;");
            // Further check for assessment completion will happen after DOM load
        }
        // --- END IMMEDIATE REDIRECTION ---


        document.addEventListener('DOMContentLoaded', function() {
            console.log("Dashboard page DOM loaded.");

            // --- Element References ---
            const loadingMessage = document.getElementById('loadingMessage');
            const userDashboardContent = document.getElementById('userDashboardContent');
            const adminSection = document.getElementById('adminSection');

            // Get current user data
            const currentUser = getCurrentUser();

            if (!currentUser) {
                console.error("Dashboard DOMContentLoaded: Critical - User data missing/invalid after initial check. Forcing logout.");
                logout(); // Force logout if user data became invalid between checks
                return; // Stop further execution
            }

            console.log("Current User Data (Dashboard):", currentUser);

            // *** Determine if the current user is the admin ***
            IS_ADMIN_USER = currentUser.email.toLowerCase() === ADMIN_EMAIL.toLowerCase();
            console.log(`User is admin: ${IS_ADMIN_USER}`);

            // Populate user info in the top bar immediately
            populateTopBar(currentUser);

            // --- Assessment Check ---
            if (!currentUser.assessmentCompleted) {
                console.warn("Assessment not completed. Redirecting to Assessment page.");
                // Redirect to assessment page if not completed
                window.location.replace(ASSESSMENT_URL);
            } else {
                console.log("Assessment completed. Displaying main dashboard.");
                // Proceed to display the dashboard content
                displayMainDashboard(currentUser);
            }
        });


        // --- Helper Functions ---

        function getCurrentUser() {
            try {
                const userData = localStorage.getItem(CURRENT_USER_KEY);
                if (!userData) {
                    console.warn("getCurrentUser: No current user data found.");
                    return null;
                }
                const parsedUser = JSON.parse(userData);

                // Basic validation of parsed object structure
                if (parsedUser && typeof parsedUser === 'object' && parsedUser.name && parsedUser.email) {
                    let dataUpdated = false; // Flag to check if data was modified

                    // Initialize assessment status if needed (safety check)
                    if (parsedUser.assessmentCompleted === undefined) {
                        parsedUser.assessmentCompleted = false; dataUpdated = true;
                    }
                     // Initialize progress if needed (should exist if assessment is complete, but good check)
                     if (typeof parsedUser.progress !== 'object' || parsedUser.progress === null) {
                         parsedUser.progress = {}; dataUpdated = true;
                     }
                     // Ensure progress exists for all defined sections (crucial for dashboard display)
                     courseSections.forEach(section => {
                         if (parsedUser.progress[section.id] === undefined || parsedUser.progress[section.id] === null) {
                             // Initialize progress to 0 for any missing section
                             parsedUser.progress[section.id] = 0; dataUpdated = true;
                         }
                     });

                    // Save only if data structure was actually modified
                    if (dataUpdated) {
                        console.log("User data structure updated, saving...");
                        saveCurrentUser(parsedUser);
                    }
                    return parsedUser;
                } else {
                    console.error("getCurrentUser: Parsed user data is invalid.", parsedUser);
                    logout(); // Force logout if data is bad
                    return null;
                }
            } catch (error) {
                console.error("Error parsing current user data:", error);
                logout(); // Force logout on parsing error
                return null;
            }
        }

        function saveCurrentUser(userObject) {
             try {
                 if (!userObject || typeof userObject !== 'object') { throw new Error("Invalid user object."); }
                 localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userObject));
                 console.log("Saved user data to localStorage:", userObject);
             } catch (error) {
                 console.error("Error saving current user data:", error);
             }
        }

        function populateTopBar(user) {
            const userNameBar = document.getElementById('userNameBar');
            const userEmailBar = document.getElementById('userEmailBar');
            if (userNameBar) userNameBar.textContent = user.name;
            if (userEmailBar) userEmailBar.textContent = user.email;
        }

        function displayMainDashboard(user) {
            console.log("Displaying main dashboard content.");
            const loadingMessage = document.getElementById('loadingMessage');
            const userDashboardContent = document.getElementById('userDashboardContent');
            const adminSection = document.getElementById('adminSection');
            const adminDataContainer = document.getElementById('adminDataContainer');
            const courseSectionsList = document.getElementById('courseSectionsList');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const dashboardUserName = document.getElementById('dashboardUserName');
            const dashboardUserEmail = document.getElementById('dashboardUserEmail');

            // Hide loading message first
            loadingMessage.style.display = 'none';

             // Populate User Info in Dashboard Area
             if (welcomeMessage) welcomeMessage.textContent = `Welcome back, ${user.name}!`;
             if (dashboardUserName) dashboardUserName.textContent = user.name;
             if (dashboardUserEmail) dashboardUserEmail.textContent = user.email;

            // Display Course Sections for the user
            if (courseSectionsList) {
                displayCourseSections(user, courseSectionsList);
            } else {
                 console.error("Course sections list container not found!");
            }

            // Show User Dashboard Content & Apply Fade-in
            if (userDashboardContent) {
                userDashboardContent.style.display = 'block';
                setTimeout(() => userDashboardContent.classList.add('fade-in'), 50); // Short delay for smooth transition
            } else {
                console.error("User dashboard content container not found!");
            }

            // Check for Admin Access (using global IS_ADMIN_USER determined earlier)
            if (IS_ADMIN_USER) {
                console.log("Admin user detected. Displaying admin panel.");
                const adminEmailDisplay = document.getElementById('adminEmailDisplay');
                 if(adminEmailDisplay) adminEmailDisplay.textContent = user.email;

                if (adminSection) {
                     // Display Admin-specific Data (e.g., progress table for the admin's own account)
                     if (adminDataContainer) {
                         displayAdminData(user, adminDataContainer);
                     } else {
                         console.error("Admin data container not found!");
                         if(adminSection.querySelector('p')) adminSection.querySelector('p').textContent = "Error loading admin data container."; // Show error in UI
                     }
                     // Show the admin section container and fade it in
                     adminSection.style.display = 'block';
                     setTimeout(() => adminSection.classList.add('fade-in'), 100); // Slightly later fade-in for effect
                 } else {
                     console.error("Admin section container not found!");
                 }
            } else {
                 console.log("Regular user detected. Admin panel remains hidden.");
                 if (adminSection) adminSection.style.display = 'none'; // Ensure it's hidden
            }
        }

        function displayCourseSections(user, containerElement) {
            // Ensure user and container are valid, and user has progress data
            if (!user || !containerElement) { console.error("Invalid user or container for course sections."); return; }
            if (!user.progress) {
                 console.error("User progress data is missing!");
                 containerElement.innerHTML = '<p style="color: red;">Error: Could not load course progress.</p>';
                 return;
             }

            containerElement.innerHTML = ''; // Clear previous content

            courseSections.forEach(section => {
                // Safely get progress, default to 0 if undefined/null
                const progress = user.progress[section.id] || 0;
                // Clamp progress between 0 and 100
                const progressPercentage = Math.max(0, Math.min(100, Math.round(progress)));

                const sectionElement = document.createElement('div');
                sectionElement.className = 'course-section';

                // Determine button text and style based on progress
                let buttonText = 'Start';
                let buttonClass = '';
                if (progressPercentage >= 100) {
                    buttonText = 'Review';
                    buttonClass = 'status-review';
                } else if (progressPercentage > 0) {
                    buttonText = 'Continue';
                    buttonClass = 'status-continue';
                }

                sectionElement.innerHTML = `
                    <span class="section-title">${section.title}</span>
                    <div class="section-progress">
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: 0%;"></div> <!-- Start at 0% width -->
                        </div>
                        <span class="progress-text">${progressPercentage}% Complete</span>
                        <a href="${section.link || '#'}" class="section-link ${buttonClass}" title="Go to ${section.title}">${buttonText}</a>
                    </div>
                `;

                containerElement.appendChild(sectionElement);

                 // Animate progress bar after element is added to DOM
                 // Use requestAnimationFrame for potentially smoother rendering, or setTimeout
                 const progressBar = sectionElement.querySelector('.progress-bar');
                 setTimeout(() => {
                     if (progressBar) { // Check if element still exists
                         progressBar.style.width = `${progressPercentage}%`;
                     }
                 }, 100); // Small delay to allow rendering before transition starts
            });
        }

         function displayAdminData(adminUser, containerElement) {
             if (!containerElement) { console.error("Admin container element not found."); return; }
             // Ensure admin user data and progress exist
             if (!adminUser || !adminUser.progress) {
                 containerElement.innerHTML = '<p style="color: red;">Error: Could not load your progress data for the admin view.</p>';
                 return;
             }

             // Build the HTML table for the admin's own progress
             let tableHTML = `
                <p style="font-weight: 500;">Displaying progress for your account (${adminUser.email}):</p>
                <table class="admin-user-table">
                    <thead>
                        <tr>
                            <th>Section</th>
                            <th>Progress (%)</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>`;

             courseSections.forEach(section => {
                 const progress = adminUser.progress[section.id] || 0; // Default to 0
                 const progressPercentage = Math.max(0, Math.min(100, Math.round(progress)));
                 let status = 'Not Started';
                 if (progressPercentage >= 100) {
                     status = 'Completed';
                 } else if (progressPercentage > 0) {
                     status = 'In Progress';
                 }
                 // Append a row for each course section
                 tableHTML += `<tr><td>${section.title}</td><td>${progressPercentage}%</td><td>${status}</td></tr>`;
             });

             tableHTML += `
                    </tbody>
                </table>
                <p style="margin-top: 20px; font-size: 14px; color: #78350f;"><em>Reminder: This table shows only *your* data due to technical limitations (localStorage). A full admin view requires a server backend.</em></p>`;

             // Set the inner HTML of the container
             containerElement.innerHTML = tableHTML;
         }

        function logout() {
            console.log("Logging out user from Dashboard page...");
            try {
                localStorage.removeItem(LOGGED_IN_KEY);
                localStorage.removeItem(CURRENT_USER_KEY);
                IS_ADMIN_USER = false; // Reset global flag
                console.log("Local storage cleared for logout.");
                // Redirect to login page, do not add dashboard to history
                window.location.replace('login.html');
            } catch (e) {
                console.error("Error during logout:", e);
                 // Fallback redirect
                 window.location.replace('login.html');
            }
        }
    </script>
</body>
</html>
