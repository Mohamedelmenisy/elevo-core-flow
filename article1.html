<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introduction to Coaching & Leadership</title>
    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <style>
        /* --- Global Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html {
            scroll-behavior: smooth; /* Smooth scroll for anchors/focus */
        }

        body {
            margin: 0;
            padding: 0;
            line-height: 1.7; /* Slightly increased line-height for readability */
            background-color: #f8f9fa; /* Lighter background */
            color: #343a40; /* Darker text */
        }

        /* --- User Bar Styles --- */
        .user-bar {
            background-color: #34495e;
            padding: 10px 20px; /* Adjusted padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-size: 14px; /* Slightly smaller base font */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px; /* Adjusted gap */
        }
        .user-info svg {
             opacity: 0.8; /* Moved from inline style */
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .user-email {
            font-size: 12px;
            opacity: 0.8;
        }

        .logout-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px; /* Adjusted padding */
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px; /* Adjusted font size */
        }

        .logout-button:hover {
            background-color: #c0392b;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logout-button:active {
            transform: translateY(0);
        }

        /* --- Navigation Tabs --- */
        .nav-tab {
            background-color: #2c3e50;
            padding: 12px 10px; /* Increased padding slightly */
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            overflow-x: auto; /* Allow horizontal scrolling on small screens */
            white-space: nowrap; /* Prevent tabs from wrapping */
            -webkit-overflow-scrolling: touch; /* Smoother scrolling on iOS */
            scrollbar-width: thin; /* Firefox scrollbar */
            scrollbar-color: #556a80 #2c3e50; /* Firefox scrollbar color */
        }
        /* Webkit scrollbar styles */
        .nav-tab::-webkit-scrollbar {
            height: 6px;
        }
        .nav-tab::-webkit-scrollbar-track {
            background: #2c3e50;
        }
        .nav-tab::-webkit-scrollbar-thumb {
            background-color: #556a80;
            border-radius: 10px;
            border: 1px solid #2c3e50;
        }


        .nav-tab a {
            color: white;
            text-decoration: none;
            margin: 0 8px; /* Adjusted margin */
            padding: 8px 12px; /* Adjusted padding */
            border-radius: 6px;
            transition: background-color 0.3s, color 0.3s;
            font-size: 14px; /* Consistent font size */
            display: inline-block; /* Ensure padding and margin work correctly */
        }

        .nav-tab a:hover,
        .nav-tab a.active { /* Add an 'active' class potentially */
            background-color: #4e6a85;
            color: #fff;
        }

        /* --- Main Content Styles --- */
        h1 {
            color: #fff;
            background: linear-gradient(90deg, #e67e22, #d35400); /* Gradient background */
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 25px auto;
            max-width: 800px;
            font-size: 26px; /* Adjusted font size */
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .container {
            max-width: 800px;
            margin: 25px auto; /* Consistent margin */
            background: white;
            padding: 30px; /* Increased padding */
            box-shadow: 0 4px 15px rgba(0,0,0,0.07); /* Softer shadow */
            border-radius: 8px; /* Rounded corners */
        }

        .quote {
            font-style: italic;
            border-left: 5px solid #e67e22; /* Thicker border */
            padding: 15px 20px;
            background-color: #fff8f0; /* Lighter background for quote */
            margin: 25px 0; /* Consistent vertical margin */
            color: #555;
            font-size: 15px; /* Adjusted font size */
        }

        .image-container {
            text-align: center;
            margin: 30px 0; /* Increased margin */
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px; /* Match container radius */
            border: 1px solid #eee; /* Subtle border */
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        .image-container p { /* Caption style */
             font-size: 14px;
             color: #777;
             margin-top: 10px;
             font-style: italic;
        }

        .tip-box, .action-box {
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .tip-box strong, .action-box strong {
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .tip-box { background: linear-gradient(135deg, #3498db, #2980b9); }
        .action-box { background: linear-gradient(135deg, #f39c12, #e67e22); } /* Adjusted action box color */

        .question-box {
            background-color: #fdfefe; /* Lighter background */
            padding: 25px;
            border-radius: 8px;
            margin: 25px 0;
            border: 1px solid #e9ecef; /* Subtle border */
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .question-box h3 {
            margin-bottom: 15px;
            color: #34495e;
            font-size: 18px;
        }

        textarea, input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            margin-top: 8px;
            margin-bottom: 10px;
            resize: vertical;
            min-height: 100px;
            font-size: 15px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
         textarea:focus, input[type="text"]:focus {
             border-color: #80bdff;
             outline: 0;
             box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
         }

        /* Table Styles (if used later) */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            font-size: 14px;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        table th, table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        /* Highlighted Sections */
        .highlight-section, .skills-list, .ei-elements, .trust-methods {
            padding: 25px;
            border-left-width: 5px; /* Thicker border */
            border-radius: 8px;
            margin: 25px 0;
            font-size: 15px;
        }
        .highlight-section { background-color: #eaf5ff; border-left-color: #3498db; }
        .skills-list { background-color: #e8f8f0; border-left-color: #2ecc71; }
        .ei-elements { background-color: #f4ecf7; border-left-color: #9b59b6; }
        .trust-methods { background-color: #eaf2f8; border-left-color: #2980b9; }

        .skills-list ul {
            margin-top: 10px;
            margin-left: 20px;
            list-style: disc; /* Ensure bullets are visible */
        }
        .skills-list li {
            margin-bottom: 8px; /* Space between list items */
        }

        /* Buttons */
        .save-button, .delete-button {
            color: white;
            border: none;
            padding: 8px 15px; /* Slightly larger padding */
            border-radius: 6px;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .save-button { background-color: #28a745; } /* Bootstrap green */
        .delete-button { background-color: #dc3545; margin-left: 10px;} /* Bootstrap red */

        .save-button:hover { background-color: #218838; transform: translateY(-1px); }
        .delete-button:hover { background-color: #c82333; transform: translateY(-1px); }

        .button-group {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .save-status {
            font-size: 13px;
            color: #28a745;
            margin-left: 10px;
            font-weight: 500;
            display: none; /* Hidden by default */
        }
        .save-status.deleted { /* Style for delete message */
             color: #6c757d; /* Grey color for delete */
        }

        .error-message {
            color: #dc3545;
            font-size: 13px;
            margin-left: 10px;
            font-weight: 500;
            display: none; /* Hidden by default */
        }

        /* Required Field Indication */
        .required-field {
            border-color: #dc3545 !important;
            background-color: #fbeeed !important; /* Lighter red background */
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important; /* Focus-like shadow */
            /* Removed pulse animation - can be distracting */
        }

        /* Navigation Buttons (Bottom) */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px; /* Increased space */
            gap: 15px; /* Gap between buttons */
            border-top: 1px solid #eee; /* Separator line */
            padding-top: 25px;
        }

        .navigation-buttons a {
            text-decoration: none;
            padding: 12px 20px; /* Increased padding */
            color: white;
            background: linear-gradient(90deg, #e67e22, #d35400); /* Match h1 style */
            border-radius: 6px;
            font-weight: 600; /* Bold text */
            flex: 1;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 15px;
        }

        .navigation-buttons a:hover {
            background: linear-gradient(90deg, #d35400, #e67e22);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
         .navigation-buttons a:first-child { /* Style for back button */
            background: #6c757d; /* Grey background for back */
         }
         .navigation-buttons a:first-child:hover {
            background: #5a6268;
         }


        /* Floating Warning Message */
        .floating-warning {
            background-color: #fff3cd; /* Bootstrap warning background */
            border-left: 5px solid #ffc107; /* Bootstrap warning border */
            padding: 15px 25px;
            color: #856404; /* Bootstrap warning text */
            display: none; /* Hidden by default */
            position: fixed;
            top: 75px; /* Adjusted position */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001; /* Ensure it's above sticky nav */
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            animation: slideDownFadeIn 0.4s ease-out;
            font-weight: 500;
            max-width: 90%; /* Limit width on mobile */
            text-align: center;
        }

        @keyframes slideDownFadeIn {
            from { opacity: 0; top: 50px; }
            to { opacity: 1; top: 75px; }
        }

        @keyframes fadeOutUp {
            from { opacity: 1; top: 75px;}
            to { opacity: 0; top: 50px;}
        }

        /* Highlight class for text */
        .highlight {
            color: #e67e22;
            font-weight: bold;
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            h1 {
                font-size: 22px; /* Smaller h1 on mobile */
                padding: 15px;
                margin: 20px 15px; /* Add side margin */
            }
            .container {
                padding: 20px; /* Reduced padding */
                margin: 20px 15px; /* Add side margin */
            }
             .user-bar {
                padding: 10px 15px; /* Reduce padding */
                font-size: 13px;
            }
            .user-name { font-size: 13px; }
            .user-email { font-size: 11px; }
            .logout-button { padding: 7px 12px; font-size: 12px; }

            .nav-tab { padding: 10px 5px; } /* Slightly less padding */
            .nav-tab a { margin: 0 5px; padding: 7px 10px; font-size: 13px;}

            .quote, .tip-box, .action-box, .question-box, .highlight-section, .skills-list {
                 padding: 15px;
                 margin: 20px 0;
             }
             .question-box h3 { font-size: 16px;}
             textarea, input[type="text"] { font-size: 14px; min-height: 80px;}

             .navigation-buttons {
                 flex-direction: column; /* Stack buttons on small screens */
                 padding-top: 20px;
                 margin-top: 30px;
             }
             .navigation-buttons a { font-size: 14px; padding: 12px 15px;}

             .floating-warning {
                 padding: 12px 20px;
                 font-size: 14px;
                 top: 65px; /* Adjust if nav height changes */
                 width: calc(100% - 30px); /* Adjust width */
                 max-width: 400px; /* Max width */
             }
              @keyframes slideDownFadeIn {
                 from { opacity: 0; top: 45px; }
                 to { opacity: 1; top: 65px; }
             }
             @keyframes fadeOutUp {
                 from { opacity: 1; top: 65px;}
                 to { opacity: 0; top: 45px;}
             }
        }

    </style>
</head>
<body>
    <!-- User Info Bar -->
    <header class="user-bar">
        <div class="user-info">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <div class="user-details">
                <span class="user-name" id="userName">Welcome back</span>
                <span class="user-email" id="userEmail">user@example.com</span>
            </div>
        </div>
        <button class="logout-button" onclick="logout()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
        </button>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tab">
        <a href="index.html">Home</a>
        <a href="article1.html" class="active">Article 1</a> <!-- Add 'active' class for current page -->
        <a href="coaching-skills.html">Coaching Skills</a>
        <a href="coaching-individuals.html">Coaching Individuals</a>
        <a href="coaching-team.html">Team Coaching</a>
        <a href="coaching-yourself.html">Self Coaching</a>
        <a href="action-plan.html">Action Plan</a> <!-- ** NEW TAB ADDED ** -->
    </nav>

    <main>
        <h1>Introduction to Coaching & Leadership</h1>

        <div class="floating-warning" id="warningMessage">
            <strong>Action Required:</strong> Please complete all required questions before proceeding.
        </div>

        <div class="container">
            <div class="highlight-section">
                <p>Coaching skills are a valuable asset for any manager. A study by Deloitte found that leaders who frequently coached their teams improved their business results by <span class="highlight">21 percent</span>. So, it's no surprise that an increasing number of workplaces consider coaching to be a worthwhile investment. In a survey by the Conference Board Council, 61 percent of the participating organizations used some form of internal coaching.</p>
            </div>

            <div class="quote">
                <p>"I haven't got time for coaching! And who needs it, anyway?"</p>
                <p>If this is your first reaction to what might feel like just another burdensome task, read on. Coaching is an investment that pays dividends.</p>
            </div>

            <div class="image-container">
                 <!-- ** NEW IMAGE ** (Source: Unsplash - Jason Goodman) -->
                 <img src="https://images.unsplash.com/photo-1556761175-5973dc0f32e7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1032&q=80"
                      alt="Diverse team members collaborating around a laptop in a modern office setting, representing coaching and teamwork."
                      onerror="this.onerror=null; this.src='https://via.placeholder.com/800x450/ffa726/ffffff?text=Coaching+Illustration';">
                 <p>Effective coaching fosters collaboration, improves performance, and supports individual growth.</p>
            </div>

            <h2>The Impact of Coaching</h2>
            <p>One reason for this increase is that people who receive coaching can reap considerable benefits. Research by PwC found that, of the participants who had received coaching:</p>

            <ul>
                <li><strong>80%</strong> had increased self-confidence.</li>
                <li><strong>73%</strong> had improved relationships.</li>
                <li><strong>72%</strong> had improved communication skills.</li>
                <li><strong>67%</strong> reported a better work-life balance.</li>
            </ul>

            <p>Numbers like these will likely appeal to any leader, in any industry! But, despite the evidence that effective coaching can make a difference, most managers have very little training in how to do it. The good news is that <span class="highlight">coaching is a skill that you can learn</span>.</p>

            <h2 class="highlight">What Will Coaching Do for Me and My Team?</h2>

            <p>We'll tell you right now, coaching isn't always easy – at least, not if you want to do it well. However, it can be a rewarding and inspiring experience, especially when you see your team members develop and succeed. When you coach effectively, you may find that your job satisfaction increases, too, and you have a deeper sense of purpose and meaning at work. What's more, you'll likely strengthen your relationship with your team, building trust and rapport.</p>

            <div class="skills-list">
                <p><strong>This course will guide you through the essential coaching skills. You will learn:</strong></p>
                <ul>
                    <li>How to develop core coaching competencies like active listening, powerful questioning, emotional intelligence, and building trust.</li>
                    <li>Effective frameworks and techniques for coaching individual team members towards their goals.</li>
                    <li>Strategies for fostering a coaching culture and coaching your team collectively.</li>
                    <li>Techniques for applying coaching principles to your own development (self-coaching).</li>
                    <li>How to create a practical action plan to implement your learnings.</li>
                </ul>
            </div>

            <p>By working through the exercises in each section, you'll gain a deeper understanding of the topic and reinforce what you've learned. But first, let's address those time pressures. Consider how a small investment now in effective, targeted coaching can save you and your team large amounts of time and effort in the future. Purpose and enthusiasm will grow, errors will decrease, and loyalty and collaboration will build. And you'll likely find yourself dealing with less conflict, and delegating more effectively.</p>

            <div class="tip-box">
                <strong>TIP: Assess Your Skills</strong><br>
                For more insight into your current coaching skills, and for advice and guidance on how to develop your people effectively, consider taking an online assessment or reflecting on past experiences where you've guided others. (Placeholder for potential link/quiz)
            </div>

            <div class="action-box">
                <strong>ACTION: Prioritize Your Time</strong><br>
                Effective coaching requires dedicated time. Explore time management techniques (like time blocking or prioritization matrices) to carve out space for these important conversations. Protect this time to focus on developing your team.
            </div>

            <!-- Interactive Questions -->
            <h2 style="margin-top: 40px;">Reflection Questions</h2>

            <!-- Question 1 -->
            <div class="question-box">
                <h3>1. In your opinion, what are the top 3 qualities or behaviors of a great coach? <span class="highlight">*</span></h3>
                <label for="q1" class="sr-only">Answer for question 1</label> <!-- Accessibility -->
                <textarea id="q1" placeholder="e.g., Active listening, empathy, providing constructive feedback..." class="required-answer" data-question="q1" aria-describedby="error-q1"></textarea>
                <div class="button-group">
                    <button class="save-button" onclick="saveAnswer('q1', 'save-status-q1', 'error-q1')">Save</button>
                    <button class="delete-button" onclick="deleteAnswer('q1', 'save-status-q1', 'error-q1')">Delete</button>
                    <span class="save-status" id="save-status-q1">✓ Saved</span>
                    <span class="error-message" id="error-q1">This field is required.</span>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="question-box">
                <h3>2. Reflecting on the qualities above, which coaching skills do you believe you already possess or use effectively? <span class="highlight">*</span></h3>
                 <label for="q2" class="sr-only">Answer for question 2</label>
                <textarea id="q2" placeholder="Be specific, e.g., 'I am good at giving clear instructions' or 'I try to listen without interrupting'..." class="required-answer" data-question="q2" aria-describedby="error-q2"></textarea>
                <div class="button-group">
                    <button class="save-button" onclick="saveAnswer('q2', 'save-status-q2', 'error-q2')">Save</button>
                    <button class="delete-button" onclick="deleteAnswer('q2', 'save-status-q2', 'error-q2')">Delete</button>
                    <span class="save-status" id="save-status-q2">✓ Saved</span>
                    <span class="error-message" id="error-q2">This field is required.</span>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="question-box">
                <h3>3. Which 1-2 coaching skills mentioned in the course outline (or from your list in Q1) would you most like to develop further? <span class="highlight">*</span></h3>
                 <label for="q3" class="sr-only">Answer for question 3</label>
                <textarea id="q3" placeholder="e.g., Asking more open-ended questions, building trust faster..." class="required-answer" data-question="q3" aria-describedby="error-q3"></textarea>
                <div class="button-group">
                    <button class="save-button" onclick="saveAnswer('q3', 'save-status-q3', 'error-q3')">Save</button>
                    <button class="delete-button" onclick="deleteAnswer('q3', 'save-status-q3', 'error-q3')">Delete</button>
                    <span class="save-status" id="save-status-q3">✓ Saved</span>
                    <span class="error-message" id="error-q3">This field is required.</span>
                </div>
            </div>
            <p style="font-size: 13px; color: #6c757d; margin-top: 5px;"><span class="highlight">*</span> Required field</p>


            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <a href="index.html" class="nav-button">← Back to Home</a>
                <a href="coaching-skills.html" class="nav-button" id="nextButton">Next: Core Coaching Skills →</a>
            </div>
        </div><!-- /.container -->
    </main>

    <script>
        // --- Configuration ---
        const formspreeEndpoint = 'https://formspree.io/f/xzzeqvea'; // Your Formspree Endpoint URL
        const localStorageKeyPrefix = 'courseAnswers_'; // Prefix for keys
        const currentPageKey = 'article1'; // Specific key part for this page
        const localStorageKey = `${localStorageKeyPrefix}${currentPageKey}`; // Full key: courseAnswers_article1
        const currentUserKey = 'currentUser'; // Key for storing the whole user object

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
             // 1. Check Login Status & Get User Info
            const currentUser = getCurrentUser();
            if (!currentUser || !currentUser.email) {
                console.error("User not logged in or email missing.");
                // Redirect to login, maybe with a message
                 window.location.href = `login.html?redirect=${encodeURIComponent(window.location.pathname)}`;
                return; // Stop execution
            }

            // 2. Display User Info
            displayUserInfo(currentUser);

            // 3. Load saved answers for this user
            loadUserAnswers(currentUser.email);

            // 4. Setup interactive elements
            setupEventListeners(currentUser.email);

            // 5. Highlight active nav tab (Optional but good UX)
             highlightActiveNav();
        });

        // --- User Info & Authentication ---
        function getCurrentUser() {
            try {
                const userDataString = localStorage.getItem(currentUserKey);
                return userDataString ? JSON.parse(userDataString) : null;
            } catch (error) {
                console.error("Error parsing user data from localStorage:", error);
                return null; // Handle potential parsing error
            }
        }

        function displayUserInfo(user) {
            document.getElementById('userName').textContent = `Welcome, ${user.name || 'User'}`;
            document.getElementById('userEmail').textContent = user.email;
        }

        function logout() {
            localStorage.removeItem('loggedIn'); // From previous login logic
            localStorage.removeItem(currentUserKey);
            // Optional: Clear all answers for this user across all pages?
            // clearAllUserAnswers(getCurrentUser()?.email); // Be cautious with this
            window.location.href = 'login.html';
        }

        function highlightActiveNav() {
             const currentPath = window.location.pathname.split('/').pop(); // Get 'article1.html'
             const navLinks = document.querySelectorAll('.nav-tab a');
             navLinks.forEach(link => {
                 if (link.getAttribute('href') === currentPath) {
                     link.classList.add('active');
                 } else {
                     link.classList.remove('active');
                 }
             });
         }


        // --- Answer Handling (Local Storage) ---
        function loadUserAnswers(userEmail) {
             if (!userEmail) return; // Safety check

             const allAnswers = JSON.parse(localStorage.getItem(localStorageKey)) || {};
             const userAnswers = allAnswers[userEmail] || {};
             let allRequiredFilled = true; // Track initial state

             document.querySelectorAll('.required-answer').forEach(field => {
                 const questionId = field.getAttribute('data-question');
                 const savedAnswer = userAnswers[questionId]; // Can be '', undefined, or a string

                 if (savedAnswer !== undefined) { // Answer exists in storage (could be empty string)
                     field.value = savedAnswer;
                     field.classList.remove('required-field'); // Remove error style if previously shown
                     hideError(`error-${questionId}`); // Hide error message

                     // Show saved status only if the answer is not empty
                     if (savedAnswer.trim() !== '') {
                          showSaveStatus(`save-status-${questionId}`, '✓ Saved');
                     } else {
                          // If saved answer is empty, it doesn't count as filled for validation
                          allRequiredFilled = false;
                     }
                 } else {
                     // No answer saved for this question
                     field.value = '';
                     allRequiredFilled = false; // Mark as not filled
                     // Don't add 'required-field' class on load, only on validation fail
                 }
             });
             console.log("Initial load - All required filled:", allRequiredFilled);
        }


        function saveAnswerToStorage(userEmail, questionId, answer) {
            if (!userEmail) return;
            const allAnswers = JSON.parse(localStorage.getItem(localStorageKey)) || {};
            if (!allAnswers[userEmail]) {
                allAnswers[userEmail] = {};
            }
            allAnswers[userEmail][questionId] = answer; // Save the answer (could be empty string)
            try {
                localStorage.setItem(localStorageKey, JSON.stringify(allAnswers));
                return true; // Indicate success
            } catch (error) {
                 console.error("Error saving to localStorage:", error);
                 // Handle potential quota exceeded error
                 alert("Could not save answer. Browser storage might be full.");
                 return false; // Indicate failure
            }
        }

        function deleteAnswerFromStorage(userEmail, questionId) {
            if (!userEmail) return;
             const allAnswers = JSON.parse(localStorage.getItem(localStorageKey)) || {};
             let updated = false;
             if (allAnswers[userEmail] && allAnswers[userEmail][questionId] !== undefined) {
                 delete allAnswers[userEmail][questionId];
                 updated = true;
                 // Optional: remove user entry if no answers left for this page
                 if (Object.keys(allAnswers[userEmail]).length === 0) {
                     delete allAnswers[userEmail];
                 }
             }
             if(updated) {
                try {
                    localStorage.setItem(localStorageKey, JSON.stringify(allAnswers));
                    return true; // Indicate success
                } catch (error) {
                    console.error("Error saving to localStorage after delete:", error);
                    alert("Could not update storage after deleting answer.");
                    return false; // Indicate failure
                }
             }
             return false; // Indicate nothing was deleted
        }

        // --- Event Listeners Setup ---
        function setupEventListeners(userEmail) {
            // --- Auto-save attempt on input (optional, use with debounce if enabling) ---
            /*
            document.querySelectorAll('.required-answer').forEach(field => {
                let debounceTimer;
                field.addEventListener('input', function() {
                    clearTimeout(debounceTimer);
                    const currentField = this;
                    const questionId = currentField.getAttribute('data-question');
                    const answer = currentField.value; // Save immediately, even if empty during typing
                    const statusId = `save-status-${questionId}`;
                    const errorId = `error-${questionId}`;

                    // Indicate typing/saving maybe?
                    // showSaveStatus(statusId, '...');

                    debounceTimer = setTimeout(() => {
                        if (saveAnswerToStorage(userEmail, questionId, answer)) {
                            // Minimal feedback on auto-save to avoid annoyance
                            console.log(`Autosaved q${questionId}`);
                            if (answer.trim() !== '') {
                                currentField.classList.remove('required-field');
                                hideError(errorId);
                            }
                        }
                        // Consider showing a persistent 'unsaved changes' indicator instead
                    }, 1000); // Debounce for 1 second
                });
            });
            */


            // --- Next Button Validation ---
            const nextButton = document.getElementById('nextButton');
             if(nextButton) {
                 nextButton.addEventListener('click', function(e) {
                    if (!validateAllAnswers(true)) { // Pass true to show errors immediately
                        e.preventDefault(); // Stop navigation
                        showWarningMessage();
                    }
                 });
             } else {
                  console.warn("Next button not found on this page.");
             }
        }

        // --- UI Feedback & Validation ---
        function validateAllAnswers(showErrors = false) {
            let allAnswered = true;
            console.log("Validating answers..."); // Debug log
            document.querySelectorAll('.required-answer').forEach(field => {
                const questionId = field.getAttribute('data-question');
                const errorId = `error-${questionId}`;
                if (field.value.trim() === '') {
                    allAnswered = false;
                    console.log(`Question ${questionId} is empty.`); // Debug log
                    if (showErrors) {
                        field.classList.add('required-field');
                        showError(errorId, field); // Show error message immediately
                    }
                } else {
                    field.classList.remove('required-field');
                    hideError(errorId); // Hide error if previously shown
                }
            });
            console.log("Validation result:", allAnswered); // Debug log
            return allAnswered;
        }

        function showWarningMessage() {
            const warningElement = document.getElementById('warningMessage');
            warningElement.style.display = 'block';
            warningElement.style.animation = 'slideDownFadeIn 0.4s ease-out';

            // Scroll to the first empty required field
            const firstEmptyField = document.querySelector('.required-answer.required-field');
            if (firstEmptyField) {
                firstEmptyField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Add a slight delay before focus to allow scroll to finish
                setTimeout(() => firstEmptyField.focus({ preventScroll: true }), 500);
            }

            // Auto-hide the warning message
            setTimeout(() => {
                warningElement.style.animation = 'fadeOutUp 0.5s ease-out forwards';
                 setTimeout(() => {
                      warningElement.style.display = 'none';
                      warningElement.style.animation = ''; // Reset animation
                 }, 500);
            }, 4000); // Display for 4 seconds
        }

        function showSaveStatus(statusId, message = '✓ Saved') {
             const statusElement = document.getElementById(statusId);
             if (!statusElement) return; // Safety check
             statusElement.textContent = message;
             statusElement.classList.remove('deleted');
             if (message.includes('deleted')) {
                 statusElement.classList.add('deleted');
             }
             statusElement.style.display = 'inline-block'; // Use inline-block

             // Clear any previous timeout
             clearTimeout(statusElement.timer);

             // Hide after 3 seconds
             statusElement.timer = setTimeout(() => {
                 statusElement.style.display = 'none';
             }, 3000);
        }

        function showError(errorId, field, message = 'This field is required.') {
             const errorElement = document.getElementById(errorId);
             if (!errorElement) return;
             errorElement.textContent = message;
             errorElement.style.display = 'inline-block'; // Use inline-block
             if (field) { // Only add class if field is provided
                  field.classList.add('required-field');
                  // Only focus if part of explicit validation/save action, not general load
                  // field.focus();
             }
        }

        function hideError(errorId) {
             const errorElement = document.getElementById(errorId);
              if (!errorElement) return;
             errorElement.style.display = 'none';
             // We remove the required-field class in validation/save logic where appropriate
        }


        // --- Actions (Save, Delete) triggered by buttons ---
        function saveAnswer(questionId, statusId, errorId) {
            const currentUser = getCurrentUser();
            if (!currentUser || !currentUser.email) {
                alert('Session expired. Please login again.');
                window.location.href = 'login.html';
                return;
            }

            const field = document.querySelector(`.required-answer[data-question="${questionId}"]`);
            const answer = field.value.trim(); // Trim whitespace for validation

            // Clear previous messages and styles for this question
            const statusElement = document.getElementById(statusId);
            const errorElement = document.getElementById(errorId);
            if (statusElement) statusElement.style.display = 'none';
            if (errorElement) errorElement.style.display = 'none';
            field.classList.remove('required-field');

            // --- Validate: Answer is now mandatory to save ---
            if (!answer) {
                showError(errorId, field); // Show error message
                return; // Stop the save process
            }

            // --- Attempt to save to Local Storage ---
            if (!saveAnswerToStorage(currentUser.email, questionId, field.value)) { // Save original value with whitespace if needed
                 // Error saving (e.g., quota exceeded) - message shown in saveAnswerToStorage
                 return;
            }


            // --- Submit to Formspree (asynchronously) ---
            submitToFormspree(currentUser.email, questionId, field.value);

            // --- Show confirmation ---
            showSaveStatus(statusId);
        }


        function deleteAnswer(questionId, statusId, errorId) {
            const currentUser = getCurrentUser();
             if (!currentUser || !currentUser.email) {
                alert('Session expired. Please login again.');
                window.location.href = 'login.html';
                return;
            }

            const field = document.querySelector(`.required-answer[data-question="${questionId}"]`);
            // Clear messages and styles
             const statusElement = document.getElementById(statusId);
             const errorElement = document.getElementById(errorId);
             if (statusElement) statusElement.style.display = 'none';
             if (errorElement) errorElement.style.display = 'none';
             field.classList.remove('required-field');


            // Clear the field visually
            field.value = '';

            // Attempt to remove from Local Storage
            if(deleteAnswerFromStorage(currentUser.email, questionId)) {
                // Show delete confirmation only if deletion from storage was successful
                 showSaveStatus(statusId, 'Answer deleted');
            } else {
                 // Maybe show a different message if it wasn't saved in the first place?
                 console.log("Answer was not found in storage to delete.");
            }


             // Note: We don't send a "delete" action to Formspree.
        }

        // --- Formspree Submission ---
        function submitToFormspree(userEmail, questionId, answer) {
             if (!formspreeEndpoint) {
                 console.warn("Formspree endpoint not configured.");
                 return;
             }
             if (!userEmail) {
                 console.warn("Cannot submit to Formspree without user email.");
                 return;
             }

            const formData = new FormData();
            formData.append('email', userEmail);
            formData.append('page_key', currentPageKey); // Use page key 'article1'
            formData.append('question_id', questionId);
            formData.append('answer_text', answer);

            // Add user name if available
            const currentUser = getCurrentUser();
            if (currentUser && currentUser.name) {
                 formData.append('user_name', currentUser.name);
            }

            fetch(formspreeEndpoint, {
                method: 'POST',
                body: formData,
                headers: { 'Accept': 'application/json' }
            })
            .then(response => {
                if (response.ok) {
                    console.log(`Answer for ${questionId} submitted successfully to Formspree.`);
                } else {
                    response.json().then(data => {
                        console.error(`Formspree submission error for ${questionId}:`, data.errors ? data.errors.map(e => e.message).join(', ') : `Status ${response.status}`);
                    }).catch(() => {
                        console.error(`Non-OK response from Formspree for ${questionId}. Status: ${response.status}`);
                    });
                }
            })
            .catch(error => {
                console.error(`Network error submitting form to Formspree for ${questionId}:`, error);
                 // Maybe add subtle offline indicator if network fails?
            });
        }

    </script>

</body>
</html>
