<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        button {
            padding: 8px 12px;
            margin-right: 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
        }
        button:first-child {
            background-color: #4CAF50;
            color: white;
        }
        button:last-child {
            background-color: #f44336;
            color: white;
        }
        .no-users {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Admin Panel - User Reviews</h1>
    <table id="userTable">
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- User data will be inserted here -->
        </tbody>
    </table>
    <div id="noUsers" class="no-users" style="display: none;">
        No pending user reviews found.
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-database.min.js"></script>
    <script>
        // Firebase configuration - replace with your actual Firebase config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Get all users from Firebase Database where status is 'pending'
        function loadPendingUsers() {
            const tableBody = document.getElementById('tableBody');
            const noUsers = document.getElementById('noUsers');
            
            tableBody.innerHTML = ''; // Clear existing rows
            
            database.ref('users').orderByChild('status').equalTo('pending').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const users = snapshot.val();
                    let hasUsers = false;
                    
                    for (const userId in users) {
                        if (users.hasOwnProperty(userId)) {
                            hasUsers = true;
                            const user = users[userId];
                            const row = tableBody.insertRow();
                            row.id = `user-${userId}`;
                            row.innerHTML = `
                                <td>${user.username || 'N/A'}</td>
                                <td>${user.email || 'N/A'}</td>
                                <td>${user.status || 'N/A'}</td>
                                <td>
                                    <button onclick="approveUser('${userId}')">Approve</button>
                                    <button onclick="rejectUser('${userId}')">Reject</button>
                                </td>
                            `;
                        }
                    }
                    
                    noUsers.style.display = hasUsers ? 'none' : 'block';
                } else {
                    noUsers.style.display = 'block';
                }
            }, (error) => {
                console.error("Error loading users:", error);
                alert("Error loading users. Please check console for details.");
            });
        }

        // Approve user and change status to 'active'
        function approveUser(userId) {
            database.ref('users/' + userId).update({
                status: 'active'
            }).then(() => {
                alert('User approved!');
                // Remove row from table
                document.getElementById(`user-${userId}`).remove();
                checkNoUsers();
            }).catch((error) => {
                console.error("Error approving user:", error);
                alert("Error approving user. Please try again.");
            });
        }

        // Reject user and remove from the database
        function rejectUser(userId) {
            if (confirm('Are you sure you want to reject this user? This action cannot be undone.')) {
                database.ref('users/' + userId).remove()
                .then(() => {
                    alert('User rejected!');
                    // Remove row from table
                    document.getElementById(`user-${userId}`).remove();
                    checkNoUsers();
                }).catch((error) => {
                    console.error("Error rejecting user:", error);
                    alert("Error rejecting user. Please try again.");
                });
            }
        }

        // Check if there are no users left in the table
        function checkNoUsers() {
            const tableBody = document.getElementById('tableBody');
            const noUsers = document.getElementById('noUsers');
            
            if (tableBody.rows.length === 0) {
                noUsers.style.display = 'block';
            }
        }

        // Load users when the page loads
        document.addEventListener('DOMContentLoaded', loadPendingUsers);
    </script>
</body>
</html>
