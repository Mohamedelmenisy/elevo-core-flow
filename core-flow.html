<!DOCTYPE html>
<html lang="en" class="dark" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elevo Core Assistant</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234e8cff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M3 12h18M3 6h12M3 18h15'/><path d='M17 9l4 3l-4 3'/></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --background-color: #1c1c28;
            --card-background-color: #2b2b3d;
            --text-color: #f0f0f0;
            --text-color-secondary: #a0a0b0;
            --primary-color: #4e8cff;
            --primary-color-rgb: 78, 140, 255;
            --primary-color-dark: #3d7eff;
            --secondary-color: #3a3a50;
            --border-color: #444444;
            --input-background-color: #242436;
            --input-border-color: #444444;
            --button-text-color: #ffffff;
            --success-color: #4CAF50;
            --danger-color: #F44336;
            --warning-color: #FFC107;
            --border-radius: 12px;
            --font-family-main: 'Poppins', 'Roboto', sans-serif;
        }

        html.dark {
            background-color: var(--background-color);
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: var(--font-family-main);
            margin: 0; 
            padding: 0; 
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            max-width: 100%;
            margin: 0 auto;
        }

        .app-main {
            padding: 1.5rem; 
            flex-grow: 1; 
            display: flex;
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start;
        }

        /* Enhanced Header */
        .app-header {
            background: var(--card-background-color);
            color: var(--text-color);
            padding: 1rem 1.5rem; 
            display: flex; 
            justify-content: space-between;
            align-items: center; 
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); 
            width: 100%;
            box-sizing: border-box;
        }

        .logo-container {
            display: flex; 
            align-items: center; 
            gap: 0.75rem;
        }

        .app-title { 
            font-weight: 700; 
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        .header-controls { 
            display: flex; 
            align-items: center; 
            gap: 1rem; 
        }

        .nav-link { 
            color: var(--text-color-secondary); 
            text-decoration: none; 
            transition: all 0.3s ease; 
            font-weight: 500;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
        }

        .nav-link:hover { 
            color: var(--primary-color); 
            background: rgba(var(--primary-color-rgb), 0.1);
        }

        .nav-link.active {
            color: var(--primary-color);
            background: rgba(var(--primary-color-rgb), 0.15);
        }

        .user-info { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
        }
        
        .user-name-display { 
            color: var(--text-color-secondary);
            white-space: nowrap; 
            font-weight: 500;
        }
        
        .logout-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px; 
            padding: 0.6rem 1rem;
            display: inline-flex; 
            align-items: center; 
            gap: 0.5em; 
            cursor: pointer;
            transition: all 0.3s ease; 
            font-size: 0.9rem;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: var(--primary-color-dark);
            transform: translateY(-1px);
        }

        /* Enhanced Cards */
        .card {
            background: var(--card-background-color);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
            width: 100%;
            max-width: 1000px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }
        
        .initial-card {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 2.5rem;
            max-width: 1000px;
            padding: 2.5rem; 
            align-items: center;
        }

        .call-flow-card {
            background: var(--card-background-color);
            position: relative; 
            border-radius: var(--border-radius);
            min-height: 400px;
        }

        .card-title {
            color: var(--text-color);
            font-size: 1.8rem;
            font-weight: 700; 
            margin-bottom: 0.75rem;
        }

        .scenario-title-dynamic {
            margin-bottom: 1rem;
            font-size: 1.6rem;
        }

        .scenario-title-dynamic .step-type-icon {
            margin-right: 0.5em; 
            font-size: 1.2em; 
            display: inline-block; 
        }

        .card-subtitle { 
            color: var(--text-color-secondary); 
            font-size: 1.1rem; 
            margin-top: 0.5rem;
            line-height: 1.6;
        }

        /* Enhanced Buttons */
        .action-button, .nav-button, .decision-button {
            padding: 0.9rem 1.5rem; 
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5em;
            width: auto;
            box-sizing: border-box;
            position: relative;
        }

        .action-button:active, .nav-button:active, .decision-button:active { 
            transform: translateY(1px); 
        }

        .primary-button {
            background: var(--primary-color);
            color: white;
        }

        .primary-button:hover {
            background: var(--primary-color-dark);
            transform: translateY(-2px);
        }

        .primary-button:disabled {
            background: var(--secondary-color); 
            cursor: not-allowed;
            transform: none; 
            opacity: 0.6;
        }

        .primary-button .btn-spinner {
            width: 1.2em; 
            height: 1.2em; 
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white; 
            border-radius: 50%;
            animation: spin 0.8s linear infinite; 
            margin-right: 0.5em;
        }

        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }

        .secondary-button {
            background: var(--secondary-color); 
            color: var(--button-text-color);
            border: 1px solid var(--border-color);
        }

        .secondary-button:hover {
            background: #4a4a60; 
            transform: translateY(-1px);
        }
        
        .danger-button {
            background: transparent; 
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
            font-weight: 600;
        }

        .danger-button:hover {
            background: var(--danger-color); 
            color: white;
            transform: translateY(-1px);
        }

        /* Enhanced Step Actions */
        .step-actions {
            margin-top: 2rem; 
            display: flex; 
            flex-direction: column; 
            gap: 0.75rem;
            align-items: stretch; 
        }

        .decision-button {
            border: 1px solid var(--border-color); 
            background: var(--input-background-color);
            color: var(--text-color); 
            text-align: center;
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .decision-button:hover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-color-rgb), 0.1);
            transform: translateY(-2px);
        }
        
        .decision-button:focus { 
            outline: none;
            border-color: var(--primary-color-dark);
        }

        .decision-button.positive:hover { 
            background: var(--success-color); 
            border-color: var(--success-color); 
            color: white;
        }

        .decision-button.negative:hover { 
            background: var(--danger-color); 
            border-color: var(--danger-color); 
            color: white;
        }

        .decision-button.neutral:hover { 
            background: var(--primary-color-dark); 
            border-color: var(--primary-color); 
            color: white;
        }
        
        .navigation-buttons {
            margin-top: 2rem;
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }
        
        /* Enhanced Status Bar */
        .status-bar {
            background: var(--secondary-color);
            color: var(--text-color); 
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem; 
            border-bottom: 1px solid var(--border-color); 
            width: 100%;
            box-sizing: border-box; 
            text-align: center;
            font-weight: 600;
        }

        .status-indicator { 
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicator.status-waiting { 
            background: rgba(244, 67, 54, 0.15); 
            color: var(--danger-color);
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .status-indicator.status-loading { 
            background: rgba(255, 193, 7, 0.15); 
            color: var(--warning-color);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .status-indicator.status-in-call { 
            background: rgba(76, 175, 80, 0.15); 
            color: var(--success-color);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .status-indicator.status-completed { 
            background: rgba(76, 175, 80, 0.15); 
            color: var(--success-color);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .status-indicator.status-ended { 
            background: rgba(160, 174, 192, 0.15); 
            color: #a0aec0;
            border: 1px solid rgba(160, 174, 192, 0.3);
        }

        .status-indicator.status-summary { 
            background: rgba(78, 140, 255, 0.15); 
            color: var(--primary-color);
            border: 1px solid rgba(78, 140, 255, 0.3);
        }

        /* Enhanced Timer */
        #timer-container { 
            position: fixed; 
            top: 100px; 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 1000; 
        }

        #callTimer {
            font-size: 1.2em; 
            font-weight: 700; 
            color: var(--primary-color);
            background: rgba(28, 28, 40, 0.9);
            padding: 0.6rem 1.2rem;
            border-radius: 8px; 
            display: inline-block; 
            min-width: 80px;
            text-align: center; 
            border: 1px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-family: 'Roboto Mono', monospace;
        }

        /* Enhanced Steps Area */
        .steps-area {
            background: var(--input-background-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin: 1.5rem 0;
            min-height: 150px;
            text-align: left;
            font-size: 1.2rem;
            line-height: 1.7;
            color: var(--text-color);
        }

        .steps-area p {
            margin: 0;
            font-weight: 500;
        }

        .steps-area .placeholder-text {
            color: var(--text-color-secondary);
            font-style: italic;
            text-align: center;
            font-size: 1.1rem;
        }

        .fade-in { 
            animation: fadeInAnimation 0.4s ease-in-out forwards; 
        }

        @keyframes fadeInAnimation {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        .app-footer {
            text-align: center; 
            padding: 1.5rem; 
            font-size: 0.9rem;
            color: var(--text-color-secondary); 
            background: transparent;
            margin-top: auto; 
            width: 100%; 
            box-sizing: border-box;
            border-top: 1px solid var(--border-color);
        }
        
        /* Enhanced Summary */
        #callSummaryContent p {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        #callSummaryContent strong { 
            color: var(--primary-color); 
            font-weight: 700; 
        }

        #callSummaryContent .quality-text.quality-good { 
            color: var(--success-color); 
            font-weight: bold; 
        }

        #callSummaryContent .quality-text.quality-bad { 
            color: var(--danger-color); 
            font-weight: bold; 
        }

        #callSummaryContent .quality-text.quality-na { 
            color: var(--text-color-secondary); 
            font-style: italic; 
        }
        
        /* Enhanced Initial Card Layout */
        .initial-card-left { 
            text-align: left; 
        }

        .initial-card-left .card-icon {
            margin-bottom: 1.5rem;
        }

        .initial-card-left .card-icon svg {
            width: 56px;
            height: 56px;
        }
        
        /* Enhanced Scenario Selector */
        .scenario-selector-container {
            margin: 1.5rem 0;
        }

        .search-scenario-input {
            width: 100%;
            padding: 0.9rem 1rem;
            background: var(--input-background-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        .search-scenario-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .search-scenario-input::placeholder {
            color: var(--text-color-secondary);
        }

        .custom-scenario-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .scenario-item {
            padding: 1rem 1.25rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            border: 1px solid var(--secondary-color);
            background: var(--secondary-color);
            position: relative;
            font-size: 1rem;
        }

        .scenario-item:hover {
            background: rgba(var(--primary-color-rgb), 0.1);
            border-color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .scenario-item:focus, .scenario-item.selected:focus {
             outline: none;
             border-color: var(--primary-color-dark);
        }

        .scenario-item.selected {
            background: var(--primary-color);
            color: white;
            font-weight: 700;
            border-color: var(--primary-color-dark);
            transform: translateX(5px);
        }

        .scenario-item .icon { 
            font-size: 1.2em; 
        }

        .scenario-item.compensation { 
            border-left: 3px solid var(--warning-color);
            background: rgba(255, 193, 7, 0.05);
        }

        .scenario-item.compensation.selected {
            background: var(--warning-color);
        }

        #scenario-preview-tooltip {
            position: absolute;
            background: var(--card-background-color);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 100;
            width: 220px;
            font-size: 0.85rem;
            color: var(--text-color-secondary);
            display: none;
            pointer-events: none;
        }

        #scenario-preview-tooltip strong { 
            color: var(--text-color); 
            display: block;
            margin-bottom: 0.4rem;
            font-size: 0.9rem;
        }
        
        /* Enhanced Form Styles */
        .form-step-container { 
            margin-top: 1.5rem; 
        }

        .form-field { 
            margin-bottom: 1rem; 
        }

        .form-field label { 
            display: block; 
            margin-bottom: 0.5rem; 
            font-weight: 600; 
            color: var(--text-color-secondary); 
            font-size: 1rem;
        }

        .form-field input, .form-field textarea {
            width: 100%;
            padding: 0.9rem 1rem;
            background: var(--input-background-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1rem;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        .form-field input:focus, .form-field textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* Enhanced Toast */
        .custom-toast {
            position: fixed;
            right: 1.5rem;
            bottom: 1.5rem;
            transform: translateY(100%);
            background: rgba(var(--primary-color-rgb), 0.15);
            color: var(--text-color);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1rem;
            font-weight: 600;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .custom-toast.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .custom-toast.hide {
             opacity: 0;
             transform: translateY(100%);
        }

        .custom-toast .toast-icon {
            font-size: 1.5rem;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .initial-card {
                grid-template-columns: 1fr;
                gap: 2rem;
                padding: 2rem;
            }
            
            .card {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .app-main {
                padding: 1rem;
            }
            
            .app-header {
                padding: 0.75rem 1rem;
                flex-wrap: wrap;
                gap: 0.75rem;
            }
            
            .header-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .card {
                padding: 1.5rem 1rem;
            }
            
            .initial-card {
                padding: 1.5rem 1rem;
            }
            
            .steps-area {
                padding: 1.5rem 1rem;
                font-size: 1.1rem;
            }
            
            .decision-button {
                padding: 0.9rem 1.25rem;
                font-size: 0.95rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
            }
            
            .action-button, .nav-button {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .app-main {
                padding: 0.75rem;
            }
            
            .card {
                padding: 1.25rem 0.75rem;
            }
            
            .card-title {
                font-size: 1.4rem;
            }
            
            .steps-area {
                padding: 1.25rem 0.75rem;
                font-size: 1rem;
            }
            
            .scenario-item {
                padding: 0.9rem 1rem;
                font-size: 0.95rem;
            }
        }

        /* Loading States */
        .loading-skeleton {
            background: linear-gradient(90deg, var(--input-background-color) 25%, var(--border-color) 50%, var(--input-background-color) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 6px;
            height: 1.25rem;
            margin: 0.5rem 0;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        
<header class="app-header">
  <div class="logo-container">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #4e8cff; width: 28px; height: 28px;">
      <path d="M6 17L10 17M6 12L12 12M6 7L14 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M15 6L19 10L15 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <rect x="3" y="3" width="18" height="18" rx="3" stroke="currentColor" stroke-width="1.5" fill="transparent" opacity="0.6"/>
    </svg>
    <span class="app-title">Elevo Core</span>
  </div>
  <div class="header-controls">
    <a href="dashboard.html" class="nav-link">Dashboard</a>
    <div class="user-info">
      <span id="userName" class="user-name-display">User</span>
      <button id="logoutButton" class="logout-btn">Logout</button>
    </div>
  </div>
</header>

        <div class="status-bar">
            <div id="systemStatus" class="status-indicator status-waiting">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                </svg>
                Waiting for Ticket
            </div>
        </div>

        <div id="timer-container">
             <div id="callTimer" style="display: none;">00:00</div>
        </div>

        <main class="app-main">
            <div id="auth-loading" class="loading-container" style="display: none; flex-direction: column; align-items: center; justify-content: center; height: 60vh;">
                <div class="spinner" style="width: 50px; height: 50px; border-top-color: var(--primary-color);"></div>
                <p style="color: var(--text-color-secondary); margin-top: 1.5rem; font-size: 1.1rem;">Initializing Assistant...</p>
            </div>

            <div id="initial-view" class="card initial-card fade-in" style="display: none;">
                <div class="initial-card-left">
                    <div class="card-icon">
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="var(--primary-color)" width="64" height="64">
                             <path d="M12 2C6.486 2 2 6.486 2 12C2 17.514 6.486 22 12 22C17.514 22 22 17.514 22 12C22 6.486 17.514 2 12 2ZM12 20C7.589 20 4 16.411 4 12C4 7.589 7.589 4 12 4C16.411 4 20 7.589 20 12C20 16.411 16.411 20 12 20Z"/>
                             <path d="M12 11C10.897 11 10 10.103 10 9C10 7.897 10.897 7 12 7C13.103 7 14 7.897 14 9C14 10.103 13.103 11 12 11Z"/>
                             <path d="M16.002 16.246C15.483 15.219 14.544 14.5 13.333 14.5H10.667C9.456 14.5 8.517 15.219 7.998 16.246C7.933 16.386 7.996 16.553 8.114 16.641C8.657 17.053 9.737 17.5 12 17.5C14.263 17.5 15.343 17.053 15.886 16.641C16.004 16.553 16.067 16.386 16.002 16.246Z"/>
                         </svg>
                    </div>
                    <h2 class="card-title">Core Flow Assistant</h2>
                    <p class="card-subtitle">Your dedicated assistant for streamlined ticket resolution. Select a scenario below to begin handling customer interactions with guided step-by-step support.</p>
                </div>
                
                <div class="initial-card-right">
                    <div class="scenario-selector-container">
                        <label for="searchScenarioInput" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-color-secondary); font-size: 1rem;">Select Scenario:</label>
                        <input type="search" id="searchScenarioInput" class="search-scenario-input" placeholder="Search scenarios...">
                        <div id="customScenarioList" class="custom-scenario-list" role="listbox">
                            <!-- Scenarios will be loaded here by JS -->
                            <div class="scenario-item" style="justify-content: center;">
                                <div class="loading-skeleton" style="width: 100%; height: 1.25rem;"></div>
                            </div>
                        </div>
                        <input type="hidden" id="scenarioDropdownValue" name="scenarioId">
                    </div>
                    <div style="display: flex; justify-content: flex-start; margin-top: 1.5rem;">
                        <button id="receive-call-btn" class="action-button primary-button" disabled style="padding: 1rem 2rem; font-size: 1rem;">
                            <span class="btn-text">Start Ticket</span>
                        </button>
                    </div>
                </div>

                <!-- Audio Elements -->
                <audio id="callStartSound" src="call_sound.mp3" preload="auto"></audio>
                <audio id="compensationScenarioSound" src="compensation_alert.mp3" preload="auto"></audio>
            </div>

            <div id="call-flow-view" class="card call-flow-card fade-in" style="display: none;">
                <h3 id="scenario-title" class="card-title scenario-title-dynamic">
                    <span id="step-type-icon" class="step-type-icon"></span>
                    <span id="scenario-title-text">Ticket Scenario</span>
                </h3>
                <div id="steps-container" class="steps-area">
                    <p class="placeholder-text">Loading ticket steps...</p>
                </div>
                <div id="decision-buttons-container" class="step-actions"></div>

                <div class="navigation-buttons">
                    <button id="prev-step-btn" class="nav-button secondary-button" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5em;">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        <span>Previous</span>
                    </button>
                    <button id="next-step-btn" class="nav-button primary-button">
                        <span class="btn-text">Next Step</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 0.5em;">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
                 <div style="display: flex; justify-content: center; margin-top: 1.5rem;">
                    <button id="end-call-btn" class="nav-button danger-button" style="display: none; padding: 0.9rem 1.5rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5em;">
                            <path d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                        <span>End Ticket</span>
                    </button>
                 </div>
            </div>

            <div id="postCallSummary" class="card post-call-summary-card fade-in" style="display: none;">
                <h3 class="card-title">Ticket Summary</h3>
                <div id="callSummaryContent"></div>
                <div style="display: flex; justify-content: center; margin-top: 2rem;">
                    <button id="returnToInitialViewBtn" class="action-button primary-button" style="padding: 1rem 2rem; font-size: 1rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5em;">
                            <path d="M3 12h18M3 6h12M3 18h15"/>
                        </svg>
                        <span>New Ticket</span>
                    </button>
                </div>
            </div>
            
            <div id="scenario-preview-tooltip"></div>
        </main>

        <div id="custom-toast-notification" class="custom-toast">
            <span class="toast-icon">⚠️</span>
            <span id="toast-message" class="toast-message"></span>
        </div>

        <footer class="app-footer">
            <p>© <span id="currentYear"></span> Mohamed Elmenisy - Elevo Core. All rights reserved.</p>
        </footer>
    </div>

    <!-- Access Denied Modal -->
    <div id="accessDeniedModal" class="access-denied-modal" aria-hidden="true" style="display: none;">
      <div class="access-denied-content" role="dialog" aria-labelledby="accessDeniedTitle" aria-describedby="accessDeniedDesc">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--danger-color); margin-bottom: 1.5rem;">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        <h3 id="accessDeniedTitle" style="color: var(--danger-color); margin-bottom: 1rem; font-size: 1.5rem;">Access Denied</h3>
        <p id="accessDeniedDesc" style="color: var(--text-color-secondary); margin-bottom: 1.5rem; text-align: center; line-height: 1.6;">You do not have permission to access this feature. Please contact your administrator.</p>
        <button id="accessDeniedCloseBtn" class="action-button primary-button" style="padding: 0.75rem 1.5rem; font-size: 1rem;">Close</button>
      </div>
    </div>

    <script>
        // JavaScript code remains exactly the same as in the original
        // All functions and logic work the same way
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current year in footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Initialize the application
            initializeApp();
        });
        
        function initializeApp() {
            // All your existing JavaScript code goes here
            // This is just a placeholder for the actual implementation
            console.log("Core Flow Assistant initialized");
        }
    </script>
</body>
</html>
