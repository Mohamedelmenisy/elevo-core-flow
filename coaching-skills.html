<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coaching Skills</title>
    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <style>
        /* --- Global Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-color: #f9f9f9;
            color: #333;
        }

        /* --- User Bar Styles --- */
        .user-bar {
            background-color: #34495e;
            padding: 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-size: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info svg { /* Moved inline style here */
             opacity: 0.8;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 15px;
        }

        .user-email {
            font-size: 13px;
            opacity: 0.8;
        }

        .logout-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer; /* Added cursor */
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .logout-button:hover {
            background-color: #c0392b;
            transform: translateY(-1px);
        }

        .logout-button:active {
            transform: translateY(0);
        }

        /* --- Navigation Tabs --- */
        .nav-tab {
            background-color: #2c3e50;
            padding: 10px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            white-space: nowrap; /* Prevent wrapping */
            overflow-x: auto; /* Allow horizontal scrolling */
        }

        .nav-tab a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
            display: inline-block; /* Needed for proper spacing with nowrap */
        }

        .nav-tab a:hover {
            background-color: #34495e;
        }

        /* --- Main Content Styles --- */
        h1 {
            color: white;
            background-color: #e67e22;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            margin: 20px auto;
            max-width: 800px;
            font-size: 2em; /* Default size */
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            padding: 30px; /* Default padding */
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px; /* Slightly softer edges */
        }

        /* --- Content Blocks --- */
        .quote {
            font-style: italic;
            border-left: 4px solid #e67e22;
            padding: 15px;
            background-color: #fdfaf6; /* Slightly warmer background */
            margin: 20px 0; /* Consistent margin */
            border-radius: 0 6px 6px 0; /* Rounded corners on one side */
        }

        .image-container {
            text-align: center;
            margin: 30px 0; /* More vertical space */
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px; /* Consistent rounding */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Subtle shadow */
        }
        .image-container p {
            font-size: 0.9em;
            color: #555;
            margin-top: 10px;
        }

        .tip-box, .action-box {
            padding: 15px 20px; /* More horizontal padding */
            border-radius: 6px;
            margin: 20px 0; /* Consistent margin */
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* Subtle shadow */
        }

        .tip-box { background-color: #3498db; border-left: 5px solid #2980b9; }
        .action-box { background-color: #e67e22; border-left: 5px solid #d35400; }
        .tip-box strong, .action-box strong { display: block; margin-bottom: 5px; }

        .question-box {
            background-color: rgba(230, 126, 34, 0.07); /* Slightly subtler background */
            padding: 20px;
            border-radius: 6px;
            margin: 25px 0; /* More spacing */
            border: 1px solid rgba(230, 126, 34, 0.2); /* Subtle border */
        }
        .question-box h3 {
            margin-bottom: 10px;
            color: #c0392b; /* Match required field color theme */
        }

        /* --- Form Elements --- */
        textarea, input[type="text"] {
            width: 100%;
            padding: 12px; /* More padding */
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 8px 0;
            resize: vertical;
            min-height: 80px;
            font-size: 1em; /* Ensure readable font size */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        textarea:focus, input[type="text"]:focus {
             border-color: #e67e22;
             box-shadow: 0 0 0 3px rgba(230, 126, 34, 0.2);
             outline: none;
        }

        /* --- Table Styles --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }

        table, th, td {
            border: 1px solid #ddd;
            padding: 10px; /* More padding */
            text-align: left; /* Align text left */
        }

        th {
            background-color: #f2f2f2;
            font-weight: 600; /* Bolder headers */
        }

        .metaphor-table th {
            background-color: #e67e22;
            color: white;
        }
        .metaphor-table input[type="text"] {
            margin: 0; /* Remove margin for table context */
            display: block; /* Ensure it takes full width within td */
        }
        /* Ensure thead and tbody are used in HTML for this */
        .metaphor-table thead th { text-align: center; }

        /* --- Buttons --- */
        .button-group {
            display: flex;
            align-items: center;
            gap: 8px; /* Space between buttons and status */
            margin-top: 10px; /* More space below input */
        }

        .save-button, .delete-button {
            color: white;
            border: none;
            padding: 8px 15px; /* Slightly larger */
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500; /* Consistent weight */
            transition: background-color 0.2s, transform 0.1s;
            font-size: 0.9em;
        }
        .save-button { background-color: #27ae60; }
        .save-button:hover { background-color: #2ecc71; transform: translateY(-1px); }
        .delete-button { background-color: #e74c3c; }
        .delete-button:hover { background-color: #c0392b; transform: translateY(-1px); }
        .save-button:active, .delete-button:active { transform: translateY(0); }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px; /* More space above */
            gap: 20px;
        }

        .navigation-buttons a {
            text-decoration: none;
            padding: 12px 20px; /* Larger buttons */
            color: white;
            background-color: #e67e22;
            border-radius: 4px;
            font-weight: bold;
            flex: 1;
            text-align: center;
            transition: background-color 0.3s, transform 0.1s;
        }

        .navigation-buttons a:hover {
            background-color: #d35400;
            transform: translateY(-1px);
        }
         .navigation-buttons a:active {
             transform: translateY(0);
         }

        /* --- Feedback & Validation --- */
        .save-status {
            font-size: 13px; /* Slightly larger */
            color: #27ae60;
            margin-left: 5px; /* Align with buttons */
            display: none;
            font-weight: 500;
        }

        .error-message {
            color: #e74c3c;
            font-size: 13px; /* Slightly larger */
            margin-left: 5px;
            display: none;
            font-weight: 500;
        }

        .required-field {
            border: 2px solid #e74c3c !important;
            background-color: #fff2f1 !important; /* Slightly less intense red */
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); }
            to { box-shadow: 0 0 0 6px rgba(231, 76, 60, 0); }
        }

        .floating-warning {
            background-color: #fff8e1;
            border-left: 5px solid #ffc107; /* Thicker border */
            padding: 15px 25px; /* More padding */
            color: #333;
            display: none;
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            border-radius: 6px; /* Match other elements */
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); /* Stronger shadow */
            animation: fadeIn 0.3s ease-in-out;
            font-weight: 500;
            max-width: 90%; /* Prevent full width on mobile */
            width: auto; /* Allow content to determine width up to max */
            min-width: 300px; /* Ensure it's not too tiny */
        }

        @keyframes fadeIn {
            from { opacity: 0; top: 50px; }
            to { opacity: 1; top: 70px; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* --- Highlighted Sections --- */
        .highlight-section, .skills-list, .ei-elements, .trust-methods {
             padding: 20px;
             border-radius: 6px;
             margin: 20px 0;
             border-left-width: 5px; /* Consistent border */
             border-left-style: solid;
        }

        .highlight-section { background-color: rgba(52, 152, 219, 0.1); border-left-color: #3498db;}
        .skills-list { background-color: rgba(46, 204, 113, 0.1); border-left-color: #2ecc71; }
        .skills-list ul { margin-left: 25px; /* More indent */ list-style: disc; }
        .ei-elements { background-color: rgba(155, 89, 182, 0.1); border-left-color: #9b59b6; }
        .ei-elements ol { margin-left: 25px; }
        .trust-methods { background-color: rgba(41, 128, 185, 0.1); border-left-color: #2980b9; }
        .trust-methods ul { margin-left: 25px; list-style: disc; }


        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
             h1 {
                 font-size: 1.6em; /* Slightly smaller */
                 margin: 15px auto;
                 padding: 12px;
             }
             .container {
                 padding: 20px; /* Reduced padding */
                 margin: 15px auto;
             }
             .user-bar {
                 padding: 10px 15px; /* Less horizontal padding */
             }
             .logout-button {
                 padding: 7px 12px;
                 font-size: 14px;
             }
             .user-name { font-size: 14px; }
             .user-email { font-size: 12px; }

             .nav-tab {
                 padding: 8px 5px; /* Adjust padding for scrolling */
             }
             .nav-tab a {
                 margin: 0 8px;
                 padding: 4px 8px;
             }
             .navigation-buttons {
                 flex-direction: column; /* Stack buttons */
                 gap: 15px;
             }
             .navigation-buttons a {
                 padding: 12px 15px; /* Adjust padding */
             }
             .question-box {
                 padding: 15px;
             }
             textarea, input[type="text"] {
                padding: 10px;
             }
             .button-group {
                 /* Optional: Stack buttons if needed on very small screens */
                 /* flex-direction: column; align-items: flex-start; */
             }
             .save-button, .delete-button {
                 padding: 7px 13px;
             }
             table, th, td {
                 padding: 8px;
                 font-size: 13px;
             }
        }

         @media (max-width: 480px) {
              h1 { font-size: 1.4em; }
              .container { padding: 15px; }
              .floating-warning {
                  padding: 12px 20px;
                  min-width: 280px;
              }
         }
    </style>
</head>
<body>
    <!-- User Info Bar -->
    <div class="user-bar">
        <div class="user-info">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <div class="user-details">
                <span class="user-name" id="userName">Welcome back</span>
                <span class="user-email" id="userEmail">user@example.com</span>
            </div>
        </div>
        <button class="logout-button" onclick="logout()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
        </button>
    </div>

    <!-- Navigation Tabs -->
    <nav class="nav-tab">
        <a href="index.html">Home</a>
        <a href="article1.html">Article 1</a>
        <a href="coaching-skills.html">Coaching Skills</a>
        <a href="coaching-individuals.html">Coaching Individuals</a>
        <a href="coaching-team.html">Team Coaching</a>
        <a href="coaching-yourself.html">Self Coaching</a>
    </nav>

    <h1>1. Coaching Skills</h1>

    <div class="floating-warning" id="warningMessage">
        <strong>Action Required:</strong> Please complete all mandatory questions before proceeding.
    </div>

    <div class="container">
        <!-- Highlight Section -->
        <div class="highlight-section">
            <p>Feedback from people who have received coaching suggests that a coach's most important attributes are personal rapport, confidence, and a sense of humor.</p>
            <p>A report by the International Coaching Federation shows that thousands of coaching clients valued rapport and compatibility more highly than a coach's formal education, or his or her years of experience.</p>
            <p>This gives you an advantage – because, as a manager, you already have good working relationships with your team members.</p>
        </div>

        <!-- Skills List Section -->
        <div class="skills-list">
            <p>But coaching requires other important skills, too. These include:</p>
            <ul>
                <li>Listening</li>
                <li>Communicating</li>
                <li>Questioning</li>
                <li>Emotional intelligence</li>
                <li>Developing trust</li>
            </ul>
            <p>In this chapter, we'll look at these skills in more detail, and discuss how you can improve each one.</p>
        </div>

        <!-- Quote -->
        <div class="quote">
            "A coach is someone who tells you what you don't want to hear, and has you see what you don't want to see, so you can be who you have always known you can be."
        </div>

        <!-- Image Container - UPDATED IMAGE -->
        <div class="image-container">
             <img src="https://images.unsplash.com/photo-1517048676732-d65bc937f952?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80"
                 alt="Two colleagues actively listening and engaging in a coaching conversation in a modern office setting"
                 onerror="this.onerror=null; this.src='https://via.placeholder.com/800x450/ffa726/ffffff?text=Active+Listening';">
            <p>Developing active listening skills is crucial for effective coaching.</p>
        </div>

        <h2>1.1. Improving Your Listening Skills</h2>

        <p>The ability to listen well is the most important coaching skill. It's key to understanding what the other person is saying on the surface, and to finding out what he or she means on a deeper level.</p>

        <p>Specifically, you need good active listening skills. This means that you give your full attention to the other person, and that you're not distracted by thinking of follow-up questions or counter-arguments. You also need to be aware of the person's body language, and how it aligns with (or differs from) what he says.</p>

        <p>When you're listening actively, give subtle clues to show that you're paying attention. For example, nod your head and use words like "Yes," or agree with an "Uh huh," when the person is talking. You can also paraphrase what you've just heard to confirm that you've understood it. For example, you might say, "What I'm hearing is..." or, "If I understand what you're saying...."</p>

        <p>Another useful skill is empathic listening. This is similar to active listening, but it also requires you to make a concerted effort to understand what the speaker is saying on an emotional level, as well as an intellectual level.</p>

        <p>To listen empathically, pay attention to what's being said – and what isn't. Keep in mind that what the speaker holds back is sometimes as important as what she communicates.</p>

        <p>Try to keep your own thoughts and opinions out of the conversation, and to focus on the other person. Listen carefully to his vocal tone and inflection, and watch his facial expressions closely. Ask yourself, "How is this person feeling about what he's telling me?"</p>

        <p>Mindful listening takes this a stage further, as it enables you to listen without judgment or criticism. The key is to listen "in the moment" – to be aware of your own thoughts and reactions to what is being said without allowing them to distract you from the speaker's message. This ensures that you remain open and receptive to other people's ideas.</p>

        <div class="tip-box">
            <strong>TIP</strong><br>
            Take this quiz, <em>How Good Are Your Listening Skills?</em>, to gain a better understanding of how well you listen, and to learn ways to improve.
        </div>

        <div class="action-box">
            <strong>ACTION</strong><br>
            Practice active listening and answer the questions below.
        </div>

        <!-- Listening Question 1 -->
        <div class="question-box">
            <h3>1. Did the other person's body language align with what she said? *</h3>
            <textarea placeholder="Write your observations here..." class="required-answer" data-question="listen-q1"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('listen-q1', 'save-status-listen-q1', 'error-listen-q1')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('listen-q1', 'save-status-listen-q1', 'error-listen-q1')">Delete Answer</button>
                <span class="save-status" id="save-status-listen-q1"></span>
                <span class="error-message" id="error-listen-q1"></span>
            </div>
        </div>

         <!-- Listening Question 2 -->
        <div class="question-box">
            <h3>2. Did active listening help you to understand the other person? If so, how? *</h3>
            <textarea placeholder="Explain how active listening impacted your understanding..." class="required-answer" data-question="listen-q2"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('listen-q2', 'save-status-listen-q2', 'error-listen-q2')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('listen-q2', 'save-status-listen-q2', 'error-listen-q2')">Delete Answer</button>
                <span class="save-status" id="save-status-listen-q2"></span>
                <span class="error-message" id="error-listen-q2"></span>
            </div>
        </div>

         <!-- Listening Question 3 -->
        <div class="question-box">
            <h3>3. How could active listening improve your relationships (personal and professional)? *</h3>
            <textarea placeholder="Reflect on the potential benefits..." class="required-answer" data-question="listen-q3"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('listen-q3', 'save-status-listen-q3', 'error-listen-q3')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('listen-q3', 'save-status-listen-q3', 'error-listen-q3')">Delete Answer</button>
                <span class="save-status" id="save-status-listen-q3"></span>
                <span class="error-message" id="error-listen-q3"></span>
            </div>
        </div>

        <h2>1.2. Developing Good Communication Skills</h2>

        <p>To be an effective coach, you need to know how to communicate your thoughts and ideas clearly. The other person will rely on your expertise and guidance, so it's vital that you get your message across without causing confusion.</p>

        <p>Part of effective communication is keeping your opinions and assumptions out of the conversation. This is especially true in coaching, where the focus is always on the coachee. But it's easier said than done, and many of us insert our opinions into a discussion without even realizing it!</p>

        <div class="image-container">
            <img src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?ixlib=rb-1.2.1&auto=format&fit=crop&w=1170&q=80"
                 alt="Two people communicating effectively, possibly planning or discussing work"
                 onerror="this.src='https://via.placeholder.com/800x450/ffa726/ffffff?text=Communication'">
            <p>Effective communication is key to successful coaching.</p>
        </div>

        <div class="quote">
            <p><strong>Example Scenario:</strong></p>
            <p><strong>Rahma (Coach):</strong> So tell me what has happened this week.</p>
            <p><strong>Mohamed (Coachee):</strong> I just couldn't find the time to read that leadership development book, or work on the exercises you gave me.</p>
            <p><strong>Rahma:</strong> Was it your boss again? Did he add more to your workload? <em style="color:#e74c3c;">(Assumption/Leading Question)</em></p>
            <p><strong>Mohamed:</strong> Yes, he did.</p>
            <p><strong>Rahma:</strong> That probably made you feel stressed and unappreciated, right? <em style="color:#e74c3c;">(Assumption/Leading Question)</em></p>
            <p><strong>Mohamed:</strong> Yes, it doesn't make me feel good when he does that. I already have too much to do.</p>
        </div>

        <p>This simple example shows how easy it is to influence a conversation with your choice of words, phrases and questions. You can avoid this in your coaching conversations by learning to use <strong>Clean Language</strong>.</p>

        <p>Try to limit your own use of metaphors when you're coaching. But do pay close attention to the metaphors that your coachee uses, as they can offer powerful clues to how he feels about the subject you're discussing.</p>

        <p><strong>Examples of common metaphors:</strong></p>
        <ul>
            <li>I can't <em>digest</em> what you're telling me.</li>
            <li>I need to <em>build</em> my leadership skills.</li>
            <li>I'm <em>trapped</em> in my job.</li>
            <li>She's <em>sticking her head in the sand</em>.</li>
            <li>I'm <em>over the moon</em> about my promotion.</li>
        </ul>

         <p><strong>Clean Language Questions:</strong></p>
        <ul>
            <li>And is there anything else about...?</li>
            <li>And what kind of... is that...?</li>
            <li>And where is...? / And whereabouts?</li>
            <li>And what happens next? / And then what happens?</li>
            <li>And what happens just before...?</li>
            <li>And where could... come from?</li>
            <li>And that's like... what?</li>
        </ul>

        <div class="tip-box">
            <strong>TIP</strong><br>
            Take this self-test, <em>How Good Are Your Communication Skills?</em>, to discover your communication strengths and weaknesses, and to learn how you can improve them.
        </div>

        <div class="action-box">
            <strong>ACTION</strong><br>
            For the next few days, pay attention to the metaphors that you use in your everyday speech. Write them down in the table, below. (Try to list at least 3) *
        </div>

        <!-- Metaphor Table -->
        <table class="metaphor-table">
            <thead>
                <tr>
                    <th>Metaphors You Use</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <input type="text" class="required-answer" placeholder="Enter metaphor #1 here..." data-question="m1">
                        <div class="button-group">
                            <button class="save-button" onclick="saveAnswer('m1', 'save-status-m1', 'error-m1')">Save</button>
                            <button class="delete-button" onclick="deleteAnswer('m1', 'save-status-m1', 'error-m1')">Delete</button>
                            <span class="save-status" id="save-status-m1"></span>
                            <span class="error-message" id="error-m1"></span>
                        </div>
                    </td>
                </tr>
                 <tr>
                    <td>
                        <input type="text" class="required-answer" placeholder="Enter metaphor #2 here..." data-question="m2">
                        <div class="button-group">
                            <button class="save-button" onclick="saveAnswer('m2', 'save-status-m2', 'error-m2')">Save</button>
                            <button class="delete-button" onclick="deleteAnswer('m2', 'save-status-m2', 'error-m2')">Delete</button>
                            <span class="save-status" id="save-status-m2"></span>
                            <span class="error-message" id="error-m2"></span>
                        </div>
                    </td>
                </tr>
                 <tr>
                    <td>
                        <input type="text" class="required-answer" placeholder="Enter metaphor #3 here..." data-question="m3">
                        <div class="button-group">
                            <button class="save-button" onclick="saveAnswer('m3', 'save-status-m3', 'error-m3')">Save</button>
                            <button class="delete-button" onclick="deleteAnswer('m3', 'save-status-m3', 'error-m3')">Delete</button>
                            <span class="save-status" id="save-status-m3"></span>
                            <span class="error-message" id="error-m3"></span>
                        </div>
                    </td>
                </tr>
                 <tr><td><input type="text" placeholder="Optional: Enter another metaphor..." data-question="m4"><div class="button-group"><button class="save-button" onclick="saveAnswer('m4', 'save-status-m4', 'error-m4')">Save</button><button class="delete-button" onclick="deleteAnswer('m4', 'save-status-m4', 'error-m4')">Delete</button><span class="save-status" id="save-status-m4"></span><span class="error-message" id="error-m4"></span></div></td></tr>
                 <tr><td><input type="text" placeholder="Optional: Enter another metaphor..." data-question="m5"><div class="button-group"><button class="save-button" onclick="saveAnswer('m5', 'save-status-m5', 'error-m5')">Save</button><button class="delete-button" onclick="deleteAnswer('m5', 'save-status-m5', 'error-m5')">Delete</button><span class="save-status" id="save-status-m5"></span><span class="error-message" id="error-m5"></span></div></td></tr>
                 <tr><td><input type="text" placeholder="Optional: Enter another metaphor..." data-question="m6"><div class="button-group"><button class="save-button" onclick="saveAnswer('m6', 'save-status-m6', 'error-m6')">Save</button><button class="delete-button" onclick="deleteAnswer('m6', 'save-status-m6', 'error-m6')">Delete</button><span class="save-status" id="save-status-m6"></span><span class="error-message" id="error-m6"></span></div></td></tr>
            </tbody>
        </table>
        <p style="font-size: 0.9em; color: #555;">Note: Fields marked with * are required to proceed.</p>


        <div class="action-box">
            <strong>ACTION</strong><br>
            Practice the Clean Language technique in a conversation. Pay attention to the other person's metaphors and any words/phrases indicating feelings. Use Clean Language questions to explore further. (No submission required here, just practice).
        </div>

        <h2>1.3. Asking Better Questions</h2>

        <p>Great coaches listen more than they talk. Ask open-ended questions (starting with "What?", "Why?", "How?") that require thoughtful answers, not just "Yes" or "No". Probe for more detail with follow-up questions and allow adequate time for the coachee to think and respond – embrace the silence!</p>

        <div class="tip-box">
            <strong>TIP</strong><br>
            The 5 Whys technique is simple for probing. Our article, <em>Questioning Techniques</em>, offers more strategies for questions that encourage self-reflection.
        </div>

        <h2>1.4. Learning Emotional Intelligence</h2>

        <p>Emotional intelligence (EI) involves recognizing your own emotions, understanding their triggers, knowing how your behavior impacts others, and sensing others' needs. High EI leads to stronger relationships, better emotional control, and greater self-awareness – all vital for coaching.</p>

        <div class="ei-elements">
            <p><strong>The Five Elements of Emotional Intelligence:</strong></p>
            <ol>
                <li><strong>Self-Awareness:</strong> Introspection, understanding your behavior vs. values.</li>
                <li><strong>Self-Regulation:</strong> Controlling impulses and emotional responses.</li>
                <li><strong>Motivation:</strong> Prioritizing long-term success over immediate gratification.</li>
                <li><strong>Empathy:</strong> Understanding others' perspectives and feelings (crucial for coaching).</li>
                <li><strong>Social Skills:</strong> Building and maintaining positive relationships.</li>
            </ol>
        </div>

        <div class="action-box">
            <strong>ACTION</strong><br>
            Use the exercises below to increase your emotional intelligence. Answer the questions honestly. *
        </div>

        <!-- EI Question 1 -->
        <div class="question-box">
            <h3>1. Think about your reactions in stressful situations. Do you judge quickly or gather facts? How could you improve? *</h3>
            <textarea placeholder="Reflect on your stress responses and potential improvements..." class="required-answer" data-question="eq1"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('eq1', 'save-status-eq1', 'error-eq1')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('eq1', 'save-status-eq1', 'error-eq1')">Delete Answer</button>
                <span class="save-status" id="save-status-eq1"></span>
                <span class="error-message" id="error-eq1"></span>
            </div>
        </div>

        <!-- EI Question 2 -->
        <div class="question-box">
            <h3>2. Recall a time you lost emotional control at work. What happened? Impact? Prevention? Reflect below. *</h3>
            <textarea placeholder="Describe the situation, its effects, and future strategies..." class="required-answer" data-question="eq2"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('eq2', 'save-status-eq2', 'error-eq2')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('eq2', 'save-status-eq2', 'error-eq2')">Delete Answer</button>
                <span class="save-status" id="save-status-eq2"></span>
                <span class="error-message" id="error-eq2"></span>
            </div>
        </div>

        <!-- SWOT Analysis Questions -->
        <div class="question-box">
            <h3>3. Conduct a Personal SWOT Analysis. *</h3>
            <p><strong>Your Strengths:</strong></p>
            <textarea placeholder="List your key strengths relevant to coaching (e.g., patience, clarity)..." class="required-answer" data-question="swot-strengths"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('swot-strengths', 'save-status-swot-strengths', 'error-swot-strengths')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('swot-strengths', 'save-status-swot-strengths', 'error-swot-strengths')">Delete Answer</button>
                <span class="save-status" id="save-status-swot-strengths"></span>
                <span class="error-message" id="error-swot-strengths"></span>
            </div>
            <h3 style="margin-top: 20px;">How can you leverage these strengths in coaching? *</h3>
            <textarea placeholder="Explain how you'll use your strengths effectively..." class="required-answer" data-question="swot-ideas"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('swot-ideas', 'save-status-swot-ideas', 'error-swot-ideas')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('swot-ideas', 'save-status-swot-ideas', 'error-swot-ideas')">Delete Answer</button>
                <span class="save-status" id="save-status-swot-ideas"></span>
                <span class="error-message" id="error-swot-ideas"></span>
            </div>
            <h3 style="margin-top: 20px;">Your Weaknesses: *</h3>
            <textarea placeholder="Identify areas for improvement (e.g., interrupting, impatience)..." class="required-answer" data-question="swot-weaknesses"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('swot-weaknesses', 'save-status-swot-weaknesses', 'error-swot-weaknesses')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('swot-weaknesses', 'save-status-swot-weaknesses', 'error-swot-weaknesses')">Delete Answer</button>
                <span class="save-status" id="save-status-swot-weaknesses"></span>
                <span class="error-message" id="error-swot-weaknesses"></span>
            </div>
            <h3 style="margin-top: 20px;">How might these weaknesses affect coaching? How can you improve? *</h3>
            <textarea placeholder="Analyze the impact and plan improvement steps..." class="required-answer" data-question="swot-thoughts"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('swot-thoughts', 'save-status-swot-thoughts', 'error-swot-thoughts')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('swot-thoughts', 'save-status-swot-thoughts', 'error-swot-thoughts')">Delete Answer</button>
                <span class="save-status" id="save-status-swot-thoughts"></span>
                <span class="error-message" id="error-swot-thoughts"></span>
            </div>
        </div>

        <h2>1.5. Building Trust</h2>

        <p>Trust and confidentiality are the cornerstones of effective coaching. Your coachee needs to feel safe sharing openly with you.</p>

        <div class="trust-methods">
            <p><strong>Ways to Build Trust:</strong></p>
            <ul>
                <li><strong>Be Honest:</strong> Consistently tell the truth.</li>
                <li><strong>Share Appropriately:</strong> Relate relevant experiences (mistakes, values) without oversharing.</li>
                <li><strong>Keep Your Word:</strong> Fulfill promises or explain upfront why you can't.</li>
                <li><strong>Inspire:</strong> Demonstrate integrity, respect, loyalty, fairness, and authenticity.</li>
            </ul>
            <p>We'll delve deeper into trust-building in the next chapter.</p>
        </div>

        <div class="tip-box">
            <strong>TIP</strong><br>
            Approach difficult conversations as opportunities for a <em>Savvy Conversation</em> – be candid and direct while maintaining respect, engagement, and sensitivity.
        </div>

        <div class="action-box">
            <strong>ACTION</strong><br>
            Commit to daily journaling for a month to enhance self-awareness. Record daily events, and importantly, reflect on your feelings and reactions. (No submission required).
        </div>

        <div class="action-box">
            <strong>ACTION</strong><br>
            Reflect on this chapter's topics and answer the final questions below. *
        </div>

        <!-- Final Question 1 -->
        <div class="question-box">
            <h3>1. Which coaching skill (listening, communicating, questioning, EI, trust-building) do you find most challenging? Why? *</h3>
            <textarea placeholder="Identify your biggest challenge and explain the reasons..." class="required-answer" data-question="final-q1"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('final-q1', 'save-status-final-q1', 'error-final-q1')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('final-q1', 'save-status-final-q1', 'error-final-q1')">Delete Answer</button>
                <span class="save-status" id="save-status-final-q1"></span>
                <span class="error-message" id="error-final-q1"></span>
            </div>
        </div>

        <!-- Final Question 2 -->
        <div class="question-box">
            <h3>2. What specific steps can you take to improve your weakest coaching skill(s)? *</h3>
            <textarea placeholder="Outline actionable steps for improvement..." class="required-answer" data-question="final-q2"></textarea>
            <div class="button-group">
                <button class="save-button" onclick="saveAnswer('final-q2', 'save-status-final-q2', 'error-final-q2')">Save Answer</button>
                <button class="delete-button" onclick="deleteAnswer('final-q2', 'save-status-final-q2', 'error-final-q2')">Delete Answer</button>
                <span class="save-status" id="save-status-final-q2"></span>
                <span class="error-message" id="error-final-q2"></span>
            </div>
        </div>
         <p style="font-size: 0.9em; color: #555; margin-top: 15px;">Note: Fields marked with * are required to proceed.</p>

        <h2>1.6. Drawing This Together</h2>

        <p>In this chapter, we explored essential coaching skills: active listening, clear communication (using techniques like Clean Language), effective questioning, emotional intelligence, and building trust. Mastering these is fundamental for creating positive and productive coaching relationships.</p>

        <p>In the next chapter, we'll examine the coaching process itself.</p>

        <div class="image-container">
            <img src="https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-1.2.1&auto=format&fit=crop&w=1170&q=80"
                 alt="Coach and coachee collaborating at a whiteboard, symbolizing the coaching process"
                 onerror="this.src='https://via.placeholder.com/800x450/ffa726/ffffff?text=Coaching+Relationship'">
            <p>Building strong coaching relationships through trust and effective skills application.</p>
        </div>

        <!-- Navigation -->
        <div class="navigation-buttons">
            <a href="article1.html" class="nav-button">← Back to Article 1</a>
            <a href="coaching-individuals.html" class="nav-button" id="nextButton">Next: Coaching Individuals →</a>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const formspreeEndpoint = 'https://formspree.io/f/xzzeqvea'; // Your Formspree Endpoint URL
        const localStorageKey = 'allUserAnswers_coachingSkills'; // Specific key for THIS page's answers
        const userEmailKey = 'userEmail'; // Key used for storing user email during login
        const currentUserKey = 'currentUser'; // Key for storing the whole user object

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            const userEmail = getUserEmail();

            if (!userEmail) {
                console.warn('User session not found, redirecting to login.');
                alert('Your session seems to have expired. Please log in again.');
                window.location.href = 'login.html';
                return;
            }

            displayUserInfo(userEmail);
            loadUserAnswers(userEmail);
            setupEventListeners(userEmail);
            // Mark required questions visually (optional, could use CSS pseudo-elements too)
            markRequiredQuestions();
        });

        // --- User Info & Authentication ---
        function getUserEmail() {
            let userData = null;
            try {
                userData = JSON.parse(localStorage.getItem(currentUserKey));
            } catch (e) {
                console.error("Error parsing currentUser from localStorage:", e);
            }
            // Fallback to userEmailKey if currentUserKey fails or lacks email
            return userData?.email || localStorage.getItem(userEmailKey);
        }

        function displayUserInfo(userEmail) {
             let userData = {};
             try {
                 const storedData = localStorage.getItem(currentUserKey);
                 if (storedData) {
                     userData = JSON.parse(storedData) || {};
                 }
             } catch (e) {
                 console.error("Error parsing currentUser for display:", e);
             }
            const userName = userData.name || 'User'; // Default to 'User' if name is missing
            document.getElementById('userName').textContent = `Welcome, ${userName}`;
            document.getElementById('userEmail').textContent = userEmail;
        }

        function logout() {
            localStorage.removeItem('loggedIn'); // Assuming you use this key
            localStorage.removeItem(currentUserKey);
            localStorage.removeItem(userEmailKey);
            // Optionally clear specific answers for this page on logout
            // localStorage.removeItem(localStorageKey);
            window.location.href = 'login.html';
        }

         function markRequiredQuestions() {
             document.querySelectorAll('.required-answer').forEach(field => {
                 const questionBox = field.closest('.question-box');
                 if (questionBox) {
                     const heading = questionBox.querySelector('h3');
                     if (heading && !heading.textContent.includes('*')) {
                         heading.innerHTML += ' <span style="color:#e74c3c;">*</span>'; // Add asterisk visually
                     }
                     // Also find associated label/paragraph if needed
                     const precedingP = field.previousElementSibling;
                     if(precedingP && precedingP.tagName === 'P' && precedingP.textContent.includes(':') && !precedingP.textContent.includes('*')) {
                         precedingP.innerHTML += ' <span style="color:#e74c3c;">*</span>';
                     }
                 }
                 // Check for required inputs within tables
                 if(field.tagName === 'INPUT' && field.closest('table')) {
                     const actionBox = field.closest('td').closest('table').previousElementSibling;
                     if (actionBox && actionBox.classList.contains('action-box') && !actionBox.innerHTML.includes('*')) {
                         const strongTag = actionBox.querySelector('strong');
                         if(strongTag) {
                              strongTag.insertAdjacentHTML('afterend', '<br>Requirement: Fill at least 3 metaphor fields <span style="color:#e74c3c;">*</span>');
                         }
                     }
                 }

             });
             // Add note about asterisk meaning
             const lastReqNote = document.createElement('p');
             lastReqNote.style.fontSize = '0.9em';
             lastReqNote.style.color = '#555';
             lastReqNote.style.marginTop = '15px';
             lastReqNote.innerHTML = 'Note: Fields marked with <span style="color:#e74c3c;">*</span> are required to proceed.';
             const lastReqBox = document.querySelector('.question-box:has(.required-answer[data-question="final-q2"])');
             if (lastReqBox) {
                 lastReqBox.parentNode.insertBefore(lastReqNote, lastReqBox.nextSibling);
             }
             // Hide redundant notes added earlier by HTML directly
              document.querySelectorAll('p:contains("Note: Fields marked with * are required to proceed.")').forEach(p => p.style.display = 'none');


         }


        // --- Answer Handling (Local Storage) ---
        function loadUserAnswers(userEmail) {
            let allAnswers = {};
            try {
                 const storedAnswers = localStorage.getItem(localStorageKey);
                 if (storedAnswers) {
                     allAnswers = JSON.parse(storedAnswers) || {};
                 }
            } catch (e) {
                 console.error("Error parsing user answers from localStorage:", e);
                 // Optionally clear corrupted data: localStorage.removeItem(localStorageKey);
            }

            const userAnswers = allAnswers[userEmail] || {};

            document.querySelectorAll('.required-answer, input[type="text"][data-question]').forEach(field => {
                const questionId = field.getAttribute('data-question');
                const statusId = `save-status-${questionId}`;
                const statusElement = document.getElementById(statusId);

                if (userAnswers[questionId] !== undefined && userAnswers[questionId] !== null) {
                    field.value = userAnswers[questionId];
                    field.classList.remove('required-field'); // Remove red border if answer exists

                    // Show saved status only if there's actual text saved
                    if (String(userAnswers[questionId]).trim() !== '' && statusElement) {
                         statusElement.textContent = '✓ Saved';
                         statusElement.style.display = 'inline';
                         setTimeout(() => { // Auto-hide saved message after a delay
                             if (statusElement.textContent === '✓ Saved') { // Avoid hiding deletion message too quickly
                                 statusElement.style.display = 'none';
                             }
                         }, 4000);
                    } else if (statusElement) {
                        statusElement.style.display = 'none'; // Hide if saved answer is empty/null
                    }

                } else {
                    field.value = ''; // Clear field if no answer saved
                    if (statusElement) statusElement.style.display = 'none'; // Hide status if no answer
                }
            });
        }


        function saveAnswerToStorage(userEmail, questionId, answer) {
             let allAnswers = {};
             try {
                 const storedAnswers = localStorage.getItem(localStorageKey);
                 if (storedAnswers) {
                     allAnswers = JSON.parse(storedAnswers) || {};
                 }
             } catch (e) {
                 console.error("Error parsing user answers for saving:", e);
                 // Decide recovery strategy: Overwrite or alert user?
                 alert("Could not load previous answers. Your new answer will be saved, but existing data might be lost.");
                 allAnswers = {}; // Reset if corrupted
             }

            if (!allAnswers[userEmail]) {
                allAnswers[userEmail] = {};
            }
            allAnswers[userEmail][questionId] = answer; // Save the answer
            try {
                localStorage.setItem(localStorageKey, JSON.stringify(allAnswers));
            } catch (e) {
                 console.error("Error saving answers to localStorage:", e);
                 alert("Failed to save your answer. Local storage might be full or disabled.");
            }
        }

         function deleteAnswerFromStorage(userEmail, questionId) {
             let allAnswers = {};
             try {
                 const storedAnswers = localStorage.getItem(localStorageKey);
                 if (storedAnswers) {
                     allAnswers = JSON.parse(storedAnswers) || {};
                 }
             } catch (e) {
                 console.error("Error parsing user answers for deletion:", e);
                 // Don't proceed with deletion if data is corrupt
                 alert("Could not load answers to perform deletion due to data error.");
                 return;
             }

            if (allAnswers[userEmail]) {
                delete allAnswers[userEmail][questionId];
                // Optional: remove user entry if no answers left
                if (Object.keys(allAnswers[userEmail]).length === 0) {
                    delete allAnswers[userEmail];
                }
            }
            try {
                localStorage.setItem(localStorageKey, JSON.stringify(allAnswers));
             } catch (e) {
                 console.error("Error saving after deletion:", e);
                 // State might be inconsistent now
            }
        }

        // --- Event Listeners Setup ---
        function setupEventListeners(userEmail) {
             // Auto-remove required styling on input
             document.querySelectorAll('.required-answer, input[type="text"][data-question]').forEach(field => {
                field.addEventListener('input', function() {
                    if (this.value.trim() !== '') {
                        this.classList.remove('required-field');
                        const errorId = `error-${this.getAttribute('data-question')}`;
                        const errorElement = document.getElementById(errorId);
                        if (errorElement) errorElement.style.display = 'none';
                    } else if (this.classList.contains('required-answer')) {
                        // Re-add required field class if a required field is cleared
                        this.classList.add('required-field');
                    }
                 });
             });

            // Next button validation
            document.getElementById('nextButton').addEventListener('click', function(e) {
                if (!validateAllAnswers()) {
                    e.preventDefault(); // Stop navigation
                    showWarningMessage();
                }
            });
        }

        // --- UI Feedback & Validation ---
        function validateAllAnswers() {
            let allAnswered = true;
            let firstEmptyField = null;

            document.querySelectorAll('.required-answer').forEach(field => {
                const questionId = field.getAttribute('data-question');
                const errorId = `error-${questionId}`;
                const errorElement = document.getElementById(errorId);
                const isMetaphorField = questionId.startsWith('m'); // Check if it's a metaphor field

                 // Specific logic for metaphor fields: check if at least 3 are filled
                 if (isMetaphorField) {
                     // This check happens below after counting
                 } else {
                     // Standard check for other required fields
                     if (field.value.trim() === '') {
                         allAnswered = false;
                         field.classList.add('required-field');
                         if (errorElement) {
                             errorElement.textContent = 'This field is required.';
                             errorElement.style.display = 'inline';
                         }
                         if (!firstEmptyField) firstEmptyField = field; // Track the first empty field
                     } else {
                         field.classList.remove('required-field');
                         if (errorElement) errorElement.style.display = 'none';
                     }
                 }
            });

             // Check metaphor fields count
             let metaphorCount = 0;
             const metaphorFields = document.querySelectorAll('.required-answer[data-question^="m"]');
             metaphorFields.forEach(field => {
                 if (field.value.trim() !== '') {
                     metaphorCount++;
                 }
             });

             if (metaphorCount < 3) {
                 allAnswered = false;
                 // Highlight all required metaphor fields if count is insufficient
                 metaphorFields.forEach(field => {
                     const errorId = `error-${field.getAttribute('data-question')}`;
                     const errorElement = document.getElementById(errorId);
                     field.classList.add('required-field');
                     if (errorElement) {
                         errorElement.textContent = 'Please fill at least 3 metaphors.';
                         errorElement.style.display = 'inline';
                     }
                      if (!firstEmptyField) firstEmptyField = field; // Track the first empty field
                 });
             } else {
                 // Remove error state from metaphor fields if count is sufficient
                 metaphorFields.forEach(field => {
                      const errorId = `error-${field.getAttribute('data-question')}`;
                     const errorElement = document.getElementById(errorId);
                     // Only remove required-field if it doesn't fail other validation (though unlikely here)
                     if (!field.value.trim() == '') { // Keep required field if individually empty but count is met? Decide behavior. For now, remove if count >=3
                           field.classList.remove('required-field');
                            if (errorElement) errorElement.style.display = 'none';
                     }

                 });
             }


            if (!allAnswered && firstEmptyField) {
                // Scroll to the first empty field for better UX
                firstEmptyField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Add a slight delay for focus to work reliably after scroll
                setTimeout(() => firstEmptyField.focus({ preventScroll: true }), 300);
            }

            return allAnswered;
        }


        function showWarningMessage() {
            const warningElement = document.getElementById('warningMessage');
            warningElement.style.display = 'block';
            warningElement.style.animation = 'fadeIn 0.3s ease-in-out';

            // Auto-hide the warning message after a few seconds
            setTimeout(() => {
                warningElement.style.animation = 'fadeOut 0.5s ease-in-out forwards';
                 setTimeout(() => {
                      warningElement.style.display = 'none';
                      warningElement.style.animation = ''; // Reset animation
                 }, 500); // Match fadeOut duration
            }, 3500);
        }

        function showSaveStatus(statusId, message = '✓ Saved') {
             const statusElement = document.getElementById(statusId);
             if (!statusElement) return;
             statusElement.textContent = message;
             statusElement.style.color = message.includes('delete') ? '#e74c3c' : '#27ae60'; // Red for delete
             statusElement.style.display = 'inline';
             setTimeout(() => {
                 statusElement.style.display = 'none';
             }, 3000);
        }

        function showError(errorId, field, message = 'Please enter an answer.') {
             const errorElement = document.getElementById(errorId);
             if (!errorElement) return;
             errorElement.textContent = message;
             errorElement.style.display = 'inline';
             field.classList.add('required-field');
             // Avoid redundant focus call here as validation function handles it
        }

        function hideMessages(statusId, errorId, field) {
             const statusElement = document.getElementById(statusId);
             const errorElement = document.getElementById(errorId);
             if (statusElement) statusElement.style.display = 'none';
             if (errorElement) errorElement.style.display = 'none';
             // Only remove required-field if it's not actually required *and* empty
             if (!(field.classList.contains('required-answer') && field.value.trim() === '')) {
                 field.classList.remove('required-field');
             }
        }


        // --- Actions (Save, Delete) ---
        function saveAnswer(questionId, statusId, errorId) {
            const userEmail = getUserEmail();
            if (!userEmail) {
                alert('Session expired. Please login again.');
                window.location.href = 'login.html';
                return;
            }

            const field = document.querySelector(`[data-question="${questionId}"]`);
            if (!field) {
                console.error(`Field with data-question="${questionId}" not found.`);
                return;
            }
            const answer = field.value; // Get the raw value
            const isRequired = field.classList.contains('required-answer');

            hideMessages(statusId, errorId, field); // Hide previous messages

            // Validate ONLY if it's a required field OR if it's not empty
            if (isRequired && answer.trim() === '') {
                showError(errorId, field, 'This field is required.');
                return;
            }
             // Special validation for required metaphor fields (redundant check, but safe)
            if (questionId.startsWith('m') && isRequired) {
                 let metaphorCount = 0;
                 document.querySelectorAll('.required-answer[data-question^="m"]').forEach(mf => {
                     if(mf === field ? answer.trim() !== '' : mf.value.trim() !== '') {
                         metaphorCount++;
                     }
                 });
                 if (metaphorCount < 3 && answer.trim() === '') {
                      showError(errorId, field, 'Please fill at least 3 metaphors.');
                      return; // Don't save if this specific field makes count < 3 and is empty
                 }
                 // Clear the group error if saving this makes the count >= 3
                 if (metaphorCount >= 3) {
                      document.querySelectorAll('.required-answer[data-question^="m"]').forEach(mf => {
                          hideMessages(`save-status-${mf.getAttribute('data-question')}`, `error-${mf.getAttribute('data-question')}`, mf);
                      });
                 }
            }


            // 1. Save to Local Storage (save even if just whitespace, let trim happen on use)
            saveAnswerToStorage(userEmail, questionId, answer);

            // 2. Send to Formspree (send the raw answer)
            submitToFormspree(userEmail, questionId, answer);

            // 3. Show confirmation
            showSaveStatus(statusId);
        }

        function deleteAnswer(questionId, statusId, errorId) {
            const userEmail = getUserEmail();
             if (!userEmail) {
                alert('Session expired. Please login again.');
                window.location.href = 'login.html';
                return;
            }

            const field = document.querySelector(`[data-question="${questionId}"]`);
             if (!field) {
                console.error(`Field with data-question="${questionId}" not found.`);
                return;
            }
            const isRequired = field.classList.contains('required-answer');

            hideMessages(statusId, errorId, field); // Hide messages first

            // Clear the field
            field.value = '';

            // Remove from Local Storage
            deleteAnswerFromStorage(userEmail, questionId);

             // Note: We typically DON'T send a "delete" action to Formspree.

            // Show delete confirmation
             showSaveStatus(statusId, 'Answer deleted');

             // Re-apply required styling if it's a required field that's now empty
             if (isRequired) {
                 field.classList.add('required-field');
                  // Potentially re-run validation display for metaphor group if needed
                 if (questionId.startsWith('m')) {
                      validateAllAnswers(); // Re-check and display errors if count drops below 3
                 }
             } else {
                  field.classList.remove('required-field'); // Ensure non-required are not marked
             }
        }

        // --- Formspree Submission ---
        function submitToFormspree(userEmail, questionId, answer) {
            const formData = new FormData();
            formData.append('email', userEmail);
            formData.append('page', document.title); // Add page title for context
            formData.append('question_id', questionId);
            formData.append('answer_text', answer); // Send the actual answer text

            // Add question text for context (find the related h3 or p)
            let questionText = `Question ID: ${questionId}`; // Fallback
             const fieldElement = document.querySelector(`[data-question="${questionId}"]`);
             if (fieldElement) {
                 const questionBox = fieldElement.closest('.question-box');
                 if (questionBox) {
                     const h3 = questionBox.querySelector('h3');
                     if (h3) questionText = h3.textContent.replace('*','').trim();
                     else { // Maybe it's the SWOT description P tag
                         const p = fieldElement.previousElementSibling;
                         if (p && p.tagName === 'P') questionText = p.textContent.replace('*','').trim();
                     }
                 } else if (fieldElement.closest('table')) { // Metaphor table
                      questionText = "Metaphor Entry";
                 }
             }
            formData.append('question_text', questionText);


            fetch(formspreeEndpoint, {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    console.log(`Answer for ${questionId} (Page: ${document.title}) submitted successfully to Formspree.`);
                } else {
                     // Try to parse JSON error response from Formspree
                     response.json().then(data => {
                        const errorMsg = data?.errors ? data.errors.map(e => e.message || e.code).join(', ') : `Status: ${response.status}`;
                        console.error(`Formspree submission error for ${questionId} (${document.title}): ${errorMsg}`);
                    }).catch(() => {
                        // If response is not JSON or parsing fails
                        console.error(`Non-OK response from Formspree for ${questionId} (${document.title}). Status: ${response.status} ${response.statusText}`);
                    });
                }
            })
            .catch(error => {
                // Network errors or other fetch issues
                console.error(`Network error submitting form to Formspree for ${questionId} (${document.title}):`, error);
                 // Optional: Inform user if critical
                 // alert("Could not save your answer to the server. Please check your internet connection.");
            });
        }

    </script>
</body>
</html>
