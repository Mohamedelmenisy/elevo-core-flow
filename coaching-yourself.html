<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self Coaching</title>
    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* --- Global Styles (Consistent) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        body { margin: 0; padding: 0; line-height: 1.7; background-color: #f9f9f9; color: #333; }

        /* --- User Bar Styles (Consistent) --- */
        .user-bar { background-color: #34495e; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; color: white; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-info svg { opacity: 0.8; }
        .user-details { display: flex; flex-direction: column; }
        .user-name { font-weight: 600; font-size: 14px; }
        .user-email { font-size: 12px; opacity: 0.8; }
        .logout-button { background-color: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px; font-size: 13px; }
        .logout-button:hover { background-color: #c0392b; transform: translateY(-1px); }
        .logout-button:active { transform: translateY(0); }

        /* --- Navigation Tabs (Consistent) --- */
        .nav-tab { background-color: #2c3e50; padding: 12px 10px; text-align: center; position: sticky; top: 0; z-index: 100; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: thin; scrollbar-color: #556a80 #2c3e50; }
        .nav-tab::-webkit-scrollbar { height: 6px; }
        .nav-tab::-webkit-scrollbar-track { background: #2c3e50; }
        .nav-tab::-webkit-scrollbar-thumb { background-color: #556a80; border-radius: 10px; border: 1px solid #2c3e50; }
        .nav-tab a { color: white; text-decoration: none; margin: 0 8px; padding: 8px 12px; border-radius: 6px; transition: background-color 0.3s, color 0.3s; font-size: 14px; display: inline-block; }
        .nav-tab a:hover, .nav-tab a.active { background-color: #34495e; color: #fff; }

        /* --- Main Content Styles (Consistent) --- */
        h1 { color: #fff; background-color: #e67e22; padding: 20px; border-radius: 8px; text-align: center; margin: 25px auto; max-width: 800px; font-size: 26px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 + p { text-align: center; margin-top: -15px; margin-bottom: 25px; color: #555; font-size: 15px; }
        .container {
            max-width: 800px;
            margin: 0 auto 30px;
            background: white;
            padding: 30px;
            padding-top: 80px; /* <<< Added Padding Top */
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        .section-title { color: #e67e22; font-size: 1.6em; margin: 30px 0 15px 0; border-bottom: 2px solid #e67e22; padding-bottom: 8px; font-weight: 600; }
        .highlight-section { background-color: rgba(230, 126, 34, 0.07); padding: 20px; border-left: 5px solid #e67e22; border-radius: 6px; margin: 25px 0; }
        .action-card { background-color: #e67e22; color: white; padding: 20px; border-radius: 6px; margin: 25px 0; border-left: 5px solid #d35400; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .action-card > p, .action-card > h3 { color: white; }
        .media-container { text-align: center; margin: 30px 0; }
        .media-container img { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .caption { color: #555; margin-top: 10px; font-size: 14px; }
        .question-item { background-color: rgba(52, 152, 219, 0.08); padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #3498db; }
        .question-text { color: #34495e; font-weight: 600; margin-bottom: 15px; font-size: 1.1em; }
        .question-text .required-star { color: #e74c3c; font-weight: bold; margin-left: 3px; }
        .action-card .question-item { background-color: rgba(255, 255, 255, 0.9); border-left: 4px solid #ffffff; padding: 15px; margin: 15px 0; }
        .action-card .question-item .question-text { color: #333; }
        .action-card .model-section { background: none; border: none; padding: 0; margin: 15px 0; }
        .action-card .model-section h3 { color: white; margin-bottom: 10px; }
        .action-card .model-section p { color: #eee; }
        .editable-answer { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; margin-top: 8px; margin-bottom: 10px; background-color: white; min-height: 45px; line-height: 1.6; display: block; color: #333; font-size: 15px; transition: border-color 0.3s, box-shadow 0.3s; }
        textarea.editable-answer { min-height: 80px; resize: vertical; }
        .editable-answer:focus { outline: none; border-color: #e67e22; box-shadow: 0 0 0 3px rgba(230, 126, 34, 0.2); }
        .editable-answer::placeholder { color: #aaa; opacity: 1; }
        .editable-answer:disabled { background-color: #f8f9fa; cursor: not-allowed; color: #6c757d; } /* Disabled state */
        .action-card .editable-answer { margin: 5px 0; color: #333; background-color: white; border: 1px solid #ccc; padding: 8px 10px; font-size: 14px; }
        .action-card input.editable-answer::placeholder { color: #888; }
        .save-btn, .delete-btn { color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; font-weight: 500; }
        .save-btn { background-color: #27ae60; margin-right: 8px; }
        .delete-btn { background-color: #e74c3c; }
        .save-btn:hover:not(:disabled) { background-color: #2ecc71; transform: translateY(-1px); }
        .delete-btn:hover:not(:disabled) { background-color: #c0392b; transform: translateY(-1px); }
        .save-btn:active, .delete-btn:active { transform: translateY(0); }
        .save-btn:disabled, .delete-btn:disabled { background-color: #bdc3c7; cursor: not-allowed; box-shadow: none; transform: none;} /* Disabled button state */
        /* Removed saved-message styles */
        .inline-error-message { color: #e74c3c; font-size: 13px; margin-left: 5px; display: none; font-weight: 500; }
        .action-card .inline-error-message { color: #f8d7da; }
        /* Tables */
        table { width: 100%; border-collapse: collapse; margin: 25px 0; font-size: 14px; }
        table, th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: 600; color: #333; }
        .action-table { width: 100%; margin: 20px 0; background-color: #f8f9fa; border-radius: 6px; overflow: hidden; border: 1px solid #ddd; }
        .action-table th { background-color: #34495e; color: white; text-align: center; }
        .action-table td { vertical-align: top; color: #333; }
        .action-card table { background-color: transparent; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 4px; }
        .action-card table th, .action-card table td { border-color: rgba(255, 255, 255, 0.3); }
        .action-card thead th { color: white; }
        .action-card .orange-row td { background-color: rgba(255, 255, 255, 0.8); vertical-align: top; padding: 8px; } /* Adjust padding */
         .action-card .orange-row .editable-answer { margin: 0; } /* Remove margin for tighter fit */
         .action-card .orange-row .answer-buttons { margin-top: 8px; } /* Consistent button spacing */

        .swot-table th:nth-child(1) { background-color: #27ae60 !important; color: white !important; }
        .swot-table th:nth-child(2) { background-color: #e74c3c !important; color: white !important; }
        .options-table th { color: white !important; text-align: center !important; }
        .options-table th:nth-child(1) { background-color: #3498db !important; }
        .options-table th:nth-child(2) { background-color: #2ecc71 !important; }
        .options-table th:nth-child(3) { background-color: #e74c3c !important; }
        .will-table th { color: white !important; text-align: center !important; }
        .will-table th:nth-child(1) { background-color: #3498db !important; }
        .will-table th:nth-child(2) { background-color: #9b59b6 !important; }
        .will-table th:nth-child(3) { background-color: #e67e22 !important; }
        /* Navigation Buttons */
        .button-container { display: flex; justify-content: space-between; margin-top: 40px; gap: 20px; border-top: 1px solid #eee; padding-top: 25px; }
        .button { text-decoration: none; padding: 12px 20px; color: white; border-radius: 4px; font-weight: 600; flex: 1; text-align: center; transition: all 0.3s ease; font-size: 15px; border: none; cursor: pointer; }
        .button.back { background-color: #6c757d; }
        .button#nextButton { background-color: #e67e22; }
        .button:hover { transform: translateY(-1px); filter: brightness(110%); }
        .button:active { transform: translateY(0); filter: brightness(100%); }
        .warning-message { background-color: #fff8e1; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; color: #333; display: none; font-size: 14px; line-height: 1.6; border-radius: 4px; font-weight: 500; }
        .required-field { border: 2px solid #e74c3c !important; background-color: #fff2f1 !important; box-shadow: none !important; }
        /* Section specific styles */
        .model-section, .trust-section, .rapport-section, .informal-tips { padding: 20px; border-radius: 6px; margin: 25px 0; border-left-width: 5px; border-left-style: solid; }
        .model-section { background-color: rgba(52, 152, 219, 0.1); border-left-color: #3498db; }
        .trust-section { background-color: rgba(46, 204, 113, 0.1); border-left-color: #2ecc71; }
        .rapport-section { background-color: rgba(155, 89, 182, 0.1); border-left-color: #9b59b6; }
        .informal-tips { background-color: rgba(241, 196, 15, 0.1); border-left-color: #f1c40f; }
        .drawing-together { display: flex; align-items: center; gap: 20px; background-color: rgba(155, 89, 182, 0.1); padding: 20px; border-radius: 6px; margin: 25px 0; border-left: 5px solid #9b59b6; }
        .drawing-icon { font-size: 28px; color: #9b59b6; flex-shrink: 0; }
        .answer-buttons { display: flex; gap: 8px; align-items: center; margin-top: 10px; flex-wrap: wrap; }
        /* Modal Styles */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; animation: modalFadeInBackground 0.3s ease-out; }
        @keyframes modalFadeInBackground { from { background: rgba(0,0,0,0); } to { background: rgba(0,0,0,0.6); } }
        .modal-content { background: white; padding: 30px 40px; border-radius: 8px; max-width: 450px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.2); position: relative; animation: modalSlideIn 0.3s ease-out; }
        @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .modal-button { background-color: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; margin-top: 25px; font-weight: bold; transition: all 0.3s; font-size: 15px; }
        .modal-button:hover { background-color: #219653; transform: translateY(-2px); }
        .close-modal { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #aaa; transition: color 0.3s; }
        .close-modal:hover { color: #555; }
        .required-star { color: #e74c3c; font-weight: bold; margin-left: 2px; }

         /* --- Progress Bar Styles --- */
        .question-progress-container { margin-top: 15px; background-color: #ecf0f1; border-radius: 5px; overflow: hidden; height: 12px; width: 100%; display: none; /* Hidden by default */ }
        .question-progress-bar { height: 100%; width: 100%; background: linear-gradient(90deg, #2ecc71, #27ae60); /* Green gradient */ border-radius: 5px; transition: opacity 0.5s ease-in-out; display: flex; align-items: center; justify-content: center; }
        .question-progress-text { font-size: 9px; font-weight: 600; color: white; text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2); white-space: nowrap; overflow: hidden; padding: 0 4px; }
        .table-container + .question-progress-container { margin-top: 10px; margin-bottom: 15px;} /* Space below table, above bar */

        /* Responsive Adjustments */
        @media (max-width: 768px) {
             h1 { font-size: 22px; padding: 15px; margin: 20px 15px; }
             h1 + p { font-size: 14px; margin: -10px 15px 20px; }
             .container { padding: 20px; padding-top: 40px; /* Consistent padding */ margin: 0 15px 20px; }
             .user-bar { padding: 10px 15px; font-size: 13px; }
             .user-name { font-size: 13px; }
             .user-email { font-size: 11px; }
             .logout-button { padding: 7px 12px; font-size: 12px; }
             .nav-tab { padding: 10px 5px; }
             .nav-tab a { margin: 0 5px; padding: 7px 10px; font-size: 13px;}
             .section-title { font-size: 1.4em; margin: 25px 0 10px 0; }
              .highlight-section, .action-card, .question-item, .model-section, .trust-section, .rapport-section, .informal-tips, .drawing-together { padding: 15px; margin: 20px 0; }
             .editable-answer { font-size: 14px; padding: 10px; }
             textarea.editable-answer { min-height: 80px; }
             .save-btn, .delete-btn { padding: 7px 13px; font-size: 13px; }
             .button-container { flex-direction: column; gap: 15px; padding-top: 20px; margin-top: 30px;}
             .button { font-size: 14px; padding: 12px 15px;}
             .modal-content { max-width: 90%; padding: 20px 25px; }
             .modal-button { padding: 10px 20px; font-size: 14px; }
             .close-modal { top: 10px; right: 10px; font-size: 20px; }
             .warning-message { font-size: 13px; }
             /* Responsive Tables */
             table, thead, tbody, th, td, tr { display: block; }
             thead tr { position: absolute; top: -9999px; left: -9999px; }
             tr { border: 1px solid #ccc; margin-bottom: 10px; border-radius: 4px; }
             .action-card tr { border: 1px solid rgba(255,255,255,0.3); }
             td { border: none; border-bottom: 1px solid #eee; position: relative; padding-left: 40% !important; /* Ensure padding for label */ text-align: right !important; min-height: 40px; }
             .action-card td { border-bottom: 1px solid rgba(255,255,255,0.2); padding-left: 6px !important; text-align: left !important;}
             td:before { position: absolute; top: 6px; left: 6px; width: 35%; padding-right: 10px; white-space: nowrap; content: attr(data-label); font-weight: bold; text-align: left;}
             .action-card td:before { color: #eee; }
             .action-card .orange-row td:before { display: none; }
             .action-card .editable-answer { width: 100%; }
             /* Keep action table headers */
              .action-table thead, .action-table tr, .action-table th, .action-table td { display: revert; }
             .action-table th { text-align: center;}
             .action-table td { padding-left: 10px !important; text-align: left !important;}
             .action-table td:before { display: none; }
             .answer-buttons { justify-content: flex-start; margin-top: 8px; } /* Adjust button alignment */
        }
        @media (max-width: 480px) { h1 { font-size: 20px; } h2 { font-size: 1.3em; } h3 { font-size: 1.1em; } .container { padding: 15px; padding-top: 30px; margin: 0 10px 15px; } .warning-message { font-size: 12px; padding: 10px 15px; } .button-group { gap: 8px; } }

    </style>
</head>
<body>
    <!-- User Info Bar -->
    <div class="user-bar"> <div class="user-info"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.8;"> <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> <circle cx="12" cy="7" r="4"></circle> </svg> <div class="user-details"> <span class="user-name" id="userName">Welcome back</span> <span class="user-email" id="userEmail">user@example.com</span> </div> </div> <button class="logout-button" onclick="logout()"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path> <polyline points="16 17 21 12 16 7"></polyline> <line x1="21" y1="12" x2="9" y2="12"></line> </svg> Logout </button> </div>

    <!-- Navigation Tabs (Reordered) -->
    <nav class="nav-tab">
        <a href="dashboard.html">Dashboard</a>
        <a href="index.html">Home</a>
        <a href="introduction.html">Introduction</a>
        <a href="coaching-skills.html">Coaching Skills</a>
        <a href="coaching-individuals.html">Coaching Individuals</a>
        <a href="coaching-team.html">Team Coaching</a>
        <a href="coaching-yourself.html" class="active">Self Coaching</a>
        <a href="action-plan.html">Action Plan</a>
        <a href="ass.html">Assessment</a>
    </nav>

    <h1>Self Coaching</h1>
    <p>Applying coaching techniques for personal development</p>

    <div class="container">
        <h2 class="section-title">4. Coaching Yourself</h2>
        <div class="highlight-section"> <p>A coach's role is to solve problems, identify goals and put action plans into place. Once you've learned to use these skills, you can apply them to yourself, too.</p> </div>
        <p>As we've seen, the coaching process can boost your team members' confidence, build their self- awareness, and help to keep them motivated. So why stop there?</p>
        <p>Using the skills you've learned to coach yourself is a great way to "practice what you preach" with your team. And, as a role model, your people will be inspired to achieve their goals when they see you fulfilling yours.</p>
        <div class="media-container"> <img src="https://images.unsplash.com/photo-1600880292203-757bb62b4baf?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Woman reviewing her personal development plan with coaching techniques" loading="lazy"> <p class="caption">Applying coaching techniques to your own development</p> </div>

        <h2 class="section-title">4.1 Identifying Your Strengths and Weaknesses</h2>
        <p>Before you begin any journey, you need to know your starting point. It's the same with coaching. When you begin to coach yourself, you have to understand your strengths and weaknesses.</p>
        <p>When you know what you're good at, you can use those strengths to achieve your goals. And when you identify your weakest areas, you can come up with strategies to address them, or to minimize their impact.</p>

        <!-- SWOT Analysis Action Card -->
        <div class="action-card">
            <h3>ACTION: Perform a personal SWOT analysis<span class="required-star">*</span></h3>
            <p>Identify at least one key strength and one key weakness.</p>
            <div class="table-container" id="swot-table-container"> <!-- Added container ID -->
                <table class="swot-table">
                     <thead> <tr> <th>My Strengths</th> <th>My Weaknesses</th> </tr> </thead>
                     <tbody>
                        <tr class="orange-row"> <td data-label="Strength"> <textarea class="editable-answer required-answer" data-question="strength1" placeholder="Enter your biggest strength..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('strength1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('strength1')">Delete</button> <span class="saved-message" id="save-status-strength1"></span> <span class="inline-error-message" id="error-strength1"></span> </div> </td> <td data-label="Weakness"> <textarea class="editable-answer required-answer" data-question="weakness1" placeholder="Enter your biggest weakness..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('weakness1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('weakness1')">Delete</button> <span class="saved-message" id="save-status-weakness1"></span> <span class="inline-error-message" id="error-weakness1"></span> </div> </td> </tr>
                        <tr class="orange-row"> <td data-label="Strength"> <textarea class="editable-answer" data-question="strength2" placeholder="Enter another strength (optional)..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('strength2')">Save</button> <button class="delete-btn" onclick="deleteAnswer('strength2')">Delete</button> <span class="saved-message" id="save-status-strength2"></span> </div> </td> <td data-label="Weakness"> <textarea class="editable-answer" data-question="weakness2" placeholder="Enter another weakness (optional)..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('weakness2')">Save</button> <button class="delete-btn" onclick="deleteAnswer('weakness2')">Delete</button> <span class="saved-message" id="save-status-weakness2"></span> </div> </td> </tr>
                        <tr class="orange-row"> <td data-label="Strength"> <textarea class="editable-answer" data-question="strength3" placeholder="Enter another strength (optional)..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('strength3')">Save</button> <button class="delete-btn" onclick="deleteAnswer('strength3')">Delete</button> <span class="saved-message" id="save-status-strength3"></span> </div> </td> <td data-label="Weakness"> <textarea class="editable-answer" data-question="weakness3" placeholder="Enter another weakness (optional)..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('weakness3')">Save</button> <button class="delete-btn" onclick="deleteAnswer('weakness3')">Delete</button> <span class="saved-message" id="save-status-weakness3"></span> </div> </td> </tr>
                     </tbody>
                </table>
            </div> <!-- End table-container -->
             <!-- Progress Bar for SWOT Table -->
            <div class="question-progress-container table-progress-container" id="swot-progress-container">
                <div class="question-progress-bar" id="progress-bar-swot">
                    <span class="question-progress-text" id="progress-text-swot">✔️ Requirement Met</span>
                </div>
            </div>
             <p style="font-size: 0.9em; color: #eee; margin-top: 10px;"><span class="required-star" style="color:#f8d7da;">*</span> First Strength and Weakness are required.</p>
        </div>

        <!-- Reflection Question -->
        <div class="question-item" id="question-container-reflection1">
            <div class="question-text">Reflection: How do these strengths and weaknesses impact your professional development?<span class="required-star">*</span></div>
            <textarea class="editable-answer required-answer" data-question="reflection1" placeholder="Consider how you can leverage strengths and mitigate weaknesses..."></textarea>
            <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('reflection1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('reflection1')">Delete</button>  <span class="inline-error-message" id="error-reflection1"></span> </div>
             <!-- Progress Bar -->
             <div class="question-progress-container" id="progress-container-reflection1">
                <div class="question-progress-bar" id="progress-bar-reflection1">
                    <span class="question-progress-text" id="progress-text-reflection1">✔️ Completed</span>
                </div>
            </div>
        </div>

        <div class="media-container"> <img src="https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Person analyzing their skills and competencies" loading="lazy"> <p class="caption">Honest self-assessment is the foundation of self-coaching</p> </div>

        <h2 class="section-title">4.2 Using the GROW Model for Self-Coaching</h2>
        <p>In Chapter 2, we discussed how to use The GROW Model in one-on-one coaching sessions. You can effectively apply this same structured approach to coach yourself.</p>
        <p>The GROW Model helps you clarify goals, understand your current situation, explore possibilities, and commit to action. Remember to schedule regular self-check-ins to review progress.</p>

        <!-- GROW Model Action Card -->
        <div class="action-card">
            <h3>ACTION: Use the GROW Model for Self-Coaching<span class="required-star">*</span></h3>
            <p>Apply the GROW model to a personal or professional goal.</p>
            <!-- Step 1: Goal -->
            <div class="model-section"> <h3>Step 1: Identify Your Goal (G)</h3> <p>Define what you want to achieve. Ensure your goal is SMART (Specific, Measurable, Achievable, Relevant, Time-bound).</p> <div class="question-item"> <div class="question-text">My SMART Goal:<span class="required-star">*</span></div> <textarea class="editable-answer required-answer" data-question="smart-goal" placeholder="e.g., Improve presentation skills by Q3, Delegate 2 tasks weekly..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('smart-goal')">Save</button> <button class="delete-btn" onclick="deleteAnswer('smart-goal')">Delete</button>  <span class="inline-error-message" id="error-smart-goal"></span> </div>
                 <!-- Progress Bar -->
                 <div class="question-progress-container" id="progress-container-smart-goal">
                    <div class="question-progress-bar" id="progress-bar-smart-goal">
                        <span class="question-progress-text" id="progress-text-smart-goal">✔️ Completed</span>
                    </div>
                </div>
              </div>
            </div>
            <!-- Step 2: Reality -->
            <div class="model-section"> <h3>Step 2: Examine Current Reality (R)</h3> <p>Honestly assess your current situation regarding this goal. What factors help or hinder you right now?</p> <div class="question-item"> <div class="question-text">Current Reality Assessment:<span class="required-star">*</span></div> <textarea class="editable-answer required-answer" data-question="current-reality" placeholder="Describe where you are now relative to the goal, including obstacles and resources..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('current-reality')">Save</button> <button class="delete-btn" onclick="deleteAnswer('current-reality')">Delete</button>  <span class="inline-error-message" id="error-current-reality"></span> </div>
                 <!-- Progress Bar -->
                 <div class="question-progress-container" id="progress-container-current-reality">
                    <div class="question-progress-bar" id="progress-bar-current-reality">
                        <span class="question-progress-text" id="progress-text-current-reality">✔️ Completed</span>
                    </div>
                </div>
              </div>
             </div>
            <!-- Step 3: Options -->
            <div class="model-section">
                <h3>Step 3: Explore Options (O)<span class="required-star">*</span></h3>
                <p>Brainstorm different ways you could reach your goal. Consider pros and cons for each (list at least one option).</p>
                <div class="table-container" id="options-table-container"> <!-- Added container ID -->
                    <table class="options-table">
                         <thead> <tr> <th>Possible Options</th> <th>Advantages (Pros)</th> <th>Disadvantages (Cons)</th> </tr> </thead>
                         <tbody>
                            <tr class="orange-row"> <td data-label="Option"> <textarea class="editable-answer required-answer" data-question="option1" placeholder="Option 1..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('option1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('option1')">Delete</button>  <span class="inline-error-message" id="error-option1"></span> </div> </td> <td data-label="Pros"> <textarea class="editable-answer" data-question="pro1" placeholder="Advantages..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('pro1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('pro1')">Delete</button> </div> </td> <td data-label="Cons"> <textarea class="editable-answer" data-question="con1" placeholder="Disadvantages..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('con1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('con1')">Delete</button> </div> </td> </tr>
                            <tr class="orange-row"> <td data-label="Option"> <textarea class="editable-answer" data-question="option2" placeholder="Option 2 (optional)..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('option2')">Save</button> <button class="delete-btn" onclick="deleteAnswer('option2')">Delete</button> </div> </td> <td data-label="Pros"> <textarea class="editable-answer" data-question="pro2" placeholder="Advantages..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('pro2')">Save</button> <button class="delete-btn" onclick="deleteAnswer('pro2')">Delete</button> </div> </td> <td data-label="Cons"> <textarea class="editable-answer" data-question="con2" placeholder="Disadvantages..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('con2')">Save</button> <button class="delete-btn" onclick="deleteAnswer('con2')">Delete</button> </div> </td> </tr>
                            <tr class="orange-row"> <td data-label="Option"> <textarea class="editable-answer" data-question="option3" placeholder="Option 3 (optional)..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('option3')">Save</button> <button class="delete-btn" onclick="deleteAnswer('option3')">Delete</button> </div> </td> <td data-label="Pros"> <textarea class="editable-answer" data-question="pro3" placeholder="Advantages..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('pro3')">Save</button> <button class="delete-btn" onclick="deleteAnswer('pro3')">Delete</button> </div> </td> <td data-label="Cons"> <textarea class="editable-answer" data-question="con3" placeholder="Disadvantages..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('con3')">Save</button> <button class="delete-btn" onclick="deleteAnswer('con3')">Delete</button> </div> </td> </tr>
                         </tbody>
                    </table>
                </div> <!-- End table-container -->
                 <!-- Progress Bar for Options Table Requirement-->
                <div class="question-progress-container table-progress-container" id="options-progress-container">
                    <div class="question-progress-bar" id="progress-bar-options">
                        <span class="question-progress-text" id="progress-text-options">✔️ Requirement Met</span>
                    </div>
                </div>
                 <p style="font-size: 0.9em; color: #eee; margin-top: 10px;"><span class="required-star" style="color:#f8d7da;">*</span> First option is required.</p>
            </div>

            <!-- Step 4: Will -->
            <div class="model-section">
                <h3>Step 4: Establish the Will (W)<span class="required-star">*</span></h3>
                <p>Commit to specific actions. Create a plan with dates and ways to measure success. Schedule regular check-ins.</p>
                <div class="table-container" id="will-table-container"> <!-- Added container ID -->
                    <table class="will-table">
                         <thead> <tr> <th>Action Steps</th> <th>Completion Date</th> <th>Success Measures</th> </tr> </thead>
                         <tbody>
                            <tr class="orange-row"> <td data-label="Action"> <textarea class="editable-answer required-answer" data-question="action1" placeholder="Specific action step 1..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('action1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('action1')">Delete</button>  <span class="inline-error-message" id="error-action1"></span> </div> </td> <td data-label="Date"> <input type="date" class="editable-answer required-answer" data-question="date1"> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('date1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('date1')">Delete</button>  <span class="inline-error-message" id="error-date1"></span> </div> </td> <td data-label="Measure"> <textarea class="editable-answer required-answer" data-question="measure1" placeholder="How will you know it's done/successful?"></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('measure1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('measure1')">Delete</button>  <span class="inline-error-message" id="error-measure1"></span> </div> </td> </tr>
                            <tr class="orange-row"> <td data-label="Action"> <textarea class="editable-answer" data-question="action2" placeholder="Action step 2 (optional)..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('action2')">Save</button> <button class="delete-btn" onclick="deleteAnswer('action2')">Delete</button> </div> </td> <td data-label="Date"> <input type="date" class="editable-answer" data-question="date2"> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('date2')">Save</button> <button class="delete-btn" onclick="deleteAnswer('date2')">Delete</button> </div> </td> <td data-label="Measure"> <textarea class="editable-answer" data-question="measure2" placeholder="How will you know it's done/successful?"></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('measure2')">Save</button> <button class="delete-btn" onclick="deleteAnswer('measure2')">Delete</button> </div> </td> </tr>
                            <tr class="orange-row"> <td data-label="Action"> <textarea class="editable-answer" data-question="action3" placeholder="Action step 3 (optional)..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('action3')">Save</button> <button class="delete-btn" onclick="deleteAnswer('action3')">Delete</button> </div> </td> <td data-label="Date"> <input type="date" class="editable-answer" data-question="date3"> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('date3')">Save</button> <button class="delete-btn" onclick="deleteAnswer('date3')">Delete</button> </div> </td> <td data-label="Measure"> <textarea class="editable-answer" data-question="measure3" placeholder="How will you know it's done/successful?"></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('measure3')">Save</button> <button class="delete-btn" onclick="deleteAnswer('measure3')">Delete</button> </div> </td> </tr>
                         </tbody>
                    </table>
                </div><!-- End table-container -->
                 <!-- Progress Bar for Will Table Requirement -->
                <div class="question-progress-container table-progress-container" id="will-progress-container">
                    <div class="question-progress-bar" id="progress-bar-will">
                        <span class="question-progress-text" id="progress-text-will">✔️ Requirement Met</span>
                    </div>
                </div>
                 <p style="font-size: 0.9em; color: #eee; margin-top: 10px;"><span class="required-star" style="color:#f8d7da;">*</span> First Action Step, Date, and Measure are required.</p>
            </div>
        </div>

        <div class="highlight-section"> <p><strong>TIP:</strong> Schedule regular "check-in" sessions with yourself (weekly or bi-weekly) to review your progress on your GROW plan. Treat these sessions as seriously as you would a coaching session with someone else - put them in your calendar and prepare for them.</p> </div>
         <!-- General Warning Message -->
        <div class="warning-message" id="generalWarningMessage"> <strong>Action Required:</strong> Please complete all required fields (marked with <span class="required-star">*</span>) before proceeding. </div>
        <!-- Navigation Buttons -->
        <div class="button-container"> <a href="coaching-team.html" class="button back">← Back to Team Coaching</a> <button type="button" class="button" id="nextButton">Next: Action Plan →</button> </div>
    </div>

    <!-- Success Modal (Keep for potential future use) -->
    <div id="successModal" class="modal-overlay"> <div class="modal-content"> <button class="close-modal" onclick="closeModal()">×</button> <h3 style="color: #27ae60;">Section Complete!</h3> <p>All required answers for this section have been saved.</p> <p>You can now proceed to the next section.</p> <button class="modal-button" onclick="redirectToNextPage()">CONTINUE TO ACTION PLAN</button> </div> </div>

    <script>
        // --- Supabase Configuration ---
        const SUPABASE_URL = 'https://lgcutmuspcaralydycmg.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxnY3V0bXVzcGNhcmFseWR5Y21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NDY3MDEsImV4cCI6MjA2MTAyMjcwMX0.3u5Y7pkH2NNnnoGLMWVfAa5b8fq88o1itRYnG1K38tE';
        let supabase = null;

        // --- Configuration ---
        // REMOVED: Formspree Endpoint
        const localStorageKey = 'allUserAnswers_selfCoaching';
        const SECTION_ID = 'self'; // Unique ID for this section
        const PAGE_NAME = 'coaching-yourself.html';

        // --- Unified Keys ---
        const LOGGED_IN_KEY = 'isUserLoggedIn';
        const CURRENT_USER_KEY = 'currentUser';

         // Initialize Supabase Client
         try {
             if (window.supabase && window.supabase.createClient) {
                 supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                 console.log(`Supabase client initialized successfully on ${PAGE_NAME}.`);
             } else { throw new Error("Supabase library not found."); }
         } catch (error) { console.error("CRITICAL ERROR initializing Supabase:", error); }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
             console.log(`%c${PAGE_NAME}: DOMContentLoaded event fired.`, "color: green;");
             if (!supabase) {
                 console.error(`Supabase client failed to initialize on ${PAGE_NAME}. Some features might not work.`);
             }

             const currentUser = getCurrentUser();
              if (!currentUser || !currentUser.id || !currentUser.email) { // Added ID check
                 console.error(`%c${PAGE_NAME}: User not logged in or essential data missing. Redirecting...`, "color: red;");
                  if (!window.location.search.includes('redir_attempt')) { window.location.href = `login.html?redirect=${encodeURIComponent(window.location.pathname + window.location.search)}&redir_attempt=1`; }
                  else { console.error("REDIRECTION LOOP DETECTED."); document.body.innerHTML = '<p style="color: red; padding: 20px;">Login check failed repeatedly.</p>'; }
                 return;
             }
             console.log(`%c${PAGE_NAME}: User validated (${currentUser.email}, ID: ${currentUser.id}). Initializing.`, "color: green;");
             displayUserInfo(currentUser);
             loadUserAnswers(currentUser); // Pass full user object
             setupEventListeners(currentUser); // Pass full user object
             highlightActiveNav();
             // Removed addRequiredStars
             setupMobileTableLabels();
             console.log(`%c${PAGE_NAME}: Initialization complete.`, "color: blue;");
        });

        // --- User Info & Auth ---
        function getCurrentUser() { /* ... consistent ... */ try { const d = localStorage.getItem(CURRENT_USER_KEY); if (!d) return null; const p = JSON.parse(d); if (p && typeof p === 'object' && p.email && p.name && p.id) { if (typeof p.progress !== 'object' || p.progress === null) p.progress = {}; return p; } else { localStorage.removeItem(CURRENT_USER_KEY); localStorage.removeItem(LOGGED_IN_KEY); return null; } } catch (e) { console.error("GUC Error:", e); localStorage.removeItem(CURRENT_USER_KEY); localStorage.removeItem(LOGGED_IN_KEY); return null; } }
        function saveCurrentUser(userObject) { /* ... consistent ... */ try { if (!userObject || typeof userObject !== 'object') throw new Error("Invalid user object"); localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userObject)); console.log("Saved user data."); } catch (error) { console.error("SCU Error:", error); } }
        function displayUserInfo(user) { /* ... consistent ... */ if(!user) return; document.getElementById('userName').textContent=`Welcome, ${user.name || user.email.split('@')[0]}`; document.getElementById('userEmail').textContent=user.email;}
        function logout() { /* ... consistent ... */ localStorage.removeItem(LOGGED_IN_KEY); localStorage.removeItem(CURRENT_USER_KEY); window.location.href = 'login.html';}
        function highlightActiveNav() { /* ... consistent ... */ const cP=window.location.pathname.split('/').pop()||PAGE_NAME; document.querySelectorAll('.nav-tab a').forEach(l=>{const lP=(l.getAttribute('href')||'').split('/').pop(); l.classList.toggle('active',lP===cP);}); }
        function setupMobileTableLabels() { /* ... consistent ... */ document.querySelectorAll('table tbody tr').forEach(r=>{const h=Array.from(r.closest('table').querySelectorAll('thead th')).map(th=>th.textContent.replace('*','').trim()); r.querySelectorAll('td').forEach((t,i)=>t.setAttribute('data-label',h[i]||''));});}


        // --- Answer Handling (Local Storage & UI Locking) ---
        function loadUserAnswers(currentUser) {
            if (!currentUser || !currentUser.email) return;
            let allAnswers = {};
            try { const d = localStorage.getItem(localStorageKey); if (d) allAnswers = JSON.parse(d) || {}; }
            catch(e) { console.error("Load Answers Error:", e); }
            const userPageAnswers = allAnswers[currentUser.email] || {};

            // Load single textareas
            document.querySelectorAll('.question-item textarea.editable-answer, .model-section textarea.editable-answer').forEach(field => {
                const qId = field.dataset.question;
                const qContainer = field.closest('.question-item') || field.closest('.model-section');
                loadFieldState(field, qId, userPageAnswers, qContainer);
            });

             // Load Table Data
             loadTableData('swot', ['strength', 'weakness'], userPageAnswers);
             loadTableData('options', ['option', 'pro', 'con'], userPageAnswers);
             loadTableData('will', ['action', 'date', 'measure'], userPageAnswers);

            updateSectionProgress(SECTION_ID); // Recalculate overall progress
        }

        // Helper to load state for ANY field (Textarea, Input, Select)
        function loadFieldState(field, questionId, userAnswers, questionContainer) {
            if (!field) return;
             const errorId = `error-${questionId}`;
            const buttonGroup = field.parentElement?.querySelector('.answer-buttons'); // Find buttons relative to field
            const saveButton = buttonGroup?.querySelector('.save-btn');
            const deleteButton = buttonGroup?.querySelector('.delete-btn');

            hideMessages(errorId, field); // Clear previous state

            // Check if an answer exists AND it's not just whitespace
            if (userAnswers[questionId] !== undefined && userAnswers[questionId] !== null && userAnswers[questionId].trim() !== '') {
                field.value = userAnswers[questionId];
                field.disabled = true; // Disable field
                field.classList.remove('required-field');
                if (saveButton) {
                    saveButton.disabled = true;
                    saveButton.textContent = 'Saved ✔️';
                }
                if (deleteButton) {
                    deleteButton.disabled = true;
                    deleteButton.style.display = 'none'; // Hide delete button
                }
                // Show individual progress bar if the container exists
                const individualProgressContainer = document.getElementById(`progress-container-${questionId}`);
                if (individualProgressContainer && questionContainer) {
                     showQuestionProgressBar(individualProgressContainer);
                }

            } else {
                // Ensure fields are enabled if no answer is found or answer is empty/whitespace
                field.value = (field.type === 'date') ? '' : ''; // Reset field value (handle date type)
                field.disabled = false;
                if (saveButton) {
                    saveButton.disabled = false;
                    saveButton.textContent = 'Save';
                }
                if (deleteButton) {
                    deleteButton.disabled = false;
                    deleteButton.style.display = 'inline-block'; // Show delete button
                }
                 // Hide individual progress bar
                 const individualProgressContainer = document.getElementById(`progress-container-${questionId}`);
                if (individualProgressContainer && questionContainer) {
                    hideQuestionProgressBar(individualProgressContainer);
                }
            }
        }


         // Helper to load state for Tables & check completion requirement
         function loadTableData(tableType, prefixes, userAnswers) {
             const tableProgressContainer = document.getElementById(`${tableType}-progress-container`);
             let isRequirementMet = checkTableCompletion(tableType, userAnswers); // Check initial state

             const maxRows = (tableType === 'swot') ? 3 : 3; // Adjust max rows if needed

             for (let i = 1; i <= maxRows; i++) { // Loop through potential rows
                 for (const prefix of prefixes) {
                     const questionId = `${prefix}${i}`;
                     const field = document.querySelector(`[data-question="${questionId}"]`); // Use data-question
                     if (field) {
                          loadFieldState(field, questionId, userAnswers, null); // Load field state
                     }
                 }
             }

             // Show/Hide the specific progress bar below the table based on the requirement check
             if (isRequirementMet && tableProgressContainer) {
                  showQuestionProgressBar(tableProgressContainer);
             } else if (tableProgressContainer) {
                  hideQuestionProgressBar(tableProgressContainer);
             }
        }


        function saveAnswerToStorage(userEmail, questionId, answer) { /* ... consistent ... */ if(!userEmail) return false; let a={}; try{const d=localStorage.getItem(localStorageKey); if(d) a=JSON.parse(d)||{};}catch(e){console.error("Save Parse Err:",e); a={};} if(!a[userEmail]) a[userEmail]={}; a[userEmail][questionId]=answer; try{localStorage.setItem(localStorageKey,JSON.stringify(a)); return true;} catch(e){console.error("Save Storage Err:",e); return false;} }
        function deleteAnswerFromStorage(userEmail, questionId) { /* ... consistent ... */ if(!userEmail) return false; let a={}; try{const d=localStorage.getItem(localStorageKey); if(d) a=JSON.parse(d)||{}; else return false;} catch(e){console.error("Del Parse Err:",e); return false;} let u=false; if(a[userEmail]?.[questionId]!==undefined){delete a[userEmail][questionId]; u=true; if(Object.keys(a[userEmail]).length===0) delete a[userEmail];} if(u){try{localStorage.setItem(localStorageKey,JSON.stringify(a)); return true;}catch(e){console.error("Del Storage Err:", e); return false;}} return false; }

        // --- Event Listeners Setup ---
        function setupEventListeners(currentUser) { /* ... consistent ... */
            if (!currentUser?.email) return;
            document.querySelectorAll('.editable-answer').forEach(field => {
                const eventType = (field.type === 'date' || field.tagName === 'SELECT') ? 'change' : 'input'; // Use change for date/select
                field.addEventListener(eventType, function() {
                     const questionId = this.dataset.question; // Use data-question
                     const errorId = `error-${questionId}`;
                    hideError(errorId); // Hide specific error on input/change
                    if (this.value.trim() !== '') this.classList.remove('required-field');

                    // Check table completion silently on input/change
                    if(questionId.startsWith('strength') || questionId.startsWith('weakness')) checkTableCompletionSilently('swot');
                    if(questionId.startsWith('option')) checkTableCompletionSilently('options');
                    if(questionId.startsWith('action') || questionId.startsWith('date') || questionId.startsWith('measure')) checkTableCompletionSilently('will');
                });
            });
            const nextButton = document.getElementById('nextButton');
            if (nextButton) { nextButton.addEventListener('click', handleNextButtonClick); }
        }

        function handleNextButtonClick(e) { /* ... consistent ... */ if (!validateAllAnswers(true)) { e.preventDefault(); showGeneralWarningMessage(); } else { window.location.href = 'action-plan.html'; /* Direct navigation on success */ } }

        function checkTableCompletionSilently(tableType) { // Used on input to clear table-level validation errors
             const errorId = `error-${tableType}-table`; // Potential table-level error ID
             const errorElement = document.getElementById(errorId);
             if (!errorElement || errorElement.style.display === 'none') return; // No error showing, do nothing

             const currentUser = getCurrentUser(); if (!currentUser) return;
              let allAnswers = {}; try { const d = localStorage.getItem(localStorageKey); if (d) allAnswers = JSON.parse(d) || {}; } catch (e) {}
             const userAnswers = allAnswers[currentUser.email] || {};

             if (checkTableCompletion(tableType, userAnswers)) {
                  hideError(errorId); // Hide the table error if now complete
                  // Clear field highlights within the table based on requirement met
                  clearTableHighlights(tableType);
             }
        }


        // --- UI Feedback & Validation ---
        function validateAllAnswers(showErrors = false) {
             let allValid = true; let firstInvalidField = null;
             console.log(`Running validation (Show Errors: ${showErrors})`);

             // Textareas and GROW inputs
             document.querySelectorAll('textarea.required-answer[data-question], input.required-answer[data-question]').forEach(field => {
                 const qId = field.dataset.question;
                 const eId = `error-${qId}`;
                 if (!field.disabled && field.value.trim() === '') { // Only validate enabled fields
                     allValid = false;
                     if (showErrors) showError(eId, field);
                     if (!firstInvalidField) firstInvalidField = field;
                 } else if (!field.disabled) { // Clear errors for enabled, filled fields
                     hideError(eId); field.classList.remove('required-field');
                 } else { // Clear errors for disabled (already saved) fields
                      hideError(eId); field.classList.remove('required-field');
                 }
             });

             // Tables
             const currentUser = getCurrentUser();
             const userAnswers = currentUser ? (JSON.parse(localStorage.getItem(localStorageKey) || '{}')[currentUser.email] || {}) : {};

             if(!checkTableCompletion('swot', userAnswers, showErrors)){allValid=false; if(!firstInvalidField && showErrors) firstInvalidField=document.querySelector('#swot-table-container .required-field');} else {clearTableHighlights('swot');}
             if(!checkTableCompletion('options', userAnswers, showErrors)){allValid=false; if(!firstInvalidField && showErrors) firstInvalidField=document.querySelector('#options-table-container .required-field');} else {clearTableHighlights('options');}
             if(!checkTableCompletion('will', userAnswers, showErrors)){allValid=false; if(!firstInvalidField && showErrors) firstInvalidField=document.querySelector('#will-table-container .required-field');} else {clearTableHighlights('will');}

             // Scroll
             if(!allValid && showErrors && firstInvalidField){firstInvalidField.scrollIntoView({behavior:'smooth',block:'center'}); setTimeout(()=>firstInvalidField.focus({preventScroll:true}),400);}
             console.log("Validation result:", allValid);
             return allValid;
        }

         function clearTableHighlights(tableType) {
             document.querySelectorAll(`#${tableType}-table-container .required-field`).forEach(f => f.classList.remove('required-field'));
             hideError(`error-${tableType}-table`); // Hide any table-level error
             // Also hide individual cell errors within the now valid table
             let prefixes = [];
             if (tableType === 'swot') prefixes = ['strength', 'weakness'];
             else if (tableType === 'options') prefixes = ['option', 'pro', 'con'];
             else if (tableType === 'will') prefixes = ['action', 'date', 'measure'];
             for (let i = 1; i <= 3; i++) {
                  prefixes.forEach(p => hideError(`error-${p}${i}`));
             }
         }

        function showGeneralWarningMessage(message = "Please complete all required fields marked with *.") { /* ... consistent ... */ const w=document.getElementById('generalWarningMessage'); if(!w) return; w.innerHTML=`<strong>Action Required:</strong> ${message}`; w.style.animation='none'; void w.offsetWidth; w.style.display='block'; w.style.animation='slideDownFadeInWarn 0.4s ease-out'; clearTimeout(w.timer); w.timer=setTimeout(()=>{w.style.animation='fadeOutUpWarn 0.5s ease-out forwards'; setTimeout(()=>{if(w.style.animationName==='fadeOutUpWarn'){w.style.display='none';w.style.animation='';}},500);},4000); }
        // Removed show/hideSaveStatus as it's handled by button state
        function showError(errorId, fieldToFocus, message = 'Required field.') { /* ... consistent ... */ const e=document.getElementById(errorId); if(!e) return; e.textContent=message; const aC=e.closest('.action-card'); if(aC) e.style.color='#f8d7da'; else e.style.color='#e74c3c'; e.style.display='inline-block'; if(fieldToFocus) fieldToFocus.classList.add('required-field'); }
        function hideError(errorId) { /* ... consistent ... */ const e=document.getElementById(errorId); if(e) e.style.display='none';}
        function hideMessages(errorId, field) { // Simplified helper
             hideError(errorId);
             if (field) field.classList.remove('required-field');
         }


        // --- Actions (Save/Delete Single Fields/Cells) ---
        window.saveAnswer = async function(questionId) {
            if (!supabase) { alert('Database connection error. Cannot save.'); return; }
            const currentUser = getCurrentUser(); if (!currentUser?.email || !currentUser.id) { alert('Session expired.'); return; }

            const field = document.querySelector(`[data-question="${questionId}"]`); if (!field) { console.error("Save Error: Field missing for", questionId); return; }

            const questionContainer = field.closest('.question-item') || field.closest('td'); // Find relevant container
            const errorId = `error-${questionId}`;
            const buttonGroup = field.parentElement?.querySelector('.answer-buttons');
            const saveButton = buttonGroup?.querySelector('.save-btn');
            const deleteButton = buttonGroup?.querySelector('.delete-btn');

             if (!saveButton || !deleteButton) { console.error("Save Error: Buttons missing for", questionId); return; }
             if (field.disabled) { console.warn("Attempted to save already saved question:", questionId); return; }

            const answer = field.value;
            const trimmedAnswer = answer.trim();
            const isRequired = field.classList.contains('required-answer');

            hideMessages(errorId, field);

            if (isRequired && trimmedAnswer === '') {
                showError(errorId, field);
                updateRelevantProgressBar(questionId, false); // Update progress bar state
                return;
            }

            saveButton.disabled = true; saveButton.textContent = 'Saving...'; deleteButton.disabled = true;

            try {
                let questionText = `Answer for ${questionId}`; // Default
                const qTextElement = field.closest('.question-item')?.querySelector('.question-text'); // For standalone questions
                const tableCell = field.closest('td'); // For table questions
                const tableHeader = tableCell?.closest('table')?.querySelector(`thead th:nth-child(${tableCell.cellIndex + 1})`);

                if (qTextElement) {
                    questionText = qTextElement.textContent.replace('*','').trim();
                } else if (tableHeader) {
                     questionText = `${tableHeader.textContent.trim()} (Row ${questionId.match(/(\d+)$/)[1]})`; // Construct text for table cells
                }

                const submissionTime = new Date().toISOString();
                const userProgressPayload = {
                    user_id: currentUser.id, email: currentUser.email, question_id: questionId,
                    question_text: questionText, answer: answer, page: PAGE_NAME, status: 'completed',
                    submitted_at: submissionTime, updated_at: submissionTime, section_type: 'article',
                    section_id: SECTION_ID, section_title: document.title || 'Self Coaching', // Updated Title
                    progress_percentage: 100, score: null, is_passed: null
                };

                console.log("Attempting to upsert to user_progress:", userProgressPayload);
                const { data, error } = await supabase.from('user_progress').upsert([userProgressPayload], { onConflict: ['user_id', 'question_id'] }).select();
                if (error) throw new Error(`Supabase error: ${error.message}`);
                console.log("Supabase upsert successful:", data);

                // --- Update UI on SUCCESS ---
                field.disabled = true; saveButton.textContent = 'Saved ✔️'; deleteButton.style.display = 'none';
                saveAnswerToStorage(currentUser.email, questionId, answer);

                // Update relevant progress bar
                updateRelevantProgressBar(questionId, true);

                // REMOVED Formspree call

            } catch (error) {
                console.error(`Failed to save answer for ${questionId}:`, error);
                showError(errorId, field, `Save failed. Try again.`);
                saveButton.disabled = false; saveButton.textContent = 'Save'; deleteButton.disabled = false;
            }
        }

        window.deleteAnswer = function(questionId) {
             const currentUser = getCurrentUser(); if (!currentUser?.email) return;
             const field = document.querySelector(`[data-question="${questionId}"]`); if (!field) return;
             const errorId = `error-${questionId}`;

             if (field.disabled) { console.warn("Cannot delete saved answer:", questionId); return; }

             hideMessages(errorId, field); field.value = (field.type === 'date') ? '' : '';
             deleteAnswerFromStorage(currentUser.email, questionId); console.log("Cleared answer locally for", questionId);
             field.classList.remove('required-field');
             updateRelevantProgressBar(questionId, false); // Update progress bar state
        }


        // --- Progress Functions ---
        function updateSectionProgress(sectionId) {
             const currentUser = getCurrentUser(); if (!currentUser) return 0;
             let allAnswers = {}; try { const d = localStorage.getItem(localStorageKey); if (d) allAnswers = JSON.parse(d) || {}; } catch (e) {}
             const userAnswers = allAnswers[currentUser.email] || {};

             const reflectionComplete = !!userAnswers['reflection1']?.trim();
             const goalComplete = !!userAnswers['smart-goal']?.trim();
             const realityComplete = !!userAnswers['current-reality']?.trim();
             const swotComplete = checkTableCompletion('swot', userAnswers);
             const optionsComplete = checkTableCompletion('options', userAnswers);
             const willComplete = checkTableCompletion('will', userAnswers);

             const totalRequirements = 6; // 3 textareas + 3 tables
             const totalAnswered = (reflectionComplete ? 1 : 0) + (goalComplete ? 1 : 0) + (realityComplete ? 1 : 0) + (swotComplete ? 1 : 0) + (optionsComplete ? 1 : 0) + (willComplete ? 1 : 0);

             const progressPercentage = totalRequirements > 0 ? Math.round((totalAnswered / totalRequirements) * 100) : 0;

             if (!currentUser.progress) currentUser.progress = {};
             currentUser.progress[sectionId] = progressPercentage;
             saveCurrentUser(currentUser);
             console.log(`Section '${sectionId}' progress: ${progressPercentage}% (${totalAnswered}/${totalRequirements})`);
             return progressPercentage;
        }

        // Check if the minimum requirement for a specific table is met
        function checkTableCompletion(tableType, userAnswers, showErrors = false) {
            let tableIsValid = false;
            const errorId = `error-${tableType}-table`; // Table-level error message span
            if(errorId && !showErrors) hideError(errorId); // Hide if just checking silently

            if (tableType === 'swot') {
                 const s1 = userAnswers['strength1']?.trim();
                 const w1 = userAnswers['weakness1']?.trim();
                 tableIsValid = !!(s1 && w1);
                 if(!tableIsValid && showErrors) {
                      if(!s1) showError(`error-strength1`, document.querySelector('[data-question="strength1"]'));
                      if(!w1) showError(`error-weakness1`, document.querySelector('[data-question="weakness1"]'));
                      showError(errorId, null, "First Strength and Weakness required."); // Table level error
                 } else if (tableIsValid) {
                     hideError(errorId); // Hide table level error if valid
                     hideError(`error-strength1`); hideError(`error-weakness1`); // Hide cell errors
                     document.querySelector('[data-question="strength1"]')?.classList.remove('required-field');
                     document.querySelector('[data-question="weakness1"]')?.classList.remove('required-field');
                 }
            } else if (tableType === 'options') {
                 const o1 = userAnswers['option1']?.trim();
                 tableIsValid = !!o1;
                 if(!tableIsValid && showErrors) {
                    showError(`error-option1`, document.querySelector('[data-question="option1"]'));
                    showError(errorId, null, "First Option required.");
                 } else if (tableIsValid) {
                     hideError(errorId);
                     hideError(`error-option1`);
                     document.querySelector('[data-question="option1"]')?.classList.remove('required-field');
                 }
            } else if (tableType === 'will') {
                const a1 = userAnswers['action1']?.trim();
                const d1 = userAnswers['date1']?.trim();
                const m1 = userAnswers['measure1']?.trim();
                tableIsValid = !!(a1 && d1 && m1);
                 if(!tableIsValid && showErrors) {
                      if(!a1) showError(`error-action1`, document.querySelector('[data-question="action1"]'));
                      if(!d1) showError(`error-date1`, document.querySelector('[data-question="date1"]'));
                      if(!m1) showError(`error-measure1`, document.querySelector('[data-question="measure1"]'));
                       showError(errorId, null, "First Action, Date, and Measure required.");
                 } else if (tableIsValid) {
                      hideError(errorId);
                      hideError(`error-action1`); hideError(`error-date1`); hideError(`error-measure1`);
                      document.querySelector('[data-question="action1"]')?.classList.remove('required-field');
                      document.querySelector('[data-question="date1"]')?.classList.remove('required-field');
                      document.querySelector('[data-question="measure1"]')?.classList.remove('required-field');
                 }
            }
            console.log(`${tableType} completion check: ${tableIsValid}`);
            return tableIsValid;
        }


        // Shows the 100% completed bar for a specific question/group
        function showQuestionProgressBar(containerElement) {
             if (!containerElement) return;
             const barContainer = containerElement.querySelector('.question-progress-container') || containerElement; // Allow passing container directly
             const bar = barContainer.querySelector('.question-progress-bar');
             const text = barContainer.querySelector('.question-progress-text');
             if (barContainer && bar && text) {
                 bar.style.width = `100%`; // Always 100%
                 // Use specific text for table vs individual questions
                 const isTableBar = barContainer.id.includes('-progress-container') && !barContainer.id.includes('question-container'); // Check if it's a table bar
                 text.textContent = isTableBar ? `✔️ Requirement Met` : `✔️ Completed`;
                 barContainer.style.display = 'block';
             } else { /* console.warn("Progress elements missing in:", containerElement); */ }
        }

        // Hides the progress bar for a specific question/group
        function hideQuestionProgressBar(containerElement) {
             if (!containerElement) return;
             const barContainer = containerElement.querySelector('.question-progress-container') || containerElement; // Allow passing container directly
             if (barContainer) barContainer.style.display = 'none';
        }

        // --- Modal Handling ---
        function showSuccessModal() { /* ... consistent ... */ const m=document.getElementById('successModal'); if(m) m.style.display='flex'; }
        function closeModal() { /* ... consistent ... */ const m=document.getElementById('successModal'); if(m) m.style.display='none'; }
        function redirectToNextPage() { /* ... consistent ... */ window.location.href = 'action-plan.html'; /* UPDATE ME */ }

    </script>
</body>
</html>
