<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Course Progress</title>
    <!-- Favicon Links (Copied from article1.txt) -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <style>
        /* --- Base CSS Rules (Copied VERBATIM from article1.txt) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        body { margin: 0; padding: 0; line-height: 1.7; background-color: #f9f9f9; color: #333; display: flex; flex-direction: column; min-height: 100vh; } /* Added flex display */
        main { flex-grow: 1; } /* Allow main to grow */

        /* User Bar Styles (from article1.txt) */
        .user-bar { background-color: #34495e; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; color: white; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-info svg { opacity: 0.8; }
        .user-details { display: flex; flex-direction: column; }
        .user-name { font-weight: 600; font-size: 14px; }
        .user-email { font-size: 12px; opacity: 0.8; }
        .logout-button { background-color: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px; font-size: 13px; }
        .logout-button:hover { background-color: #c0392b; transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .logout-button:active { transform: translateY(0); }

        /* Navigation Tabs (from article1.txt - Not strictly needed for dashboard, but kept for potential future use) */
        .nav-tab { background-color: #2c3e50; padding: 12px 10px; text-align: center; position: sticky; top: 0; z-index: 100; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: thin; scrollbar-color: #556a80 #2c3e50; }
        .nav-tab::-webkit-scrollbar { height: 6px; } .nav-tab::-webkit-scrollbar-track { background: #2c3e50; } .nav-tab::-webkit-scrollbar-thumb { background-color: #556a80; border-radius: 10px; border: 1px solid #2c3e50; }
        .nav-tab a { color: white; text-decoration: none; margin: 0 8px; padding: 8px 12px; border-radius: 6px; transition: background-color 0.3s, color 0.3s; font-size: 14px; display: inline-block; }
        .nav-tab a:hover, .nav-tab a.active { background-color: #34495e; color: #fff; }

        /* Main Content & Container Styles (from article1.txt) */
         h1 { /* Style for main page title if needed - using dashboard specific below */
             color: #fff; background-color: #e67e22; padding: 20px; border-radius: 8px; text-align: center;
             margin: 25px auto; max-width: 800px; font-size: 26px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
         }
        .container { max-width: 800px; margin: 25px auto; background: white; padding: 30px; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px; }
        /* Other content styles from article1.txt (quotes, images, etc.) - kept for reference if needed */
        .quote { font-style: italic; border-left: 5px solid #e67e22; padding: 15px 20px; background-color: #fdfaf6; margin: 25px 0; color: #555; font-size: 15px; border-radius: 0 6px 6px 0; }
        .image-container { text-align: center; margin: 30px 0; }
        .image-container img { max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #eee; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .image-container p { font-size: 14px; color: #555; margin-top: 10px; }
        .tip-box, .action-box, .highlight-section, .skills-list { padding: 20px; border-radius: 6px; margin: 25px 0; font-size: 15px; border-left-width: 5px; border-left-style: solid; }
        .tip-box { background-color: #3498db; border-left-color: #2980b9; color: white;} .action-box { background-color: #e67e22; border-left-color: #d35400; color: white;}
        .highlight-section { background-color: rgba(52, 152, 219, 0.1); border-left-color: #3498db;}
        .skills-list { background-color: rgba(46, 204, 113, 0.1); border-left-color: #2ecc71; }
        .highlight { color: #e67e22; font-weight: 600; }
         h2 { color: #2c3e50; margin-bottom: 20px; font-size: 28px; } /* From reference */
         h3 { margin: 25px 0 15px; font-size: 22px; color: #2c3e50; } /* From reference */
         p { margin-bottom: 15px; color: #34495e; line-height: 1.7; } /* From reference */


        /* Footer Styling (from article1.txt) */
        .footer { text-align: center; padding: 20px 30px; background: #2c3e50; color: rgba(255, 255, 255, 0.8); margin-top: 40px; font-size: 14px; display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 25px; }
        .footer-text { text-align: center; }
        .social-icons { display: flex; gap: 18px; align-items: center; }
        .social-icons a { color: rgba(255, 255, 255, 0.8); text-decoration: none; display: inline-block; transition: transform 0.3s ease, color 0.3s ease; }
        .social-icons a:hover { color: #ffffff; transform: translateY(-2px); }
        .social-icons svg { width: 22px; height: 22px; fill: currentColor; vertical-align: middle; }
        /* --- End Base CSS --- */


        /* --- ✨ NEW / Updated Styles for Dashboard & Modal ✨ --- */

        /* Modal Overlay (Styled like reference, using darker overlay) */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(44, 62, 80, 0.75); /* Dark overlay slightly more opaque */
            z-index: 1000; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s ease-in-out;
        }
        .modal-overlay.visible { display: flex; opacity: 1; }

        /* Modal Content Box (Styled like reference container) */
        .modal-content {
            background: white; padding: 35px 40px; border-radius: 8px; /* Match container */
            max-width: 500px; width: 90%; text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); /* Standard shadow */
            position: relative; transform: scale(0.95); transition: transform 0.3s ease-in-out;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }

        /* Modal Message (Using reference paragraph style) */
        .modal-message { font-size: 1.1em; color: #34495e; margin-bottom: 30px; line-height: 1.7; }

        /* Modal Buttons Container */
        .modal-actions { display: flex; justify-content: center; gap: 15px; margin-top: 25px; }

        /* Modal Button Styling (Base) */
        .modal-button {
            border: none; padding: 10px 25px; font-size: 15px; cursor: pointer; border-radius: 6px; /* Match logout button */
            font-weight: 600; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;
            box-shadow: none; /* Cleaner look */
        }

        /* Close Button Style (Secondary/Grey - Match article nav button) */
        .modal-button.close { background-color: #6c757d; color: white; }
        .modal-button.close:hover { background-color: #5a6268; transform: translateY(-1px); }

        /* Back Button Style (Primary/Orange - Match article nav button) */
        .modal-button.back { background-color: #e67e22; color: white; }
        .modal-button.back:hover { background-color: #d35400; transform: translateY(-1px); }


        /* Dashboard Content Container (Hidden by default) */
        #dashboard-content {
            /* Uses the general .container style */
            display: none; /* Hidden initially */
            opacity: 0; transition: opacity 0.5s ease-in-out 0.1s; /* Slight delay */
        }
         #dashboard-content.visible { display: block; opacity: 1; }

        /* User Info Display Area (Styled like reference highlight boxes) */
        #dashboard-user-info {
            background-color: rgba(52, 152, 219, 0.1); /* Light blue bg */
            border-left: 5px solid #3498db; /* Blue accent */
            padding: 20px 25px;
            margin-bottom: 30px;
            border-radius: 0 6px 6px 0; /* Match reference */
        }
        #dashboard-user-info h3 { /* Using h3 style from reference */
            margin: 0 0 10px 0; font-size: 20px; color: #2c3e50;
        }
        #dashboard-user-info p { /* Using p style from reference */
            margin-bottom: 5px; font-size: 1em; color: #34495e;
        }
         #dashboard-user-info strong { font-weight: 600; color: #2c3e50; }


        /* Dashboard Table Styles (Refined to match article1.txt style) */
        #dashboardTable {
            width: 100%; margin: 30px 0; border-collapse: collapse; background-color: #fff;
            font-size: 15px; border: 1px solid #eee; border-radius: 8px; overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Lighter shadow */
        }
        #dashboardTable th, #dashboardTable td {
            border: none; border-bottom: 1px solid #eee; /* Lighter border */
            padding: 14px 18px; text-align: left; vertical-align: middle; line-height: 1.6;
        }
         #dashboardTable tbody tr:last-child td { border-bottom: none; }
        #dashboardTable th {
            background-color: #f8f9fa; /* Very light header */
            font-weight: 600; color: #495057; white-space: nowrap;
            border-bottom: 2px solid #e9ecef; /* Slightly thicker header border */
        }
        #dashboardTable tbody tr:nth-child(even) { background-color: transparent; } /* Remove stripe for cleaner look */
        #dashboardTable tbody tr:hover { background-color: #f8f9fa; } /* Subtle hover */


        /* Progress Bar Styles (Adjusted for consistency) */
        .progress-container { width: 100%; background-color: #e9ecef; border-radius: 10px; height: 22px; overflow: hidden; box-shadow: inset 0 1px 2px rgba(0,0,0,0.05); }
        .progress-bar {
            height: 100%; background: linear-gradient(90deg, #1abc9c, #16a085); /* Teal/Green gradient */
            color: white; text-align: center; font-size: 12px; font-weight: 600; line-height: 22px;
            border-radius: 10px; transition: width 0.6s ease; width: 0%; min-width: 5px; box-sizing: border-box;
            display: flex; align-items: center; justify-content: center; overflow: hidden; white-space: nowrap;
        }

        /* Improvement Percentage Text Styles */
        .improvement-percentage { font-weight: 600; display: inline-block; min-width: 55px; text-align: right;}
        .improvement-percentage.positive { color: #27ae60; } /* Green from reference buttons */
        .improvement-percentage.negative { color: #e74c3c; } /* Red from reference buttons */
        .improvement-percentage.neutral { color: #6c757d; } /* Grey from reference buttons */
        .skill-name { font-weight: 500; color: #34495e; }
        /* --- End Dashboard & Modal Styles --- */

        /* Add Responsive Adjustments if needed, copied from article1.txt */
         @media (max-width: 768px) {
            h1 { font-size: 22px; padding: 15px; margin: 20px 15px; }
            .container { padding: 20px; margin: 20px 15px; }
            .user-bar { padding: 10px 15px; font-size: 13px; }
            .user-name { font-size: 13px; } .user-email { font-size: 11px; }
            .logout-button { padding: 7px 12px; font-size: 12px; }
            .nav-tab { padding: 10px 5px; } .nav-tab a { margin: 0 5px; padding: 7px 10px; font-size: 13px;}
            .quote, .tip-box, .action-box, .highlight-section, .skills-list, #dashboard-user-info { padding: 15px; margin: 20px 0; }
            #dashboardTable th, #dashboardTable td { padding: 10px 12px; font-size: 14px; }
            .modal-content { padding: 25px 20px; } .modal-message { font-size: 1em; }
            .modal-button { padding: 10px 20px; font-size: 14px; }
            h2 { font-size: 24px; } h3 { font-size: 18px; }
         }

    </style>
</head>
<body>
    <!-- User Info Bar (Copied from article1.txt) -->
    <header class="user-bar">
        <div class="user-info">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> <circle cx="12" cy="7" r="4"></circle> </svg>
            <div class="user-details">
                 <!-- IDs changed for dashboard context -->
                <span class="user-name" id="headerUserName">Loading...</span>
                <span class="user-email" id="headerUserEmail"></span>
            </div>
        </div>
        <button class="logout-button" onclick="logout()">
             <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path> <polyline points="16 17 21 12 16 7"></polyline> <line x1="21" y1="12" x2="9" y2="12"></line> </svg>
            Logout
        </button>
    </header>

    <!-- Navigation Tabs (Optional - kept from article1.txt) -->
    <nav class="nav-tab">
        <a href="index.html">Home</a>
        <a href="article1.html">Article 1</a>
        <a href="coaching-skills.html">Coaching Skills</a>
        <!-- Add other nav items if needed -->
        <a href="admin_dashboard.html" class="active">Admin Dashboard</a> <!-- Mark dashboard as active -->
    </nav>

    <!-- Main Content Area -->
    <main>
        <!-- Dashboard Content (Inside Container, hidden initially) -->
        <div id="dashboard-content" class="container">

            <!-- User Info Display Area -->
            <div id="dashboard-user-info">
                 <!-- Content will be populated by JS -->
                <h3>Administrator Dashboard</h3>
                <p><strong>Viewing As:</strong> <span id="dashboardInfoName"></span></p>
                <p><strong>Email:</strong> <span id="dashboardInfoEmail"></span></p>
            </div>

            <h2>User Progress Overview</h2>
            <p>Detailed skill development tracking for the course participant.</p>

            <table id="dashboardTable">
                <thead>
                    <tr>
                        <th>User Email</th>
                        <th>Skill / Topic</th>
                        <th>Pre-Score</th>
                        <th>Post-Score</th>
                        <th>Improvement</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody id="progressDataBody">
                    <!-- Data loaded by JS -->
                </tbody>
            </table>
        </div>
    </main>

     <!-- Footer (Copied from article1.txt) -->
    <footer class="footer">
        <span class="footer-text">© 2025 Elmenisy Leadership Coaching - All Rights Reserved</span>
        <div class="social-icons">
             <a href="https://www.linkedin.com/in/mohamedmenisy17/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn Profile"><svg viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg></a>
             <a href="https://wa.me/201014527321" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp Chat"><svg viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01s-.521.074-.792.372c-.272.296-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg></a>
             <a href="https://www.instagram.com/mohamed_menisyy/profilecard/?igsh=d3ZwZDM4czRqMzB2" target="_blank" rel="noopener noreferrer" aria-label="Instagram Profile"><svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.172.053 1.905.33 2.46.538.7.268 1.192.64 1.64 1.092.45.447.83 1.004 1.093 1.64.208.555.485 1.288.538 2.46.058 1.265.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.053 1.172-.33 1.905-.538 2.46-.268.7-.64 1.192-1.092 1.64-.447.45-.997.827-1.64 1.093-.555.208-1.288.485-2.46.538-1.265.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.172-.053-1.905-.33-2.46-.538-.697-.268-1.19-.64-1.64-1.093-.45-.447-.827-.997-1.093-1.64-.208-.555-.485-1.288-.538-2.46-.058-1.265-.07-1.646-.07-4.85s.012-3.584.07-4.85c.053-1.172.33-1.905.538-2.46.268-.697.64-1.19 1.093-1.64.45-.45.997-.827 1.64-1.093.555-.208 1.288.485 2.46.538 1.265-.058 1.646-.07 4.85-.07zm0-2.163c-3.259 0-3.667.014-4.947.072-1.356.06-2.31.344-3.174.732-.884.396-1.627.96-2.377 1.71-.755.752-1.318 1.494-1.716 2.378-.386.863-.67 1.818-.73 3.172C.014 8.333 0 8.741 0 12s.014 3.667.072 4.947c.06 1.356.344 2.31.73 3.174.396.884.96 1.627 1.716 2.377.752.755 1.494 1.318 2.378 1.716.863.386 1.818.67 3.172.73 1.28.058 1.688.072 4.947.072s3.667-.014 4.947-.072c1.356-.06 2.31-.344 3.174-.73.884-.396 1.627-.96 2.377-1.716.755-.752 1.318-1.494 1.716-2.378.386.863.67-1.818.73-3.172.058-1.28.072-1.688.072-4.947s-.014-3.667-.072-4.947c-.06-1.356-.344-2.31-.73-3.174-.396-.884-.96-1.627-1.716-2.377-.752-.755-1.494-1.318-2.378-1.716-.863-.386-1.818-.67-3.172-.73C15.667.014 15.259 0 12 0zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162S15.403 5.838 12 5.838zm0 10.333c-2.306 0-4.171-1.865-4.171-4.171s1.865-4.171 4.171-4.171 4.171 1.865 4.171 4.171-1.865 4.171-4.171 4.171zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg></a>
        </div>
    </footer>

    <!-- Authentication Required Modal -->
    <div id="auth-modal-overlay" class="modal-overlay"> <!-- Renamed ID -->
        <div id="auth-modal-content" class="modal-content">
            <p class="modal-message">Admin access is required to view this content.</p>
            <div class="modal-actions">
                 <button id="modal-close-btn" class="modal-button close">Close</button>
                 <button id="modal-back-btn" class="modal-button back">Back to Course</button>
            </div>
        </div>
    </div>


    <script>
        // --- Configuration ---
        const ADMIN_EMAIL = "m.elsayed@thechefz.co"; // The designated admin email
        const COURSE_HOME_URL = "index.html"; // Main course page from article1.txt nav
        // --- Use Keys from Login/Signup/Article pages ---
        const LOGGED_IN_KEY = 'isUserLoggedIn'; // Corrected key from login.txt
        const CURRENT_USER_KEY = 'currentUser'; // Corrected key from login.txt

        // --- DOM Element References ---
        let dashboardContentEl, authModalOverlayEl, modalCloseBtn, modalBackBtn;
        let headerUserNameEl, headerUserEmailEl; // Elements in the top user bar
        let dashboardInfoNameEl, dashboardInfoEmailEl; // Elements in the dashboard info box
        let progressTableBodyEl;

        // --- Authentication Check (Uses localStorage keys from login/signup) ---
        function checkAdminAuthStatus() {
            try {
                // Check login flag first
                const isLoggedIn = localStorage.getItem(LOGGED_IN_KEY) === 'true';
                 if (!isLoggedIn) {
                     console.log("Auth Status Check: User not logged in.");
                     return { isAdmin: false, user: null }; // Not logged in
                 }

                // If logged in, get user data
                const userDataString = localStorage.getItem(CURRENT_USER_KEY);
                if (!userDataString) {
                    console.log("Auth Status Check: Logged in flag set, but no user data found.");
                     // Optional: Clear inconsistent state
                    // localStorage.removeItem(LOGGED_IN_KEY);
                     return { isAdmin: false, user: null }; // Logged in but no data
                 }

                const user = JSON.parse(userDataString);
                 if (!user || !user.email || !user.name) {
                     console.warn("Auth Status Check: Invalid user data format found.", user);
                     // Optional: Clear corrupted data
                     // localStorage.removeItem(CURRENT_USER_KEY);
                     // localStorage.removeItem(LOGGED_IN_KEY);
                      return { isAdmin: false, user: null }; // Data format issue
                 }

                // Check if the logged-in user is the admin
                const isUserAdmin = user.email.trim().toLowerCase() === ADMIN_EMAIL.toLowerCase();
                console.log(`Auth Status Check: Logged in as ${user.email}. Is Admin? ${isUserAdmin}`);
                return { isAdmin: isUserAdmin, user: user }; // Return auth status and user object

            } catch (e) {
                console.error("Error checking auth status from localStorage:", e);
                 // Treat as not authenticated on error
                 return { isAdmin: false, user: null };
            }
        }

        // --- Modal Control ---
        function showAuthModal() {
            if (authModalOverlayEl) {
                 authModalOverlayEl.classList.add('visible');
                 console.log("Auth Modal Shown");
            } else { console.error("Cannot show auth modal: Element not found."); }
        }
        function hideAuthModal() {
             if (authModalOverlayEl) {
                 authModalOverlayEl.classList.remove('visible');
                 console.log("Auth Modal Hidden");
            }
        }

        // --- Display User Info (Updates both header and dashboard area) ---
        function displayUserInfo(user) {
             const displayName = user ? user.name : "Restricted";
             const displayEmail = user ? user.email : "No Access";

             // Update User Bar (Top Header)
             if (headerUserNameEl) headerUserNameEl.textContent = displayName; // Removed "Welcome," prefix to match article1.txt
             if (headerUserEmailEl) headerUserEmailEl.textContent = displayEmail;

             // Update Dashboard Info Box (Main Content)
             if (dashboardInfoNameEl) dashboardInfoNameEl.textContent = displayName;
             if (dashboardInfoEmailEl) dashboardInfoEmailEl.textContent = displayEmail;

             console.log(`User info displayed. Name: ${displayName}, Email: ${displayEmail}`);
        }

         // --- Logout Function (Copied from article1.txt) ---
        function logout() {
             try {
                localStorage.removeItem(LOGGED_IN_KEY); // Use correct key
                localStorage.removeItem(CURRENT_USER_KEY); // Use correct key
                 console.log("Logged out. Redirecting to login page.");
                 window.location.href = 'login.html'; // Redirect to login
            } catch (e) {
                console.error("Error during logout:", e);
                 window.location.href = 'login.html'; // Force redirect
            }
        }

        // --- Dashboard Data Loading (Remains the same) ---
        function loadDashboardData() {
             console.log("Loading dashboard data...");
             // Dummy data - ONLY for the admin user as requested
             const userProgressData = [
                { userEmail: "M.elsayed@thechefz.co", skill: "Communication", scorePre: 65, scorePost: 85 },
                { userEmail: "M.elsayed@thechefz.co", skill: "Decision Making", scorePre: 50, scorePost: 70 },
                { userEmail: "M.elsayed@thechefz.co", skill: "Coaching Mindset", scorePre: 70, scorePost: 90 },
                { userEmail: "M.elsayed@thechefz.co", skill: "Leadership Confidence", scorePre: 60, scorePost: 65 },
                { userEmail: "M.elsayed@thechefz.co", skill: "Strategic Thinking", scorePre: 75, scorePost: 70 },
                { userEmail: "M.elsayed@thechefz.co", skill: "Team Motivation", scorePre: 80, scorePost: 80 },
                { userEmail: "M.elsayed@thechefz.co", skill: "Feedback Delivery", scorePre: 55, scorePost: 80 },
                { userEmail: "M.elsayed@thechefz.co", skill: "Overall Summary", scorePre: 65, scorePost: 77 }
             ];

             if (!progressTableBodyEl) { console.error("Dashboard table body element not found!"); return; }
             progressTableBodyEl.innerHTML = ''; // Clear

             // Filter data (for consistency, even if only one user)
             const adminData = userProgressData.filter(item => item.userEmail.toLowerCase() === ADMIN_EMAIL.toLowerCase());

             adminData.forEach(item => {
                let improvementPercentage = 0; let improvementText = "0.0%"; let percentageClass = 'neutral';
                if (item.scorePre > 0) { improvementPercentage = ((item.scorePost - item.scorePre) / item.scorePre) * 100; }
                else if (item.scorePost > 0) { improvementPercentage = 100; }

                if (improvementPercentage > 0.05) { improvementText = `+${improvementPercentage.toFixed(1)}%`; percentageClass = 'positive'; }
                else if (improvementPercentage < -0.05) { improvementText = `${improvementPercentage.toFixed(1)}%`; percentageClass = 'negative'; }
                else { improvementText = "0.0%"; percentageClass = 'neutral'; }

                let progressBarValue = 0;
                if (item.scorePre > 0 && item.scorePost >= item.scorePre) { progressBarValue = Math.min(100, ((item.scorePost - item.scorePre) / item.scorePre) * 100); }
                else if (item.scorePre === 0 && item.scorePost > 0) { progressBarValue = 100; }

                const row = progressTableBodyEl.insertRow();
                row.insertCell().textContent = item.userEmail;
                row.insertCell().innerHTML = `<span class="skill-name">${item.skill}</span>`;
                row.insertCell().textContent = item.scorePre;
                row.insertCell().textContent = item.scorePost;
                row.insertCell().innerHTML = `<span class="improvement-percentage ${percentageClass}">${improvementText}</span>`;
                const barText = progressBarValue > 15 ? `${progressBarValue.toFixed(0)}%` : '';
                row.insertCell().innerHTML = `
                    <div class="progress-container" title="${improvementText} improvement">
                        <div class="progress-bar" style="width: ${progressBarValue}%;">
                           ${barText}
                        </div>
                    </div>`;
             });
             console.log("Dashboard data loaded.");
        }

        // --- Initialize Page ---
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Admin Dashboard DOMContentLoaded.");

            // Get Element References
            dashboardContentEl = document.getElementById('dashboard-content');
            authModalOverlayEl = document.getElementById('auth-modal-overlay');
            modalCloseBtn = document.getElementById('modal-close-btn');
            modalBackBtn = document.getElementById('modal-back-btn');
            headerUserNameEl = document.getElementById('headerUserName'); // Updated ID
            headerUserEmailEl = document.getElementById('headerUserEmail'); // Updated ID
            dashboardInfoNameEl = document.getElementById('dashboardInfoName'); // Updated ID
            dashboardInfoEmailEl = document.getElementById('dashboardInfoEmail'); // Updated ID
            progressTableBodyEl = document.getElementById('progressDataBody');

            // Check for essential elements
            if (!dashboardContentEl || !authModalOverlayEl || !modalCloseBtn || !modalBackBtn || !headerUserNameEl || !headerUserEmailEl || !dashboardInfoNameEl || !dashboardInfoEmailEl || !progressTableBodyEl) {
                console.error("CRITICAL: One or more essential page elements not found!");
                 document.body.innerHTML = "<p style='color: red; padding: 30px; text-align: center;'>Error: Page initialization failed. Required elements missing.</p>";
                 return;
            }

            // Perform Authentication Check
            const authResult = checkAdminAuthStatus();

            if (authResult.isAdmin) {
                 console.log("Admin authenticated. Initializing dashboard view.");
                 displayUserInfo(authResult.user); // Display admin details
                 loadDashboardData(); // Load table data
                 dashboardContentEl.classList.add('visible'); // Show dashboard with fade-in
                 authModalOverlayEl.style.display = 'none'; // Ensure modal is definitely hidden

            } else {
                 console.log("User is not admin or not logged in. Showing auth modal.");
                 displayUserInfo(null); // Display restricted state in UI
                 dashboardContentEl.style.display = 'none'; // Hide content immediately
                 dashboardContentEl.classList.remove('visible');
                 showAuthModal(); // Show the modal
            }

            // Add Modal Button Event Listeners
            modalCloseBtn.addEventListener('click', hideAuthModal);
            modalBackBtn.addEventListener('click', function() {
                console.log("Modal 'Back to Course' clicked. Redirecting to:", COURSE_HOME_URL);
                 window.location.href = COURSE_HOME_URL; // Use constant
            });
            authModalOverlayEl.addEventListener('click', function(event) {
                 if (event.target === authModalOverlayEl) { hideAuthModal(); }
            });

            // Highlight active nav item (Optional, but good practice)
             highlightActiveNav();

            console.log("Page initialization complete.");
        });

        // --- Helper to highlight active nav item ---
         function highlightActiveNav() {
              const currentPath = window.location.pathname.split('/').pop() || 'index.html';
              const targetHref = 'admin_dashboard.html'; // The file name of this dashboard
              const navLinks = document.querySelectorAll('.nav-tab a');
              navLinks.forEach(link => {
                  // Match based on the specific href for the dashboard page
                  if (link.getAttribute('href') === targetHref) {
                      link.classList.add('active');
                  } else {
                      link.classList.remove('active');
                  }
              });
          }

    </script>

</body>
</html>
