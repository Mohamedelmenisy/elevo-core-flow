
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Course Assessment - Coaching & Leadership</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f9f9f9; margin: 0; padding: 0; }
        header { background-color: #4f46e5; color: white; padding: 20px; text-align: center; font-size: 24px; }
        main { max-width: 800px; margin: 30px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        label { font-weight: bold; display: block; margin-top: 20px; }
        textarea, input[type="number"] { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; }
        button { margin-top: 20px; padding: 12px 20px; font-size: 16px; background-color: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; }
        button:hover { background-color: #059669; }
        #progressContainer { background-color: #e5e7eb; border-radius: 6px; overflow: hidden; margin-bottom: 20px; }
        #progressBar { height: 24px; background: linear-gradient(90deg, #4f46e5, #60a5fa); width: 0%; color: white; text-align: center; line-height: 24px; font-weight: bold; transition: width 0.5s ease; }
        #successMessage, #errorMessage, #completionMessage { display: none; margin-top: 20px; font-size: 20px; font-weight: bold; text-align: center; }
        #successMessage { color: #3b82f6; }
        #errorMessage { color: #ef4444; }
        #completionMessage { color: #10b981; }
    </style>
</head>
<body>

<header>Coaching & Leadership - Pre-Course Assessment</header>

<main>
    <div id="progressContainer"><div id="progressBar">0%</div></div>
    <form id="assessmentForm">
        <label>What does coaching mean to you?</label>
        <textarea id="q1" required></textarea>

        <label>Random Question</label>
        <textarea id="q2" required></textarea>

        <label>What are your expectations from this course?</label>
        <textarea id="q3" required></textarea>

        <label>Rate your current coaching confidence (1-5)</label>
        <input type="number" id="q4" min="1" max="5" required>

        <label>Explain your rating</label>
        <textarea id="q5" required></textarea>

        <button type="submit">Submit</button>
    </form>

    <div id="successMessage">ðŸŽ¯ Your answers have been saved successfully! ðŸŽ¯</div>
    <div id="completionMessage">ðŸŽ‰ You completed 100% of the assessment! ðŸŽ‰</div>
    <div id="errorMessage">ðŸš¨ There was an error saving your answers. Please try again. ðŸš¨</div>
</main>

<script>
const supabaseUrl = 'https://lgcutmuspcaralydycmg.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxnY3V0bXVzcGNhcmFseWR5Y21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NDY3MDEsImV4cCI6MjA2MTAyMjcwMX0.3u5Y7pkH2NNnnoGLMWVfAa5b8fq88o1itRYnG1K38tE';
const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

const currentUser = JSON.parse(localStorage.getItem('currentUser')) || { id: Math.random().toString(36).substring(2), email: 'anonymous@example.com' };

const fields = ['q1', 'q2', 'q3', 'q4', 'q5'];

function updateProgressBar() {
    const answered = fields.filter(id => document.getElementById(id).value.trim() !== '').length;
    const percentage = Math.round((answered / fields.length) * 100);
    const bar = document.getElementById('progressBar');
    bar.style.width = percentage + '%';
    bar.innerText = percentage + '%';

    if (percentage === 100) {
        document.getElementById('completionMessage').style.display = 'block';
    } else {
        document.getElementById('completionMessage').style.display = 'none';
    }
}
fields.forEach(id => document.getElementById(id).addEventListener('input', updateProgressBar));

async function saveAssessment(answers) {
    const insertData = Object.entries(answers).map(([key, value]) => ({
        user_id: currentUser.id,
        user_email: currentUser.email,
        question_id: key,
        answer: value,
        submitted_at: new Date(),
        created_at: new Date(),
        page: 'assessment.html',
        type: 'pre_course',
        completion_status: 'completed'
    }));

    const { error } = await supabase.from('assessments').insert(insertData);
    if (error) throw error;
}

async function saveProgress() {
    const { error } = await supabase.from('user_progress').upsert([{
        user_id: currentUser.id,
        section_type: 'assessment',
        section_id: 'pre_course',
        section_title: 'Pre-Course Assessment',
        page: 'assessment.html',
        progress: 100,
        progress_percentage: 100,
        status: 'completed',
        submitted_at: new Date(),
        updated_at: new Date()
    }], { onConflict: ['user_id', 'section_id'] });
    if (error) throw error;
}

document.getElementById('assessmentForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    try {
        const answers = {
            q1: document.getElementById('q1').value,
            q2: document.getElementById('q2').value,
            q3: document.getElementById('q3').value,
            q4: document.getElementById('q4').value,
            q5: document.getElementById('q5').value
        };
        await saveAssessment(answers);
        await saveProgress();
        document.getElementById('assessmentForm').style.display = 'none';
        document.getElementById('successMessage').style.display = 'block';
    } catch (err) {
        console.error('Error saving data:', err);
        document.getElementById('errorMessage').style.display = 'block';
    }
});
</script>
</body>
</html>
