<!doctype html>
<html lang=en class=dark>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Agent Portal - Elevo Core</title>
<link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234e8cff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M12 22V12M9 19l3-3 3 3M12 2a4 4 0 0 0-4 4v0a4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4z'/></svg>">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel=stylesheet>
<script src=https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2></script>
<script src=https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js></script>
<script src=role-check.js></script>
<style>:root{--primary-color:#4e8cff;--primary-color-rgb:78,140,255;--accent-color:#8b5cf6;--success-color:#10b981;--warning-color:#f59e0b;--danger-color:#ef4444;--danger-color-rgb:239,68,68;--bg-color:#111827;--card-bg-color:#1f2937;--sidebar-card-bg-color:#1f2937;--input-bg-color:#374151;--border-color:#4b5563;--text-color:#f9fafb;--text-color-light:#d1d5db;--text-color-subtle:#9ca3af;--border-radius-sm:4px;--border-radius-md:8px;--border-radius-lg:12px;--border-radius-xl:16px;--border-radius-full:9999px;--transition-speed-fast:0.15s;--transition-speed-normal:0.3s;--transition-speed-slow:0.5s;--shadow-sm:0 1px 2px 0 rgba(0, 0, 0, 0.05);--shadow-md:0 4px 6px -1px rgba(0, 0, 0, 0.1),0 2px 4px -1px rgba(0, 0, 0, 0.06);--shadow-lg:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);--shadow-xl:0 20px 25px -5px rgba(0, 0, 0, 0.1),0 10px 10px -5px rgba(0, 0, 0, 0.04)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:Poppins,sans-serif;background-color:var(--bg-color);color:var(--text-color);line-height:1.6;overflow-x:hidden}.app-container{min-height:100vh;display:flex;flex-direction:column}.app-header{background-color:rgba(17,24,39,.95);padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:var(--shadow-lg);position:sticky;top:0;z-index:100;backdrop-filter:blur(10px);border-bottom:1px solid var(--border-color)}.logo-container{display:flex;align-items:center;gap:.75rem}.app-title{font-weight:600;font-size:1.4rem;background:linear-gradient(135deg,var(--primary-color),var(--accent-color));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.header-controls{display:flex;align-items:center;gap:1.5rem}.nav-link{color:var(--text-color-light);text-decoration:none;padding:.5rem 1rem;border-radius:var(--border-radius-md);transition:all var(--transition-speed-fast) ease;display:inline-flex;align-items:center;gap:.5rem;font-weight:500}.nav-link:hover{background-color:var(--input-bg-color);color:var(--text-color);transform:translateY(-1px)}.nav-link.active{background-color:var(--primary-color);color:#fff}.user-info{display:flex;align-items:center;gap:1rem}.user-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--primary-color),var(--accent-color));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:.9rem}.user-name-display{color:var(--text-color);font-weight:500}.logout-btn{background:0 0;border:none;color:var(--text-color-light);cursor:pointer;padding:.5rem 1rem;border-radius:var(--border-radius-md);display:flex;align-items:center;gap:.5rem;transition:all var(--transition-speed-fast) ease;font-weight:500}.logout-btn:hover{background-color:var(--danger-color);color:#fff;transform:translateY(-1px)}.app-main{flex-grow:1}.dashboard-main{width:100%;max-width:100%;margin:0 auto;padding:1.5rem 2rem}.dashboard-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:2rem}.dashboard-header h1{font-size:2rem;font-weight:700;background:linear-gradient(135deg,var(--text-color),var(--primary-color));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.text-color-light{color:var(--text-color-light)}.text-color-subtle{color:var(--text-color-subtle)}.action-button{padding:.75rem 1.5rem;border:none;border-radius:var(--border-radius-md);cursor:pointer;font-weight:500;display:inline-flex;align-items:center;gap:.5rem;transition:all var(--transition-speed-fast) ease;text-decoration:none;font-size:.9rem;font-family:inherit}.action-button:disabled{opacity:.6;cursor:not-allowed;transform:none!important}.primary-button{background-color:var(--primary-color);color:#fff;box-shadow:var(--shadow-md)}.primary-button:hover:not(:disabled){background-color:#3b78e7;transform:translateY(-2px);box-shadow:var(--shadow-lg)}.secondary-button{background-color:var(--input-bg-color);color:var(--text-color)}.secondary-button:hover:not(:disabled){background-color:#4b5563;transform:translateY(-1px)}.danger-button{background-color:var(--danger-color);color:#fff}.danger-button:hover:not(:disabled){background-color:#dc2626;transform:translateY(-1px)}.success-button{background-color:var(--success-color);color:#fff}.success-button:hover:not(:disabled){background-color:#0da271;transform:translateY(-1px)}.scorecard{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.5rem;margin-bottom:2rem}.kpi-card{background-color:var(--card-bg-color);padding:1.5rem;border-radius:var(--border-radius-lg);border-left:4px solid var(--primary-color);box-shadow:var(--shadow-md);transition:all var(--transition-speed-normal) ease;position:relative;overflow:hidden}.kpi-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--primary-color),transparent)}.kpi-card:hover{transform:translateY(-5px);box-shadow:var(--shadow-xl)}.kpi-card h4{font-size:.9em;color:var(--text-color-light);margin-bottom:.5rem;font-weight:500;display:flex;align-items:center;gap:.5rem}.kpi-value{font-size:1.75em;font-weight:700;color:var(--text-color);display:flex;align-items:center;gap:.5rem}.kpi-trend{font-size:.8em;padding:.2rem .5rem;border-radius:var(--border-radius-full);margin-left:.5rem}.trend-up{background-color:rgba(16,185,129,.2);color:var(--success-color)}.trend-down{background-color:rgba(239,68,68,.2);color:var(--danger-color)}.progress-card{background-color:var(--card-bg-color);padding:1.5rem;border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md)}.progress-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;font-size:.9em;font-weight:500;color:var(--text-color-light)}.progress-bar-container{width:100%;height:12px;background-color:var(--input-bg-color);border-radius:6px;overflow:hidden}.progress-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--primary-color),var(--accent-color));border-radius:6px;transition:width .8s cubic-bezier(.22, .61, .36, 1);position:relative}.progress-bar::after{content:'';position:absolute;top:0;left:0;bottom:0;right:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.4),transparent);animation:shimmer 2s infinite}@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}.portal-layout-grid{display:grid;grid-template-columns:minmax(0,1fr);gap:2rem;margin-top:1.5rem}@media (min-width:1024px){.portal-layout-grid{grid-template-columns:minmax(0,2.5fr) minmax(0,1.5fr)}}.main-content-column,.sidebar-column{display:flex;flex-direction:column;gap:2rem}.card{background-color:var(--card-bg-color);border-radius:var(--border-radius-lg);padding:1.5rem;box-shadow:var(--shadow-md);transition:all var(--transition-speed-normal) ease}.card:hover{box-shadow:var(--shadow-lg);transform:translateY(-2px)}.card h2,.card h3{margin-top:0;margin-bottom:1rem;font-weight:600;display:flex;align-items:center;gap:.5rem}.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.table-responsive{overflow-x:auto;border-radius:var(--border-radius-md);border:1px solid var(--border-color)}table{width:100%;border-collapse:collapse;min-width:600px}td,th{padding:1rem 1.25rem;text-align:left;border-bottom:1px solid var(--border-color)}th{font-weight:600;color:var(--text-color-light);font-size:.85em;background-color:rgba(0,0,0,.2);text-transform:uppercase;letter-spacing:.5px}tr:hover{background-color:rgba(255,255,255,.05)}.status-badge{padding:.35rem .75rem;border-radius:var(--border-radius-full);font-size:.8em;font-weight:600;text-transform:capitalize}.status-completed{background-color:rgba(16,185,129,.2);color:var(--success-color)}.status-in-progress{background-color:rgba(78,140,255,.2);color:var(--primary-color)}.status-not-started{background-color:rgba(156,163,175,.2);color:var(--text-color-light)}.status-good{background-color:rgba(16,185,129,.2);color:var(--success-color)}.status-bad{background-color:rgba(239,68,68,.2);color:var(--danger-color)}.status-na{background-color:rgba(156,163,175,.2);color:var(--text-color-light)}.filter-controls{margin-bottom:1.5rem}.filter-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1rem;align-items:end}.filter-grid label{display:block;margin-bottom:.5rem;font-size:.9em;color:var(--text-color-light);font-weight:500}.filter-grid input,.filter-grid select{width:100%;padding:.75rem;background-color:var(--input-bg-color);border:1px solid var(--border-color);border-radius:var(--border-radius-md);color:var(--text-color);font-family:inherit;transition:all var(--transition-speed-fast) ease}.filter-grid input:focus,.filter-grid select:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(var(--primary-color-rgb),.1)}#agentScratchpad,.modal-form textarea{width:100%;min-height:150px;background-color:var(--input-bg-color);border:1px solid var(--border-color);border-radius:var(--border-radius-md);color:var(--text-color);padding:1rem;font-family:inherit;font-size:.95em;resize:vertical;transition:all var(--transition-speed-fast) ease;line-height:1.5}#agentScratchpad:focus,.modal-form textarea:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(var(--primary-color-rgb),.1)}.form-group{margin-bottom:1rem}.form-group label{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-color-light)}.form-group input,.form-group textarea{width:100%;padding:.75rem;background-color:var(--input-bg-color);border:1px solid var(--border-color);border-radius:var(--border-radius-md);color:var(--text-color)}.scratchpad-actions{display:flex;justify-content:flex-end;gap:.75rem;margin-top:1rem}.saved-notes-list,.training-programs-list{display:flex;flex-direction:column;gap:1rem;max-height:400px;overflow-y:auto;padding-right:.5rem}.saved-notes-list::-webkit-scrollbar,.training-programs-list::-webkit-scrollbar{width:6px}.saved-notes-list::-webkit-scrollbar-track,.training-programs-list::-webkit-scrollbar-track{background:var(--input-bg-color);border-radius:3px}.saved-notes-list::-webkit-scrollbar-thumb,.training-programs-list::-webkit-scrollbar-thumb{background-color:var(--border-color);border-radius:3px}.saved-notes-list::-webkit-scrollbar-thumb:hover,.training-programs-list::-webkit-scrollbar-thumb:hover{background-color:var(--primary-color)}.note-card{background-color:var(--input-bg-color);border-radius:var(--border-radius-lg);border-left:4px solid var(--accent-color);padding:1.25rem;transition:all var(--transition-speed-normal) ease}.note-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}.note-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.75rem;font-size:.85em}.note-author{color:var(--text-color-light);font-weight:600;font-size:1.1em}.note-timestamp{color:var(--text-color-subtle);font-size:.9em}.note-email{color:var(--text-color-subtle);font-size:.9em;margin-bottom:.75rem}.note-content{color:var(--text-color);line-height:1.6;white-space:pre-wrap;word-break:break-word;font-family:Poppins,sans-serif;font-weight:400}.note-actions{display:flex;justify-content:flex-end;align-items:center;gap:.5rem;margin-top:1rem}.icon-button{background:0 0;border:none;cursor:pointer;padding:.5rem;border-radius:var(--border-radius-md);display:flex;align-items:center;justify-content:center;transition:all var(--transition-speed-fast) ease;color:var(--text-color-light)}.icon-button:hover{background-color:rgba(255,255,255,.1);transform:scale(1.1)}.icon-button.view{color:var(--primary-color)}.icon-button.edit{color:var(--warning-color)}.icon-button.delete{color:var(--danger-color)}.training-card{background-color:var(--input-bg-color);border-radius:var(--border-radius-lg);padding:1.5rem;border-left:4px solid var(--primary-color);transition:all var(--transition-speed-normal) ease;position:relative}.training-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}.training-card.completed{border-left-color:var(--success-color)}.training-card-header{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem;margin-bottom:1rem}.training-card-header h4{margin:0;font-size:1.1em;font-weight:600;flex:1}.training-card-body{color:var(--text-color-light);line-height:1.6;margin-bottom:1rem}.training-card-footer{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;font-size:.9em}.training-card-actions{display:flex;gap:.5rem}.training-date{color:var(--text-color-subtle);font-weight:500}.performance-summary-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:1.25rem}.performance-summary-item{display:flex;justify-content:space-between;align-items:center;padding:.75rem 0;border-bottom:1px solid var(--border-color)}.performance-summary-item:last-child{border-bottom:none}.performance-summary-item span{color:var(--text-color-light);font-weight:500}.performance-summary-item strong{font-weight:700;font-size:1.1em;color:var(--text-color)}.charts-container{display:flex;flex-direction:column;gap:2rem}.chart-wrapper{position:relative;height:250px}.comparison-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin:1.5rem 0}.comparison-metric{text-align:center;padding:1rem;background-color:var(--input-bg-color);border-radius:var(--border-radius-lg)}.comparison-metric h5{margin:0 0 .5rem 0;font-size:.9em;color:var(--text-color-light);font-weight:500}.comparison-metric p{margin:0;font-size:1.5em;font-weight:700}.comparison-result{text-align:center;padding-top:1rem;border-top:1px solid var(--border-color)}.comparison-result p{margin:0;font-size:1.1em;font-weight:600;display:flex;align-items:center;justify-content:center;gap:.5rem}.improvement{color:var(--success-color)}.decline{color:var(--danger-color)}.achievements-list{list-style:none;padding:0}.achievement-item{display:flex;align-items:center;gap:1rem;padding:1rem 0;border-bottom:1px solid var(--border-color)}.achievement-item:last-child{border-bottom:none}.achievement-icon{font-size:1.75em;width:50px;height:50px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary-color),var(--accent-color));border-radius:50%;flex-shrink:0}.achievement-content{flex:1}.achievement-content strong{display:block;margin-bottom:.25rem;font-weight:600}.achievement-content p{margin:0;color:var(--text-color-light);font-size:.9em}.pagination-container{margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--border-color)}.pagination{display:flex;justify-content:center;align-items:center;gap:.5rem;flex-wrap:wrap}.pagination-btn,.pagination-current{padding:.5rem 1rem;border-radius:var(--border-radius-md);font-size:.9em;font-weight:500;min-width:40px;text-align:center}.pagination-btn{background-color:var(--input-bg-color);color:var(--text-color);border:none;cursor:pointer;transition:all var(--transition-speed-fast) ease}.pagination-btn:hover:not(:disabled){background-color:var(--primary-color);color:#fff;transform:translateY(-1px)}.pagination-btn:disabled{opacity:.5;cursor:not-allowed}.pagination-current{background-color:var(--primary-color);color:#fff}.loading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;height:60vh;text-align:center}.spinner{width:50px;height:50px;border:4px solid rgba(255,255,255,.1);border-left-color:var(--primary-color);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:1rem}@keyframes spin{to{transform:rotate(360deg)}}.skeleton{background:linear-gradient(90deg,var(--input-bg-color) 25%,rgba(255,255,255,.1) 50%,var(--input-bg-color) 75%);background-size:200% 100%;animation:loading 1.5s infinite;border-radius:var(--border-radius-md)}@keyframes loading{0%{background-position:200% 0}100%{background-position:-200% 0}}.empty-state{text-align:center;padding:3rem 2rem;color:var(--text-color-subtle)}.empty-state i{font-size:3rem;margin-bottom:1rem;opacity:.5}.empty-state h3{margin-bottom:.5rem;color:var(--text-color-light)}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.7);align-items:center;justify-content:center;opacity:0;transition:opacity var(--transition-speed-normal) ease}.modal-content{background-color:var(--card-bg-color);padding:2rem;border-radius:var(--border-radius-lg);width:90%;max-width:500px;box-shadow:var(--shadow-xl);transform:scale(.95);transition:transform var(--transition-speed-normal) ease}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.modal-header h3{margin:0}.modal-footer{display:flex;justify-content:flex-end;gap:.75rem;margin-top:1.5rem}.app-footer{background-color:var(--card-bg-color);padding:1.5rem 2rem;text-align:center;color:var(--text-color-light);font-size:.9em;border-top:1px solid var(--border-color);margin-top:auto}@media (max-width:768px){.app-header{padding:1rem;flex-direction:column;gap:1rem}.dashboard-main{padding:1rem}.dashboard-header{flex-direction:column;align-items:flex-start}.scorecard{grid-template-columns:1fr}.portal-layout-grid{grid-template-columns:1fr}.filter-grid{grid-template-columns:1fr}.comparison-grid{grid-template-columns:1fr}td,th{padding:.75rem .5rem}}.text-center{text-align:center}.text-right{text-align:right}.mb-1{margin-bottom:.5rem}.mb-2{margin-bottom:1rem}.mb-3{margin-bottom:1.5rem}.mt-1{margin-top:.5rem}.mt-2{margin-top:1rem}.mt-3{margin-top:1.5rem}.flex{display:flex}.flex-between{display:flex;justify-content:space-between;align-items:center}.flex-center{display:flex;justify-content:center;align-items:center}.hidden{display:none}</style>
</head>
<body>
<div class=app-container>
<header class=app-header>
<div class=logo-container>
<svg class=company-logo viewBox="0 0 24 24" fill=none xmlns=http://www.w3.org/2000/svg" style=color:var(--primary-color);width:32px;height:32px>
<path d="M12 22V12M9 19l3-3 3 3M12 2a4 4 0 0 0-4 4v0a4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4z" stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round />
</svg>
<span class=app-title>Elevo Core - Agent Portal</span>
</div>
<div class=header-controls>
<a href=core-flow.html class=nav-link>
<i class="fas fa-phone"></i>
Call App
</a>
<a href=admin-dashboard.html class=nav-link id=dashboardLink style=display:none>
<i class="fas fa-tachometer-alt"></i>
Admin Dashboard
</a>
<div class=user-info id=userInfo>
<div class=user-avatar id=userAvatar>A</div>
<span id=userName class=user-name-display></span>
<button id=logoutButton class=logout-btn>
<i class="fas fa-sign-out-alt"></i>
Logout
</button>
</div>
</div>
</header>
<main class=app-main>
<div class=dashboard-main>
<div id=auth-loading class=loading-container>
<div class=spinner></div>
<h2>Loading Agent Portal</h2>
<p class=text-color-light>Please wait while we load your data...</p>
</div>
<div id=portalContent style=display:none>
<div class=dashboard-header>
<div>
<h1 id=agentGreeting>Welcome back!</h1>
<p class=text-color-light id=agentSubtext>Here's your performance overview and recent activity</p>
</div>
<button id=exportDataBtn class="action-button primary-button">
<i class="fas fa-download"></i>
Export Data
</button>
</div>
<div class=scorecard>
<div class=kpi-card>
<h4><i class="fas fa-clock"></i> Avg. Handling Time</h4>
<div class=kpi-value id=kpiAvgTime>
<span class=skeleton style=width:80px;height:32px></span>
</div>
</div>
<div class=kpi-card style=border-left-color:var(--success-color)>
<h4><i class="fas fa-star"></i> Customer Rating</h4>
<div class=kpi-value id=kpiAvgRating>
<span class=skeleton style=width:80px;height:32px></span>
</div>
</div>
<div class=kpi-card style=border-left-color:var(--warning-color)>
<h4><i class="fas fa-phone"></i> Calls Completed</h4>
<div class=kpi-value id=kpiTotalCalls>
<span class=skeleton style=width:60px;height:32px></span>
</div>
</div>
<div class=kpi-card style=border-left-color:var(--accent-color)>
<h4><i class="fas fa-bullseye"></i> Daily Target</h4>
<div class=progress-card style="padding:0;background:0 0;box-shadow:none">
<div class=progress-title>
<span>Progress</span>
<span id=dailyTargetPercentage>0%</span>
</div>
<div class=progress-bar-container>
<div id=dailyTargetProgressBar class=progress-bar style=width:0%></div>
</div>
</div>
</div>
</div>
<div class=portal-layout-grid>
<div class=main-content-column>
<div class=card>
<div class=card-header>
<h2><i class="fas fa-history"></i> Call History</h2>
<div class=flex style=gap:.5rem>
<button id=refreshCallsBtn class=icon-button title=Refresh>
<i class="fas fa-sync-alt"></i>
</button>
</div>
</div>
<div class=filter-controls>
<div class=filter-grid>
<div>
<label for=searchInput><i class="fas fa-search"></i> Search</label>
<input id=searchInput placeholder="Search scenarios...">
</div>
<div>
<label for=qualityFilter><i class="fas fa-filter"></i> Quality</label>
<select id=qualityFilter>
<option value="">All Quality</option>
<option value=Good>Good</option>
<option value=Bad>Bad</option>
<option value=N/A>N/A</option>
</select>
</div>
<div>
<label for=startDateFilter><i class="fas fa-calendar"></i> From Date</label>
<input type=date id=startDateFilter>
</div>
<div>
<label for=endDateFilter><i class="fas fa-calendar"></i> To Date</label>
<input type=date id=endDateFilter>
</div>
<div>
<label>&nbsp;</label>
<button id=resetFiltersBtn class="action-button secondary-button" style=width:100%>
<i class="fas fa-undo"></i>
Reset
</button>
</div>
</div>
</div>
<div class=table-responsive>
<table id=callsTable>
<thead>
<tr>
<th>Date</th>
<th>Start Time</th>
<th>Scenario</th>
<th>Duration</th>
<th>Status</th>
<th>Quality</th>
<th>Reason</th>
</tr>
</thead>
<tbody id=callsTableBody>
</tbody>
</table>
</div>
<div id=noCallsMessage class=empty-state style=display:none>
<i class="fas fa-phone-slash"></i>
<h3>No Calls Found</h3>
<p>No call records match your current filters.</p>
</div>
<div id=paginationControls class=pagination-container></div>
</div>
<div class=card>
<h2><i class="fas fa-sticky-note"></i> My Notes</h2>
<textarea id=agentScratchpad placeholder="Write your notes here... This is your personal scratchpad for quick notes and reminders."></textarea>
<div class=scratchpad-actions>
<button id=cancelNoteBtn class="action-button secondary-button">
<i class="fas fa-times"></i>
Cancel
</button>
<button id=saveNoteBtn class="action-button primary-button">
<i class="fas fa-save"></i>
Save Note
</button>
</div>
<div style=margin-top:2rem>
<h3><i class="fas fa-bookmark"></i> Saved Notes</h3>
<div id=savedNotesList class=saved-notes-list>
</div>
<div id=noNotesMessage class=empty-state style=display:none>
<i class="fas fa-clipboard"></i>
<h3>No Notes Yet</h3>
<p>You haven't saved any notes yet. Start by writing something above!</p>
</div>
<div id=notesPaginationControls class=pagination-container></div>
</div>
</div>
<div class=card>
<div class=card-header>
<h2><i class="fas fa-graduation-cap"></i> Training Programs</h2>
<button id=addTrainingBtn class="action-button primary-button">
<i class="fas fa-plus"></i>
Add Training
</button>
</div>
<div id=trainingProgramsList class=training-programs-list>
</div>
<div id=noTrainingMessage class=empty-state style=display:none>
<i class="fas fa-book-open"></i>
<h3>No Training Programs</h3>
<p>You don't have any training programs assigned yet.</p>
</div>
<div id=trainingPaginationControls class=pagination-container></div>
</div>
</div>
<div class=sidebar-column>
<div class=card>
<h3><i class="fas fa-chart-line"></i> Performance Summary</h3>
<ul class=performance-summary-list>
<li class=performance-summary-item>
<span>Total Calls</span>
<strong id=ins-total>0</strong>
</li>
<li class=performance-summary-item>
<span>Avg. Handling Time</span>
<strong id=ins-avg-time>--:--</strong>
</li>
<li class=performance-summary-item>
<span>Avg. Customer Rating</span>
<strong id=ins-avg-rating>-.--</strong>
</li>
<li class=performance-summary-item>
<span>Completion Rate</span>
<strong id=ins-completion>0%</strong>
</li>
<li class=performance-summary-item>
<span>Good Quality Rate</span>
<strong id=ins-good-quality>0%</strong>
</li>
</ul>
</div>
<div class=card>
<h3><i class="fas fa-chart-pie"></i> Performance Charts</h3>
<div class=charts-container>
<div class=chart-wrapper>
<canvas id=qualityChart></canvas>
</div>
<div class=chart-wrapper>
<canvas id=durationChart></canvas>
</div>
</div>
</div>
<div class=card>
<h3><i class="fas fa-users"></i> Performance vs. Team</h3>
<div class=comparison-grid>
<div class=comparison-metric>
<h5>Your AHT</h5>
<p id=yourAHT>--:--</p>
</div>
<div class=comparison-metric>
<h5>Team Avg. AHT</h5>
<p id=teamAHT>--:--</p>
</div>
</div>
<div class=comparison-result>
<p id=comparisonResult>
<i class="fas fa-info-circle"></i>
<span>Loading comparison data...</span>
</p>
</div>
</div>
<div class=card>
<h3><i class="fas fa-trophy"></i> Recent Achievements</h3>
<ul class=achievements-list id=achievementsList>
<li class=achievement-item>
<div class=achievement-icon>
<i class="fas fa-star"></i>
</div>
<div class=achievement-content>
<strong>First Perfect Call</strong>
<p>Completed your first call with 100% quality score</p>
</div>
</li>
<li class=achievement-item>
<div class=achievement-icon>
<i class="fas fa-bolt"></i>
</div>
<div class=achievement-content>
<strong>Speed Demon</strong>
<p>Handled 50 calls with below average handling time</p>
</div>
</li>
<li class=achievement-item>
<div class=achievement-icon>
<i class="fas fa-medal"></i>
</div>
<div class=achievement-content>
<strong>Consistency Master</strong>
<p>Maintained 90%+ quality rating for 5 consecutive days</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</main>
<footer class=app-footer>
<div class=text-center>
<p>Elevo Core Agent Portal &copy; <span id=currentYear></span> | All rights reserved</p>
</div>
</footer>
</div>
<div id=accessRestrictedModal class=modal style="display: none; justify-content: center; align-items: center;">
<div class=modal-content>
<div class=modal-header>
<h3><i class="fas fa-exclamation-triangle"></i> Access Restricted</h3>
</div>
<p>You do not have the required permissions to view this page.</p>
<div class=modal-footer>
<button id=backToDashboardBtn class="action-button primary-button">
<i class="fas fa-arrow-left"></i>
Back to Core App
</button>
</div>
</div>
</div>
<script>
    const supabaseUrl = 'https://aefiigottnlcmjzilqnh.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFlZmlpZ290dG5sY21qemlscW5oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxNzY2MDQsImV4cCI6MjA2Mjc1MjYwNH0.FypB02v3tGMnxXV9ZmZMdMC0oQpREKOJWgHMPxUzwX4';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

document.addEventListener('DOMContentLoaded', async function() {
    let currentUser = await window.elevo.checkAccess(['agent', 'admin', 'manager']);
    if (!currentUser) return;

    document.getElementById('userAvatar').textContent = (currentUser.name ? currentUser.name.charAt(0).toUpperCase() : currentUser.email.charAt(0).toUpperCase());
    const hour = new Date().getHours();
    let greeting = hour < 12 ? 'Good morning' : hour < 18 ? 'Good afternoon' : 'Good evening';
    document.getElementById('agentGreeting').textContent = `${greeting}, ${currentUser.name ? currentUser.name.split(' ')[0] : 'Agent'}!`;
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    const qualityChart = new Chart(document.getElementById('qualityChart'), {
        type: 'doughnut',
        data: {
            labels: ['Good', 'Bad', 'N/A'],
            datasets: [{
                data: [0, 0, 0],
                backgroundColor: ['rgba(16, 185, 129, 0.8)','rgba(239, 68, 68, 0.8)','rgba(156, 163, 175, 0.8)'],
                borderColor: ['#1f2937'],
                borderWidth: 4,
                hoverOffset: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: { position: 'bottom', labels: { color: 'var(--text-color)', font: { family: 'Poppins' }}},
                tooltip: { backgroundColor: 'var(--card-bg-color)', titleColor: 'var(--text-color)', bodyColor: 'var(--text-color)', borderColor: 'var(--border-color)', borderWidth: 1 }
            }
        }
    });
    
    const durationChart = new Chart(document.getElementById('durationChart'), {
        type: 'bar',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Avg. Handling Time (min)',
                data: [0, 0, 0, 0, 0, 0, 0],
                backgroundColor: 'rgba(78, 140, 255, 0.7)',
                borderColor: 'rgba(78, 140, 255, 1)',
                borderWidth: 1,
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'var(--text-color-light)' }},
                x: { grid: { display: false }, ticks: { color: 'var(--text-color-light)' }}
            },
            plugins: {
                legend: { display: false },
                tooltip: { backgroundColor: 'var(--card-bg-color)', titleColor: 'var(--text-color)', bodyColor: 'var(--text-color)', borderColor: 'var(--border-color)', borderWidth: 1 }
            }
        }
    });

    const formatDuration = (seconds) => {
        if (seconds === null || isNaN(seconds)) return 'N/A';
        const mins = Math.floor(seconds / 60);
        const secs = Math.round(seconds % 60);
        return `${mins}m ${secs}s`;
    };
    
    async function loadCallsData() {
        try {
            const { data, error } = await supabase.from('call_sessions_egypt').select('*').eq('agent_email', currentUser.email).order('start_time_egypt', { ascending: false });
            if (error) throw error;
            return data || [];
        } catch (error) {
            console.error('Error loading calls data:', error);
            window.elevo.showToast('Failed to load call history', 'error');
            return [];
        }
    }
    
    function populateCallsTable(calls) {
        const tableBody = document.getElementById('callsTableBody');
        tableBody.innerHTML = '';
        document.getElementById('noCallsMessage').style.display = calls.length === 0 ? 'block' : 'none';
        
        calls.forEach(call => {
            const startTime = new Date(call.start_time_egypt);
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${startTime.toLocaleDateString('en-GB')}</td>
                <td>${startTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}</td>
                <td>${call.scenario_title || 'N/A'}</td>
                <td>${formatDuration(call.duration)}</td>
                <td><span class="status-badge ${call.completed ? 'status-completed' : 'status-not-started'}">${call.completed ? 'Completed' : 'Not Started'}</span></td>
                <td><span class="status-badge status-${(call.call_quality || 'N/A').toLowerCase().replace('/', '-')}">${call.call_quality || 'N/A'}</span></td>
                <td>${call.quality_reason || 'N/A'}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    async function initializeData() {
        const calls = await loadCallsData();
        populateCallsTable(calls);
        // ... update other metrics and charts
    }

    // --- Notes and Training Functionality ---
    const setupNoteActions = () => {
        document.getElementById('savedNotesList').addEventListener('click', async (e) => {
            const button = e.target.closest('.icon-button');
            if (!button) return;
            const noteId = button.dataset.id;
            const action = button.dataset.action;
            const { data: note } = await supabase.from('agent_notes').select('*').eq('id', noteId).single();

            if (action === 'edit') {
                window.elevo.showModal('Edit Note', 
                    `<textarea id="editNoteTextarea" class="modal-form" style="min-height: 120px;">${note.content}</textarea>`,
                    [{ text: 'Save Changes', className: 'primary', onClick: async () => {
                        const newContent = document.getElementById('editNoteTextarea').value;
                        const { error } = await supabase.from('agent_notes').update({ content: newContent }).eq('id', noteId);
                        if (error) window.elevo.showToast('Failed to update note', 'error');
                        else {
                            window.elevo.showToast('Note updated successfully', 'success');
                            window.elevo.removeModal();
                            loadNotes();
                        }
                    }}]
                );
            } else if (action === 'delete') {
                window.elevo.showModal('Confirm Deletion', 
                    `<p>Are you sure you want to delete this note?</p>`,
                    [{ text: 'Delete', className: 'danger', onClick: async () => {
                        const { error } = await supabase.from('agent_notes').delete().eq('id', noteId);
                        if (error) window.elevo.showToast('Failed to delete note', 'error');
                        else {
                            window.elevo.showToast('Note deleted', 'success');
                            window.elevo.removeModal();
                            loadNotes();
                        }
                    }}]
                );
            }
        });
    };
    
    // Similarly for Training...
    const setupTrainingActions = () => {
         document.getElementById('addTrainingBtn').addEventListener('click', () => {
            if (currentUser.role === 'agent') {
                return window.elevo.showToast('Only admins can add training programs', 'error');
            }
             window.elevo.showModal('Add New Training',
                `<div class="form-group">
                    <label for="newTrainingTitle">Title</label>
                    <input type="text" id="newTrainingTitle" placeholder="e.g., Advanced Communication Skills">
                 </div>
                 <div class="form-group">
                    <label for="newTrainingDescription">Description</label>
                    <textarea id="newTrainingDescription" rows="4"></textarea>
                 </div>`,
                [{ text: 'Add Training', className: 'primary', onClick: async () => {
                    const title = document.getElementById('newTrainingTitle').value;
                    const description = document.getElementById('newTrainingDescription').value;
                    if (!title) return window.elevo.showToast('Title is required', 'error');
                    
                    const { error } = await supabase.from('training_programs').insert({ title, description, created_by: currentUser.id });
                    if (error) window.elevo.showToast('Failed to add training', 'error');
                    else {
                        window.elevo.showToast('Training added successfully', 'success');
                        window.elevo.removeModal();
                        loadTrainingData();
                    }
                }}]
            );
         });
    };

    const loadNotes = async () => { /* ... load and populate notes ... */ };
    const loadTrainingData = async () => { /* ... load and populate training ... */ };

    initializeData();
    setupNoteActions();
    setupTrainingActions();
});
</script>
</body>
</html>
