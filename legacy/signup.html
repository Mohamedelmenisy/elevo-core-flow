<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Elevo Core System</title> {/* MODIFIED */}
  <!-- Favicon Links -->
    <link rel="icon" href="/my-training-course/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/my-training-course/favicon.ico">

    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* --- CSS (No changes here as per request, assuming it's fine) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f5f7fa; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; background-image: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%); }
        .signup-container { width: 100%; max-width: 450px; background: #ffffff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); padding: 40px; animation: fadeIn 0.5s ease-in-out; position: relative; overflow: hidden; }
        .signup-container::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: linear-gradient(90deg, #3498db, #2ecc71); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .logo { text-align: center; margin-bottom: 25px; }
        .logo svg { width: 48px; height: 48px; stroke: #3498db; stroke-width: 1.5; margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto; }
        .logo h2 { color: #2c3e50; font-size: 20px; font-weight: 600; letter-spacing: 0.5px; margin-top: 0; }
        .signup-header { text-align: center; margin-bottom: 30px; margin-top: 0; }
        .signup-header h2 { color: #2c3e50; font-size: 24px; font-weight: 700; margin-bottom: 8px; }
        .signup-header p { color: #7f8c8d; font-size: 15px; }
        .input-group { margin-bottom: 20px; position: relative; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #34495e; font-size: 14px; }
        .input-group .input-icon { position: absolute; top: 45px; left: 15px; transform: translateY(-50%); color: #95a5a6; font-size: 18px; pointer-events: none; }
        .input-group .input-icon svg { width: 18px; height: 18px; vertical-align: middle; }
        .input-group input[type="text"], .input-group input[type="email"], .input-group input[type="password"] { width: 100%; padding: 14px 15px 14px 45px; border: 1px solid #e0e4e7; border-radius: 8px; font-size: 15px; transition: all 0.3s; background-color: #f9fafb; }
        .input-group input[type="password"] { padding-right: 40px; }
        .input-group input:hover:not(:focus) { border-color: #bdc3c7; }
        .input-group input:focus { border-color: #3498db; outline: none; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); background-color: #fff; }
        .password-toggle { position: absolute; top: 45px; right: 15px; transform: translateY(-50%); cursor: pointer; color: #95a5a6; font-size: 18px; user-select: none; }
        .password-toggle:hover { color: #7f8c8d; }
        .password-toggle svg { width: 20px; height: 20px; vertical-align: middle; }
        .signup-button { width: 100%; padding: 14px; background: linear-gradient(90deg, #3498db, #2980b9); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-top: 10px; box-shadow: 0 4px 6px rgba(52, 152, 219, 0.1); }
        .signup-button:hover:not(:disabled) { background: linear-gradient(90deg, #2980b9, #3498db); box-shadow: 0 6px 8px rgba(52, 152, 219, 0.15); transform: translateY(-1px); }
        .signup-button:active:not(:disabled) { transform: translateY(0); }
        .signup-button:disabled { background: #bdc3c7; cursor: not-allowed; box-shadow: none; transform: none; }
        .login-link { text-align: center; margin-top: 25px; font-size: 14px; color: #7f8c8d; }
        .login-link a { color: #3498db; text-decoration: none; margin: 0 5px; transition: color 0.3s; font-weight: 500; }
        .login-link a:hover { color: #2c3e50; text-decoration: underline; }
        .error-message { color: #e74c3c; font-size: 13px; margin-top: 8px; display: none; font-weight: 500; }
        .success-message { color: #27ae60; font-size: 13px; margin-top: 8px; display: none; font-weight: 500; }
        .password-strength { margin-top: 8px; font-size: 13px; color: #7f8c8d; }
        .strength-weak { color: #e74c3c; } .strength-medium { color: #f39c12; } .strength-strong { color: #27ae60; }
        .terms { display: flex; align-items: flex-start; margin-bottom: 15px; font-size: 14px; color: #7f8c8d; }
        .terms input[type="checkbox"] { margin-top: 2px; margin-right: 8px; flex-shrink: 0; }
        .terms label { font-weight: normal; color: #7f8c8d; margin-bottom: 0; font-size: 14px; display: inline; }
        .terms a { color: #3498db; text-decoration: none; cursor: pointer; }
        .terms a:hover { text-decoration: underline; }
        .terms .error-message { margin-top: 5px; margin-left: 25px; }
        .data-privacy-notice { font-size: 12px; color: #95a5a6; text-align: center; margin-top: 15px; margin-bottom: 0; }
        .data-privacy-notice svg { width: 12px; height: 12px; vertical-align: middle; margin-right: 4px; stroke: currentColor; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); animation: fadeInModal 0.3s ease-out; }
        .modal-content { background-color: #fefefe; margin: 10vh auto; padding: 30px 40px; border-radius: 8px; max-width: 800px; max-height: 80vh; overflow-y: auto; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.2); animation: slideInModal 0.3s ease-out; }
        .modal-close { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; line-height: 1; cursor: pointer; transition: color 0.2s; }
        .modal-close:hover, .modal-close:focus { color: #333; text-decoration: none; }
        .modal-content h2 { color: #2c3e50; border-bottom: 1px solid #e0e4e7; padding-bottom: 10px; margin-top: 15px; margin-bottom: 20px; font-size: 22px; }
        .modal-content h1 { text-align: center; color: #2c3e50; font-size: 26px; margin-bottom: 25px; }
        .modal-content p, .modal-content li { margin-bottom: 15px; color: #555; font-size: 15px; line-height: 1.6; }
        .modal-content strong { font-weight: 600; color: #34495e; }
        .modal-content ul { padding-left: 25px; margin-bottom: 15px; }
        .modal-content .modal-date { text-align: right; font-style: italic; color: #7f8c8d; margin-bottom: 20px; font-size: 13px; }
        .modal-content a { color: #3498db; text-decoration: none; }
        .modal-content a:hover { text-decoration: underline; }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInModal { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        body.modal-open { overflow: hidden; }
    </style>
</head>
<body>
    <div class="signup-container">
        <div class="logo">
             <!-- MODIFIED SVG Icon -->
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M3 6l3 6h12l3-6H3z"></path>
                <path d="M3 18l3-6h12l3 6H3z"></path>
                <line x1="12" y1="3" x2="12" y2="21"></line>
             </svg>
           <h2>Elevo Core System</h2> <!-- MODIFIED -->
        </div>
        <div class="signup-header">
            <h2>Create Your Account</h2>
            <p>Create your account to access the Elevo core flow system.</p> <!-- MODIFIED -->
        </div>

        <form id="signupForm" novalidate>
            <!-- Input fields remain unchanged -->
            <div class="input-group">
                <label for="name">Full Name</label>
                <span class="input-icon" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                </span>
                <input type="text" id="name" name="name" required placeholder="John Doe" aria-describedby="nameError">
                <div id="nameError" class="error-message">Please enter your full name</div>
            </div>
            <div class="input-group">
                <label for="email">Email Address</label>
                 <span class="input-icon" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                </span>
                <input type="email" id="email" name="email" required placeholder="your@email.com" aria-describedby="emailError signupError">
                <div id="emailError" class="error-message">Please enter a valid email address</div>
            </div>
            <div class="input-group">
                <label for="password">Password</label>
                 <span class="input-icon" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                 </span>
                <input type="password" id="password" name="password" minlength="6" required placeholder="••••••••" aria-describedby="passwordError passwordStrength">
                <span class="password-toggle" aria-label="Show password" role="button" tabindex="0">
                     <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                 </span>
                <div class="password-strength" id="passwordStrength"></div>
                <div id="passwordError" class="error-message">Password must be at least 6 characters</div>
            </div>
            <div class="input-group">
                <label for="confirmPassword">Confirm Password</label>
                <span class="input-icon" aria-hidden="true">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                 </span>
                <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="••••••••" aria-describedby="confirmError">
                 <span class="password-toggle" aria-label="Show password" role="button" tabindex="0">
                     <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                 </span>
                <div id="confirmError" class="error-message">Passwords don't match</div>
            </div>
            <div class="terms">
                <input type="checkbox" id="terms" name="terms" required aria-describedby="termsError">
                <div>
                    <label for="terms">I agree to the <a href="#" data-modal-target="termsModal">Terms of Service</a> and <a href="#" data-modal-target="privacyModal">Privacy Policy</a></label>
                    <div id="termsError" class="error-message">You must agree to the terms</div>
                </div>
            </div>

            <p class="data-privacy-notice">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                Your information is kept confidential and secure.
            </p>

            <div id="signupError" class="error-message">An error occurred. Please try again.</div>
            <div id="signupSuccess" class="success-message">Registration successful! Redirecting to login...</div>

            <button type="submit" class="signup-button" id="submitButton">Create Account</button>
        </form>

        <div class="login-link">
            Already have an account? <a href="login.html">Log in</a>
        </div>
    </div>

    <!-- Modals -->
     <div id="termsModal" class="modal">
         <div class="modal-content">
             <span class="modal-close" data-close-modal>×</span>
             <h1>Terms of Service for Elevo Core System</h1> <!-- MODIFIED -->
             <p class="modal-date">Last updated: May 11, 2025</p> <!-- MODIFIED -->

             <h2>Welcome to Elevo Core System!</h2> <!-- MODIFIED -->
             <p>These terms and conditions outline the rules and regulations for the use of Elevo Core System's services, provided by [Your Company Name/Your Name]. By accessing this system, we assume you accept these terms and conditions. Do not continue to use Elevo Core System if you do not agree to all of the terms and conditions stated on this page.</p>

             <h2>User Accounts</h2>
             <p>When you create an account with us, you must provide information that is accurate, complete, and current at all times. Failure to do so constitutes a breach of the Terms, which may result in immediate termination of your account on our Service. You are responsible for safeguarding the password that you use to access the Service and for any activities or actions under your password.</p>

             <h2>System Use</h2>
             <p>The Elevo Core System is designed to assist agents in managing call flows and related operational tasks. You agree not to use the system for any unlawful purpose or any purpose prohibited under this clause. You agree not to use the system in any way that could damage the system, services, or general business of [Your Company Name/Your Name].</p>
             
             <h2>Data and Performance Metrics</h2>
             <p>The system will collect data related to call handling, step durations, and overall performance. This data is used to improve the system, provide training feedback, and for Key Performance Indicator (KPI) tracking. All data will be handled in accordance with our Privacy Policy.</p>

             <h2>Disclaimer</h2>
             <p>The Elevo Core System is provided "as is," with all faults, and [Your Company Name/Your Name] express no representations or warranties, of any kind related to this system or the materials contained on this system. Your use of the system and reliance on any information on the system is solely at your own risk.</p>

             <h2>Contact Us</h2> <!-- MODIFIED -->
             <p>If you have any questions about these Terms, please contact us at <a href="mailto:m.elsayed@thechefz.co">[Your Contact Email]</a>.</p>
         </div>
     </div>
     <div id="privacyModal" class="modal">
          <div class="modal-content">
              <span class="modal-close" data-close-modal>×</span>
             <h1>Privacy Policy for Elevo Core System</h1> <!-- MODIFIED -->
             <p class="modal-date">Last updated: May 11, 2025</p> <!-- MODIFIED -->

             <h2>Our Commitment to Your Privacy</h2>
             <p>[Your Company Name/Your Name] ("us", "we", or "our") operates the Elevo Core System (the "Service"). This page informs you of our policies regarding the collection, use, and disclosure of personal data when you use our Service and the choices you have associated with that data.</p>

             <h2>Information Collection and Use</h2>
             <p>We collect several different types of information for various purposes to provide and improve our Service to you. Types of Data Collected may include:</p>
             <ul>
                 <li><strong>Personal Data:</strong> While using our Service, we may ask you to provide us with certain personally identifiable information that can be used to contact or identify you ("Personal Data"). Personally identifiable information may include, but is not limited to: Email address, Full Name.</li>
                 <li><strong>Usage Data:</strong> We may also collect information on how the Service is accessed and used ("Usage Data"). This Usage Data may include information such as your computer's Internet Protocol address (e.g. IP address), browser type, browser version, the pages of our Service that you visit, the time and date of your visit, the time spent on those pages, unique device identifiers and other diagnostic data. Data related to call scenarios, step timings, and performance will also be collected.</li>
             </ul>
             
             <h2>Use of Data</h2>
             <p>[Your Company Name/Your Name] uses the collected data for various purposes:</p>
             <ul>
                 <li>To provide and maintain our Service</li>
                 <li>To manage your account and provide user support</li>
                 <li>To monitor the usage of our Service</li>
                 <li>To detect, prevent and address technical issues</li>
                 <li>For performance analysis, training, and talent development purposes</li>
             </ul>

             <h2>Data Security</h2>
             <p>The security of your data is important to us but remember that no method of transmission over the Internet or method of electronic storage is 100% secure. While we strive to use commercially acceptable means to protect your Personal Data, such as utilizing secure platforms like Supabase, we cannot guarantee its absolute security.</p>

             <h2>Contact Us</h2> <!-- MODIFIED -->
             <p>If you have any questions about this Privacy Policy, please contact us at <a href="mailto:m.elsayed@thechefz.co">[Your Contact Email]</a>.</p>
         </div>
     </div>

    <script>
        // JavaScript remains unchanged as per your request
        document.addEventListener('DOMContentLoaded', function() {

            const SUPABASE_URL = 'https://lgcutmuspcaralydycmg.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxnY3V0bXVzcGNhcmFseWR5Y21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NDY3MDEsImV4cCI6MjA2MTAyMjcwMX0.3u5Y7pkH2NNnnoGLMWVfAa5b8fq88o1itRYnG1K38tE';

            if (!window.supabase || !window.supabase.createClient) {
                console.error("Supabase library not loaded correctly!");
                alert("Error: Could not initialize Supabase. Please check the console.");
                return;
            }
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('Supabase client initialized.');

            const signupForm = document.getElementById('signupForm');
            const nameInput = document.getElementById('name');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const confirmInput = document.getElementById('confirmPassword');
            const termsCheckbox = document.getElementById('terms');
            const submitButton = document.getElementById('submitButton');
            const passwordToggles = document.querySelectorAll('.password-toggle');
            const nameError = document.getElementById('nameError');
            const emailError = document.getElementById('emailError');
            const passwordError = document.getElementById('passwordError');
            const confirmError = document.getElementById('confirmError');
            const termsError = document.getElementById('termsError');
            const signupError = document.getElementById('signupError');
            const signupSuccess = document.getElementById('signupSuccess');
            const passwordStrength = document.getElementById('passwordStrength');

            function showError(element, message) { if(element){ element.textContent = message; element.style.display = 'block';} }
            function hideError(element) { if(element) element.style.display = 'none'; }
            function updatePasswordStrength(password) {
                 if (!passwordStrength) return;
                 let strength = 0;
                 if (password.length >= 6) strength++;
                 if (password.length >= 8) strength++;
                 if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
                 if (password.match(/\d/)) strength++;
                 if (password.match(/[^a-zA-Z\d]/)) strength++;
                 passwordStrength.textContent = '';
                 passwordStrength.className = 'password-strength';
                 if (password.length > 0) {
                     if (strength <= 2) { passwordStrength.textContent = 'Weak'; passwordStrength.classList.add('strength-weak'); }
                     else if (strength <= 4) { passwordStrength.textContent = 'Medium'; passwordStrength.classList.add('strength-medium'); }
                     else { passwordStrength.textContent = 'Strong'; passwordStrength.classList.add('strength-strong'); }
                 }
            }
            function togglePasswordVisibility(toggleButton, inputElement) {
                 if (!toggleButton || !inputElement) return;
                 const isPassword = inputElement.type === 'password';
                 inputElement.type = isPassword ? 'text' : 'password';
                 toggleButton.innerHTML = isPassword ?
                     '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>' :
                     '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>';
                 toggleButton.setAttribute('aria-label', isPassword ? 'Hide password' : 'Show password');
            }

            if(passwordInput) { passwordInput.addEventListener('input', (e) => updatePasswordStrength(e.target.value)); }
            if(confirmInput) { confirmInput.addEventListener('input', () => { if (passwordInput?.value !== confirmInput.value) { showError(confirmError, "Passwords don't match"); } else { hideError(confirmError); } }); }
            passwordToggles.forEach(toggle => {
                 const input = toggle.previousElementSibling;
                 if(input && input.tagName === 'INPUT') {
                     toggle.addEventListener('click', () => togglePasswordVisibility(toggle, input));
                     toggle.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') togglePasswordVisibility(toggle, input); });
                 } else {
                     const inputId = toggle.closest('.input-group')?.querySelector('input')?.id;
                     const inputElement = document.getElementById(inputId);
                     if(inputElement){
                        toggle.addEventListener('click', () => togglePasswordVisibility(toggle, inputElement));
                        toggle.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') togglePasswordVisibility(toggle, inputElement); });
                     }
                 }
            });

            if(signupForm) {
                signupForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    console.log("Signup form submitted.");
                    [nameError, emailError, passwordError, confirmError, termsError, signupError, signupSuccess].forEach(hideError);
                    if(submitButton) { submitButton.disabled = true; submitButton.textContent = 'Creating Account...'; }
                    const name = nameInput?.value.trim();
                    const email = emailInput?.value.trim().toLowerCase();
                    const password = passwordInput?.value; 
                    const confirmPassword = confirmInput?.value;
                    const termsAgreed = termsCheckbox?.checked;
                    console.log("Validating input...");
                    let isValid = true;
                    if (!name) { showError(nameError, "Please enter your full name"); isValid = false; }
                    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { showError(emailError, "Please enter a valid email address"); isValid = false; }
                    if (!password || password.length < 6) { showError(passwordError, "Password must be at least 6 characters"); isValid = false; }
                    if (password !== confirmPassword) { showError(confirmError, "Passwords don't match"); isValid = false; }
                    if (!termsAgreed) { showError(termsError, "You must agree to the terms"); isValid = false; }

                    if (!isValid) {
                        console.log("Frontend validation failed.");
                        if(submitButton) { submitButton.disabled = false; submitButton.textContent = 'Create Account'; }
                        const firstError = signupForm.querySelector('.error-message[style*="display: block"]');
                         if (firstError) {
                             const inputId = firstError.id.replace('Error','');
                             const inputElement = document.getElementById(inputId);
                             if(inputElement && typeof inputElement.focus === 'function') inputElement.focus();
                         }
                        return;
                    }
                    try {
                        console.log(`Attempting Supabase signup for: ${email}`);
                        const { data: signUpData, error: signUpError } = await supabase.auth.signUp({
                            email: email,
                            password: password 
                        });

                        if (signUpError) {
                            console.error('Supabase signup error:', signUpError);
                            showError(signupError, signUpError.message || 'Signup failed. Please check your details.');
                            isValid = false;
                        } else if (!signUpData.user) {
                             console.warn('Supabase signup may require email confirmation.');
                             showError(signupError, 'Account registration initiated. Check your email to confirm your account if required.');
                             isValid = false; 
                        } else {
                            const userId = signUpData.user.id;
                            console.log('Supabase signup successful. User ID:', userId);
                            console.log(`Attempting to insert profile into 'users' table for user ID: ${userId}`);
                            const { error: insertError } = await supabase
                                .from('users') 
                                .insert({ id: userId, name: name, email: email, is_admin: email === "m.elsayed@thechefz.co" });

                            if (insertError) {
                                console.error('Supabase profile insert error:', insertError);
                                console.warn(`Profile insert failed for ${userId}.`);
                                showError(signupError, `Account created, but failed to save profile details. (Error: ${insertError.message})`);
                                isValid = false;
                            } else {
                                console.log(`Profile inserted successfully. is_admin set to: ${email === "m.elsayed@thechefz.co"}`);
                                isValid = true; 
                                try {
                                    localStorage.setItem('currentUserSignupInfo', JSON.stringify({ name: name, email: email }));
                                    console.log('Signup info (name, email) saved to localStorage.');
                                } catch (storageError) {
                                    console.error('Error saving signup info to localStorage:', storageError);
                                }
                            }
                        }
                    } catch (err) {
                        console.error("Unexpected error during signup process:", err);
                        showError(signupError, 'An unexpected error occurred. Please try again later.');
                        isValid = false;
                    }
                    if (isValid) {
                        console.log("Signup and profile insert successful.");
                        if(signupSuccess) signupSuccess.style.display = 'block';
                        setTimeout(function() {
                            window.location.href = 'login.html?email=' + encodeURIComponent(email) + '&signedup=true';
                        }, 1500);
                    } else {
                        console.log("Signup process failed or partially failed.");
                        if(submitButton) { submitButton.disabled = false; submitButton.textContent = 'Create Account'; }
                        const firstError = signupForm.querySelector('.error-message[style*="display: block"]');
                         if (firstError) {
                             const inputId = firstError.id.replace('Error','');
                             const inputElement = document.getElementById(inputId);
                             if(inputElement && typeof inputElement.focus === 'function') inputElement.focus();
                         }
                    }
                });
            }

            const modalTriggers = document.querySelectorAll('[data-modal-target]');
            const closeButtons = document.querySelectorAll('[data-close-modal]');
            modalTriggers.forEach(button => { button.addEventListener('click', function(event) { event.preventDefault(); const modalId = this.dataset.modalTarget; const modal = document.getElementById(modalId); if (modal) openModal(modal); }); });
            closeButtons.forEach(button => { button.addEventListener('click', function() { const modal = this.closest('.modal'); if (modal) closeModal(modal); }); });
            window.addEventListener('click', function(event) { document.querySelectorAll('.modal').forEach(modal => { if (event.target == modal) closeModal(modal); }); });
            function openModal(modal) { if (modal == null) return; modal.style.display = 'block'; document.body.classList.add('modal-open'); }
            function closeModal(modal) { if (modal == null) return; modal.style.display = 'none'; document.body.classList.remove('modal-open'); }

            if(nameInput) nameInput.focus();
            console.log("Signup page script loaded and initialized.");
        });
    </script>
</body>
</html>
