<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Coaching</title>
    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <style>
        /* --- Global Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html { scroll-behavior: smooth; }

        body {
            margin: 0;
            padding: 0;
            line-height: 1.7;
            background-color: #f9f9f9;
            color: #333;
        }

        /* --- User Bar Styles (Consistent) --- */
        .user-bar {
            background-color: #34495e;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-info svg { opacity: 0.8; }
        .user-details { display: flex; flex-direction: column; }
        .user-name { font-weight: 600; font-size: 14px; }
        .user-email { font-size: 12px; opacity: 0.8; }
        .logout-button {
            background-color: #e74c3c; /* Consistent Red */
            color: white; border: none; padding: 8px 15px;
            border-radius: 6px; cursor: pointer; font-weight: 500;
            transition: all 0.3s ease; display: flex; align-items: center;
            gap: 6px; font-size: 13px;
        }
        .logout-button:hover { background-color: #c0392b; transform: translateY(-1px); }
        .logout-button:active { transform: translateY(0); }

        /* --- Navigation Tabs (Consistent) --- */
        .nav-tab {
            background-color: #2c3e50;
            padding: 12px 10px;
            text-align: center; position: sticky; top: 0; z-index: 100;
            overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch;
            scrollbar-width: thin; scrollbar-color: #556a80 #2c3e50;
        }
        .nav-tab::-webkit-scrollbar { height: 6px; }
        .nav-tab::-webkit-scrollbar-track { background: #2c3e50; }
        .nav-tab::-webkit-scrollbar-thumb { background-color: #556a80; border-radius: 10px; border: 1px solid #2c3e50; }
        .nav-tab a {
            color: white; text-decoration: none; margin: 0 8px;
            padding: 8px 12px; border-radius: 6px;
            transition: background-color 0.3s, color 0.3s; font-size: 14px;
            display: inline-block;
        }
        .nav-tab a:hover,
        .nav-tab a.active {
            background-color: #34495e; /* Consistent hover/active */
            color: #fff;
        }

        /* --- Main Content Styles (Consistent) --- */
        h1 {
            color: #fff;
            background-color: #e67e22; /* Standard Orange */
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 25px auto;
            max-width: 800px;
            font-size: 26px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
         h1 + p { /* Subtitle */
            text-align: center; margin-top: -15px; margin-bottom: 25px;
            color: #555; font-size: 15px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto 30px;
            background: white;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        .section-title {
            color: #e67e22; /* Standard Orange */
            font-size: 1.6em;
            margin: 30px 0 15px 0;
            border-bottom: 2px solid #e67e22;
            padding-bottom: 8px;
            font-weight: 600;
        }

        .highlight-section {
            background-color: rgba(230, 126, 34, 0.07); /* Orange tint */
            padding: 20px;
            border-left: 5px solid #e67e22;
            border-radius: 6px;
            margin: 25px 0;
        }

        .action-card { /* Standard Orange */
            background-color: #e67e22;
            color: white; /* Default text for direct children */
            padding: 20px;
            border-radius: 6px;
            margin: 25px 0;
            border-left: 5px solid #d35400;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
         /* Ensure direct children inherit white color */
        .action-card > p, .action-card > h3 { color: white; }

        .media-container { text-align: center; margin: 30px 0; }
        .media-container img {
            max-width: 100%; height: auto; border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .caption { color: #555; margin-top: 10px; font-size: 14px; }

        .question-item { /* Standard light bg, blue border */
            background-color: rgba(52, 152, 219, 0.08); /* Blue tint */
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 4px solid #3498db; /* Blue border */
        }
         /* Question text styling */
        .question-text {
            color: #34495e; font-weight: 600;
            margin-bottom: 15px; font-size: 1.1em;
        }
        .question-text .required-star { color: #e74c3c; font-weight: bold; margin-left: 3px; }

         /* Question items INSIDE action cards need different styling */
        .action-card .question-item {
            background-color: rgba(255, 255, 255, 0.9); /* Lighter background inside orange */
            border-left: 4px solid #ffffff; /* White border inside orange */
            padding: 15px;
        }
        .action-card .question-item .question-text {
             color: #333; /* Dark text for readability on light bg */
        }

        /* Unified class for all answer fields (Consistent) */
        .editable-answer {
            width: 100%; padding: 12px; border: 1px solid #ddd;
            border-radius: 4px; margin-top: 8px; margin-bottom: 10px;
            background-color: white; min-height: 45px; line-height: 1.6;
            display: block; color: #333; font-size: 15px;
             transition: border-color 0.3s, box-shadow 0.3s;
        }
        textarea.editable-answer { min-height: 80px; resize: vertical; }
        .editable-answer:focus {
            outline: none; border-color: #e67e22; /* Orange focus */
            box-shadow: 0 0 0 3px rgba(230, 126, 34, 0.2);
        }
        .editable-answer::placeholder { color: #aaa; opacity: 1; }

        /* Save/Delete Buttons (Consistent) */
        .save-btn, .delete-btn {
            color: white; border: none; padding: 8px 15px;
            border-radius: 4px; cursor: pointer; transition: all 0.3s ease;
            font-size: 14px; font-weight: 500;
        }
        .save-btn { background-color: #27ae60; margin-right: 8px; } /* Green */
        .delete-btn { background-color: #e74c3c; } /* Red */
        .save-btn:hover { background-color: #2ecc71; transform: translateY(-1px); }
        .delete-btn:hover { background-color: #c0392b; transform: translateY(-1px); }
        .save-btn:active, .delete-btn:active { transform: translateY(0); }

        .saved-message { /* Consistent Green */
            color: #27ae60; font-size: 13px; margin-left: 5px;
            display: none; font-weight: 500;
        }
         .saved-message.deleted { color: #6c757d; }

         .inline-error-message { /* Consistent Red */
            color: #e74c3c; font-size: 13px; margin-left: 5px;
            display: none; font-weight: 500;
        }
         /* Feedback messages inside action cards */
         .action-card .saved-message { color: #d1e7dd; } /* Light green */
         .action-card .saved-message.deleted { color: #e9ecef; } /* Light grey */
         .action-card .inline-error-message { color: #f8d7da; } /* Light red */

        /* General table styles (Consistent) */
        table { width: 100%; border-collapse: collapse; margin: 25px 0; font-size: 14px; }
        table, th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: 600; color: #333; }

        /* Action Table (Instructions) Styles (Consistent) */
        .action-table {
            width: 100%; margin: 20px 0; background-color: #f8f9fa;
            border-radius: 6px; overflow: hidden; border: 1px solid #ddd;
        }
        .action-table th { /* Dark Blue Header */
             background-color: #34495e;
             color: white; text-align: center;
        }
        .action-table td { vertical-align: top; color: #333; }

        /* Orange Header for Tables inside Action Cards */
        .orange-header th { /* Applied to TH directly */
            background-color: #e67e22 !important; /* Orange BG */
            color: black !important; /* <<< Black text override >>> */
            padding: 10px; text-align: center; font-size: 14px; font-weight: bold;
             border-bottom: 1px solid #d35400; /* Darker orange bottom border */
        }

        /* Light orange for data rows in tables inside action cards */
        .orange-row td {
             background-color: rgba(255, 255, 255, 0.8); /* Lighter background inside action card */
             vertical-align: top; /* Align content top */
        }

        /* Inputs/Selects within the light orange rows */
        .orange-row .editable-answer {
            margin: 5px 0; color: #333; background-color: white;
            border: 1px solid #ccc; padding: 8px 10px; font-size: 14px;
        }
        .orange-row input.editable-answer::placeholder { color: #888; }

        /* Button Container (Bottom Navigation) (Consistent) */
        .button-container {
            display: flex; justify-content: space-between; margin-top: 40px;
            gap: 20px; border-top: 1px solid #eee; padding-top: 25px;
        }
        .button {
            text-decoration: none; padding: 12px 20px; color: white;
            border-radius: 4px; font-weight: 600; flex: 1; text-align: center;
            transition: all 0.3s ease; font-size: 15px; border: none; cursor: pointer;
        }
        .button.back { background-color: #6c757d; } /* Grey back */
        .button#nextButton { background-color: #e67e22; } /* Orange next */
        .button:hover { transform: translateY(-1px); filter: brightness(110%); }
        .button:active { transform: translateY(0); filter: brightness(100%); }

        /* Warning Message (Bottom) (Consistent) */
        .warning-message {
            background-color: #fff8e1; border-left: 4px solid #ffc107;
            padding: 15px; margin: 20px 0; color: #333; display: none;
            font-size: 14px; line-height: 1.6; border-radius: 4px; font-weight: 500;
        }

        /* Required Field Style (Consistent) */
        .required-field {
            border: 2px solid #e74c3c !important;
            background-color: #fff2f1 !important;
            box-shadow: none !important;
        }

        /* Section specific styles (Consistent BG/Borders) */
        .model-section, .trust-section, .rapport-section, .informal-tips {
            padding: 20px; border-radius: 6px; margin: 25px 0;
            border-left-width: 5px; border-left-style: solid;
        }
        .model-section { background-color: rgba(52, 152, 219, 0.1); border-left-color: #3498db; } /* Blue */
        .trust-section { background-color: rgba(46, 204, 113, 0.1); border-left-color: #2ecc71; } /* Green */
        .rapport-section { background-color: rgba(155, 89, 182, 0.1); border-left-color: #9b59b6; } /* Purple */
        .informal-tips { background-color: rgba(241, 196, 15, 0.1); border-left-color: #f1c40f; } /* Yellow */

        /* Drawing Together Section (Consistent) */
        .drawing-together {
            display: flex; align-items: center; gap: 20px;
            background-color: rgba(155, 89, 182, 0.1);
            padding: 20px; border-radius: 6px; margin: 25px 0;
            border-left: 5px solid #9b59b6;
        }
        .drawing-icon { font-size: 28px; color: #9b59b6; flex-shrink: 0; }

        .answer-buttons { /* Consistent */
            display: flex; gap: 8px; align-items: center; margin-top: 10px;
            flex-wrap: wrap;
        }
        /* Styles for table action buttons */
        .table-action-buttons {
             margin-top: 15px; text-align: right;
        }

        /* Modal Styles (Consistent) */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center;
            animation: modalFadeInBackground 0.3s ease-out;
        }
        @keyframes modalFadeInBackground { from { background: rgba(0,0,0,0); } to { background: rgba(0,0,0,0.6); } }
        .modal-content {
            background: white; padding: 30px 40px; border-radius: 8px; max-width: 450px;
            text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.2); position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .modal-button {
            background-color: #27ae60; /* Consistent Green */
            color: white; border: none; padding: 12px 25px; border-radius: 5px;
            cursor: pointer; margin-top: 25px; font-weight: bold; transition: all 0.3s;
            font-size: 15px;
        }
        .modal-button:hover { background-color: #219653; transform: translateY(-2px); }
        .close-modal {
            position: absolute; top: 15px; right: 15px; background: none; border: none;
            font-size: 24px; cursor: pointer; color: #aaa; transition: color 0.3s;
        }
        .close-modal:hover { color: #555; }

         /* Required Star Helper */
         .required-star { color: #e74c3c; font-weight: bold; margin-left: 2px; }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
             h1 { font-size: 22px; padding: 15px; margin: 20px 15px; }
             h1 + p { font-size: 14px; margin: -10px 15px 20px; }
             .container { padding: 20px; margin: 0 15px 20px; }
             .user-bar { padding: 10px 15px; font-size: 13px; }
             .user-name { font-size: 13px; }
             .user-email { font-size: 11px; }
             .logout-button { padding: 7px 12px; font-size: 12px; }
             .nav-tab { padding: 10px 5px; }
             .nav-tab a { margin: 0 5px; padding: 7px 10px; font-size: 13px;}
             .section-title { font-size: 1.4em; margin: 25px 0 10px 0; }
              .highlight-section, .action-card, .question-item, .model-section, .trust-section, .rapport-section, .informal-tips, .drawing-together {
                 padding: 15px; margin: 20px 0;
             }
             .editable-answer { font-size: 14px; padding: 10px; }
             textarea.editable-answer { min-height: 80px; }
             .save-btn, .delete-btn { padding: 7px 13px; font-size: 13px; }
             .button-container { flex-direction: column; gap: 15px; padding-top: 20px; margin-top: 30px;}
             .button { font-size: 14px; padding: 12px 15px;}
             .modal-content { max-width: 90%; padding: 20px 25px; }
             .modal-button { padding: 10px 20px; font-size: 14px; }
             .close-modal { top: 10px; right: 10px; font-size: 20px; }
             .table-action-buttons { text-align: center; } /* Center buttons below table on mobile */
             .warning-message { font-size: 13px; }
             /* Improve table display on mobile if needed */
             table, thead, tbody, th, td, tr { display: block; }
             thead tr { position: absolute; top: -9999px; left: -9999px; } /* Hide table header visually */
             tr { border: 1px solid #ccc; margin-bottom: 10px; border-radius: 4px; }
             td { border: none; border-bottom: 1px solid #eee; position: relative; padding-left: 50%; text-align: right; }
             td:before { position: absolute; top: 6px; left: 6px; width: 45%; padding-right: 10px; white-space: nowrap; content: attr(data-label); font-weight: bold; text-align: left;}
             /* Apply data-label attributes in JS or manually */
             .action-card table { margin: 15px 0; } /* Adjust margin */
             .orange-header { display: none; } /* Hide visual orange header row */
             .orange-row td:before { color: #e67e22; } /* Style data labels for orange rows */
             .action-table { display: table; } /* Keep instruction table as table */
             .action-table thead, .action-table tbody, .action-table tr, .action-table th, .action-table td { display: revert; } /* Revert instruction table display */
             .action-table thead tr { position: static; }
             .action-table th { text-align: center; }
             .action-table td { text-align: left; padding-left: 10px; }
             .action-table td:before { display: none; }

        }

    </style>
</head>
<body>
    <!-- User Info Bar -->
    <div class="user-bar">
        <div class="user-info">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.8;">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <div class="user-details">
                <span class="user-name" id="userName">Welcome back</span>
                <span class="user-email" id="userEmail">user@example.com</span>
            </div>
        </div>
        <button class="logout-button" onclick="logout()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
        </button>
    </div>

    <!-- Navigation Tabs -->
    <nav class="nav-tab">
        <a href="index.html">Home</a>
        <a href="article1.html">Article 1</a>
        <a href="coaching-skills.html">Coaching Skills</a>
        <a href="coaching-individuals.html">Coaching Individuals</a>
        <a href="coaching-team.html" class="active">Team Coaching</a> <!-- Active Tab -->
        <a href="coaching-yourself.html">Self Coaching</a>
        <a href="action-plan.html">Action Plan</a>
    </nav>

    <!-- Page Title -->
    <h1>Team Coaching</h1>
    <p>Developing high-performing teams through collective growth</p>

    <div class="container">
        <div class="highlight-section"> <!-- Orange highlight -->
            <p>It's not easy to get a team to work to its full potential. Conflicts, power struggles and miscommunication can cause a group to start, stumble and stop.</p>
        </div>

        <p>When your people aren't working together as effectively as they could, team coaching can help. Instead of focusing on individual development, your attention with group coaching is on improving relationships and interactions within the team as a whole.</p>

        <p>Team coaching is useful in many situations. For example, it can help people to:</p>
        <ul style="margin-left: 25px; list-style: disc; margin-bottom: 15px;">
            <li>Work through interpersonal conflicts</li>
            <li>Understand their roles within the group</li>
            <li>Improve relationships</li>
            <li>Understand team goals</li>
        </ul>

        <p>You can coach your people at a specific place and time - at a team-building event, for example - or you can do it spontaneously.</p>

        <div class="media-container">
            <img src="https://images.unsplash.com/photo-1593642634524-b40b5baae6bb?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                 alt="Team members collaborating in a coaching session"
                 loading="lazy">
            <p class="caption">Team coaching focuses on group dynamics and interactions</p>
        </div>

        <h2 class="section-title">3.1 Understanding Team Dynamics</h2>

        <p>Before you start your group coaching session, you need to know how your people relate to one another.</p>
        <p>Each person has a unique personality and way of communicating. But, when people are in a group, they have to work closely with one another. Their different styles can cause frustration and conflict, which may prevent them from working together effectively.</p>
        <p>By understanding team dynamics, you can help people to recognize how they relate to one another, and to identify ways to improve their relationships.</p>

        <div class="trust-section"> <!-- Green section -->
            <h3>Recognizing Unique Personalities</h3>
            <p>Personality tests such as Myers-Briggs®, the Big Five Personality Traits Model, and The DiSC Model can help you and your team members to learn more about how you prefer to communicate and process information.</p>
            <p>If your team members agree to take these tests, and to share the results, they may learn to understand one another better, and that it's OK for individuals to have different preferences. This can enable them to work together more effectively.</p>
            <p>It can also help if each team member understands their "role" within the group, perhaps using a framework like Belbin's Team Roles (Action Oriented, People Oriented, or Thought Oriented).</p>
        </div>


        <div class="highlight-section">
            <p><strong>Example:</strong> Patrick is detail-oriented and enjoys research. His colleagues sometimes find him slow. However, recognizing the value his attention to detail brings transforms this perception from a weakness into a team strength.</p>
        </div>


        <!-- Team Roles Action Card -->
        <div class="action-card"> <!-- Orange card -->
            <h3>ACTION: Identify Team Roles</h3>
            <p>Reflect on your team members' strengths and typical behaviors. Consider frameworks like Belbin's team roles. List potential roles and strengths below (fill at least one row).</p>

            <table>
                 <thead>
                    <tr class="orange-header"> <!-- Orange header, Black text -->
                        <th>Team Member</th>
                        <th>Potential Role</th>
                        <th>Key Strengths</th>
                    </tr>
                 </thead>
                 <tbody>
                    <!-- Row 1 -->
                    <tr class="orange-row"> <!-- Light orange bg -->
                        <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member1"></td>
                        <td data-label="Role"><input type="text" class="editable-answer" placeholder="e.g., Implementer, Coordinator..." data-question="role1"></td>
                        <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="e.g., Organised, Good listener..." data-question="strengths1"></td>
                    </tr>
                     <!-- Row 2 -->
                    <tr class="orange-row">
                        <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member2"></td>
                        <td data-label="Role"><input type="text" class="editable-answer" placeholder="e.g., Plant, Monitor Evaluator..." data-question="role2"></td>
                        <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="e.g., Creative, Analytical..." data-question="strengths2"></td>
                    </tr>
                    <!-- Add more rows as needed -->
                     <tr class="orange-row">
                        <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member3"></td>
                        <td data-label="Role"><input type="text" class="editable-answer" placeholder="Team role..." data-question="role3"></td>
                        <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths3"></td>
                    </tr>
                      <tr class="orange-row">
                        <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member4"></td>
                        <td data-label="Role"><input type="text" class="editable-answer" placeholder="Team role..." data-question="role4"></td>
                        <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths4"></td>
                    </tr>
                       <tr class="orange-row">
                        <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member5"></td>
                        <td data-label="Role"><input type="text" class="editable-answer" placeholder="Team role..." data-question="role5"></td>
                        <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths5"></td>
                    </tr>
                 </tbody>
            </table>
            <div class="table-action-buttons">
                <button class="save-btn" onclick="saveTableData('teamRoles')">Save Team Roles</button>
                <button class="delete-btn" onclick="deleteTableData('teamRoles')">Clear Team Roles</button>
                <span class="saved-message" id="save-status-teamRoles"></span>
                <span class="inline-error-message" id="error-teamRoles"></span> <!-- Error message here -->
            </div>
             <p style="font-size: 0.9em; color: #eee; margin-top: 10px;">Note: Fill all columns if entering a team member's name.</p>
        </div>


        <div class="media-container">
            <img src="https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                 alt="Team members with diverse personalities working together"
                 loading="lazy">
            <p class="caption">Understanding personality differences improves team dynamics</p>
        </div>

        <h2 class="section-title">3.2 Defining Your Expectations</h2>
        <p>When your team members understand one another better, they will likely work together more effectively. But they may also benefit from a set of ground rules that guides the way that they behave and communicate.</p>

        <div class="highlight-section">
            <p><strong>Example:</strong> Rudi finds high-energy meetings exhausting. In the past, he stayed silent when he could have raised important concerns, damaging the team's reputation. Clear communication guidelines could prevent this.</p>
        </div>
        <p>Defining expectations is crucial. A <strong>team charter</strong> is a document defining behavior and communication "rules" everyone agrees to follow. If a formal charter isn't suitable, discuss and agree on acceptable standards for different situations.</p>

        <!-- Team Charter Action Card -->
        <div class="action-card"> <!-- Orange card -->
            <h3>ACTION: Develop Team Charter Elements</h3>
            <p>List key responsibilities, priorities, and expected outcomes for team members or roles (fill at least one row).</p>

            <table>
                 <thead>
                    <tr> <!-- Orange Header, Black Text -->
                        <th class="orange-header">Name / Role</th>
                        <th class="orange-header">Responsibility</th>
                        <th class="orange-header">Priority</th>
                        <th class="orange-header">Expected Outcome</th>
                    </tr>
                 </thead>
                 <tbody>
                     <!-- Row 1 -->
                    <tr class="orange-row"> <!-- Light orange bg -->
                        <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name1"></td>
                        <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility1"></textarea></td>
                        <td data-label="Priority">
                            <select class="editable-answer" data-question="priority1">
                                <option value="">Select...</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </td>
                        <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome1"></textarea></td>
                    </tr>
                    <!-- Add more rows -->
                     <tr class="orange-row">
                        <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name2"></td>
                        <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility2"></textarea></td>
                        <td data-label="Priority">
                            <select class="editable-answer" data-question="priority2">
                                <option value="">Select...</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option>
                            </select>
                        </td>
                        <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome2"></textarea></td>
                    </tr>
                     <tr class="orange-row">
                        <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name3"></td>
                        <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility3"></textarea></td>
                        <td data-label="Priority">
                            <select class="editable-answer" data-question="priority3">
                                <option value="">Select...</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option>
                            </select>
                        </td>
                        <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome3"></textarea></td>
                    </tr>
                    <tr class="orange-row">
                        <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name4"></td>
                        <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility4"></textarea></td>
                        <td data-label="Priority">
                            <select class="editable-answer" data-question="priority4">
                                <option value="">Select...</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option>
                            </select>
                        </td>
                        <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome4"></textarea></td>
                    </tr>
                    <tr class="orange-row">
                        <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name5"></td>
                        <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility5"></textarea></td>
                        <td data-label="Priority">
                            <select class="editable-answer" data-question="priority5">
                                <option value="">Select...</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option>
                            </select>
                        </td>
                        <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome5"></textarea></td>
                    </tr>

                 </tbody>
            </table>
            <div class="table-action-buttons">
                <button class="save-btn" onclick="saveTableData('teamCharter')">Save Team Charter</button>
                <button class="delete-btn" onclick="deleteTableData('teamCharter')">Clear Team Charter</button>
                <span class="saved-message" id="save-status-teamCharter"></span>
                 <span class="inline-error-message" id="error-teamCharter"></span>
            </div>
             <p style="font-size: 0.9em; color: #eee; margin-top: 10px;">Note: Fill all columns if entering a Name/Role.</p>
        </div>

        <h2 class="section-title">3.3 Evaluating Rewards and Recognition</h2>
        <p>At times, people in your team might have competing priorities, and this can lead to serious dysfunction within the group.</p>
        <div class="highlight-section">
            <p><strong>Example:</strong> An organization promotes teamwork but primarily rewards individual performance. This conflict can demotivate collaborative efforts.</p>
        </div>
        <p>As a manager, it's important to identify any competing values or goals in your team, and to address them before they cause problems.</p>

        <!-- Assess Priorities Action Card -->
        <div class="action-card"> <!-- Orange card -->
            <h3>ACTION: Assess Team Priorities</h3>
            <p>Answer the questions below to determine whether your team is facing any competing priorities:</p>

            <div class="question-item"> <!-- Light background inside orange -->
                <div class="question-text">1. Analyze your organization's reward system vs. your team's goals. Any conflicts? How can you resolve them?<span class="required-star">*</span></div>
                <textarea class="editable-answer required-answer" data-question="rewardSystem" placeholder="Describe conflicts and potential resolutions..."></textarea>
                <div class="answer-buttons">
                    <button class="save-btn" onclick="saveAnswer('rewardSystem')">Save</button>
                    <button class="delete-btn" onclick="deleteAnswer('rewardSystem')">Delete</button>
                    <span class="saved-message" id="save-status-rewardSystem"></span>
                    <span class="inline-error-message" id="error-rewardSystem"></span>
                </div>
            </div>

            <div class="question-item">
                <div class="question-text">2. For cross-functional teams: Do reward systems in different departments clash? How?<span class="required-star">*</span></div>
                <textarea class="editable-answer required-answer" data-question="departmentConflicts" placeholder="Describe inter-departmental reward conflicts..."></textarea>
                <div class="answer-buttons">
                    <button class="save-btn" onclick="saveAnswer('departmentConflicts')">Save</button>
                    <button class="delete-btn" onclick="deleteAnswer('departmentConflicts')">Delete</button>
                    <span class="saved-message" id="save-status-departmentConflicts"></span>
                    <span class="inline-error-message" id="error-departmentConflicts"></span>
                </div>
            </div>

            <div class="question-item">
                <div class="question-text">3. List your team's main goals and individuals' key objectives. Are they aligned? Where are the mismatches?<span class="required-star">*</span></div>
                <textarea class="editable-answer required-answer" data-question="goalAlignment" placeholder="List goals & objectives; identify misalignments..."></textarea>
                <div class="answer-buttons">
                    <button class="save-btn" onclick="saveAnswer('goalAlignment')">Save</button>
                    <button class="delete-btn" onclick="deleteAnswer('goalAlignment')">Delete</button>
                    <span class="saved-message" id="save-status-goalAlignment"></span>
                    <span class="inline-error-message" id="error-goalAlignment"></span>
                </div>
            </div>
              <p style="font-size: 0.9em; color: #eee; margin-top: 10px;"><span class="required-star" style="color:#f8d7da;">*</span> Required field.</p>
        </div>

        <div class="media-container">
            <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                 alt="Team celebrating success with aligned objectives"
                 loading="lazy">
            <p class="caption">Aligning rewards with team objectives is crucial</p>
        </div>

        <h2 class="section-title">3.4 Team Coaching Processes</h2>
        <p>There are various models that you can use when you coach a group, and some of the models that we outlined in Chapter 2 can also apply to team coaching. Here are some further suggestions:</p>

        <div class="model-section"> <!-- Blue section -->
            <h3>1. The POSITIVE Model of Coaching</h3>
            <p>Developed by Vincenzo Libri (2004), this model helps maintain motivation:</p>
            <ul style="margin-left: 25px; list-style: disc;">
                <li><strong>Purpose:</strong> Define the desired outcome.</li>
                <li><strong>Observations:</strong> Analyze the current situation.</li>
                <li><strong>SMART:</strong> Set a Specific, Measurable, Achievable, Relevant, Time-bound goal.</li>
                <li><strong>Insight:</strong> Reflect on the goal's meaning and implications.</li>
                <li><strong>Team:</strong> Consider support systems and stakeholders.</li>
                <li><strong>Initiate:</strong> Plan the first steps and start date.</li>
                <li><strong>Value:</strong> Break down the goal into manageable steps.</li>
                <li><strong>Encourage:</strong> Regularly review progress and offer support.</li>
            </ul>
        </div>

         <div class="model-section"> <!-- Blue section -->
            <h3>2. The PRACTICE Model of Coaching</h3>
            <p>Published by psychologist Stephen Palmer (2008), this focuses on problem-solving:</p>
            <ol style="margin-left: 25px;">
                <li>Identify the <strong>P</strong>roblem.</li>
                <li>Develop <strong>R</strong>ealistic and relevant goals.</li>
                <li>Generate <strong>A</strong>lternative solutions.</li>
                <li>Consider the <strong>C</strong>onsequences of each alternative.</li>
                <li><strong>T</strong>arget the most feasible solution(s).</li>
                <li><strong>I</strong>mplement the <strong>C</strong>hosen solution(s).</li>
                <li><strong>E</strong>valuate the outcome.</li>
            </ol>
            <p>Its strength lies in its structured, solution-focused approach.</p>
        </div>


        <!-- Apply Coaching Models Action Card -->
        <div class="action-card"> <!-- Orange card -->
            <h3>ACTION: Apply Coaching Models</h3>
            <p>Identify team issues that coaching could resolve. How could the models help? (Fill at least the first issue).</p>

            <div class="question-item"> <!-- Light background inside orange -->
                <div class="question-text">Team Issue & Potential Resolution<span class="required-star">*</span></div>
                <!-- Issue 1 -->
                <textarea class="editable-answer required-answer" data-question="teamIssue1" placeholder="Issue 1: Describe the team issue and how a model (e.g., PRACTICE) could help resolve it..."></textarea>
                <div class="answer-buttons">
                    <button class="save-btn" onclick="saveAnswer('teamIssue1')">Save</button>
                    <button class="delete-btn" onclick="deleteAnswer('teamIssue1')">Delete</button>
                    <span class="saved-message" id="save-status-teamIssue1"></span>
                    <span class="inline-error-message" id="error-teamIssue1"></span>
                </div>
                 <!-- Issue 2 (Optional) -->
                 <textarea class="editable-answer" data-question="teamIssue2" placeholder="Issue 2 (Optional): Describe another issue and potential resolution..."></textarea>
                 <div class="answer-buttons">
                     <button class="save-btn" onclick="saveAnswer('teamIssue2')">Save</button>
                     <button class="delete-btn" onclick="deleteAnswer('teamIssue2')">Delete</button>
                     <span class="saved-message" id="save-status-teamIssue2"></span>
                 </div>
                  <!-- Issue 3 (Optional) -->
                 <textarea class="editable-answer" data-question="teamIssue3" placeholder="Issue 3 (Optional): Describe another issue..."></textarea>
                  <div class="answer-buttons">
                     <button class="save-btn" onclick="saveAnswer('teamIssue3')">Save</button>
                     <button class="delete-btn" onclick="deleteAnswer('teamIssue3')">Delete</button>
                     <span class="saved-message" id="save-status-teamIssue3"></span>
                 </div>
            </div>
             <p style="font-size: 0.9em; color: #eee; margin-top: 10px;"><span class="required-star" style="color:#f8d7da;">*</span> First issue field is required.</p>
        </div>

        <h2 class="section-title">3.5 Drawing This Together</h2>
        <div class="drawing-together"> <!-- Purple section -->
            <div class="drawing-icon">✓</div>
            <div>
                <p>In this chapter, we learned how coaching can enable your team to perform to its full potential by focusing on group dynamics, roles, expectations, and reward alignment. We explored models like POSITIVE and PRACTICE applicable to teams. Remember, team coaching, like individual coaching, is essentially a focused conversation aimed at collective improvement.</p>
            </div>
        </div>

        <div class="media-container">
            <img src="https://images.unsplash.com/photo-1523240795612-9a054b0db644?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                 alt="Team celebrating collective success"
                 loading="lazy">
            <p class="caption">Effective team coaching leads to collective success</p>
        </div>

         <!-- General Warning Message (for Next Button click) -->
        <div class="warning-message" id="generalWarningMessage">
            <strong>Action Required:</strong> Please complete all required answers (marked with <span class="required-star">*</span>) and ensure table rows are complete if started.
        </div>

        <!-- Navigation Buttons -->
        <div class="button-container">
            <a href="coaching-individuals.html" class="button back">← Back to Coaching Individuals</a>
            <button type="button" class="button" id="nextButton">Next: Self Coaching →</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">×</button>
            <h3 style="color: #27ae60;">Section Complete!</h3> <!-- Consistent Green -->
            <p>All required answers for this section have been saved.</p>
            <p>You can now proceed to the next section.</p>
            <button class="modal-button" onclick="redirectToNextPage()">CONTINUE TO SELF COACHING</button>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const formspreeEndpoint = 'https://formspree.io/f/xzzeqvea'; // YOUR Formspree Endpoint
        const localStorageKey = 'allUserAnswers_teamCoaching'; // Specific key for THIS page
        const currentUserKey = 'currentUser'; // Key for storing the whole user object

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = getCurrentUser();
            if (!currentUser || !currentUser.email) {
                console.error("User not logged in or email missing. Redirecting...");
                window.location.href = `login.html?redirect=${encodeURIComponent(window.location.pathname)}`;
                return;
            }
            displayUserInfo(currentUser);
            loadUserAnswers(currentUser.email);
            setupEventListeners(currentUser.email);
            highlightActiveNav();
            addRequiredStars(); // Add visual indicators
            setupMobileTableLabels(); // Add data-labels for mobile tables
        });

        // --- User Info & Authentication ---
        function getCurrentUser() { /* ... Consistent ... */
            try {
                const userDataString = localStorage.getItem(currentUserKey);
                return userDataString ? JSON.parse(userDataString) : null;
            } catch (error) { console.error("Error parsing user data:", error); return null; }
        }
        function displayUserInfo(user) { /* ... Consistent ... */
            document.getElementById('userName').textContent = `Welcome, ${user.name || 'User'}`;
            document.getElementById('userEmail').textContent = user.email;
        }
        function logout() { /* ... Consistent ... */
            localStorage.removeItem('loggedIn');
            localStorage.removeItem(currentUserKey);
            window.location.href = 'login.html';
        }
        function highlightActiveNav() { /* ... Consistent ... */
             const currentPath = window.location.pathname.split('/').pop() || 'index.html';
             const navLinks = document.querySelectorAll('.nav-tab a');
             navLinks.forEach(link => {
                 const linkPath = link.getAttribute('href');
                 link.classList.toggle('active', linkPath === currentPath);
             });
         }
          function addRequiredStars() { /* ... Consistent ... */
              document.querySelectorAll('.required-answer').forEach(field => {
                   const questionItem = field.closest('.question-item');
                   let labelElement = questionItem?.querySelector('.question-text');

                   // If not in a question-item, maybe it's the first textarea in an action-card directly
                   if (!labelElement && field.tagName === 'TEXTAREA' && field.closest('.action-card')) {
                       labelElement = field.previousElementSibling; // Check previous element (likely a p tag)
                        if (!labelElement || labelElement.tagName !== 'P') {
                             labelElement = field.closest('.action-card').querySelector('h3'); // Fallback to card heading
                        }
                   }

                   if (labelElement && !labelElement.querySelector('.required-star')) {
                       labelElement.insertAdjacentHTML('beforeend', '<span class="required-star">*</span>');
                   }
               });
                // Hide redundant paragraph notes
               const notes = document.querySelectorAll('p:has(.required-star)');
               notes.forEach(note => note.style.display = 'none');
         }
         function setupMobileTableLabels() { // Add data-label attributes for mobile table CSS
             document.querySelectorAll('table:not(.action-table) tbody tr').forEach(row => {
                 const headers = Array.from(row.closest('table').querySelectorAll('thead th')).map(th => th.textContent);
                 row.querySelectorAll('td').forEach((td, index) => {
                     td.setAttribute('data-label', headers[index] || '');
                 });
             });
         }


        // --- Answer Handling (Local Storage) ---
        function loadUserAnswers(userEmail) { /* ... Consistent load logic ... */
            if (!userEmail) return;
            let allAnswers = {};
            try {
                 const storedData = localStorage.getItem(localStorageKey);
                 if (storedData) { allAnswers = JSON.parse(storedData) || {}; }
            } catch(e) { console.error("Error parsing stored answers:", e); }

            const userPageAnswers = allAnswers[userEmail] || {};

            // Load single textareas
            document.querySelectorAll('textarea.editable-answer').forEach(field => {
                 loadFieldState(field, field.dataset.question, userPageAnswers);
            });

            // Load Team Roles table
            loadTableState('teamRoles', ['member', 'role', 'strengths'], userPageAnswers);

            // Load Team Charter table
            loadTableState('teamCharter', ['name', 'responsibility', 'priority', 'outcome'], userPageAnswers);
        }

        // Helper to load state for a single field
        function loadFieldState(field, questionId, userAnswers, showStatus = true) { /* ... Consistent ... */
            const statusId = `save-status-${questionId}`;
            const statusElement = document.getElementById(statusId);

            if (userAnswers[questionId] !== undefined) {
                field.value = userAnswers[questionId];
                field.classList.remove('required-field');
                if (showStatus && userAnswers[questionId].trim() !== '' && statusElement) {
                     statusElement.textContent = '✓ Saved';
                     statusElement.style.display = 'inline';
                     setTimeout(() => { if (statusElement?.textContent === '✓ Saved') statusElement.style.display = 'none'; }, 3000);
                } else if (showStatus && statusElement) {
                    statusElement.style.display = 'none';
                }
            } else {
                field.value = (field.tagName === 'SELECT') ? '' : ''; // Reset field
                 if (showStatus && statusElement) statusElement.style.display = 'none';
            }
        }

        // Helper to load state for a whole table
        function loadTableState(tableType, prefixes, userAnswers) {
             const statusId = `save-status-${tableType}`;
             const statusElement = document.getElementById(statusId);
             let hasAnySavedData = false;

             for (let i = 1; i <= 5; i++) { // Assuming 5 rows max
                 let rowHasData = false;
                 for (const prefix of prefixes) {
                     const questionId = `${prefix}${i}`;
                     const field = document.querySelector(`[data-question="${questionId}"]`);
                     if (field) {
                          loadFieldState(field, questionId, userAnswers, false); // Load without showing individual status
                          if(userAnswers[questionId] !== undefined && userAnswers[questionId].trim() !== '') {
                              rowHasData = true; // Check if any field in the row has saved data
                          }
                     }
                 }
                  if(rowHasData) hasAnySavedData = true; // Mark if any row had data
             }

             // Show overall table saved status if any row had data loaded
             if (statusElement) {
                 statusElement.style.display = hasAnySavedData ? 'inline' : 'none';
                 if (hasAnySavedData) statusElement.textContent = '✓ Saved';
                  setTimeout(() => { if (statusElement?.textContent === '✓ Saved') statusElement.style.display = 'none'; }, 3000);
             }
        }


        function saveAnswerToStorage(userEmail, questionId, answer) { /* ... Consistent ... */
            if (!userEmail) return false;
             let allAnswers = {};
             try {
                 const storedData = localStorage.getItem(localStorageKey);
                 if (storedData) { allAnswers = JSON.parse(storedData) || {}; }
             } catch(e) { console.error("Error parsing answers before save:", e); allAnswers = {}; }

            if (!allAnswers[userEmail]) { allAnswers[userEmail] = {}; }
            allAnswers[userEmail][questionId] = answer;
            try {
                localStorage.setItem(localStorageKey, JSON.stringify(allAnswers));
                console.log(`Saved locally: ${questionId}`);
                return true;
            } catch (error) { console.error("Error saving to localStorage:", error); return false; }
        }

        function deleteAnswerFromStorage(userEmail, questionId) { /* ... Consistent ... */
            if (!userEmail) return false;
             let allAnswers = {};
              try {
                 const storedData = localStorage.getItem(localStorageKey);
                 if (storedData) { allAnswers = JSON.parse(storedData) || {}; } else { return false; }
             } catch(e) { console.error("Error parsing answers before delete:", e); return false; }
             let updated = false;
             if (allAnswers[userEmail]?.[questionId] !== undefined) {
                 delete allAnswers[userEmail][questionId]; updated = true;
                 if (Object.keys(allAnswers[userEmail]).length === 0) { delete allAnswers[userEmail]; }
             }
             if(updated) {
                try { localStorage.setItem(localStorageKey, JSON.stringify(allAnswers)); console.log(`Deleted locally: ${questionId}`); return true; }
                catch (error) { console.error("Error saving after delete:", error); return false; }
             }
             return false;
        }

        // --- Event Listeners Setup ---
        function setupEventListeners(userEmail) { /* ... Consistent ... */
             // Input listeners to clear validation errors
             document.querySelectorAll('.editable-answer').forEach(field => {
                 const eventType = (field.tagName === 'SELECT') ? 'change' : 'input';
                 field.addEventListener(eventType, function() {
                      const questionId = this.dataset.question;
                      const isRequiredDirectly = this.classList.contains('required-answer');
                      const errorId = isRequiredDirectly ? `error-${questionId}` : null;

                      this.classList.remove('required-field');
                      if (errorId) hideError(errorId); // Hide specific error

                      // Check parent table row if applicable
                      const tableRow = this.closest('tr');
                      if (tableRow && tableRow.closest('table')) {
                          const tableElement = tableRow.closest('table');
                          let tableType = '';
                          if(tableElement.parentElement.id === 'teamRolesCard' || tableElement.closest('.action-card')?.querySelector('h3')?.textContent.includes('Team Roles')) tableType = 'teamRoles';
                          if(tableElement.parentElement.id === 'teamCharterCard' || tableElement.closest('.action-card')?.querySelector('h3')?.textContent.includes('Team Charter')) tableType = 'teamCharter';

                          if (tableType) {
                              const rowIndexMatch = questionId.match(/(\d+)$/);
                              if (rowIndexMatch) {
                                   clearTableErrorIfRowComplete(tableType, rowIndexMatch[1]);
                              }
                          }
                      }
                 });
             });

            // Next button validation & modal trigger
            const nextButton = document.getElementById('nextButton');
            if (nextButton) { nextButton.addEventListener('click', handleNextButtonClick); }
        }

        function handleNextButtonClick(e) {
              if (!validateAllAnswers(true)) {
                  e.preventDefault();
                  showGeneralWarningMessage();
              } else {
                  e.preventDefault();
                  showSuccessModal();
              }
        }

         // Helper to clear table-wide error if row becomes valid
        function clearTableErrorIfRowComplete(tableType, rowIndex) { /* ... Consistent ... */
             const errorId = `error-${tableType}`;
             const errorElement = document.getElementById(errorId);
             if (!errorElement) return;

             let prefixes = [];
             let namePrefix = '';
             if (tableType === 'teamRoles') { prefixes = ['member', 'role', 'strengths']; namePrefix = 'member'; }
             else if (tableType === 'teamCharter') { prefixes = ['name', 'responsibility', 'priority', 'outcome']; namePrefix = 'name'; }
             else { return; }

             const nameField = document.querySelector(`[data-question="${namePrefix}${rowIndex}"]`);
             if (!nameField) return;

             let isRowNowValid = true;
             if (nameField.value.trim() !== '') {
                 for (const prefix of prefixes) {
                     const field = document.querySelector(`[data-question="${prefix}${rowIndex}"]`);
                     if (!field || field.value.trim() === '') { isRowNowValid = false; break; }
                 }
             } else {
                 // If name is empty, clear highlights from the row
                 for (const prefix of prefixes) {
                      const field = document.querySelector(`[data-question="${prefix}${rowIndex}"]`);
                      if (field) field.classList.remove('required-field');
                  }
             }

             if (isRowNowValid) { // Clear highlights if row is valid now
                 for (const prefix of prefixes) {
                      const field = document.querySelector(`[data-question="${prefix}${rowIndex}"]`);
                      if (field) field.classList.remove('required-field');
                  }
             }

            // Check if *any* other rows are still invalid before hiding table message
            let anyOtherRowInvalid = false;
            for (let i = 1; i <= 5; i++) {
                if (i === parseInt(rowIndex)) continue;
                const otherNameField = document.querySelector(`[data-question="${namePrefix}${i}"]`);
                if (otherNameField?.value.trim() !== '') {
                     for (const prefix of prefixes) {
                         const otherField = document.querySelector(`[data-question="${prefix}${i}"]`);
                         if (otherField && otherField.value.trim() === '') { anyOtherRowInvalid = true; break; }
                     }
                 }
                 if (anyOtherRowInvalid) break;
            }

            if (!anyOtherRowInvalid) { hideError(errorId); } // Hide table error if all rows are ok
        }


        // --- UI Feedback & Validation ---
        function validateAllAnswers(showErrors = false) { /* ... Consistent, includes table validation ... */
            let allValid = true;
            let firstInvalidField = null;

            // Check single required textareas
            document.querySelectorAll('textarea.required-answer').forEach(field => {
                const questionId = field.dataset.question;
                const errorId = `error-${questionId}`;
                hideError(errorId); // Clear previous
                if (field.value.trim() === '') {
                    allValid = false;
                    if (!firstInvalidField) firstInvalidField = field;
                    if (showErrors) { field.classList.add('required-field'); showError(errorId, null, 'Please enter an answer.'); }
                } else { field.classList.remove('required-field'); }
            });

            // Validate tables
            if (!validateTable('teamRoles', ['member', 'role', 'strengths'], 'member', showErrors)) {
                allValid = false;
                if (!firstInvalidField) firstInvalidField = document.querySelector('#error-teamRoles + table .required-field'); // Find first error in this table
            }
            if (!validateTable('teamCharter', ['name', 'responsibility', 'priority', 'outcome'], 'name', showErrors)) {
                allValid = false;
                 if (!firstInvalidField) firstInvalidField = document.querySelector('#error-teamCharter + table .required-field'); // Find first error in this table
            }

             // Scroll to first error
             if (!allValid && showErrors && firstInvalidField) {
                 firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                 setTimeout(() => { try { firstInvalidField.focus({ preventScroll: true }); } catch (e) {} }, 400);
             }
            return allValid;
        }

         // Helper function for table validation logic
         function validateTable(tableType, prefixes, namePrefix, showErrors) {
             const errorId = `error-${tableType}`;
             const errorElement = document.getElementById(errorId);
             hideError(errorId); // Clear previous table error
             let tableIsValid = true;

             for (let i = 1; i <= 5; i++) {
                 const nameField = document.querySelector(`[data-question="${namePrefix}${i}"]`);
                 if (!nameField) continue;
                 const nameValue = nameField.value.trim();

                  // Clear previous row highlights
                 for (const prefix of prefixes) {
                      const field = document.querySelector(`[data-question="${prefix}${i}"]`);
                       if (field) field.classList.remove('required-field');
                 }

                 if (nameValue !== '') { // If name is entered, check rest of row
                     let rowFullyFilled = true;
                     for (const prefix of prefixes) {
                         const field = document.querySelector(`[data-question="${prefix}${i}"]`);
                         if (!field || field.value.trim() === '') {
                             rowFullyFilled = false;
                             if (showErrors && field) field.classList.add('required-field'); // Mark specific empty field
                         }
                     }
                     if (!rowFullyFilled) {
                         tableIsValid = false; // Mark table as invalid
                     }
                 }
             }

             if (!tableIsValid && showErrors && errorElement) {
                 showError(errorId, null, `Please fill all fields in rows where ${namePrefix} is entered.`);
             }
             return tableIsValid;
         };


        function showGeneralWarningMessage() { /* ... Consistent ... */
            const warningElement = document.getElementById('generalWarningMessage');
            if (!warningElement) return;
            warningElement.style.animation = 'none'; void warningElement.offsetWidth;
            warningElement.style.display = 'block';
            warningElement.style.animation = 'slideDownFadeIn 0.4s ease-out';
            clearTimeout(warningElement.timer);
            warningElement.timer = setTimeout(() => {
                warningElement.style.animation = 'fadeOutUp 0.5s ease-out forwards';
                 setTimeout(() => {
                      if (warningElement.style.animationName === 'fadeOutUp') {
                           warningElement.style.display = 'none'; warningElement.style.animation = '';
                      }
                 }, 500);
            }, 4000);
        }
        function showSaveStatus(statusId, message = '✓ Saved') { /* ... Consistent ... */
             const statusElement = document.getElementById(statusId);
             if (!statusElement) return;
             statusElement.textContent = message;
             statusElement.classList.remove('deleted');
             statusElement.style.color = ''; // Reset color
             const actionCard = statusElement.closest('.action-card');
             if (actionCard) statusElement.style.color = '#d1e7dd'; // Light green in action card
             else statusElement.style.color = '#27ae60'; // Default green

             if (message.includes('Deleted') || message.includes('cleared')) {
                 statusElement.classList.add('deleted');
                  if (actionCard) statusElement.style.color = '#e9ecef'; // Light grey in action card
                  else statusElement.style.color = '#6c757d'; // Default grey
             }
             statusElement.style.display = 'inline-block';
             clearTimeout(statusElement.timer);
             statusElement.timer = setTimeout(() => { statusElement.style.display = 'none'; }, 3000);
        }
        function showError(errorId, fieldToFocus, message = 'Required field.') { /* ... Consistent ... */
             const errorElement = document.getElementById(errorId);
             if (!errorElement) return;
             errorElement.textContent = message;
              const actionCard = errorElement.closest('.action-card');
             if (actionCard) errorElement.style.color = '#f8d7da'; // Light red in action card
             else errorElement.style.color = '#e74c3c'; // Default red
             errorElement.style.display = 'inline-block';
        }
        function hideError(errorId) { /* ... Consistent ... */
             const errorElement = document.getElementById(errorId);
             if (errorElement) errorElement.style.display = 'none';
        }
        function hideMessages(statusId, errorId, field) { /* ... Consistent ... */
             hideError(errorId);
             const statusElement = statusId ? document.getElementById(statusId) : null;
             if (statusElement) statusElement.style.display = 'none';
             if (field) field.classList.remove('required-field');
        }

        // --- Actions (Save/Delete Single Textareas) ---
        function saveAnswer(questionId) { /* ... Consistent ... */
             const currentUser = getCurrentUser(); if (!currentUser?.email) return;
             const field = document.querySelector(`textarea[data-question="${questionId}"]`);
             if (!field) return;
             const statusId = `save-status-${questionId}`; const errorId = `error-${questionId}`;
             const answer = field.value; const trimmedAnswer = answer.trim();
             const isRequired = field.classList.contains('required-answer');
             hideMessages(statusId, errorId, field);
             if (isRequired && !trimmedAnswer) { showError(errorId, field, 'Please enter an answer.'); return; }
             if (saveAnswerToStorage(currentUser.email, questionId, answer)) {
                 if (trimmedAnswer) submitToFormspree(currentUser.email, questionId, answer);
                 showSaveStatus(statusId); field.classList.remove('required-field');
             }
        }
        function deleteAnswer(questionId) { /* ... Consistent ... */
            const currentUser = getCurrentUser(); if (!currentUser?.email) return;
            const field = document.querySelector(`textarea[data-question="${questionId}"]`);
            if (!field) return;
            const statusId = `save-status-${questionId}`; const errorId = `error-${questionId}`;
            hideMessages(statusId, errorId, field); field.value = '';
            if (deleteAnswerFromStorage(currentUser.email, questionId)) { showSaveStatus(statusId, '✓ Deleted'); }
            field.classList.remove('required-field');
        }


        // --- Actions (Save/Delete Entire Tables) ---
        function saveTableData(tableType) { /* ... Consistent ... */
             const currentUser = getCurrentUser(); if (!currentUser?.email) return;
             const statusId = `save-status-${tableType}`; const errorId = `error-${tableType}`;
             hideMessages(statusId, errorId, null);

             let prefixes = [], namePrefix = '';
             if (tableType === 'teamRoles') { prefixes = ['member', 'role', 'strengths']; namePrefix = 'member'; }
             else if (tableType === 'teamCharter') { prefixes = ['name', 'responsibility', 'priority', 'outcome']; namePrefix = 'name'; }
             else return;

             let validationPassed = true;
             const dataToSaveAndSubmit = {};

             for (let i = 1; i <= 5; i++) { // Validate and collect
                 const rowData = {}; let isRowFullyFilled = true; let isRowStarted = false;
                 const nameField = document.querySelector(`[data-question="${namePrefix}${i}"]`);
                 if (!nameField) continue;
                 const nameValue = nameField.value.trim();
                 nameField.classList.remove('required-field'); // Clear border
                  rowData[`${namePrefix}${i}`] = nameField.value; // Store original
                  if(nameValue !== '') isRowStarted = true;

                 for (const prefix of prefixes) {
                     const questionId = `${prefix}${i}`;
                     const field = document.querySelector(`[data-question="${questionId}"]`);
                      if (!field) continue; // Skip if field missing in HTML
                     field.classList.remove('required-field'); // Clear border
                     rowData[questionId] = field.value; // Store original
                     if (isRowStarted && field.value.trim() === '') { // Check empty only if name was entered
                         isRowFullyFilled = false;
                         field.classList.add('required-field');
                     }
                     if(field.value.trim() !== '' && !isRowStarted) isRowStarted = true; // Mark as started if any field has value
                 }

                 if (isRowStarted && !isRowFullyFilled) validationPassed = false;

                 // Store data if row was started
                  if (isRowStarted) {
                     for (const key in rowData) dataToSaveAndSubmit[key] = rowData[key];
                  } else { // Ensure empty rows are cleared from storage
                      for (const prefix of prefixes) deleteAnswerFromStorage(currentUser.email, `${prefix}${i}`);
                  }
             }

             if (!validationPassed) { showError(errorId, null, `Please fill all fields in rows where ${namePrefix} is entered.`); return; }

             // Save and submit valid data
             let savedOk = true;
             for (const questionId in dataToSaveAndSubmit) {
                 if (!saveAnswerToStorage(currentUser.email, questionId, dataToSaveAndSubmit[questionId])) savedOk = false;
                 if (dataToSaveAndSubmit[questionId]?.trim()) submitToFormspree(currentUser.email, questionId, dataToSaveAndSubmit[questionId]);
             }

             if(savedOk) showSaveStatus(statusId);
         }


         function deleteTableData(tableType) { /* ... Consistent ... */
            const currentUser = getCurrentUser(); if (!currentUser?.email) return;
            const statusId = `save-status-${tableType}`; const errorId = `error-${tableType}`;
            hideMessages(statusId, errorId, null);
            let prefixes = [];
             if (tableType === 'teamRoles') prefixes = ['member', 'role', 'strengths'];
             else if (tableType === 'teamCharter') prefixes = ['name', 'responsibility', 'priority', 'outcome'];
             else return;
             let deletedSomething = false;
             for (let i = 1; i <= 5; i++) {
                 for (const prefix of prefixes) {
                     const questionId = `${prefix}${i}`;
                     const field = document.querySelector(`[data-question="${questionId}"]`);
                     if (field) {
                         field.value = (field.tagName === 'SELECT') ? '' : '';
                         field.classList.remove('required-field');
                         if(deleteAnswerFromStorage(currentUser.email, questionId)) deletedSomething = true;
                     }
                 }
             }
              if(deletedSomething) showSaveStatus(statusId, '✓ Cleared');
         }


        // --- Formspree Submission ---
        function submitToFormspree(userEmail, questionId, answer) { /* ... Consistent ... */
            if (!answer?.trim()) return; // Skip empty
            if (!formspreeEndpoint) { console.warn("Formspree endpoint not configured."); return; }
            if (!userEmail) { console.warn("No user email for Formspree."); return; }

            const formData = new FormData();
            formData.append('email', userEmail);
            formData.append('page', document.title);
            formData.append('page_key', 'teamCoaching'); // Page identifier
            formData.append('question_id', questionId);
            formData.append('answer_text', answer);

            const currentUser = getCurrentUser();
            if (currentUser?.name) formData.append('user_name', currentUser.name);

            // Add Context
             const fieldElement = document.querySelector(`[data-question="${questionId}"]`);
             let context = `Q-ID: ${questionId}`;
             if(fieldElement) {
                 const qItem = fieldElement.closest('.question-item');
                 const table = fieldElement.closest('table');
                 if(qItem?.querySelector('.question-text')) context = qItem.querySelector('.question-text').textContent.replace('*','').trim();
                 else if (table?.closest('.action-card')?.querySelector('h3')) {
                     context = `${table.closest('.action-card').querySelector('h3').textContent} - ${questionId}`;
                 }
             }
              formData.append('question_context', context);

            fetch(formspreeEndpoint, { method: 'POST', body: formData, headers: { 'Accept': 'application/json' } })
            .then(response => {
                if (response.ok) { console.log(`Formspree: ${questionId} submitted.`); }
                else { response.json().then(data => console.error(`Formspree error (${questionId}):`, data.errors ? data.errors.map(e => e.message).join(', ') : `Status ${response.status}`)).catch(() => console.error(`Formspree non-JSON error (${questionId}). Status: ${response.status}`)); }
            })
            .catch(error => console.error(`Network error submitting (${questionId}):`, error));
        }

        // --- Modal Handling ---
        function showSuccessModal() { /* ... Consistent ... */
             const modal = document.getElementById('successModal');
             if(modal) modal.style.display = 'flex';
        }
        function closeModal() { /* ... Consistent ... */
            const modal = document.getElementById('successModal');
            if(modal) modal.style.display = 'none';
        }
        function redirectToNextPage() { /* ... Consistent ... */
            window.location.href = 'coaching-yourself.html'; // Update to next page
        }

    </script>
</body>
</html>
