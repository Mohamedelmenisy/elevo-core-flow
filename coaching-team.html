<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Coaching</title>
    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-color: #f9f9f9;
            color: #333;
        }

        /* User Bar Styles */
        .user-bar {
            background-color: #34495e;
            padding: 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-size: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 15px;
        }

        .user-email {
            font-size: 13px;
            opacity: 0.8;
        }

        .logout-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .logout-button:hover {
            background-color: #c0392b;
            transform: translateY(-1px);
        }

        .logout-button:active {
            transform: translateY(0);
        }

        /* Navigation Tabs */
        .nav-tab {
            background-color: #2c3e50;
            padding: 10px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .nav-tab a:hover {
            background-color: #34495e;
        }

        /* Main Content Styles */
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto 30px;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        .section-title {
            color: #3498db;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .highlight-section {
            background-color: rgba(230, 126, 34, 0.1);
            padding: 15px;
            border-left: 4px solid #e67e22;
            border-radius: 0 4px 4px 0;
            margin: 15px 0;
        }

        .action-card {
            background-color: #e67e22;
            color: white;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }

        .media-container {
            text-align: center;
            margin: 20px 0;
        }

        .media-container img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .caption {
            font-style: italic;
            color: #777;
            margin-top: 8px;
            font-size: 14px;
        }

        .question-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }

        .question-text {
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Unified class for all answer fields */
        .editable-answer {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px 0; /* Consistent margin */
            background-color: white;
            min-height: 40px;
            line-height: 1.5;
            display: block;
            font-size: 14px; /* Consistent font size */
        }

        /* Specific styles for textareas */
        textarea.editable-answer {
            min-height: 80px; /* Default textarea height */
            resize: vertical; /* Allow vertical resize */
        }

        .editable-answer:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .save-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-right: 5px;
            font-size: 13px;
        }

        .delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 13px;
        }

        .save-btn:hover { background-color: #219653; }
        .delete-btn:hover { background-color: #c0392b; }

        .saved-message {
            color: #27ae60;
            font-size: 12px;
            margin-left: 10px;
            display: none;
            font-style: italic;
        }
        .inline-error-message {
             color: #e74c3c;
             font-size: 12px;
             margin-left: 10px;
             display: none;
             font-style: italic;
             font-weight: 500;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        table, th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: 600;
        }

        .action-table {
            width: 100%;
            margin: 20px 0;
            background-color: #f8f9fa;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        .action-table th { background-color: #3498db; color: white; text-align: center; }
        .action-table td { vertical-align: top; }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 20px;
        }

        .button {
            background-color: #3498db;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            border: none;
            cursor: pointer;
            flex: 1;
            text-align: center;
            transition: all 0.3s;
            font-size: 15px;
        }
        .button:hover { background-color: #2980b9; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .button:active { transform: translateY(0); box-shadow: none; }
        .button.back { background-color: #95a5a6; }
        .button.back:hover { background-color: #7f8c8d; }

        .warning-message { /* General warning */
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            color: #333;
            display: none;
            font-size: 14px;
            line-height: 1.6;
            border-radius: 4px;
            font-weight: 500;
        }

        .required-field { /* Style for required fields needing input */
            border: 2px solid #e74c3c !important;
            background-color: #fff2f2 !important;
            animation: pulse 1.5s infinite alternate ease-in-out;
        }
        @keyframes pulse {
            from { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.3); }
            to { box-shadow: 0 0 0 5px rgba(231, 76, 60, 0); }
        }

        @media (max-width: 600px) {
            .button-container { flex-direction: column; }
        }

        /* Section specific styles */
        .model-section, .trust-section, .rapport-section, .informal-tips {
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .model-section { background-color: rgba(52, 152, 219, 0.08); border-left: 4px solid #3498db; }
        .trust-section { background-color: rgba(46, 204, 113, 0.08); border-left: 4px solid #2ecc71; }
        .rapport-section { background-color: rgba(155, 89, 182, 0.08); border-left: 4px solid #9b59b6; }
        .informal-tips { background-color: rgba(241, 196, 15, 0.08); border-left: 4px solid #f1c40f; }

        .orange-header {
            background-color: #e67e22;
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 4px 4px 0 0;
            font-size: 14px;
            font-weight: bold;
        }
        .orange-row td { background-color: rgba(230, 126, 34, 0.05); }
        .orange-row .editable-answer { /* Input/Select/Textarea in orange rows */
            margin: 5px 0; /* Consistent margin */
        }

        .drawing-together {
            display: flex;
            align-items: center;
            gap: 20px;
            background-color: rgba(155, 89, 182, 0.08);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #9b59b6;
        }
        .drawing-icon { font-size: 30px; color: #9b59b6; flex-shrink: 0; }

        .answer-buttons { /* Container for save/delete/status/error */
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        /* Styles for table action buttons */
        .table-action-buttons {
             margin-top: 15px; /* Space above table-wide buttons */
             text-align: right; /* Align buttons right */
        }

        /* Modal Styles */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center;
            animation: modalFadeInBackground 0.3s ease-out;
        }
        @keyframes modalFadeInBackground { from { background: rgba(0,0,0,0); } to { background: rgba(0,0,0,0.6); } }
        .modal-content {
            background: white; padding: 30px 40px; border-radius: 8px; max-width: 450px;
            text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.2); position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .modal-button {
            background-color: #27ae60; color: white; border: none; padding: 12px 25px;
            border-radius: 5px; cursor: pointer; margin-top: 25px; font-weight: bold;
            transition: all 0.3s; font-size: 15px;
        }
        .modal-button:hover { background-color: #219653; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .close-modal {
            position: absolute; top: 15px; right: 15px; background: none; border: none;
            font-size: 24px; cursor: pointer; color: #aaa; transition: color 0.3s;
        }
        .close-modal:hover { color: #555; }
    </style>
</head>
<body>
    <!-- User Info Bar -->
    <div class="user-bar">
        <div class="user-info">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.8;">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <div class="user-details">
                <span class="user-name" id="userName">Welcome back</span>
                <span class="user-email" id="userEmail">user@example.com</span>
            </div>
        </div>
        <button class="logout-button" onclick="logout()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
        </button>
    </div>

    <!-- Navigation Tabs -->
    <nav class="nav-tab">
        <a href="index.html">Home</a>
        <a href="article1.html">Article 1</a>
        <a href="coaching-skills.html">Coaching Skills</a>
        <a href="coaching-individuals.html">Coaching Individuals</a>
        <a href="coaching-team.html">Team Coaching</a>
        <a href="coaching-yourself.html">Self Coaching</a>
    </nav>

    <header>
        <h1>Team Coaching</h1>
        <p>Developing high-performing teams through collective growth</p>
    </header>

    <div class="container">
        <div class="highlight-section">
            <p>It's not easy to get a team to work to its full potential. Conflicts, power struggles and miscommunication can cause a group to start, stumble and stop.</p>
        </div>

        <p>When your people aren't working together as effectively as they could, team coaching can help. Instead of focusing on individual development, your attention with group coaching is on improving relationships and interactions within the team as a whole.</p>

        <p>Team coaching is useful in many situations. For example, it can help people to:</p>
        <ul>
            <li>Work through interpersonal conflicts</li>
            <li>Understand their roles within the group</li>
            <li>Improve relationships</li>
            <li>Understand team goals</li>
        </ul>

        <p>You can coach your people at a specific place and time - at a team-building event, for example - or you can do it spontaneously.</p>

        <div class="media-container">
            <img src="https://images.unsplash.com/photo-1593642634524-b40b5baae6bb?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                 alt="Team members collaborating in a coaching session"
                 loading="lazy">
            <p class="caption">Team coaching focuses on group dynamics and interactions</p>
        </div>

        <h2 class="section-title">3.1. Understanding Team Dynamics</h2>

        <p>Before you start your group coaching session, you need to know how your people relate to one another.</p>
        <p>Each person has a unique personality and way of communicating. But, when people are in a group, they have to work closely with one another. Their different styles can cause frustration and conflict, which may prevent them from working together effectively.</p>
        <p>By understanding team dynamics, you can help people to recognize how they relate to one another, and to identify ways to improve their relationships.</p>

        <h3>Recognizing Unique Personalities</h3>
        <p>Personality tests such as Myers-Briggs®, the Big Five Personality Traits Model, and The DiSC Model can help you and your team members to learn more about how you prefer to communicate and process information.</p>
        <p>If your team members agree to take these tests, and to share the results, they may learn to understand one another better, and that it's OK for individuals to have different preferences. This can enable them to work together more effectively.</p>

        <div class="highlight-section">
            <p>"Let's look at an example. Patrick is detail-oriented, and enjoys compiling facts and doing research. This sometimes annoys his colleagues, because they think he can be too slow to finish his work.</p>
            <p>But, when they realize the benefit that the team gets from his attention to detail, they begin to see it as a strength rather than a weakness."</p>
        </div>

        <p>It can also help if each team member understands her "role" within the group, and whether it's Action Oriented, People Oriented or Thought Oriented.</p>

        <!-- Team Roles Action Card -->
        <div class="action-card">
            <h3>ACTION: Identify Team Roles</h3>
            <p>Ask your team members to identify their strengths in relation to the team as a whole. Then, read about Belbin's team roles and pick the role that you think each team member plays within your group. List them in the table below.</p>

            <table>
                 <thead>
                    <tr class="orange-header">
                        <th>Team Member</th>
                        <th>Role</th>
                        <th>Strengths</th>
                    </tr>
                 </thead>
                 <tbody>
                    <!-- Row 1 -->
                    <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Member name..." data-question="member1"></td>
                        <td><input type="text" class="editable-answer" placeholder="Team role..." data-question="role1"></td>
                        <td><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths1"></td>
                    </tr>
                    <!-- Row 2 -->
                     <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Member name..." data-question="member2"></td>
                        <td><input type="text" class="editable-answer" placeholder="Team role..." data-question="role2"></td>
                        <td><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths2"></td>
                    </tr>
                     <!-- Row 3 -->
                     <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Member name..." data-question="member3"></td>
                        <td><input type="text" class="editable-answer" placeholder="Team role..." data-question="role3"></td>
                        <td><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths3"></td>
                    </tr>
                     <!-- Row 4 -->
                     <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Member name..." data-question="member4"></td>
                        <td><input type="text" class="editable-answer" placeholder="Team role..." data-question="role4"></td>
                        <td><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths4"></td>
                    </tr>
                     <!-- Row 5 -->
                     <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Member name..." data-question="member5"></td>
                        <td><input type="text" class="editable-answer" placeholder="Team role..." data-question="role5"></td>
                        <td><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths5"></td>
                    </tr>
                 </tbody>
            </table>
            <div class="table-action-buttons"> <!-- Container for table-wide buttons -->
                <button class="save-btn" onclick="saveTableData('teamRoles')">Save Team Roles</button>
                <button class="delete-btn" onclick="deleteTableData('teamRoles')">Clear Team Roles</button>
                <span class="saved-message" id="save-status-teamRoles">✓ Saved</span>
                 <span class="inline-error-message" id="error-teamRoles">Please fill all fields in a row if Member Name is entered.</span>
            </div>
        </div>

        <p>Another useful technique for matching and balancing team roles and individual preferences is the Margerison-McCann Team Management Profile. This tool is similar to Belbin's Team Roles, and is based on the same principles: that people have different strengths, and that a well-balanced team includes a variety of preference types.</p>

        <div class="media-container">
            <img src="https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                 alt="Team members with diverse personalities working together"
                 loading="lazy">
            <p class="caption">Understanding personality differences improves team dynamics</p>
        </div>

        <h2 class="section-title">3.2. Defining Your Expectations</h2>
        <p>When your team members understand one another better, they will likely work together more effectively. But they may also benefit from a set of ground rules that guides the way that they behave and communicate.</p>
        <div class="highlight-section">
            <p>"For instance, let's say that Rudi finds high-energy meetings exhausting and intimidating... In the past, he has stayed silent when he could have raised the alarm, and this has damaged the team's reputation."</p>
        </div>
        <p>This highlights the importance of defining your expectations regarding behavior and communication...</p>
        <p>You can set out your expectations in a team charter. This is a document that defines the behavior and communication "rules" that everyone in the group is expected to follow and support.</p>
        <p>If a written charter isn't appropriate, you can discuss and agree acceptable standards of behavior for different situations with your team members...</p>

        <!-- Team Charter Action Card -->
        <div class="action-card">
            <h3>ACTION: Review Team Charter</h3>
            <p>List each person's responsibilities and what he is expected to deliver, below:</p>

            <table>
                 <thead>
                    <tr class="orange-header">
                        <th>Name</th>
                        <th>Responsibility</th>
                        <th>Priority</th>
                        <th>Outcome</th>
                    </tr>
                 </thead>
                 <tbody>
                     <!-- Row 1 -->
                    <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Name..." data-question="name1"></td>
                        <td><textarea class="editable-answer" placeholder="Responsibilities..." data-question="responsibility1"></textarea></td>
                        <td>
                            <select class="editable-answer" data-question="priority1">
                                <option value="">Select...</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </td>
                        <td><textarea class="editable-answer" placeholder="Expected outcomes..." data-question="outcome1"></textarea></td>
                    </tr>
                    <!-- Row 2 -->
                    <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Name..." data-question="name2"></td>
                        <td><textarea class="editable-answer" placeholder="Responsibilities..." data-question="responsibility2"></textarea></td>
                        <td>
                            <select class="editable-answer" data-question="priority2">
                                <option value="">Select...</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </td>
                        <td><textarea class="editable-answer" placeholder="Expected outcomes..." data-question="outcome2"></textarea></td>
                    </tr>
                    <!-- Row 3 -->
                    <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Name..." data-question="name3"></td>
                        <td><textarea class="editable-answer" placeholder="Responsibilities..." data-question="responsibility3"></textarea></td>
                        <td>
                            <select class="editable-answer" data-question="priority3">
                                <option value="">Select...</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </td>
                        <td><textarea class="editable-answer" placeholder="Expected outcomes..." data-question="outcome3"></textarea></td>
                    </tr>
                     <!-- Row 4 -->
                    <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Name..." data-question="name4"></td>
                        <td><textarea class="editable-answer" placeholder="Responsibilities..." data-question="responsibility4"></textarea></td>
                        <td>
                            <select class="editable-answer" data-question="priority4">
                                <option value="">Select...</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </td>
                        <td><textarea class="editable-answer" placeholder="Expected outcomes..." data-question="outcome4"></textarea></td>
                    </tr>
                     <!-- Row 5 -->
                    <tr class="orange-row">
                        <td><input type="text" class="editable-answer" placeholder="Name..." data-question="name5"></td>
                        <td><textarea class="editable-answer" placeholder="Responsibilities..." data-question="responsibility5"></textarea></td>
                        <td>
                            <select class="editable-answer" data-question="priority5">
                                <option value="">Select...</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </td>
                        <td><textarea class="editable-answer" placeholder="Expected outcomes..." data-question="outcome5"></textarea></td>
                    </tr>
                 </tbody>
            </table>
            <div class="table-action-buttons"> <!-- Container for table-wide buttons -->
                <button class="save-btn" onclick="saveTableData('teamCharter')">Save Team Charter</button>
                <button class="delete-btn" onclick="deleteTableData('teamCharter')">Clear Team Charter</button>
                <span class="saved-message" id="save-status-teamCharter">✓ Saved</span>
                <span class="inline-error-message" id="error-teamCharter">Please fill all fields in a row if Name is entered.</span>
            </div>
        </div>

        <h2 class="section-title">3.3. Evaluating Rewards and Recognition</h2>
        <p>At times, people in your team might have competing priorities, and this can lead to serious dysfunction within the group.</p>
        <div class="highlight-section">
            <p>"For instance, your organization might promote teamwork but reward individual performance... Conflict can arise if these objectives are at odds."</p>
        </div>
        <p>As a manager, it's important to identify any competing values or goals in your team, and to address them before they cause problems.</p>

        <!-- Assess Priorities Action Card -->
        <div class="action-card">
            <h3>ACTION: Assess Team Priorities</h3>
            <p>Answer the questions below to determine whether your team is facing any competing priorities:</p>

            <div class="question-item">
                <div class="question-text">1. Look at how your organization recognizes and rewards good performance. Does the system clash with the goals and objectives of your own team? If so, how can you resolve this conflict?</div>
                 <!-- Changed to textarea, added required class and data-question -->
                <textarea class="editable-answer required-answer" data-question="rewardSystem" placeholder="Enter your answer here..."></textarea>
                <div class="answer-buttons">
                    <button class="save-btn" onclick="saveAnswer('rewardSystem')">Save</button>
                    <button class="delete-btn" onclick="deleteAnswer('rewardSystem')">Delete</button>
                    <span class="saved-message" id="save-status-rewardSystem">✓ Saved</span>
                    <span class="inline-error-message" id="error-rewardSystem">Please enter an answer.</span>
                </div>
            </div>

            <div class="question-item">
                <div class="question-text">2. If you're leading a cross-functional team, look at the reward system within each department. Are there any conflicts?</div>
                 <!-- Changed to textarea, added required class and data-question -->
                <textarea class="editable-answer required-answer" data-question="departmentConflicts" placeholder="Enter your answer here..."></textarea>
                <div class="answer-buttons">
                    <button class="save-btn" onclick="saveAnswer('departmentConflicts')">Save</button>
                    <button class="delete-btn" onclick="deleteAnswer('departmentConflicts')">Delete</button>
                    <span class="saved-message" id="save-status-departmentConflicts">✓ Saved</span>
                    <span class="inline-error-message" id="error-departmentConflicts">Please enter an answer.</span>
                </div>
            </div>

            <div class="question-item">
                <div class="question-text">3. Make a list of your team goals, as well as each person's objectives. Are they aligned? If not, where is the mismatch?</div>
                 <!-- Changed to textarea, added required class and data-question -->
                <textarea class="editable-answer required-answer" data-question="goalAlignment" placeholder="Enter your answer here..."></textarea>
                <div class="answer-buttons">
                    <button class="save-btn" onclick="saveAnswer('goalAlignment')">Save</button>
                    <button class="delete-btn" onclick="deleteAnswer('goalAlignment')">Delete</button>
                    <span class="saved-message" id="save-status-goalAlignment">✓ Saved</span>
                    <span class="inline-error-message" id="error-goalAlignment">Please enter an answer.</span>
                </div>
            </div>
        </div>

        <div class="media-container">
            <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                 alt="Team celebrating success with aligned objectives"
                 loading="lazy">
            <p class="caption">Aligning rewards with team objectives is crucial</p>
        </div>

        <h2 class="section-title">3.4. Team Coaching Processes</h2>
        <p>There are various models that you can use when you coach a group, and some of the models that we outlined in Chapter 2 can also apply to team coaching. Here are some further suggestions:</p>

        <h3>1. The POSITIVE Model of Coaching</h3>
        <p>The POSITIVE Model of Coaching was developed by Vincenzo Libri in 2004... [content continues]</p>
        <ul>
            <li><strong>Purpose</strong> - Decide what you want to achieve...</li>
            <li><strong>Observations</strong> - Think about your situation...</li>
            <li><strong>SMART</strong> - Set a SMART goal...</li>
            <li><strong>Insight</strong> - Consider your goal...</li>
            <li><strong>Team</strong> - Look at the people around you...</li>
            <li><strong>Initiate</strong> - When will you start...</li>
            <li><strong>Value</strong> - Break the goal down...</li>
            <li><strong>Encourage</strong> - Meet your team members regularly...</li>
        </ul>
        <p>Use the POSITIVE Model when your team needs to stay motivated...</p>

        <h3>2. The PRACTICE Model of Coaching</h3>
        <p>The PRACTICE Model of Coaching was published by psychologist Stephen Palmer in 2008... [content continues]</p>
        <ol>
            <li>Identify a Problem.</li>
            <li>Develop Realistic and relevant goals.</li>
            <li>Generate Alternative solutions.</li>
            <li>Consider the consequences.</li>
            <li>Target the most feasible solution.</li>
            <li>Implement your Chosen solution.</li>
            <li>Evaluate.</li>
        </ol>
        <p>The biggest advantage of this model is that it's solution-focused...</p>

        <div class="highlight-section">
            <p>TIP: Use the PRACTICE model next time your team has a particular issue or problem that you want to address.</p>
        </div>

        <!-- Apply Coaching Models Action Card -->
        <div class="action-card">
            <h3>ACTION: Apply Coaching Models</h3>

            <div class="question-item">
                <div class="question-text">What issue do you have with your team that you could resolve with coaching? How could it help? (Enter up to 5 issues)</div>
                <!-- Issue 1 -->
                <textarea class="editable-answer required-answer" data-question="teamIssue1" placeholder="Enter issue and potential resolution..."></textarea>
                <div class="answer-buttons">
                    <button class="save-btn" onclick="saveAnswer('teamIssue1')">Save</button>
                    <button class="delete-btn" onclick="deleteAnswer('teamIssue1')">Delete</button>
                    <span class="saved-message" id="save-status-teamIssue1">✓ Saved</span>
                    <span class="inline-error-message" id="error-teamIssue1">Please enter an answer.</span>
                </div>
                <!-- Issue 2 -->
                 <textarea class="editable-answer required-answer" data-question="teamIssue2" placeholder="Enter another issue (optional)..."></textarea>
                 <div class="answer-buttons">
                     <button class="save-btn" onclick="saveAnswer('teamIssue2')">Save</button>
                     <button class="delete-btn" onclick="deleteAnswer('teamIssue2')">Delete</button>
                     <span class="saved-message" id="save-status-teamIssue2">✓ Saved</span>
                     <span class="inline-error-message" id="error-teamIssue2">Please enter an answer.</span>
                 </div>
                 <!-- Issue 3 -->
                 <textarea class="editable-answer required-answer" data-question="teamIssue3" placeholder="Enter another issue (optional)..."></textarea>
                  <div class="answer-buttons">
                     <button class="save-btn" onclick="saveAnswer('teamIssue3')">Save</button>
                     <button class="delete-btn" onclick="deleteAnswer('teamIssue3')">Delete</button>
                     <span class="saved-message" id="save-status-teamIssue3">✓ Saved</span>
                     <span class="inline-error-message" id="error-teamIssue3">Please enter an answer.</span>
                 </div>
                 <!-- Issue 4 -->
                 <textarea class="editable-answer required-answer" data-question="teamIssue4" placeholder="Enter another issue (optional)..."></textarea>
                  <div class="answer-buttons">
                     <button class="save-btn" onclick="saveAnswer('teamIssue4')">Save</button>
                     <button class="delete-btn" onclick="deleteAnswer('teamIssue4')">Delete</button>
                     <span class="saved-message" id="save-status-teamIssue4">✓ Saved</span>
                     <span class="inline-error-message" id="error-teamIssue4">Please enter an answer.</span>
                 </div>
                 <!-- Issue 5 -->
                 <textarea class="editable-answer required-answer" data-question="teamIssue5" placeholder="Enter another issue (optional)..."></textarea>
                  <div class="answer-buttons">
                     <button class="save-btn" onclick="saveAnswer('teamIssue5')">Save</button>
                     <button class="delete-btn" onclick="deleteAnswer('teamIssue5')">Delete</button>
                     <span class="saved-message" id="save-status-teamIssue5">✓ Saved</span>
                     <span class="inline-error-message" id="error-teamIssue5">Please enter an answer.</span>
                 </div>
            </div>
        </div>

        <h2 class="section-title">3.5. Drawing This Together</h2>
        <div class="drawing-together">
            <div class="drawing-icon">✓</div>
            <div>
                <p>In this chapter, we learned how coaching can enable your team to perform to its full potential... Keep in mind that coaching is really nothing more than a focused conversation...</p>
            </div>
        </div>

        <div class="media-container">
            <img src="https://images.unsplash.com/photo-1523240795612-9a054b0db644?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                 alt="Team celebrating collective success"
                 loading="lazy">
            <p class="caption">Effective team coaching leads to collective success</p>
        </div>

         <!-- General Warning Message (for Next Button click) -->
        <div class="warning-message" id="generalWarningMessage">
            <strong>Action Required:</strong> Please complete all required answers before proceeding.
            Unanswered questions are highlighted.
        </div>

        <!-- Navigation Buttons -->
        <div class="button-container">
            <!-- Updated back button link -->
            <a href="coaching-individuals.html" class="button back" id="backButton">← Back to Coaching Individuals</a>
            <!-- Next button triggers validation and modal -->
            <button type="button" class="button" id="nextButton">Next: Self Coaching →</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">×</button>
            <h3>Section Complete!</h3>
            <p>All required answers for this section have been saved.</p>
            <p>You can now proceed to the next section.</p>
            <button class="modal-button" onclick="redirectToNextPage()">CONTINUE TO SELF COACHING</button>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const formspreeEndpoint = 'https://formspree.io/f/xzzeqvea'; // YOUR Formspree Endpoint
        const localStorageKey = 'allUserAnswers_teamCoaching'; // Specific key for THIS page
        const userEmailKey = 'userEmail';
        const currentUserKey = 'currentUser';

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            const userEmail = getUserEmail();
            if (!userEmail) {
                alert('User session not found. Please log in again.');
                window.location.href = 'login.html';
                return;
            }

            displayUserInfo(userEmail);
            loadUserAnswers(userEmail);
            setupEventListeners(userEmail);
        });

        // --- User Info & Authentication ---
        function getUserEmail() {
            const userData = JSON.parse(localStorage.getItem(currentUserKey));
            return userData?.email || localStorage.getItem(userEmailKey);
        }

        function displayUserInfo(userEmail) {
            const userData = JSON.parse(localStorage.getItem(currentUserKey)) || {};
            document.getElementById('userName').textContent = `Welcome, ${userData.name || 'User'}`;
            document.getElementById('userEmail').textContent = userEmail;
        }

        function logout() {
            localStorage.removeItem('loggedIn');
            localStorage.removeItem(currentUserKey);
            localStorage.removeItem(userEmailKey);
            window.location.href = 'login.html';
        }

        // --- Answer Handling (Local Storage) ---
        function loadUserAnswers(userEmail) {
            const allAnswers = JSON.parse(localStorage.getItem(localStorageKey)) || {};
            const userPageAnswers = allAnswers[userEmail] || {};

            // Load answers for single textareas
            document.querySelectorAll('textarea.required-answer').forEach(field => {
                 const questionId = field.getAttribute('data-question');
                 const statusId = `save-status-${questionId}`;
                 const statusElement = document.getElementById(statusId);

                 if (userPageAnswers[questionId] !== undefined) {
                    field.value = userPageAnswers[questionId];
                    field.classList.remove('required-field');
                    if (userPageAnswers[questionId].trim() !== '' && statusElement) {
                         statusElement.textContent = '✓ Saved';
                         statusElement.style.display = 'inline';
                    } else if (statusElement) {
                        statusElement.style.display = 'none';
                    }
                 } else {
                    field.value = '';
                    if (statusElement) statusElement.style.display = 'none';
                 }
            });

             // Load answers for Team Roles table
             for (let i = 1; i <= 5; i++) {
                 ['member', 'role', 'strengths'].forEach(prefix => {
                     const questionId = `${prefix}${i}`;
                     const field = document.querySelector(`[data-question="${questionId}"]`);
                     if (field && userPageAnswers[questionId] !== undefined) {
                         field.value = userPageAnswers[questionId];
                     } else if (field) {
                         field.value = '';
                     }
                 });
             }
             // Show overall saved status for Team Roles table if any row seems complete
             const teamRolesStatus = document.getElementById('save-status-teamRoles');
             if (teamRolesStatus) {
                 let hasSavedRoles = false;
                 for(let i = 1; i <= 5; i++) {
                     if (userPageAnswers[`member${i}`]?.trim() && userPageAnswers[`role${i}`]?.trim() && userPageAnswers[`strengths${i}`]?.trim()) {
                         hasSavedRoles = true; break;
                     }
                 }
                 teamRolesStatus.style.display = hasSavedRoles ? 'inline' : 'none';
             }


              // Load answers for Team Charter table
             for (let i = 1; i <= 5; i++) {
                 ['name', 'responsibility', 'priority', 'outcome'].forEach(prefix => {
                     const questionId = `${prefix}${i}`;
                     const field = document.querySelector(`[data-question="${questionId}"]`);
                     if (field && userPageAnswers[questionId] !== undefined) {
                         field.value = userPageAnswers[questionId];
                     } else if (field) {
                         // Reset select to default if no saved value
                         field.value = (field.tagName === 'SELECT') ? '' : '';
                     }
                 });
             }
             // Show overall saved status for Team Charter table if any row seems complete
             const teamCharterStatus = document.getElementById('save-status-teamCharter');
             if (teamCharterStatus) {
                 let hasSavedCharter = false;
                 for(let i = 1; i <= 5; i++) {
                     if (userPageAnswers[`name${i}`]?.trim() && userPageAnswers[`responsibility${i}`]?.trim() && userPageAnswers[`priority${i}`]?.trim() && userPageAnswers[`outcome${i}`]?.trim()) {
                         hasSavedCharter = true; break;
                     }
                 }
                 teamCharterStatus.style.display = hasSavedCharter ? 'inline' : 'none';
             }
        }


        function saveAnswerToStorage(userEmail, questionId, answer) {
            const allAnswers = JSON.parse(localStorage.getItem(localStorageKey)) || {};
            if (!allAnswers[userEmail]) {
                allAnswers[userEmail] = {};
            }
            allAnswers[userEmail][questionId] = answer;
            localStorage.setItem(localStorageKey, JSON.stringify(allAnswers));
            console.log(`Saved locally: ${questionId}`);
        }

        function deleteAnswerFromStorage(userEmail, questionId) {
            const allAnswers = JSON.parse(localStorage.getItem(localStorageKey)) || {};
            if (allAnswers[userEmail]) {
                delete allAnswers[userEmail][questionId];
                if (Object.keys(allAnswers[userEmail]).length === 0) {
                    delete allAnswers[userEmail];
                }
            }
            localStorage.setItem(localStorageKey, JSON.stringify(allAnswers));
            console.log(`Deleted locally: ${questionId}`);
        }

        // --- Event Listeners Setup ---
        function setupEventListeners(userEmail) {
             // Auto-remove required styling on input/change for all editable fields
             document.querySelectorAll('.editable-answer').forEach(field => {
                 const eventType = (field.tagName === 'SELECT') ? 'change' : 'input';
                 field.addEventListener(eventType, function() {
                     const questionId = this.getAttribute('data-question');
                     const isRequiredDirectly = this.classList.contains('required-answer');
                     const errorId = isRequiredDirectly ? `error-${questionId}` : null; // Only look for specific error if directly required
                     const errorElement = errorId ? document.getElementById(errorId) : null;

                     if (this.value.trim() !== '') {
                         this.classList.remove('required-field');
                         if (errorElement) errorElement.style.display = 'none';

                         // Clear table-wide error if this field contributes to completing a row
                         if (questionId.startsWith('member') || questionId.startsWith('role') || questionId.startsWith('strengths')) {
                            clearTableErrorIfRowComplete('teamRoles', questionId.slice(-1));
                         } else if (questionId.startsWith('name') || questionId.startsWith('responsibility') || questionId.startsWith('priority') || questionId.startsWith('outcome')) {
                            clearTableErrorIfRowComplete('teamCharter', questionId.slice(-1));
                         }
                     }
                 });
             });

            // Next button validation & modal trigger
            document.getElementById('nextButton').addEventListener('click', function(e) {
                if (!validateAllAnswers()) {
                    e.preventDefault();
                    showGeneralWarningMessage();
                } else {
                    e.preventDefault();
                    showSuccessModal();
                }
            });
        }

         // Helper to clear table-wide error if a specific row becomes valid
         function clearTableErrorIfRowComplete(tableType, rowIndex) {
             const errorId = `error-${tableType}`;
             const errorElement = document.getElementById(errorId);
             if (!errorElement || errorElement.style.display === 'none') return; // No error to clear

             let rowComplete = true;
             let prefixes = [];
             if (tableType === 'teamRoles') {
                 prefixes = ['member', 'role', 'strengths'];
             } else if (tableType === 'teamCharter') {
                 prefixes = ['name', 'responsibility', 'priority', 'outcome'];
             }

             const nameField = document.querySelector(`[data-question="${prefixes[0]}${rowIndex}"]`);
             // Only check other fields if name is filled (as per validation logic)
             if (nameField && nameField.value.trim() !== '') {
                 for (const prefix of prefixes) {
                     const field = document.querySelector(`[data-question="${prefix}${rowIndex}"]`);
                     if (!field || field.value.trim() === '') {
                         rowComplete = false;
                         break;
                     }
                 }
                 // If this row is now complete, hide the table error (it might still show if other rows are incomplete)
                 // A more precise approach would be to re-validate the whole table, but this hides the *specific* row's contribution to the error
                 if (rowComplete) {
                     // We can't reliably hide the table error just based on one row becoming complete
                     // because other rows might still be invalid. It's better to let the main validation handle this.
                     // So, just remove the red border from the fields in this row.
                     prefixes.forEach(prefix => {
                         const field = document.querySelector(`[data-question="${prefix}${rowIndex}"]`);
                         if(field) field.classList.remove('required-field');
                     });
                     // Maybe hide the specific error for this row if we had per-row errors
                 }
             } else if (nameField && nameField.value.trim() === '') {
                 // If name is cleared, remove required from other fields in that row
                 prefixes.forEach(prefix => {
                      const field = document.querySelector(`[data-question="${prefix}${rowIndex}"]`);
                      if(field) field.classList.remove('required-field');
                 });
             }
         }


        // --- UI Feedback & Validation ---

        function validateAllAnswers() {
            let allValid = true;

            // 1. Check single required textareas
            document.querySelectorAll('textarea.required-answer').forEach(field => {
                const questionId = field.getAttribute('data-question');
                const errorId = `error-${questionId}`;
                const errorElement = document.getElementById(errorId);
                 hideMessages(null, errorId, field); // Clear previous error first

                 if (field.value.trim() === '') {
                    allValid = false;
                    showError(errorId, field, 'Please enter an answer.');
                }
            });

            // 2. Check Team Roles Table
            const teamRolesErrorElement = document.getElementById('error-teamRoles');
            hideMessages(null, 'error-teamRoles', null); // Clear previous table error
            let teamRolesTableValid = true;
            for (let i = 1; i <= 5; i++) {
                const nameField = document.querySelector(`[data-question="member${i}"]`);
                const roleField = document.querySelector(`[data-question="role${i}"]`);
                const strengthsField = document.querySelector(`[data-question="strengths${i}"]`);

                if (!nameField || !roleField || !strengthsField) continue; // Skip if row elements not found

                 // Clear borders first
                nameField.classList.remove('required-field');
                roleField.classList.remove('required-field');
                strengthsField.classList.remove('required-field');

                const nameValue = nameField.value.trim();
                const roleValue = roleField.value.trim();
                const strengthsValue = strengthsField.value.trim();

                 // Rule: If name is entered, role and strengths are required
                if (nameValue !== '' && (roleValue === '' || strengthsValue === '')) {
                    allValid = false;
                    teamRolesTableValid = false; // Mark table as invalid
                    if (roleValue === '') roleField.classList.add('required-field');
                    if (strengthsValue === '') strengthsField.classList.add('required-field');
                }
            }
             if (!teamRolesTableValid && teamRolesErrorElement) {
                  showError('error-teamRoles', null, 'If Member Name is entered, Role and Strengths are required.'); // Show table error
             }

            // 3. Check Team Charter Table
             const teamCharterErrorElement = document.getElementById('error-teamCharter');
             hideMessages(null, 'error-teamCharter', null); // Clear previous table error
             let teamCharterTableValid = true;
             for (let i = 1; i <= 5; i++) {
                 const nameField = document.querySelector(`[data-question="name${i}"]`);
                 const respField = document.querySelector(`[data-question="responsibility${i}"]`);
                 const prioField = document.querySelector(`[data-question="priority${i}"]`);
                 const outcomeField = document.querySelector(`[data-question="outcome${i}"]`);

                 if (!nameField || !respField || !prioField || !outcomeField) continue;

                  // Clear borders first
                 nameField.classList.remove('required-field');
                 respField.classList.remove('required-field');
                 prioField.classList.remove('required-field');
                 outcomeField.classList.remove('required-field');

                 const nameValue = nameField.value.trim();
                 const respValue = respField.value.trim();
                 const prioValue = prioField.value.trim();
                 const outcomeValue = outcomeField.value.trim();

                 // Rule: If name is entered, all others are required
                 if (nameValue !== '' && (respValue === '' || prioValue === '' || outcomeValue === '')) {
                     allValid = false;
                     teamCharterTableValid = false; // Mark table as invalid
                     if (respValue === '') respField.classList.add('required-field');
                     if (prioValue === '') prioField.classList.add('required-field');
                     if (outcomeValue === '') outcomeField.classList.add('required-field');
                 }
             }
              if (!teamCharterTableValid && teamCharterErrorElement) {
                  showError('error-teamCharter', null, 'If Name is entered, all other fields in the row are required.'); // Show table error
              }


            return allValid;
        }


        function showGeneralWarningMessage() {
            const warningElement = document.getElementById('generalWarningMessage');
            if (!warningElement) return;
            warningElement.style.display = 'block';
            warningElement.style.animation = 'fadeIn 0.3s ease-in-out';

            const firstEmptyField = document.querySelector('.required-field');
            if (firstEmptyField) {
                firstEmptyField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                setTimeout(() => firstEmptyField.focus(), 100);
            }

            setTimeout(() => {
                warningElement.style.animation = 'fadeOut 0.5s ease-in-out forwards';
                 setTimeout(() => {
                      warningElement.style.display = 'none';
                      warningElement.style.animation = '';
                 }, 500);
            }, 4000);
        }

         function showSaveStatus(statusId, message = '✓ Saved') {
             const statusElement = document.getElementById(statusId);
             if (!statusElement) return;
             statusElement.textContent = message;
             statusElement.style.display = 'inline';
             setTimeout(() => {
                 statusElement.style.display = 'none';
             }, 2500);
        }

        function showError(errorId, field, message = 'Required field.') {
             const errorElement = document.getElementById(errorId);
             if (!errorElement) return;
             errorElement.textContent = message;
             errorElement.style.display = 'inline';
             if (field) {
                 field.classList.add('required-field');
                 // Don't auto-focus on table errors shown outside the fields
                 if (!errorId.includes('teamRoles') && !errorId.includes('teamCharter')) {
                      field.focus();
                 }
             }
        }

        function hideMessages(statusId, errorId, field) {
             const statusElement = statusId ? document.getElementById(statusId) : null;
             const errorElement = errorId ? document.getElementById(errorId) : null;
             if (statusElement) statusElement.style.display = 'none';
             if (errorElement) errorElement.style.display = 'none';
             // Don't remove required-field class here, let validation handle it
             // if (field) field.classList.remove('required-field');
        }

        // --- Actions (Save/Delete Single Textareas) ---
        function saveAnswer(questionId) {
             const userEmail = getUserEmail();
             if (!userEmail) return;

             const field = document.querySelector(`textarea[data-question="${questionId}"]`);
             if (!field) { console.error(`Textarea not found for ${questionId}`); return; }

             const statusId = `save-status-${questionId}`;
             const errorId = `error-${questionId}`;
             const answer = field.value.trim();

             hideMessages(statusId, errorId, field); // Clear previous messages for this field

             if (!answer) {
                showError(errorId, field, 'Please enter an answer.');
                return;
             }

             saveAnswerToStorage(userEmail, questionId, field.value);
             submitToFormspree(userEmail, questionId, field.value);
             showSaveStatus(statusId);
             field.classList.remove('required-field'); // Remove red border on successful save
        }

        function deleteAnswer(questionId) {
            const userEmail = getUserEmail();
            if (!userEmail) return;

            const field = document.querySelector(`textarea[data-question="${questionId}"]`);
             if (!field) { console.error(`Textarea not found for ${questionId}`); return; }

             const statusId = `save-status-${questionId}`;
             const errorId = `error-${questionId}`;

             hideMessages(statusId, errorId, field);
             field.value = '';
             deleteAnswerFromStorage(userEmail, questionId);
             showSaveStatus(statusId, '✓ Deleted');
             field.classList.remove('required-field'); // Ensure border removed on delete
        }

        // --- Actions (Save/Delete Entire Tables) ---
         function saveTableData(tableType) { // tableType: 'teamRoles' or 'teamCharter'
             const userEmail = getUserEmail();
             if (!userEmail) return;

             const statusId = `save-status-${tableType}`;
             const errorId = `error-${tableType}`;
             const errorElement = document.getElementById(errorId);
             hideMessages(statusId, errorId, null); // Clear previous table messages

             let prefixes = [];
             if (tableType === 'teamRoles') prefixes = ['member', 'role', 'strengths'];
             else if (tableType === 'teamCharter') prefixes = ['name', 'responsibility', 'priority', 'outcome'];
             else return; // Unknown table type

             let hasDataToSave = false;
             let validationPassed = true;

             // First pass: Validate and collect data
             const dataToSave = {};
             for (let i = 1; i <= 5; i++) {
                 const rowData = {};
                 let isRowPartiallyFilled = false;
                 let isRowFullyFilled = true;
                 const rowFields = [];

                 for (const prefix of prefixes) {
                     const questionId = `${prefix}${i}`;
                     const field = document.querySelector(`[data-question="${questionId}"]`);
                     if (!field) continue; // Skip if field doesn't exist

                     field.classList.remove('required-field'); // Clear previous validation state
                     const value = field.value.trim();
                     rowData[questionId] = field.value; // Store original value
                     rowFields.push(field);

                     if (value !== '') {
                         isRowPartiallyFilled = true;
                     } else {
                          // Check if required based on the first field in the row
                          const firstFieldName = `${prefixes[0]}${i}`;
                           const firstField = document.querySelector(`[data-question="${firstFieldName}"]`);
                          if(firstField && firstField.value.trim() !== ''){
                              isRowFullyFilled = false;
                          }
                     }
                 }

                 // If the first field is filled but others aren't, mark invalid
                 const firstFieldCheckName = `${prefixes[0]}${i}`;
                 const firstFieldElement = document.querySelector(`[data-question="${firstFieldCheckName}"]`);
                 if (firstFieldElement && firstFieldElement.value.trim() !== '' && !isRowFullyFilled) {
                     validationPassed = false;
                      // Mark only the empty fields in this row as required
                      for (const prefix of prefixes) {
                         const questionId = `${prefix}${i}`;
                         const field = document.querySelector(`[data-question="${questionId}"]`);
                          if (field && field.value.trim() === '') {
                             field.classList.add('required-field');
                         }
                     }
                 }

                 // If row has any data, mark for saving
                 if (isRowPartiallyFilled) {
                     hasDataToSave = true;
                     // Store row data only if valid or partially filled (to save progress)
                     // We only *submit* valid rows later.
                      for (const key in rowData) {
                         dataToSave[key] = rowData[key];
                     }
                 }
             }

             // Show table-wide error if validation failed
             if (!validationPassed) {
                 showError(errorId, null, `Please fill all fields in rows where ${prefixes[0]} is entered.`);
                 return;
             }

             // If validation passed and there's data, save and submit
             if (hasDataToSave) {
                 for (const questionId in dataToSave) {
                     saveAnswerToStorage(userEmail, questionId, dataToSave[questionId]);
                     // Submit only non-empty values from valid rows (already filtered by validation logic)
                     const value = dataToSave[questionId];
                      if (value?.trim()){ // Submit only non-empty values
                           submitToFormspree(userEmail, questionId, value);
                      }
                 }
                 showSaveStatus(statusId);
             } else {
                  // Optional: Give feedback if save clicked with no data?
                  // console.log(`No data entered for ${tableType} table.`);
             }
         }

         function deleteTableData(tableType) {
            const userEmail = getUserEmail();
            if (!userEmail) return;

            const statusId = `save-status-${tableType}`;
            const errorId = `error-${tableType}`;
             hideMessages(statusId, errorId, null); // Clear previous messages

             let prefixes = [];
             if (tableType === 'teamRoles') prefixes = ['member', 'role', 'strengths'];
             else if (tableType === 'teamCharter') prefixes = ['name', 'responsibility', 'priority', 'outcome'];
             else return;

             for (let i = 1; i <= 5; i++) {
                 for (const prefix of prefixes) {
                     const questionId = `${prefix}${i}`;
                     const field = document.querySelector(`[data-question="${questionId}"]`);
                     if (field) {
                         field.value = (field.tagName === 'SELECT') ? '' : ''; // Clear field
                         field.classList.remove('required-field'); // Remove validation style
                         deleteAnswerFromStorage(userEmail, questionId); // Delete from storage
                     }
                 }
             }
              showSaveStatus(statusId, '✓ Cleared');
         }


        // --- Formspree Submission ---
        function submitToFormspree(userEmail, questionId, answer) {
            if (!answer?.trim()) {
                console.log(`Skipping Formspree submission for empty answer: ${questionId}`);
                return;
            }

            const formData = new FormData();
            formData.append('email', userEmail);
            formData.append('page', document.title);
            formData.append('question_id', questionId);
            formData.append('answer_text', answer);

            fetch(formspreeEndpoint, {
                method: 'POST',
                body: formData,
                headers: { 'Accept': 'application/json' }
            })
            .then(response => {
                if (response.ok) {
                    console.log(`Answer submitted to Formspree: ${questionId}`);
                } else {
                     response.json().then(data => {
                         console.error(`Formspree error for ${questionId}:`, data.errors ? data.errors.map(e => e.message).join(', ') : `Status ${response.status}`);
                    }).catch(() => console.error(`Formspree non-JSON error for ${questionId}. Status: ${response.status}`));
                }
            })
            .catch(error => console.error(`Network error submitting to Formspree for ${questionId}:`, error));
        }

        // --- Modal Handling ---
        function showSuccessModal() {
             const modal = document.getElementById('successModal');
             if(modal) modal.style.display = 'flex';
        }

        function closeModal() {
            const modal = document.getElementById('successModal');
            if(modal) modal.style.display = 'none';
        }

        function redirectToNextPage() {
            window.location.href = 'coaching-yourself.html'; // Make sure this is the correct next page filename
        }

    </script>
</body>
</html>
