<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Coaching</title>
    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn-icons-png.flaticon.com/512/3281/3281289.png">
    <style>
        /* --- Global Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        body { margin: 0; padding: 0; line-height: 1.7; background-color: #f9f9f9; color: #333; }
        /* User Bar Styles */
        .user-bar { background-color: #34495e; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; color: white; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-info svg { opacity: 0.8; }
        .user-details { display: flex; flex-direction: column; }
        .user-name { font-weight: 600; font-size: 14px; }
        .user-email { font-size: 12px; opacity: 0.8; }
        .logout-button { background-color: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px; font-size: 13px; }
        .logout-button:hover { background-color: #c0392b; transform: translateY(-1px); }
        .logout-button:active { transform: translateY(0); }
        /* Navigation Tabs */
        .nav-tab { background-color: #2c3e50; padding: 12px 10px; text-align: center; position: sticky; top: 0; z-index: 100; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: thin; scrollbar-color: #556a80 #2c3e50; }
        .nav-tab::-webkit-scrollbar { height: 6px; }
        .nav-tab::-webkit-scrollbar-track { background: #2c3e50; }
        .nav-tab::-webkit-scrollbar-thumb { background-color: #556a80; border-radius: 10px; border: 1px solid #2c3e50; }
        .nav-tab a { color: white; text-decoration: none; margin: 0 8px; padding: 8px 12px; border-radius: 6px; transition: background-color 0.3s, color 0.3s; font-size: 14px; display: inline-block; }
        .nav-tab a:hover, .nav-tab a.active { background-color: #34495e; color: #fff; }
        /* Main Content Styles */
        h1 { color: #fff; background-color: #e67e22; padding: 20px; border-radius: 8px; text-align: center; margin: 25px auto; max-width: 800px; font-size: 26px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 + p { text-align: center; margin-top: -15px; margin-bottom: 25px; color: #555; font-size: 15px; }
        .container { max-width: 800px; margin: 0 auto 30px; background: white; padding: 30px; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px; }
        .section-title { color: #e67e22; font-size: 1.6em; margin: 30px 0 15px 0; border-bottom: 2px solid #e67e22; padding-bottom: 8px; font-weight: 600; }
        .highlight-section { background-color: rgba(230, 126, 34, 0.07); padding: 20px; border-left: 5px solid #e67e22; border-radius: 6px; margin: 25px 0; }
        .action-card { background-color: #e67e22; color: white; padding: 20px; border-radius: 6px; margin: 25px 0; border-left: 5px solid #d35400; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .action-card > p, .action-card > h3 { color: white; }
        .media-container { text-align: center; margin: 30px 0; }
        .media-container img { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .caption { color: #555; margin-top: 10px; font-size: 14px; }
        .question-item { background-color: rgba(52, 152, 219, 0.08); padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #3498db; }
        .question-text { color: #34495e; font-weight: 600; margin-bottom: 15px; font-size: 1.1em; }
        .question-text .required-star { color: #e74c3c; font-weight: bold; margin-left: 3px; }
        .action-card .question-item { background-color: rgba(255, 255, 255, 0.9); border-left: 4px solid #ffffff; padding: 15px; }
        .action-card .question-item .question-text { color: #333; }
        .editable-answer { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; margin-top: 8px; margin-bottom: 10px; background-color: white; min-height: 45px; line-height: 1.6; display: block; color: #333; font-size: 15px; transition: border-color 0.3s, box-shadow 0.3s; }
        textarea.editable-answer { min-height: 80px; resize: vertical; }
        .editable-answer:focus { outline: none; border-color: #e67e22; box-shadow: 0 0 0 3px rgba(230, 126, 34, 0.2); }
        .editable-answer::placeholder { color: #aaa; opacity: 1; }
        .save-btn, .delete-btn { color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; font-weight: 500; }
        .save-btn { background-color: #27ae60; margin-right: 8px; }
        .delete-btn { background-color: #e74c3c; }
        .save-btn:hover { background-color: #2ecc71; transform: translateY(-1px); }
        .delete-btn:hover { background-color: #c0392b; transform: translateY(-1px); }
        .save-btn:active, .delete-btn:active { transform: translateY(0); }
        .saved-message { color: #27ae60; font-size: 13px; margin-left: 5px; display: none; font-weight: 500; }
        .saved-message.deleted { color: #6c757d; }
        .inline-error-message { color: #e74c3c; font-size: 13px; margin-left: 5px; display: none; font-weight: 500; }
        .action-card .saved-message { color: #d1e7dd; }
        .action-card .saved-message.deleted { color: #e9ecef; }
        .action-card .inline-error-message { color: #f8d7da; }
        /* Tables */
        table { width: 100%; border-collapse: collapse; margin: 25px 0; font-size: 14px; }
        table, th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: 600; color: #333; }
        .action-table { width: 100%; margin: 20px 0; background-color: #f8f9fa; border-radius: 6px; overflow: hidden; border: 1px solid #ddd; }
        .action-table th { background-color: #34495e; color: white; text-align: center; }
        .action-table td { vertical-align: top; color: #333; }
        .orange-header th { background-color: #e67e22 !important; color: black !important; padding: 10px; text-align: center; font-size: 14px; font-weight: bold; border-bottom: 1px solid #d35400; }
        .orange-row td { background-color: rgba(255, 255, 255, 0.8); vertical-align: top; }
        .orange-row .editable-answer { margin: 5px 0; color: #333; background-color: white; border: 1px solid #ccc; padding: 8px 10px; font-size: 14px; }
        .orange-row input.editable-answer::placeholder { color: #888; }
        /* Navigation Buttons */
        .button-container { display: flex; justify-content: space-between; margin-top: 40px; gap: 20px; border-top: 1px solid #eee; padding-top: 25px; }
        .button { text-decoration: none; padding: 12px 20px; color: white; border-radius: 4px; font-weight: 600; flex: 1; text-align: center; transition: all 0.3s ease; font-size: 15px; border: none; cursor: pointer; }
        .button.back { background-color: #6c757d; }
        .button#nextButton { background-color: #e67e22; }
        .button:hover { transform: translateY(-1px); filter: brightness(110%); }
        .button:active { transform: translateY(0); filter: brightness(100%); }
        .warning-message { background-color: #fff8e1; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; color: #333; display: none; font-size: 14px; line-height: 1.6; border-radius: 4px; font-weight: 500; }
        .required-field { border: 2px solid #e74c3c !important; background-color: #fff2f1 !important; box-shadow: none !important; }
        /* Section specific styles */
        .model-section, .trust-section, .rapport-section, .informal-tips { padding: 20px; border-radius: 6px; margin: 25px 0; border-left-width: 5px; border-left-style: solid; }
        .model-section { background-color: rgba(52, 152, 219, 0.1); border-left-color: #3498db; }
        .trust-section { background-color: rgba(46, 204, 113, 0.1); border-left-color: #2ecc71; }
        .rapport-section { background-color: rgba(155, 89, 182, 0.1); border-left-color: #9b59b6; }
        .informal-tips { background-color: rgba(241, 196, 15, 0.1); border-left-color: #f1c40f; }
        .drawing-together { display: flex; align-items: center; gap: 20px; background-color: rgba(155, 89, 182, 0.1); padding: 20px; border-radius: 6px; margin: 25px 0; border-left: 5px solid #9b59b6; }
        .drawing-icon { font-size: 28px; color: #9b59b6; flex-shrink: 0; }
        .answer-buttons { display: flex; gap: 8px; align-items: center; margin-top: 10px; flex-wrap: wrap; }
        .table-action-buttons { margin-top: 15px; text-align: right; }
        /* Modal Styles */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; animation: modalFadeInBackground 0.3s ease-out; }
        @keyframes modalFadeInBackground { from { background: rgba(0,0,0,0); } to { background: rgba(0,0,0,0.6); } }
        .modal-content { background: white; padding: 30px 40px; border-radius: 8px; max-width: 450px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.2); position: relative; animation: modalSlideIn 0.3s ease-out; }
        @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .modal-button { background-color: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; margin-top: 25px; font-weight: bold; transition: all 0.3s; font-size: 15px; }
        .modal-button:hover { background-color: #219653; transform: translateY(-2px); }
        .close-modal { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #aaa; transition: color 0.3s; }
        .close-modal:hover { color: #555; }
        .required-star { color: #e74c3c; font-weight: bold; margin-left: 2px; }

         /* --- Progress Bar Styles --- */
        .question-progress-container { margin-top: 15px; background-color: #ecf0f1; border-radius: 5px; overflow: hidden; height: 12px; width: 100%; display: none; /* Hidden by default */ }
        .question-progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #3498db, #2980b9); /* Blue gradient */ border-radius: 5px; transition: width 0.6s ease-in-out; display: flex; align-items: center; justify-content: center; }
        .question-progress-text { font-size: 9px; font-weight: 600; color: white; text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2); white-space: nowrap; overflow: hidden; padding: 0 4px; }
        .table-action-buttons + .question-progress-container { margin-top: 10px; } /* Space after buttons, before bar */


        /* Responsive */
        @media (max-width: 768px) {
             h1 { font-size: 22px; padding: 15px; margin: 20px 15px; }
             h1 + p { font-size: 14px; margin: -10px 15px 20px; }
             .container { padding: 20px; margin: 0 15px 20px; }
             .user-bar { padding: 10px 15px; font-size: 13px; }
             .user-name { font-size: 13px; }
             .user-email { font-size: 11px; }
             .logout-button { padding: 7px 12px; font-size: 12px; }
             .nav-tab { padding: 10px 5px; }
             .nav-tab a { margin: 0 5px; padding: 7px 10px; font-size: 13px;}
             .section-title { font-size: 1.4em; margin: 25px 0 10px 0; }
              .highlight-section, .action-card, .question-item, .model-section, .trust-section, .rapport-section, .informal-tips, .drawing-together { padding: 15px; margin: 20px 0; }
             .editable-answer { font-size: 14px; padding: 10px; }
             textarea.editable-answer { min-height: 80px; }
             .save-btn, .delete-btn { padding: 7px 13px; font-size: 13px; }
             .button-container { flex-direction: column; gap: 15px; padding-top: 20px; margin-top: 30px;}
             .button { font-size: 14px; padding: 12px 15px;}
             .modal-content { max-width: 90%; padding: 20px 25px; }
             .modal-button { padding: 10px 20px; font-size: 14px; }
             .close-modal { top: 10px; right: 10px; font-size: 20px; }
             .table-action-buttons { text-align: center; }
             .warning-message { font-size: 13px; }
             table, thead, tbody, th, td, tr { display: block; }
             thead tr { position: absolute; top: -9999px; left: -9999px; }
             tr { border: 1px solid #ccc; margin-bottom: 10px; border-radius: 4px; }
             .action-card tr { border: 1px solid rgba(255,255,255,0.3); }
             td { border: none; border-bottom: 1px solid #eee; position: relative; padding-left: 50% !important; text-align: right !important; } /* Force padding/alignment */
             .action-card td { border-bottom: 1px solid rgba(255,255,255,0.2); }
             td:before { position: absolute; top: 6px; left: 6px; width: 45%; padding-right: 10px; white-space: nowrap; content: attr(data-label); font-weight: bold; text-align: left;}
             .action-card td:before { color: #eee; }
             .orange-header { display: none; }
             .orange-row td:before { color: #e67e22; }
             .action-table { display: table; }
             .action-table thead, .action-table tbody, .action-table tr, .action-table th, .action-table td { display: revert; }
             .action-table thead tr { position: static; }
             .action-table th { text-align: center; }
             .action-table td { text-align: left; padding-left: 10px !important; }
             .action-table td:before { display: none; }
        }

    </style>
</head>
<body>
    <!-- User Info Bar -->
    <div class="user-bar"> <div class="user-info"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.8;"> <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> <circle cx="12" cy="7" r="4"></circle> </svg> <div class="user-details"> <span class="user-name" id="userName">Welcome back</span> <span class="user-email" id="userEmail">user@example.com</span> </div> </div> <button class="logout-button" onclick="logout()"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path> <polyline points="16 17 21 12 16 7"></polyline> <line x1="21" y1="12" x2="9" y2="12"></line> </svg> Logout </button> </div>

    <!-- Navigation Tabs -->
    <nav class="nav-tab"> <a href="index.html">Home</a> <a href="article1.html">Article 1</a> <a href="coaching-skills.html">Coaching Skills</a> <a href="coaching-individuals.html">Coaching Individuals</a> <a href="coaching-team.html" class="active">Team Coaching</a> <a href="coaching-yourself.html">Self Coaching</a> <a href="action-plan.html">Action Plan</a> </nav>

    <h1>Team Coaching</h1>
    <p>Developing high-performing teams through collective growth</p>

    <div class="container">
        <div class="highlight-section"> <p>It's not easy to get a team to work to its full potential. Conflicts, power struggles and miscommunication can cause a group to start, stumble and stop.</p> </div>
        <p>When your people aren't working together as effectively as they could, team coaching can help. Instead of focusing on individual development, your attention with group coaching is on improving relationships and interactions within the team as a whole.</p>
        <p>Team coaching is useful in many situations. For example, it can help people to:</p>
        <ul style="margin-left: 25px; list-style: disc; margin-bottom: 15px;"> <li>Work through interpersonal conflicts</li> <li>Understand their roles within the group</li> <li>Improve relationships</li> <li>Understand team goals</li> </ul>
        <p>You can coach your people at a specific place and time - at a team-building event, for example - or you can do it spontaneously.</p>
        <div class="media-container"> <img src="https://images.unsplash.com/photo-1593642634524-b40b5baae6bb?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Team members collaborating in a coaching session" loading="lazy"> <p class="caption">Team coaching focuses on group dynamics and interactions</p> </div>

        <h2 class="section-title">3.1 Understanding Team Dynamics</h2>
        <p>Before you start your group coaching session, you need to know how your people relate to one another.</p>
        <p>Each person has a unique personality and way of communicating. But, when people are in a group, they have to work closely with one another. Their different styles can cause frustration and conflict, which may prevent them from working together effectively.</p>
        <p>By understanding team dynamics, you can help people to recognize how they relate to one another, and to identify ways to improve their relationships.</p>
        <div class="trust-section"> <h3>Recognizing Unique Personalities</h3> <p>Personality tests such as Myers-Briggs®, the Big Five Personality Traits Model, and The DiSC Model can help you and your team members to learn more about how you prefer to communicate and process information.</p> <p>If your team members agree to take these tests, and to share the results, they may learn to understand one another better, and that it's OK for individuals to have different preferences. This can enable them to work together more effectively.</p> <p>It can also help if each team member understands their "role" within the group, perhaps using a framework like Belbin's Team Roles (Action Oriented, People Oriented, or Thought Oriented).</p> </div>
        <div class="highlight-section"> <p><strong>Example:</strong> Patrick is detail-oriented and enjoys research. His colleagues sometimes find him slow. However, recognizing the value his attention to detail brings transforms this perception from a weakness into a team strength.</p> </div>

        <!-- Team Roles Action Card -->
        <div class="action-card" id="teamRolesCard"> <!-- Added ID -->
            <h3>ACTION: Identify Team Roles<span class="required-star">*</span></h3>
            <p>Reflect on your team members' strengths and typical behaviors. Consider frameworks like Belbin's team roles. List potential roles and strengths below (fill at least one complete row for progress).</p>
            <table>
                 <thead> <tr class="orange-header"> <th>Team Member</th> <th>Potential Role</th> <th>Key Strengths</th> </tr> </thead>
                 <tbody>
                    <!-- Row 1 --> <tr class="orange-row"> <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member1"></td> <td data-label="Role"><input type="text" class="editable-answer" placeholder="e.g., Implementer, Coordinator..." data-question="role1"></td> <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="e.g., Organised, Good listener..." data-question="strengths1"></td> </tr>
                    <!-- Row 2 --> <tr class="orange-row"> <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member2"></td> <td data-label="Role"><input type="text" class="editable-answer" placeholder="e.g., Plant, Monitor Evaluator..." data-question="role2"></td> <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="e.g., Creative, Analytical..." data-question="strengths2"></td> </tr>
                    <!-- Row 3 --> <tr class="orange-row"> <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member3"></td> <td data-label="Role"><input type="text" class="editable-answer" placeholder="Team role..." data-question="role3"></td> <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths3"></td> </tr>
                    <!-- Row 4 --> <tr class="orange-row"> <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member4"></td> <td data-label="Role"><input type="text" class="editable-answer" placeholder="Team role..." data-question="role4"></td> <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths4"></td> </tr>
                    <!-- Row 5 --> <tr class="orange-row"> <td data-label="Member"><input type="text" class="editable-answer" placeholder="Member name..." data-question="member5"></td> <td data-label="Role"><input type="text" class="editable-answer" placeholder="Team role..." data-question="role5"></td> <td data-label="Strengths"><input type="text" class="editable-answer" placeholder="Key strengths..." data-question="strengths5"></td> </tr>
                 </tbody>
            </table>
            <div class="table-action-buttons"> <button class="save-btn" onclick="saveTableData('teamRoles')">Save Team Roles</button> <button class="delete-btn" onclick="deleteTableData('teamRoles')">Clear Team Roles</button> <span class="saved-message" id="save-status-teamRoles"></span> <span class="inline-error-message" id="error-teamRoles"></span> </div>
             <!-- Progress Bar for Team Roles Table -->
            <div class="question-progress-container" id="teamRoles-progress-container">
                <div class="question-progress-bar" id="progress-bar-teamRoles">
                    <span class="question-progress-text" id="progress-text-teamRoles"></span>
                </div>
            </div>
             <p style="font-size: 0.9em; color: #eee; margin-top: 10px;">Note: Fill all columns if entering a team member's name. Complete at least one row.</p>
        </div>

        <div class="media-container"> <img src="https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Team members with diverse personalities working together" loading="lazy"> <p class="caption">Understanding personality differences improves team dynamics</p> </div>

        <h2 class="section-title">3.2 Defining Your Expectations</h2>
        <p>When your team members understand one another better, they will likely work together more effectively. But they may also benefit from a set of ground rules that guides the way that they behave and communicate.</p>
        <div class="highlight-section"> <p><strong>Example:</strong> Rudi finds high-energy meetings exhausting. In the past, he stayed silent when he could have raised important concerns, damaging the team's reputation. Clear communication guidelines could prevent this.</p> </div>
        <p>Defining expectations is crucial. A <strong>team charter</strong> is a document defining behavior and communication "rules" everyone agrees to follow. If a formal charter isn't suitable, discuss and agree on acceptable standards for different situations.</p>

        <!-- Team Charter Action Card -->
        <div class="action-card" id="teamCharterCard"> <!-- Added ID -->
            <h3>ACTION: Develop Team Charter Elements<span class="required-star">*</span></h3>
            <p>List key responsibilities, priorities, and expected outcomes for team members or roles (fill at least one complete row for progress).</p>
            <table>
                 <thead> <tr> <th class="orange-header">Name / Role</th> <th class="orange-header">Responsibility</th> <th class="orange-header">Priority</th> <th class="orange-header">Expected Outcome</th> </tr> </thead>
                 <tbody>
                     <!-- Row 1 --> <tr class="orange-row"> <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name1"></td> <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility1"></textarea></td> <td data-label="Priority"> <select class="editable-answer" data-question="priority1"> <option value="">Select...</option> <option value="High">High</option> <option value="Medium">Medium</option> <option value="Low">Low</option> </select> </td> <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome1"></textarea></td> </tr>
                     <!-- Row 2 --> <tr class="orange-row"> <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name2"></td> <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility2"></textarea></td> <td data-label="Priority"> <select class="editable-answer" data-question="priority2"> <option value="">Select...</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option> </select> </td> <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome2"></textarea></td> </tr>
                     <!-- Row 3 --> <tr class="orange-row"> <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name3"></td> <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility3"></textarea></td> <td data-label="Priority"> <select class="editable-answer" data-question="priority3"> <option value="">Select...</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option> </select> </td> <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome3"></textarea></td> </tr>
                     <!-- Row 4 --> <tr class="orange-row"> <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name4"></td> <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility4"></textarea></td> <td data-label="Priority"> <select class="editable-answer" data-question="priority4"> <option value="">Select...</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option> </select> </td> <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome4"></textarea></td> </tr>
                     <!-- Row 5 --> <tr class="orange-row"> <td data-label="Name/Role"><input type="text" class="editable-answer" placeholder="Name or Role..." data-question="name5"></td> <td data-label="Responsibility"><textarea class="editable-answer" placeholder="Key Responsibilities..." data-question="responsibility5"></textarea></td> <td data-label="Priority"> <select class="editable-answer" data-question="priority5"> <option value="">Select...</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option> </select> </td> <td data-label="Outcome"><textarea class="editable-answer" placeholder="Measurable outcomes..." data-question="outcome5"></textarea></td> </tr>
                 </tbody>
            </table>
            <div class="table-action-buttons"> <button class="save-btn" onclick="saveTableData('teamCharter')">Save Team Charter</button> <button class="delete-btn" onclick="deleteTableData('teamCharter')">Clear Team Charter</button> <span class="saved-message" id="save-status-teamCharter"></span> <span class="inline-error-message" id="error-teamCharter"></span> </div>
            <!-- Progress Bar for Team Charter Table -->
            <div class="question-progress-container" id="teamCharter-progress-container">
                <div class="question-progress-bar" id="progress-bar-teamCharter">
                    <span class="question-progress-text" id="progress-text-teamCharter"></span>
                </div>
            </div>
             <p style="font-size: 0.9em; color: #eee; margin-top: 10px;">Note: Fill all columns if entering a Name/Role. Complete at least one row.</p>
        </div>

        <h2 class="section-title">3.3 Evaluating Rewards and Recognition</h2>
        <p>At times, people in your team might have competing priorities, and this can lead to serious dysfunction within the group.</p>
        <div class="highlight-section"> <p><strong>Example:</strong> An organization promotes teamwork but primarily rewards individual performance. This conflict can demotivate collaborative efforts.</p> </div>
        <p>As a manager, it's important to identify any competing values or goals in your team, and to address them before they cause problems.</p>

        <!-- Assess Priorities Action Card -->
        <div class="action-card">
            <h3>ACTION: Assess Team Priorities</h3>
            <p>Answer the questions below to determine whether your team is facing any competing priorities:</p>
            <div class="question-item" id="question-container-rewardSystem"> <div class="question-text">1. Analyze your organization's reward system vs. your team's goals. Any conflicts? How can you resolve them?<span class="required-star">*</span></div> <textarea class="editable-answer required-answer" data-question="rewardSystem" placeholder="Describe conflicts and potential resolutions..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('rewardSystem')">Save</button> <button class="delete-btn" onclick="deleteAnswer('rewardSystem')">Delete</button> <span class="saved-message" id="save-status-rewardSystem"></span> <span class="inline-error-message" id="error-rewardSystem"></span> </div>
                 <!-- Progress Bar -->
                 <div class="question-progress-container" id="progress-container-rewardSystem">
                    <div class="question-progress-bar" id="progress-bar-rewardSystem">
                        <span class="question-progress-text" id="progress-text-rewardSystem"></span>
                    </div>
                </div>
             </div>
            <div class="question-item" id="question-container-departmentConflicts"> <div class="question-text">2. For cross-functional teams: Do reward systems in different departments clash? How?<span class="required-star">*</span></div> <textarea class="editable-answer required-answer" data-question="departmentConflicts" placeholder="Describe inter-departmental reward conflicts..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('departmentConflicts')">Save</button> <button class="delete-btn" onclick="deleteAnswer('departmentConflicts')">Delete</button> <span class="saved-message" id="save-status-departmentConflicts"></span> <span class="inline-error-message" id="error-departmentConflicts"></span> </div>
                 <!-- Progress Bar -->
                 <div class="question-progress-container" id="progress-container-departmentConflicts">
                    <div class="question-progress-bar" id="progress-bar-departmentConflicts">
                        <span class="question-progress-text" id="progress-text-departmentConflicts"></span>
                    </div>
                </div>
             </div>
            <div class="question-item" id="question-container-goalAlignment"> <div class="question-text">3. List your team's main goals and individuals' key objectives. Are they aligned? Where are the mismatches?<span class="required-star">*</span></div> <textarea class="editable-answer required-answer" data-question="goalAlignment" placeholder="List goals & objectives; identify misalignments..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('goalAlignment')">Save</button> <button class="delete-btn" onclick="deleteAnswer('goalAlignment')">Delete</button> <span class="saved-message" id="save-status-goalAlignment"></span> <span class="inline-error-message" id="error-goalAlignment"></span> </div>
                 <!-- Progress Bar -->
                 <div class="question-progress-container" id="progress-container-goalAlignment">
                    <div class="question-progress-bar" id="progress-bar-goalAlignment">
                        <span class="question-progress-text" id="progress-text-goalAlignment"></span>
                    </div>
                </div>
             </div>
              <p style="font-size: 0.9em; color: #eee; margin-top: 10px;"><span class="required-star" style="color:#f8d7da;">*</span> Required field.</p>
        </div>

        <div class="media-container"> <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Team celebrating success with aligned objectives" loading="lazy"> <p class="caption">Aligning rewards with team objectives is crucial</p> </div>

        <h2 class="section-title">3.4 Team Coaching Processes</h2>
        <p>There are various models that you can use when you coach a group, and some of the models that we outlined in Chapter 2 can also apply to team coaching. Here are some further suggestions:</p>
        <div class="model-section"> <h3>1. The POSITIVE Model of Coaching</h3> <p>Developed by Vincenzo Libri (2004), this model helps maintain motivation:</p> <ul style="margin-left: 25px; list-style: disc;"> <li><strong>Purpose:</strong> Define the desired outcome.</li> <li><strong>Observations:</strong> Analyze the current situation.</li> <li><strong>SMART:</strong> Set a Specific, Measurable, Achievable, Relevant, Time-bound goal.</li> <li><strong>Insight:</strong> Reflect on the goal's meaning and implications.</li> <li><strong>Team:</strong> Consider support systems and stakeholders.</li> <li><strong>Initiate:</strong> Plan the first steps and start date.</li> <li><strong>Value:</strong> Break down the goal into manageable steps.</li> <li><strong>Encourage:</strong> Regularly review progress and offer support.</li> </ul> </div>
         <div class="model-section"> <h3>2. The PRACTICE Model of Coaching</h3> <p>Published by psychologist Stephen Palmer (2008), this focuses on problem-solving:</p> <ol style="margin-left: 25px;"> <li>Identify the <strong>P</strong>roblem.</li> <li>Develop <strong>R</strong>ealistic and relevant goals.</li> <li>Generate <strong>A</strong>lternative solutions.</li> <li>Consider the <strong>C</strong>onsequences of each alternative.</li> <li><strong>T</strong>arget the most feasible solution(s).</li> <li><strong>I</strong>mplement the <strong>C</strong>hosen solution(s).</li> <li><strong>E</strong>valuate the outcome.</li> </ol> <p>Its strength lies in its structured, solution-focused approach.</p> </div>

        <!-- Apply Coaching Models Action Card -->
        <div class="action-card">
            <h3>ACTION: Apply Coaching Models</h3>
            <p>Identify team issues that coaching could resolve. How could the models help? (Fill at least the first issue).</p>
            <div class="question-item" id="question-container-teamIssue1"> <div class="question-text">Team Issue & Potential Resolution<span class="required-star">*</span></div> <textarea class="editable-answer required-answer" data-question="teamIssue1" placeholder="Issue 1: Describe the team issue and how a model (e.g., PRACTICE) could help resolve it..."></textarea> <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('teamIssue1')">Save</button> <button class="delete-btn" onclick="deleteAnswer('teamIssue1')">Delete</button> <span class="saved-message" id="save-status-teamIssue1"></span> <span class="inline-error-message" id="error-teamIssue1"></span> </div>
                 <!-- Progress Bar -->
                 <div class="question-progress-container" id="progress-container-teamIssue1">
                    <div class="question-progress-bar" id="progress-bar-teamIssue1">
                        <span class="question-progress-text" id="progress-text-teamIssue1"></span>
                    </div>
                </div>
             </div>
             <div class="question-item"> <!-- Optional Question 2 -->
                 <div class="question-text">Team Issue & Potential Resolution (Optional)</div>
                 <textarea class="editable-answer" data-question="teamIssue2" placeholder="Issue 2 (Optional): Describe another issue and potential resolution..."></textarea>
                 <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('teamIssue2')">Save</button> <button class="delete-btn" onclick="deleteAnswer('teamIssue2')">Delete</button> <span class="saved-message" id="save-status-teamIssue2"></span> </div>
             </div>
             <div class="question-item"> <!-- Optional Question 3 -->
                 <div class="question-text">Team Issue & Potential Resolution (Optional)</div>
                 <textarea class="editable-answer" data-question="teamIssue3" placeholder="Issue 3 (Optional): Describe another issue..."></textarea>
                  <div class="answer-buttons"> <button class="save-btn" onclick="saveAnswer('teamIssue3')">Save</button> <button class="delete-btn" onclick="deleteAnswer('teamIssue3')">Delete</button> <span class="saved-message" id="save-status-teamIssue3"></span> </div>
             </div>
             <p style="font-size: 0.9em; color: #eee; margin-top: 10px;"><span class="required-star" style="color:#f8d7da;">*</span> First issue field is required.</p>
        </div>

        <h2 class="section-title">3.5 Drawing This Together</h2>
        <div class="drawing-together"> <div class="drawing-icon">✓</div> <div> <p>In this chapter, we learned how coaching can enable your team to perform to its full potential by focusing on group dynamics, roles, expectations, and reward alignment. We explored models like POSITIVE and PRACTICE applicable to teams. Remember, team coaching, like individual coaching, is essentially a focused conversation aimed at collective improvement.</p> </div> </div>
        <div class="media-container"> <img src="https://images.unsplash.com/photo-1523240795612-9a054b0db644?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Team celebrating collective success" loading="lazy"> <p class="caption">Effective team coaching leads to collective success</p> </div>
         <!-- General Warning Message -->
        <div class="warning-message" id="generalWarningMessage"> <strong>Action Required:</strong> Please complete all required answers (marked with <span class="required-star">*</span>) and ensure table rows are complete if started. </div>
        <!-- Navigation Buttons -->
        <div class="button-container"> <a href="coaching-individuals.html" class="button back">← Back to Coaching Individuals</a> <button type="button" class="button" id="nextButton">Next: Self Coaching →</button> </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal-overlay"> <div class="modal-content"> <button class="close-modal" onclick="closeModal()">×</button> <h3 style="color: #27ae60;">Section Complete!</h3> <p>All required answers for this section have been saved.</p> <p>You can now proceed to the next section.</p> <button class="modal-button" onclick="redirectToNextPage()">CONTINUE TO SELF COACHING</button> </div> </div>

    <script>
        // --- Configuration ---
        const formspreeEndpoint = 'https://formspree.io/f/xzzeqvea';
        const localStorageKey = 'allUserAnswers_teamCoaching';
        const SECTION_ID = 'team'; // Unique ID for this section

        // --- Unified Keys ---
        const LOGGED_IN_KEY = 'isUserLoggedIn';
        const CURRENT_USER_KEY = 'currentUser';

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = getCurrentUser();
             if (!currentUser) {
                 console.error(`${SECTION_ID} page: User not logged in. Redirecting...`);
                  if (!window.location.search.includes('redir_attempt')) { window.location.href = `login.html?redirect=${encodeURIComponent(window.location.pathname + window.location.search)}&redir_attempt=1`; }
                  else { console.error("REDIRECTION LOOP DETECTED."); document.body.innerHTML = '<p style="color: red; padding: 20px;">Login check failed repeatedly.</p>'; }
                 return;
             }
            console.log(`%c${SECTION_ID} page: User validated (${currentUser.email}). Initializing.`, "color: green;");
            displayUserInfo(currentUser);
            loadUserAnswers(currentUser.email);
            setupEventListeners(currentUser.email);
            highlightActiveNav();
            addRequiredStars();
            setupMobileTableLabels();
            console.log(`%c${SECTION_ID} page: Initialization complete.`, "color: blue;");
        });

        // --- User Info & Authentication ---
        function getCurrentUser() { /* ... consistent ... */ try { const d = localStorage.getItem(CURRENT_USER_KEY); if (!d) return null; const p = JSON.parse(d); if (p && typeof p === 'object' && p.email && p.name) { if (typeof p.progress !== 'object' || p.progress === null) p.progress = {}; return p; } else { localStorage.removeItem(CURRENT_USER_KEY); localStorage.removeItem(LOGGED_IN_KEY); return null; } } catch (e) { console.error("GUC Error:", e); localStorage.removeItem(CURRENT_USER_KEY); localStorage.removeItem(LOGGED_IN_KEY); return null; } }
        function saveCurrentUser(userObject) { /* ... consistent ... */ try { if (!userObject || typeof userObject !== 'object') throw new Error("Invalid user object"); localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userObject)); console.log("Saved user data."); } catch (error) { console.error("SCU Error:", error); } }
        function displayUserInfo(user) { /* ... consistent ... */ document.getElementById('userName').textContent = `Welcome, ${user.name || 'User'}`; document.getElementById('userEmail').textContent = user.email; }
        function logout() { /* ... consistent ... */ localStorage.removeItem(LOGGED_IN_KEY); localStorage.removeItem(CURRENT_USER_KEY); window.location.href = 'login.html';}
        function highlightActiveNav() { /* ... consistent ... */ const cP=window.location.pathname.split('/').pop()||'index.html'; document.querySelectorAll('.nav-tab a').forEach(l=>{const lP=(l.getAttribute('href')||'').split('/').pop(); l.classList.toggle('active',lP===cP);}); }
        function addRequiredStars() { /* ... consistent ... */ document.querySelectorAll('.required-answer').forEach(f=>{let l=f.closest('.question-item')?.querySelector('.question-text'); if(!l&&f.closest('.action-card')&&f.tagName==='TEXTAREA')l=f.closest('.action-card').querySelector('h3'); if(l&&!l.querySelector('.required-star'))l.insertAdjacentHTML('beforeend','<span class="required-star">*</span>');}); document.querySelectorAll('.action-card table:first-of-type').forEach(t=>{const h=t.closest('.action-card')?.querySelector('h3'); if(h&&!h.querySelector('.required-star'))h.insertAdjacentHTML('beforeend','<span class="required-star">*</span>');}); document.querySelectorAll('p:has(.required-star)').forEach(n=>n.style.display='none'); }
        function setupMobileTableLabels() { /* ... consistent ... */ document.querySelectorAll('table:not(.action-table) tbody tr').forEach(r=>{const h=Array.from(r.closest('table').querySelectorAll('thead th')).map(th=>th.textContent.replace('*','').trim()); r.querySelectorAll('td').forEach((t,i)=>t.setAttribute('data-label',h[i]||''));});}


        // --- Answer Handling (Local Storage) ---
        function loadUserAnswers(userEmail) { /* ... consistent load logic ... */
             if (!userEmail) return;
             let allAnswers = {}; try { const d = localStorage.getItem(localStorageKey); if (d) allAnswers = JSON.parse(d) || {}; } catch(e) { console.error("Load Answers Error:", e); }
             const userPageAnswers = allAnswers[userEmail] || {};
             const currentProgress = updateSectionProgress(SECTION_ID);

             // Load textareas
             document.querySelectorAll('textarea.editable-answer').forEach(field => {
                 const qId = field.dataset.question;
                 const qContainer = document.getElementById(`question-container-${qId}`);
                 loadFieldState(field, qId, userPageAnswers, qContainer, currentProgress);
             });

             // Load tables and check completion
             loadTableState('teamRoles', ['member', 'role', 'strengths'], userPageAnswers, currentProgress);
             loadTableState('teamCharter', ['name', 'responsibility', 'priority', 'outcome'], userPageAnswers, currentProgress);
        }

        function loadFieldState(field, questionId, userAnswers, questionContainer, overallProgress, showBar = true) { /* ... consistent ... */
             const statusId = `save-status-${questionId}`; hideMessages(statusId, `error-${questionId}`, field);
             if (userAnswers[questionId] !== undefined) { field.value = userAnswers[questionId]; if (field.value.trim() !== '' && showBar && questionContainer) { showQuestionProgressBar(questionContainer, overallProgress); } else if (showBar && questionContainer) { hideQuestionProgressBar(questionContainer); } } else { field.value = (field.tagName === 'SELECT') ? '' : ''; if (showBar && questionContainer) { hideQuestionProgressBar(questionContainer); } }
        }

         // Load table state & check completion
         function loadTableState(tableType, prefixes, userAnswers, overallProgress) {
             const tableProgressContainer = document.getElementById(`${tableType}-progress-container`);
             let isTableComplete = false;

             for (let i = 1; i <= 5; i++) {
                 let rowComplete = true; let rowStarted = false;
                 for (const prefix of prefixes) {
                     const qId = `${prefix}${i}`; const field = document.querySelector(`[data-question="${qId}"]`);
                     if (field) { loadFieldState(field, qId, userAnswers, null, 0, false); if(userAnswers[qId]?.trim()) rowStarted = true; if(field.value.trim() === '') rowComplete = false; }
                     else { rowComplete = false; }
                 }
                 if(rowStarted && rowComplete) isTableComplete = true;
             }
             if (isTableComplete && tableProgressContainer) { showQuestionProgressBar(tableProgressContainer, overallProgress); }
             else if (tableProgressContainer) { hideQuestionProgressBar(tableProgressContainer); }
         }

        function saveAnswerToStorage(userEmail, questionId, answer) { /* ... consistent ... */ if(!userEmail) return false; let a={}; try{const d=localStorage.getItem(localStorageKey); if(d) a=JSON.parse(d)||{};}catch(e){console.error("Save Parse Err:",e); a={};} if(!a[userEmail]) a[userEmail]={}; a[userEmail][questionId]=answer; try{localStorage.setItem(localStorageKey,JSON.stringify(a)); return true;} catch(e){console.error("Save Storage Err:",e); return false;} }
        function deleteAnswerFromStorage(userEmail, questionId) { /* ... consistent ... */ if(!userEmail) return false; let a={}; try{const d=localStorage.getItem(localStorageKey); if(d) a=JSON.parse(d)||{}; else return false;} catch(e){console.error("Del Parse Err:",e); return false;} let u=false; if(a[userEmail]?.[questionId]!==undefined){delete a[userEmail][questionId]; u=true; if(Object.keys(a[userEmail]).length===0) delete a[userEmail];} if(u){try{localStorage.setItem(localStorageKey,JSON.stringify(a)); return true;}catch(e){console.error("Del Storage Err:", e); return false;}} return false; }

        // --- Event Listeners Setup ---
        function setupEventListeners(userEmail) { /* ... consistent ... */
             if (!userEmail) return;
             document.querySelectorAll('.editable-answer').forEach(field => {
                 const eventType = (field.tagName === 'SELECT') ? 'change' : 'input';
                 field.addEventListener(eventType, function() {
                     const qId = this.dataset.question; hideError(`error-${qId}`);
                     if (this.value.trim() !== '') this.classList.remove('required-field');
                     const table = this.closest('table');
                     if(table) {
                         const card = table.closest('.action-card');
                         if(card?.id === 'teamRolesCard') clearTableErrorIfRowComplete('teamRoles', qId.match(/(\d+)$/)?.[1]);
                         else if(card?.id === 'teamCharterCard') clearTableErrorIfRowComplete('teamCharter', qId.match(/(\d+)$/)?.[1]);
                     }
                 });
             });
             const nextButton = document.getElementById('nextButton');
             if (nextButton) { nextButton.addEventListener('click', handleNextButtonClick); }
        }

        function handleNextButtonClick(e) { /* ... consistent ... */ if (!validateAllAnswers(true)) { e.preventDefault(); showGeneralWarningMessage(); } else { window.location.href = 'coaching-yourself.html'; } }
        function clearTableErrorIfRowComplete(tableType, rowIndex) { /* ... consistent ... */
             const errorId = `error-${tableType}`; const errorElement = document.getElementById(errorId); if (!errorElement) return;
             let prefixes = []; let namePrefix = '';
             if (tableType === 'teamRoles') { prefixes = ['member', 'role', 'strengths']; namePrefix = 'member'; }
             else if (tableType === 'teamCharter') { prefixes = ['name', 'responsibility', 'priority', 'outcome']; namePrefix = 'name'; }
             else return;
             const nameField = document.querySelector(`[data-question="${namePrefix}${rowIndex}"]`); if (!nameField) return;
             let isRowNowValid = true; if (nameField.value.trim() !== '') { for (const p of prefixes) { const f = document.querySelector(`[data-question="${p}${rowIndex}"]`); if (!f || f.value.trim() === '') { isRowNowValid = false; break; } } } else { for (const p of prefixes) { const f = document.querySelector(`[data-question="${p}${rowIndex}"]`); if (f) f.classList.remove('required-field'); } }
             if (isRowNowValid) { for (const p of prefixes) { const f = document.querySelector(`[data-question="${p}${rowIndex}"]`); if (f) f.classList.remove('required-field'); } }
             let anyOtherInvalid = false; for (let i = 1; i <= 5; i++) { if (i === parseInt(rowIndex)) continue; const oName = document.querySelector(`[data-question="${namePrefix}${i}"]`); if (oName?.value.trim() !== '') { for (const p of prefixes) { const oF = document.querySelector(`[data-question="${p}${i}"]`); if (oF && oF.value.trim() === '') { anyOtherInvalid = true; break; } } } if (anyOtherInvalid) break; }
             if (!anyOtherInvalid) hideError(errorId);
        }


        // --- UI Feedback & Validation ---
        function validateAllAnswers(showErrors = false) { /* ... consistent ... */
            let allValid = true; let firstInvalidField = null;
            // Textareas
            document.querySelectorAll('textarea.required-answer').forEach(f=>{const qId=f.dataset.question; const eId=`error-${qId}`; hideError(eId); if(f.value.trim()===''){allValid=false; if(!firstInvalidField)firstInvalidField=f; if(showErrors){f.classList.add('required-field'); showError(eId,null,'Required.');}}else{f.classList.remove('required-field');}});
            // Tables
            if(!validateTable('teamRoles', ['member','role','strengths'], 'member', showErrors)){allValid=false; if(!firstInvalidField) firstInvalidField=document.querySelector('#teamRolesCard .required-field');}
            if(!validateTable('teamCharter', ['name','responsibility','priority','outcome'], 'name', showErrors)){allValid=false; if(!firstInvalidField) firstInvalidField=document.querySelector('#teamCharterCard .required-field');}
            // Scroll
            if(!allValid&&showErrors&&firstInvalidField){firstInvalidField.scrollIntoView({behavior:'smooth',block:'center'}); setTimeout(()=>firstInvalidField.focus({preventScroll:true}),400);}
            return allValid;
        }
        function validateTable(tableType, prefixes, namePrefix, showErrors) { /* ... consistent ... */
             const errorId = `error-${tableType}`; hideError(errorId); let tableIsValid=true; let firstRowErrorField=null;
             for(let i=1; i<=5; i++){ const nF=document.querySelector(`[data-question="${namePrefix}${i}"]`); if(!nF) continue; const nV=nF.value.trim(); let rowComplete=true; prefixes.forEach(p=>{const f=document.querySelector(`[data-question="${p}${i}"]`); if(f) f.classList.remove('required-field');}); if(nV!==''){for(const p of prefixes){const f=document.querySelector(`[data-question="${p}${i}"]`); if(!f||f.value.trim()===''){rowComplete=false; if(showErrors&&f){f.classList.add('required-field'); if(!firstRowErrorField)firstRowErrorField=f;}}}} if(nV!==''&&!rowComplete) tableIsValid=false; }
             if(!tableIsValid&&showErrors) showError(errorId,null,`Please fill all fields in rows where ${namePrefix} is entered.`);
             return tableIsValid;
         }
        function showGeneralWarningMessage() { /* ... consistent ... */ const w=document.getElementById('generalWarningMessage'); if(!w) return; w.style.animation='none'; void w.offsetWidth; w.style.display='block'; w.style.animation='slideDownFadeIn 0.4s ease-out'; clearTimeout(w.timer); w.timer=setTimeout(()=>{w.style.animation='fadeOutUp 0.5s ease-out forwards'; setTimeout(()=>{if(w.style.animationName==='fadeOutUp'){w.style.display='none';w.style.animation='';}},500);},4000); }
        function showSaveStatus(statusId, message = '✓ Saved') { /* ... consistent ... */ const s=document.getElementById(statusId); if(!s) return; s.textContent=message; s.classList.remove('deleted'); s.style.color=''; const aC=s.closest('.action-card'); if(aC) s.style.color='#d1e7dd'; else s.style.color='#27ae60'; if(message.includes('Deleted')||message.includes('cleared')){s.classList.add('deleted'); if(aC) s.style.color='#e9ecef'; else s.style.color='#6c757d';} s.style.display='inline-block'; clearTimeout(s.timer); s.timer=setTimeout(()=>s.style.display='none',3000); }
        function showError(errorId, fieldToFocus, message = 'Required field.') { /* ... consistent ... */ const e=document.getElementById(errorId); if(!e) return; e.textContent=message; const aC=e.closest('.action-card'); if(aC) e.style.color='#f8d7da'; else e.style.color='#e74c3c'; e.style.display='inline-block'; }
        function hideError(errorId) { /* ... consistent ... */ const e=document.getElementById(errorId); if(e) e.style.display='none';}
        function hideMessages(statusId, errorId, field) { /* ... consistent ... */ hideError(errorId); const s=statusId?document.getElementById(statusId):null; if(s)s.style.display='none'; if(field)field.classList.remove('required-field');}

        // --- Actions (Save/Delete Single Textareas) ---
        window.saveAnswer = function(questionId) { /* ... consistent, includes progress update/show */
             const currentUser = getCurrentUser(); if (!currentUser?.email) return;
             const field = document.querySelector(`textarea[data-question="${questionId}"]`);
             const qContainer = document.getElementById(`question-container-${questionId}`);
             if (!field || !qContainer) return;
             const statusId = `save-status-${questionId}`; const errorId = `error-${questionId}`;
             const answer = field.value; const trimmedAnswer = answer.trim();
             const isRequired = field.classList.contains('required-answer');
             hideMessages(statusId, errorId, field);
             if (isRequired && !trimmedAnswer) { showError(errorId, field, 'Required.'); hideQuestionProgressBar(qContainer); updateSectionProgress(SECTION_ID); return; }
             if (saveAnswerToStorage(currentUser.email, questionId, answer)) {
                 if(trimmedAnswer) submitToFormspree(currentUser.email, questionId, answer);
                 showSaveStatus(statusId); const p = updateSectionProgress(SECTION_ID); showQuestionProgressBar(qContainer, p);
             }
        }
        window.deleteAnswer = function(questionId) { /* ... consistent, includes progress update/show */
             const currentUser = getCurrentUser(); if (!currentUser?.email) return;
             const field = document.querySelector(`textarea[data-question="${questionId}"]`);
             const qContainer = document.getElementById(`question-container-${questionId}`);
             if (!field || !qContainer) return;
             const statusId = `save-status-${questionId}`; const errorId = `error-${questionId}`;
             hideMessages(statusId, errorId, field); field.value = '';
             if (deleteAnswerFromStorage(currentUser.email, questionId)) { showSaveStatus(statusId, '✓ Deleted'); }
             field.classList.remove('required-field'); const p = updateSectionProgress(SECTION_ID); if (p > 0) showQuestionProgressBar(qContainer, p); else hideQuestionProgressBar(qContainer);
        }


        // --- Actions (Save/Delete Entire Tables) ---
        window.saveTableData = function(tableType) { /* ... consistent, includes progress update/show */
             const currentUser = getCurrentUser(); if (!currentUser?.email) return;
             const statusId = `save-status-${tableType}`; const errorId = `error-${tableType}`; hideMessages(statusId, errorId, null);
             let prefixes = [], namePrefix = '';
             if (tableType === 'teamRoles') { prefixes = ['member', 'role', 'strengths']; namePrefix = 'member'; }
             else if (tableType === 'teamCharter') { prefixes = ['name', 'responsibility', 'priority', 'outcome']; namePrefix = 'name'; } else return;
             let valid = true; const data = {};
             for (let i = 1; i <= 5; i++) { const rowData={}; let started=false; let complete=true; const nF=document.querySelector(`[data-question="${namePrefix}${i}"]`); if(!nF) continue; const nV=nF.value.trim(); nF.classList.remove('required-field'); rowData[`${namePrefix}${i}`]=nF.value; if(nV!=='')started=true; for(const p of prefixes){const f=document.querySelector(`[data-question="${p}${i}"]`); if(!f)continue; f.classList.remove('required-field'); rowData[`${p}${i}`]=f.value; if(started&&f.value.trim()===''){complete=false; f.classList.add('required-field');} if(f.value.trim()!==''&&!started)started=true;} if(started&&!complete)valid=false; if(started){for(const k in rowData)data[k]=rowData[k];} else {for(const p of prefixes)deleteAnswerFromStorage(currentUser.email, `${p}${i}`);} }
             if(!valid){showError(errorId,null,`Fill all fields in rows where ${namePrefix} is entered.`); return;}
             let savedOk = true; for(const qId in data){if(!saveAnswerToStorage(currentUser.email,qId,data[qId]))savedOk=false; if(data[qId]?.trim())submitToFormspree(currentUser.email,qId,data[qId]);}
             if(savedOk){showSaveStatus(statusId); const p=updateSectionProgress(SECTION_ID); const progCont=document.getElementById(`${tableType}-progress-container`); if(checkTableCompletion(tableType))showQuestionProgressBar(progCont,p); else hideQuestionProgressBar(progCont);}
         }
         window.deleteTableData = function(tableType) { /* ... consistent, includes progress update/show */
             const currentUser = getCurrentUser(); if (!currentUser?.email) return;
             const statusId = `save-status-${tableType}`; const errorId = `error-${tableType}`; hideMessages(statusId, errorId, null);
             let prefixes = []; if (tableType === 'teamRoles') prefixes = ['member', 'role', 'strengths']; else if (tableType === 'teamCharter') prefixes = ['name', 'responsibility', 'priority', 'outcome']; else return; let deleted=false;
             for(let i=1; i<=5; i++){for(const p of prefixes){const qId=`${p}${i}`; const f=document.querySelector(`[data-question="${qId}"]`); if(f){f.value=(f.tagName==='SELECT')?'':''; f.classList.remove('required-field'); if(deleteAnswerFromStorage(currentUser.email,qId))deleted=true;}}}
             if(deleted)showSaveStatus(statusId,'✓ Cleared');
             const p=updateSectionProgress(SECTION_ID); const progCont=document.getElementById(`${tableType}-progress-container`); if(checkTableCompletion(tableType))showQuestionProgressBar(progCont,p); else hideQuestionProgressBar(progCont);
         }

        // --- Formspree Submission ---
        function submitToFormspree(userEmail, questionId, answer) { /* ... consistent ... */ if(!answer?.trim()) return; if(!formspreeEndpoint) return; if(!userEmail) return; const fd=new FormData(); fd.append('email',userEmail); fd.append('page',document.title); fd.append('page_key',SECTION_ID); fd.append('question_id',questionId); fd.append('answer_text',answer); const u=getCurrentUser(); if(u?.name) fd.append('user_name',u.name); let ctx=`Q-ID: ${questionId}`; const fE=document.querySelector(`[data-question="${questionId}"]`); if(fE){const qI=fE.closest('.question-item'); const t=fE.closest('table'); const card=fE.closest('.action-card'); if(qI?.querySelector('.question-text'))ctx=qI.querySelector('.question-text').textContent.replace('*','').trim(); else if(card?.querySelector('h3'))ctx=`${card.querySelector('h3').textContent} - ${questionId}`; else if(t)ctx=`Table Field - ${questionId}`;} fd.append('question_context',ctx); fetch(formspreeEndpoint,{method:'POST',body:fd,headers:{'Accept':'application/json'}}) .then(r=>{if(r.ok)console.log(`FS OK: ${questionId}`); else{r.json().then(d=>console.error(`FS Err (${questionId}):`,d.errors?.map(e=>e.message||e.code).join(', ')||`Status ${r.status}`)).catch(()=>console.error(`FS non-JSON Err (${questionId}): Status ${r.status}`));}}) .catch(e=>console.error(`FS Network Err (${questionId}):`,e)); }

        // --- Progress Bar Functions ---
        function updateSectionProgress(sectionId) {
             const currentUser = getCurrentUser(); if (!currentUser) return 0;
             let allAnswers = {}; try { const d = localStorage.getItem(localStorageKey); if (d) allAnswers = JSON.parse(d) || {}; } catch (e) {}
             const userPageAnswers = allAnswers[currentUser.email] || {};

             const reqTextareas = document.querySelectorAll('textarea.required-answer');
             const totalTextareas = reqTextareas.length;
             let answeredTextareas = 0;
             reqTextareas.forEach(f => { if (userPageAnswers[f.dataset.question]?.trim()) answeredTextareas++; });

             const teamRolesComplete = checkTableCompletion('teamRoles') ? 1 : 0;
             const teamCharterComplete = checkTableCompletion('teamCharter') ? 1 : 0;
             const totalRequirements = totalTextareas + 2; // Textareas + 2 Tables

             const totalAnswered = answeredTextareas + teamRolesComplete + teamCharterComplete;
             const progressPercentage = totalRequirements > 0 ? Math.round((totalAnswered / totalRequirements) * 100) : 0;

             if (!currentUser.progress) currentUser.progress = {};
             currentUser.progress[sectionId] = progressPercentage;
             saveCurrentUser(currentUser);
             console.log(`Section '${sectionId}' progress: ${progressPercentage}% (${totalAnswered}/${totalRequirements})`);
             return progressPercentage;
        }

        function checkTableCompletion(tableType) {
             const currentUser = getCurrentUser(); if (!currentUser?.email) return false;
             let allAnswers = {}; try { const d = localStorage.getItem(localStorageKey); if (d) allAnswers = JSON.parse(d) || {}; } catch (e) {}
             const userPageAnswers = allAnswers[currentUser.email] || {};
             let prefixes = [], namePrefix = '';
             if (tableType === 'teamRoles') { prefixes = ['member', 'role', 'strengths']; namePrefix = 'member'; }
             else if (tableType === 'teamCharter') { prefixes = ['name', 'responsibility', 'priority', 'outcome']; namePrefix = 'name'; } else return false;

             for (let i = 1; i <= 5; i++) { // Check up to 5 rows
                 const nameVal = userPageAnswers[`${namePrefix}${i}`]?.trim();
                 if (nameVal) { // If name exists, check rest of row
                      let rowComplete = true;
                      for (const prefix of prefixes) {
                          if (!userPageAnswers[`${prefix}${i}`]?.trim()) {
                              rowComplete = false; break;
                          }
                      }
                      if (rowComplete) return true; // Found at least one complete row
                 }
             }
             return false; // No complete rows found
         }

        function showQuestionProgressBar(containerElement, percentage) { /* ... consistent ... */ if(!containerElement)return; const pC=containerElement.querySelector('.question-progress-container')||containerElement; const b=pC.querySelector('.question-progress-bar'); const t=pC.querySelector('.question-progress-text'); if(pC&&b&&t){percentage=Math.max(0,Math.min(100,Math.round(percentage))); b.style.width=`${percentage}%`; t.textContent=`${percentage}%`; pC.style.display='block';} else {console.warn("Progress elements missing in:", containerElement);} }
        function hideQuestionProgressBar(containerElement) { /* ... consistent ... */ if(!containerElement)return; const pC=containerElement.querySelector('.question-progress-container')||containerElement; if(pC) pC.style.display='none'; }

        // --- Modal Handling ---
        function showSuccessModal() { /* ... consistent ... */ const m=document.getElementById('successModal'); if(m) m.style.display='flex'; }
        function closeModal() { /* ... consistent ... */ const m=document.getElementById('successModal'); if(m) m.style.display='none'; }
        function redirectToNextPage() { /* ... consistent ... */ window.location.href = 'coaching-yourself.html'; /* UPDATE ME */ }

    </script>
</body>
</html>
